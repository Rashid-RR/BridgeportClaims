<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [FileServer].[FilesDeleteByDatePurposeDirectory]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [FileServer].[FilesDeleteByDatePurposeDirectory]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 4:58 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">[FolderEntry]</td>
        <td>17</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Subfolders AS u</td>
        <td>69</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Subfolders AS s</td>
        <td>64</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Cursors</td>
        <td colspan="1">CURSOR STATIC LOCAL
    FOR WITH     Subfolders
        AS       (SELECT e.[FolderID],
                         e.[FolderFullPathWithName]
                  FROM   [dbo].[FolderEntry] AS e
                  WHERE  e.[FolderID] = @FolderID
                         AND e.[Bus_No] = @Bus_no
                  UNION ALL
                  SELECT f.[FolderID],
                         f.[FolderFullPathWithName]
                  FROM   [dbo].[FolderEntry] AS f
                         INNER JOIN
                         Subfolders AS s
                         ON s.[FolderID] = f.[ParentFolderID])
        SELECT   [dbo].[CombinePath](u.[FolderFullPathWithName], i.[FileNameNoPath]) AS FileNameWithPath,
                 i.[Protection]
        FROM     Subfolders AS u
                 INNER JOIN
                 [dbo].[FileEntry] AS i
                 ON i.FolderID = u.FolderID
                 INNER JOIN
                 [dbo].[FilePurpose] AS p
                 ON p.FilePurposeID = i.FilePurposeID
        WHERE    i.FileState = 1
                 AND (@FilePurposeType IS NULL
                      OR @FilePurposeType = p.FilePurposeID)
                 AND (@DateStart IS NULL
                      OR @DateEnd IS NULL
                      OR (i.Created BETWEEN @DateStart AND @DateEnd))
        ORDER BY FileNameNoPath ASC</td>
        <td>51</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">WITH clause</td>
        <td colspan="1">WITH Subfolders
AS (SELECT e.[FolderID],
           e.[FolderFullPathWithName]
    FROM   [dbo].[FolderEntry] AS e
    WHERE  e.[FolderID] = @FolderID
           AND e.[Bus_No] = @Bus_no
    UNION ALL
    SELECT f.[FolderID],
           f.[FolderFullPathWithName]
    FROM   [dbo].[FolderEntry] AS f
           INNER JOIN
           Subfolders AS s
           ON s.[FolderID] = f.[ParentFolderID])</td>
        <td>51</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1"> Subfolders
AS (SELECT e.[FolderID],
           e.[FolderFullPathWithName]
    FROM   [dbo].[FolderEntry] AS e
    WHERE  e.[FolderID] = @FolderID
           AND e.[Bus_No] = @Bus_no
    UNION ALL
    SELECT f.[FolderID],
           f.[FolderFullPathWithName]
    FROM   [dbo].[FolderEntry] AS f
           INNER JOIN
           Subfolders AS s
           ON s.[FolderID] = f.[ParentFolderID])</td>
        <td>51</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">FETCH CURSOR</td>
        <td colspan="1">FETCH NEXT FROM FileCursor INTO @FileNameWithPath, @Protection</td>
        <td>78</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">FETCH NEXT FROM FileCursor INTO @FileNameWithPath, @Protection</td>
        <td>105</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">@@fetch_status</td>
        <td colspan="1">@@FETCH_STATUS</td>
        <td>80</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Three-part names</td>
        <td colspan="1">[msdb].[dbo].[sp_send_dbmail]</td>
        <td>126</td>
      </tr>
    </table>
  </body>
</html>