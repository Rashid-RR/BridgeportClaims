<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [FileServer].[ReclaimExpiredFiles]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [FileServer].[ReclaimExpiredFiles]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 4:58 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT f.FileEntryID
INTO   #tmpPendingReclaim
FROM   dbo.FileEntry AS f
WHERE  f.RefCount = 0
       AND f.DeleteTime &gt; 0
       AND f.DeleteTime &lt; GetUTCDate()
       AND f.FileState = 1</td>
        <td>17</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   TOP 100 cf.CloudFileEntryID,
                 cf.Bus_No,
                 cf.CloudLocation
INTO     #tmpPendingToSendToDelete
FROM     dbo.CloudFileEntry AS cf
         INNER JOIN
         dbo.BusUnitsSupportingCloudStorage AS b
         ON (b.BusNo = cf.Bus_No)
WHERE    cf.RefCount = 0
         AND cf.DeleteTime &gt; 0
         AND cf.DeleteTime &lt; GetUTCDate()
         AND cf.FileState IN (1, 4)
ORDER BY cf.DeleteTime ASC</td>
        <td>145</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">f</td>
        <td>27</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tmpPendingReclaim AS r</td>
        <td>29</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tmpReuse</td>
        <td>52</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">f</td>
        <td>61</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tmpReuse AS r</td>
        <td>65</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tmpPendingToSendToDelete</td>
        <td>162</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">EXECUTE SendMessage 'delete:Cloudfile', @message</td>
        <td>174</td>
      </tr>
      <tr valign="top">
        <td colspan="1">UPDATE with FROM clause</td>
        <td colspan="1">
FROM #tmpPendingReclaim AS r
     INNER JOIN
     dbo.FileEntry AS f
     ON r.FileEntryID = f.FileEntryID</td>
        <td>29</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #tmpReuse AS r
     INNER JOIN
     dbo.FileEntry AS f
     ON f.FileEntryID = r.FileEntryID</td>
        <td>65</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Cursors</td>
        <td colspan="1">CURSOR STATIC LOCAL
    FOR SELECT   FolderID,
                 bus_no,
                 FolderFullPathWithName,
                 AuthorID
        FROM     dbo.FolderEntry AS f
        WHERE    f.IsDeleted = 1
                 AND f.DeleteTime &lt;= DateAdd(day, -1, GetUTCDate())
        ORDER BY Len(FolderFullPathWithName) DESC</td>
        <td>89</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CURSOR FAST_FORWARD
    FOR SELECT CloudFileEntryID,
               Bus_No,
               CloudLocation
        FROM   #tmpPendingToSendToDelete</td>
        <td>161</td>
      </tr>
      <tr valign="top">
        <td colspan="1">FETCH CURSOR</td>
        <td colspan="1">FETCH NEXT FROM FolderCursor INTO @FolderID, @bus_no, @FolderFullPathWithName, @AuthorID</td>
        <td>100</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">FETCH NEXT FROM FolderCursor INTO @FolderID, @bus_no, @FolderFullPathWithName, @AuthorID</td>
        <td>133</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">FETCH NEXT FROM CursorToGetCloudFileEntryRow</td>
        <td>166</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">FETCH NEXT FROM CursorToGetCloudFileEntryRow INTO @CloudFileEntryID, @Bus_No_CloudFileEntry, @CloudLocation</td>
        <td>176</td>
      </tr>
      <tr valign="top">
        <td colspan="1">@@fetch_status</td>
        <td colspan="1">@@Fetch_Status</td>
        <td>104</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@@FETCH_STATUS</td>
        <td>168</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT *
 FROM   dbo.FileEntry
 WHERE  FileState = 1
        AND FolderID = @FolderID)</td>
        <td>123</td>
      </tr>
    </table>
  </body>
</html>