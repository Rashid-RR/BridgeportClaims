<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [FileServer].[GetNewQueueItems]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [FileServer].[GetNewQueueItems]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 4:57 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT *
 FROM   dbo.DistributionQueue AS e
 WHERE  e.DistributionEdgeID = @DistributionEdgeID
        AND e.Loaded = 0
        AND GETDATE() &gt;= e.TimeToTransfer)</td>
        <td>5</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   q.Bus_No,
         q.FileNameWithPath,
         Max(OpSequenceNo) AS OpSequenceNo
INTO     #ConsolidateFTP
FROM     dbo.DistributionQueue AS q
WHERE    q.Command = 'FILEPUT'
         AND q.DistributionEdgeID = @DistributionEdgeID
         AND q.Loaded = 0
GROUP BY q.Bus_No, q.FileNameWithPath
HAVING   Count(*) &gt; 1</td>
        <td>28</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT DistributionQueueID
INTO   #DistributionQueueItemsToFinish
FROM   #ConsolidateFTP AS c
       INNER JOIN
       dbo.DistributionQueue AS q
       ON q.DistributionEdgeID = @DistributionEdgeID
          AND q.Command = 'FILEPUT'
          AND q.Loaded = 0
          AND q.bus_no = c.bus_no
          AND q.FileNameWithPath = c.FileNameWithPath
          AND q.OpSequenceNo &lt; c.OpSequenceNo</td>
        <td>40</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#ConsolidateFTP AS c</td>
        <td>42</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#DistributionQueueItemsToFinish AS d</td>
        <td>53</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tmpID</td>
        <td>78</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tmpID AS t</td>
        <td>180</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">q</td>
        <td>200</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tmpID AS t</td>
        <td>202</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Cursors</td>
        <td colspan="1">CURSOR STATIC LOCAL
    FOR SELECT d.DistributionQueueID
        FROM   #DistributionQueueItemsToFinish AS d
               INNER JOIN
               dbo.DistributionQueue AS q
               ON q.DistributionQueueID = d.DistributionQueueID
                  AND q.Loaded = 0</td>
        <td>52</td>
      </tr>
      <tr valign="top">
        <td colspan="1">FETCH CURSOR</td>
        <td colspan="1">FETCH NEXT FROM FTPConsolidateCursor INTO @DistributionQueueID</td>
        <td>58</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">FETCH NEXT FROM FTPConsolidateCursor INTO @DistributionQueueID</td>
        <td>64</td>
      </tr>
      <tr valign="top">
        <td colspan="1">@@fetch_status</td>
        <td colspan="1">@@Fetch_Status</td>
        <td>60</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN @ProtocolID = 2 THEN 1 WHEN fp.FilePurposeTypeID IS NULL THEN 1 WHEN fp.FilePurposeTypeID IN (1, 12) THEN 100 ELSE 1 END</td>
        <td>85</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @ProtocolID = 2 THEN 1 WHEN fp.FilePurposeTypeID IS NULL THEN 1 WHEN fp.FilePurposeTypeID IN (1, 12) THEN 100 ELSE 1 END</td>
        <td>190</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE ISNULL(st.AutoGenerateSubFoldersOnTargetFTPFolder, 0) WHEN 0 THEN CASE ISNULL(st.OverrideDistributionTargetFTPFolder, 0) WHEN 0 THEN ISNULL(q.Folder, dt.FTP_Folder) WHEN 1 THEN ISNULL(q.Folder, st.FTPFolder) END WHEN 1 THEN CASE ISNULL(st.OverrideDistributionTargetFTPFolder, 0) WHEN 0 THEN ISNULL(q.Folder, CASE WHEN ISNULL(dt.FTP_Folder, '') = '' THEN '' ELSE dt.FTP_Folder + '/' END + CASE WHEN ISNULL(fe.FolderFullPathWithName, '') = '' THEN CASE WHEN cfe.FolderFullPathWithName = 'CallLog' THEN '' WHEN cfe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(cfe.FolderFullPathWithName, 9, LEN(cfe.FolderFullPathWithName)) ELSE cfe.FolderFullPathWithName END ELSE CASE WHEN fe.FolderFullPathWithName = 'CallLog' THEN '' WHEN fe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(fe.FolderFullPathWithName, 9, LEN(fe.FolderFullPathWithName)) ELSE fe.FolderFullPathWithName END END) WHEN 1 THEN ISNULL(q.Folder, CASE WHEN ISNULL(st.FTPFolder, '') = '' THEN '' ELSE st.FTPFolder + '/' END + CASE WHEN ISNULL(fe.FolderFullPathWithName, '') = '' THEN CASE WHEN cfe.FolderFullPathWithName = 'CallLog' THEN '' WHEN cfe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(cfe.FolderFullPathWithName, 9, LEN(cfe.FolderFullPathWithName)) ELSE cfe.FolderFullPathWithName END ELSE CASE WHEN fe.FolderFullPathWithName = 'CallLog' THEN '' WHEN fe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(fe.FolderFullPathWithName, 9, LEN(fe.FolderFullPathWithName)) ELSE fe.FolderFullPathWithName END END) END END</td>
        <td>123</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE ISNULL(st.OverrideDistributionTargetFTPFolder, 0) WHEN 0 THEN ISNULL(q.Folder, dt.FTP_Folder) WHEN 1 THEN ISNULL(q.Folder, st.FTPFolder) END</td>
        <td>124</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE ISNULL(st.OverrideDistributionTargetFTPFolder, 0) WHEN 0 THEN ISNULL(q.Folder, CASE WHEN ISNULL(dt.FTP_Folder, '') = '' THEN '' ELSE dt.FTP_Folder + '/' END + CASE WHEN ISNULL(fe.FolderFullPathWithName, '') = '' THEN CASE WHEN cfe.FolderFullPathWithName = 'CallLog' THEN '' WHEN cfe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(cfe.FolderFullPathWithName, 9, LEN(cfe.FolderFullPathWithName)) ELSE cfe.FolderFullPathWithName END ELSE CASE WHEN fe.FolderFullPathWithName = 'CallLog' THEN '' WHEN fe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(fe.FolderFullPathWithName, 9, LEN(fe.FolderFullPathWithName)) ELSE fe.FolderFullPathWithName END END) WHEN 1 THEN ISNULL(q.Folder, CASE WHEN ISNULL(st.FTPFolder, '') = '' THEN '' ELSE st.FTPFolder + '/' END + CASE WHEN ISNULL(fe.FolderFullPathWithName, '') = '' THEN CASE WHEN cfe.FolderFullPathWithName = 'CallLog' THEN '' WHEN cfe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(cfe.FolderFullPathWithName, 9, LEN(cfe.FolderFullPathWithName)) ELSE cfe.FolderFullPathWithName END ELSE CASE WHEN fe.FolderFullPathWithName = 'CallLog' THEN '' WHEN fe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(fe.FolderFullPathWithName, 9, LEN(fe.FolderFullPathWithName)) ELSE fe.FolderFullPathWithName END END) END</td>
        <td>128</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ISNULL(dt.FTP_Folder, '') = '' THEN '' ELSE dt.FTP_Folder + '/' END</td>
        <td>130</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ISNULL(fe.FolderFullPathWithName, '') = '' THEN CASE WHEN cfe.FolderFullPathWithName = 'CallLog' THEN '' WHEN cfe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(cfe.FolderFullPathWithName, 9, LEN(cfe.FolderFullPathWithName)) ELSE cfe.FolderFullPathWithName END ELSE CASE WHEN fe.FolderFullPathWithName = 'CallLog' THEN '' WHEN fe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(fe.FolderFullPathWithName, 9, LEN(fe.FolderFullPathWithName)) ELSE fe.FolderFullPathWithName END END</td>
        <td>134</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cfe.FolderFullPathWithName = 'CallLog' THEN '' WHEN cfe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(cfe.FolderFullPathWithName, 9, LEN(cfe.FolderFullPathWithName)) ELSE cfe.FolderFullPathWithName END</td>
        <td>135</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN fe.FolderFullPathWithName = 'CallLog' THEN '' WHEN fe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(fe.FolderFullPathWithName, 9, LEN(fe.FolderFullPathWithName)) ELSE fe.FolderFullPathWithName END</td>
        <td>140</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ISNULL(st.FTPFolder, '') = '' THEN '' ELSE st.FTPFolder + '/' END</td>
        <td>147</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ISNULL(fe.FolderFullPathWithName, '') = '' THEN CASE WHEN cfe.FolderFullPathWithName = 'CallLog' THEN '' WHEN cfe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(cfe.FolderFullPathWithName, 9, LEN(cfe.FolderFullPathWithName)) ELSE cfe.FolderFullPathWithName END ELSE CASE WHEN fe.FolderFullPathWithName = 'CallLog' THEN '' WHEN fe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(fe.FolderFullPathWithName, 9, LEN(fe.FolderFullPathWithName)) ELSE fe.FolderFullPathWithName END END</td>
        <td>151</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cfe.FolderFullPathWithName = 'CallLog' THEN '' WHEN cfe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(cfe.FolderFullPathWithName, 9, LEN(cfe.FolderFullPathWithName)) ELSE cfe.FolderFullPathWithName END</td>
        <td>152</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN fe.FolderFullPathWithName = 'CallLog' THEN '' WHEN fe.FolderFullPathWithName LIKE 'CallLog\%' THEN SUBSTRING(fe.FolderFullPathWithName, 9, LEN(fe.FolderFullPathWithName)) ELSE fe.FolderFullPathWithName END</td>
        <td>157</td>
      </tr>
      <tr valign="top">
        <td colspan="1">LIKE</td>
        <td colspan="1">cfe.FolderFullPathWithName LIKE 'CallLog\%'</td>
        <td>136</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">fe.FolderFullPathWithName LIKE 'CallLog\%'</td>
        <td>141</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">cfe.FolderFullPathWithName LIKE 'CallLog\%'</td>
        <td>153</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">fe.FolderFullPathWithName LIKE 'CallLog\%'</td>
        <td>158</td>
      </tr>
      <tr valign="top">
        <td colspan="1">MAXDOP</td>
        <td colspan="1">MAXDOP 1</td>
        <td>196</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">UPDATE with FROM clause</td>
        <td colspan="1">
FROM #tmpID AS t
     INNER JOIN
     dbo.DistributionQueue AS q
     ON q.DistributionQueueID = t.DistributionQueueID</td>
        <td>202</td>
      </tr>
    </table>
  </body>
</html>