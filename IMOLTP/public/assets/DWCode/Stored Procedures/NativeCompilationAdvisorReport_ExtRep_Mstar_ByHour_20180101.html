<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_Mstar_ByHour]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_Mstar_ByHour]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT h.Agent_Session_ID,
       d.StateIndex,
       h.agent_no,
       h.team_no,
       h.bus_no,
       d.start_date,
       d.working,
       d.available,
       d.outstate_code,
       s.duration,
       d.log_state,
       d.skill_no,
       (CASE WHEN d.working IN (1, 2, 3, 4) THEN d.working WHEN d.working = 0 THEN (CASE WHEN d.available = 1 THEN d.working WHEN (d.outstate_code &gt; -1)
                                                                                                                                  AND (d.outstate_code &lt; 10) THEN 3 ELSE d.outstate_code END) END) AS State_Code
INTO   #Agent_Log
FROM   dbo.Agent_Log_Header AS h
       LEFT OUTER JOIN
       dbo.Agent_Log_Detail AS d
       ON d.Agent_Session_ID = h.Agent_Session_ID
       LEFT OUTER JOIN
       dbo.Agent_Log_Detail_Summary AS s
       ON s.Agent_Session_ID = d.Agent_Session_ID
          AND s.StateIndex = d.StateIndex
WHERE  h.bus_no = @Bus_no
       AND h.start_date BETWEEN @Start_date AND @End_date</td>
        <td>8</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   COUNT(H.Contact_ID) AS Total_Contacts,
         SUM(CASE WHEN sk.outbound_skill = 0 THEN 1 ELSE 0 END) AS IB_Calls,
         SUM(CASE WHEN sk.outbound_skill = 1 THEN 1 ELSE 0 END) AS OB_Calls,
         MIN(CASE WHEN s.InQueue_Time &gt; 0 THEN S.InQueue_Time / 1000 ELSE NULL END) AS Min_Q,
         MAX(CASE WHEN s.InQueue_Time &gt; 0 THEN S.InQueue_Time / 1000 ELSE NULL END) AS Max_Q,
         AVG(CASE WHEN s.InQueue_Time &gt; 0 THEN S.InQueue_Time / 1000 ELSE NULL END) AS Avg_Q,
         SUM(CASE WHEN F.Abandon = 'Y' THEN 1 ELSE 0 END) AS Abandons,
         AVG(CASE WHEN F.Abandon = 'Y' THEN S.Abandon_Time / 1000 ELSE NULL END) AS Abandon_Time,
         CONVERT (NVARCHAR (13), h.start_date, 121) AS Date_Hour,
         sk.Skill_name AS Skill_Name,
         sk.Skill_No AS Skill_no
INTO     #tmp1
FROM     dbo.Contact_Log_header AS H
         INNER JOIN
         dbo.Contact_Log_Footer AS F
         ON H.Contact_ID = F.Contact_ID
         INNER JOIN
         dbo.Contact_Log_Summary AS S
         ON H.Contact_ID = S.Contact_ID
         INNER JOIN
         dbo.Skills AS sk
         ON F.skill_no = sk.skill_no
WHERE    h.bus_no = @Bus_no
         AND h.start_date BETWEEN @start_date AND @end_date
         AND sk.media_type = 4
GROUP BY CONVERT (NVARCHAR (13), h.start_date, 121), sk.Skill_Name, sk.Skill_No</td>
        <td>35</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   COUNT(DISTINCT a.agent_no) AS Agent_Cnt,
         CONVERT (NVARCHAR (13), a.start_date, 121) AS Date_Hour,
         s.Skill_No AS Skill_No
INTO     #tmp2
FROM     #Agent_Log AS a
         INNER JOIN
         dbo.AgentSkl AS s
         ON A.Agent_no = s.Agent_No
            AND s.Status = 'CURR'
WHERE    a.bus_no = @Bus_No
         AND a.start_date BETWEEN @start_date AND @END_date
GROUP BY CONVERT (NVARCHAR (13), a.start_date, 121), S.Skill_no</td>
        <td>72</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN d.working IN (1, 2, 3, 4) THEN d.working WHEN d.working = 0 THEN (CASE WHEN d.available = 1 THEN d.working WHEN (d.outstate_code &gt; -1)
                                                                                                                          AND (d.outstate_code &lt; 10) THEN 3 ELSE d.outstate_code END) END</td>
        <td>20</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN d.available = 1 THEN d.working WHEN (d.outstate_code &gt; -1)
                                              AND (d.outstate_code &lt; 10) THEN 3 ELSE d.outstate_code END</td>
        <td>21</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN sk.outbound_skill = 0 THEN 1 ELSE 0 END</td>
        <td>36</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN sk.outbound_skill = 1 THEN 1 ELSE 0 END</td>
        <td>39</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.InQueue_Time &gt; 0 THEN S.InQueue_Time / 1000 ELSE NULL END</td>
        <td>42</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.InQueue_Time &gt; 0 THEN S.InQueue_Time / 1000 ELSE NULL END</td>
        <td>45</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.InQueue_Time &gt; 0 THEN S.InQueue_Time / 1000 ELSE NULL END</td>
        <td>48</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN F.Abandon = 'Y' THEN 1 ELSE 0 END</td>
        <td>51</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN F.Abandon = 'Y' THEN S.Abandon_Time / 1000 ELSE NULL END</td>
        <td>54</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT a.agent_no)</td>
        <td>72</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#Agent_Log AS a</td>
        <td>76</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tmp1 AS a</td>
        <td>97</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tmp2 AS b</td>
        <td>98</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">MAXDOP</td>
        <td colspan="1">MAXDOP 2</td>
        <td>102</td>
      </tr>
    </table>
  </body>
</html>