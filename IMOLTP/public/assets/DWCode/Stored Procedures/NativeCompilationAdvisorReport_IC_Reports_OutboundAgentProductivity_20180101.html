<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_OutboundAgentProductivity]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_OutboundAgentProductivity]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:12 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #CampaignList
FROM   dbo.fn_SplitOptionalInt(@CampaignList)</td>
        <td>49</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #TeamNoList
FROM   dbo.fn_SplitOptionalInt(@TeamNoList)</td>
        <td>55</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #AgentNoList
FROM   dbo.fn_SplitOptionalInt(@AgentNoList)</td>
        <td>61</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #SkillNoList
FROM   dbo.fn_SplitOptionalInt(@SkillNoList)</td>
        <td>67</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #OutstatesList
FROM   dbo.fn_SplitOptionalInt(@OutstatesList)</td>
        <td>73</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #OutboundStrategyList
FROM   dbo.fn_SplitOptionalInt(@OutboundStrategyList)</td>
        <td>79</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT T.Team_Name AS Team_Name,
                T.Team_no AS Team_ID,
                A.Agent_No AS Agent_No,
                A.first_name AS Agent_First_Name,
                A.last_name AS Agent_Last_Name
INTO   #AgentTable
FROM   [dbo].[Agents] AS A
       INNER JOIN
       [dbo].[Team] AS T
       ON T.Team_No = A.Team_No
       INNER JOIN
       [dbo].[AgentSkl] AS ASKL
       ON A.Agent_No = ASKL.Agent_No
          AND ASKL.Status = 'CURR'
       INNER JOIN
       [dbo].[Skills] AS SKL
       ON ASKL.Skill_No = SKL.Skill_No
       INNER JOIN
       [dbo].[Campaign] AS C
       ON C.Campaign_No = SKL.Campaign_No
       INNER JOIN
       dbo.Security_DataRoles AS dr
       ON (a.Team_No = dr.EntityID
           OR dr.ViewAllAndFuture = 1)
       INNER JOIN
       dbo.Security_DataRoleEntityTypes AS dret
       ON (dr.DataRoleEntityTypeID = dret.DataRoleEntityTypeID)
       INNER JOIN
       #TeamNoList AS TList
       ON A.Team_No BETWEEN TList.IDMin AND TList.IDMax
       INNER JOIN
       #AgentNoList AS AList
       ON A.Agent_No BETWEEN AList.IDMin AND AList.IDMax
       INNER JOIN
       #SkillNoList AS SklList
       ON ASKL.Skill_No BETWEEN SklList.IDMin AND SklList.IDMax
       INNER JOIN
       #CampaignList AS CampaignList
       ON c.Campaign_no BETWEEN CampaignList.IDMin AND CampaignList.IDMax
WHERE  A.Bus_No = @Bus_No
       AND dret.DataRoleEntityTypeName = 'teams'
       AND dr.SecurityProfileID = @ProfileID
       AND (T.Status = 'CURR'
            OR @ActiveTeamOnly &lt;&gt; 1)
       AND (A.Status = 'CURR'
            OR @ActiveAgentOnly &lt;&gt; 1)
       AND (SKL.Status = 'CURR'
            OR @ActiveSkillOnly &lt;&gt; 1)</td>
        <td>84</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT ALD.Agent_No AS Agent_No,
       ALD.AgentStateID AS AgentStateID,
       s.Campaign_No AS Campaign_No,
       ALD.Skill_No AS Skill_No,
       CASE WHEN ALD.Outstate_Code = 0 THEN -1 ELSE ALD.Outstate_Code END AS Outstate_Code,
       ALD.Duration AS Duration,
       ALD.Contact_Id AS Contact_Id,
       OS.IsACW AS IsACW
INTO   #AgentLogDetail
FROM   [dbo].[Agent_Log_DetailQV] AS ALD
       INNER JOIN
       #AgentTable AS AT
       ON ALD.Agent_No = AT.Agent_No
       LEFT OUTER JOIN
       [dbo].Outstates AS OS
       ON ALD.Outstate_Code = OS.Outstate_Code
       LEFT OUTER JOIN
       [dbo].[Skills] AS s
       ON ALD.Skill_No = s.Skill_No
WHERE  ALD.Bus_No = @Bus_No
       AND (ALD.StartDate BETWEEN @Start_Date AND @End_Date)
       AND (ALD.Outstate_Code = -13
            OR ALD.Outstate_Code = -4
            OR ALD.AgentStateID = 2
            OR ALD.AgentStateID = 4
            OR (ALD.Outstate_Code &gt; 0
                AND OS.IsACW = 'T'))</td>
        <td>115</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT cld.Contact_ID AS Contact_ID,
                cld.Agent_No AS Agent_No,
                sk.Campaign_no,
                sk.Skill_No,
                cldis.Disposition_Code,
                cldis.Start_Date AS DispositionDate,
                dis.DispositionClassificationID,
                discls.DispositionClassificationTypeID,
                discls.ReportingGroupID,
                amnt.CommitmentAmount
INTO   #ContactLogHeader
FROM   #AgentTable AS AT
       INNER JOIN
       [dbo].[Contact_Log_DetailQV] AS cld
       ON CLD.Agent_No = AT.Agent_No
       INNER JOIN
       dbo.skills AS sk
       ON CLD.Skill_no = sk.skill_no
       INNER JOIN
       #SkillNoList AS SklList
       ON sk.Skill_No BETWEEN SklList.IDMin AND SklList.IDMax
       INNER JOIN
       #CampaignList AS CampaignList
       ON sk.Campaign_no BETWEEN CampaignList.IDMin AND CampaignList.IDMax
       INNER JOIN
       #OutboundStrategyList AS OSList
       ON 4 BETWEEN OSList.IDMin AND OSList.IDMax
       LEFT OUTER JOIN
       [dbo].[Contact_Log_Dispositions] AS cldis
       ON cldis.Contact_ID = cld.Contact_Id
          AND cldis.Agent_No = cld.Agent_No
       LEFT OUTER JOIN
       [dbo].[Dispositions] AS dis
       ON cldis.Disposition_Code = dis.Disposition_Code
       LEFT OUTER JOIN
       [dbo].[DispositionClassifications] AS discls
       ON dis.DispositionClassificationID = discls.DispositionClassificationID
       LEFT OUTER JOIN
       [dbo].[ReportingGroups_VW] AS ReportingGroups
       ON discls.ReportingGroupID = ReportingGroups.ReportingGroupID
       LEFT OUTER JOIN
       [dbo].[PositiveDispositions] AS amnt
       ON cld.contact_id = amnt.contact_id
WHERE  cld.Bus_No = @Bus_No
       AND (cld.StartDate BETWEEN @Start_Date AND @End_Date)
       AND cld.Direction = 2
       AND NOT cld.Agent_No IS NULL
OPTION (FORCE ORDER)</td>
        <td>144</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   ALD.Agent_No,
         SUM(CASE WHEN ALD.Outstate_Code = -4 THEN ALD.Duration ELSE 0 END) AS [Wait_Time],
         SUM(CASE WHEN ALD.Outstate_Code = -13 THEN ALD.Duration ELSE 0 END) AS [Preview_Time]
INTO     #AgentMetricsUnavailable
FROM     #AgentLogDetail AS ALD
         INNER JOIN
         #SkillNoList AS skl
         ON ALD.Skill_No BETWEEN skl.IDMin AND skl.IDMax
         INNER JOIN
         #CampaignList AS cl
         ON ALD.Campaign_No BETWEEN cl.IDMin AND cl.IDMax
GROUP BY ALD.Agent_No</td>
        <td>178</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   ALD.Agent_No,
         SUM(ALD.Duration) AS [ACW_Time]
INTO     #ACWTime
FROM     #AgentLogDetail AS ALD
         INNER JOIN
         #SkillNoList AS skl
         ON ALD.Skill_No BETWEEN skl.IDMin AND skl.IDMax
         INNER JOIN
         #CampaignList AS cl
         ON ALD.Campaign_No BETWEEN cl.IDMin AND cl.IDMax
WHERE    ALD.Outstate_Code &gt; 0
         AND ALD.IsACW = 'T'
GROUP BY ALD.Agent_No</td>
        <td>191</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   ALD.Agent_No,
         SUM(ALD.Duration) AS [OB_Talk_Time],
         MAX(ALD.Duration) AS [Longest_Talk_Time]
INTO     #AgentMetricsActive
FROM     #AgentLogDetail AS ALD
         INNER JOIN
         #SkillNoList AS SkillList
         ON ALD.skill_no BETWEEN SkillList.IDMin AND SkillList.IDMax
         INNER JOIN
         #CampaignList AS CampaignList
         ON ALD.Campaign_no BETWEEN CampaignList.IDMin AND CampaignList.IDMax
WHERE    ALD.AgentStateID = 4
GROUP BY ALD.Agent_No</td>
        <td>205</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   ALD.Agent_No,
         SUM(ALD.Duration) AS [Unavailable_Time]
INTO     #UnavailableTime
FROM     #AgentLogDetail AS ALD
         INNER JOIN
         [dbo].Outstates AS OS
         ON ALD.Outstate_Code = OS.Outstate_Code
         INNER JOIN
         #OutstatesList AS OSList
         ON OS.Outstate_Code BETWEEN OSList.IDMin AND OSList.IDMax
WHERE    (ALD.AgentStateID = 2)
         AND OS.IsACW = 'F'
GROUP BY ALD.Agent_No</td>
        <td>219</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   CLH.Agent_No AS Agent_No,
         SUM(CASE WHEN CLH.ReportingGroupID IS NULL
                       AND NOT CLH.Contact_ID IS NULL THEN 1 ELSE 0 END) AS [UnClassified],
         COUNT(*) AS [OB_Handled],
         0 AS [Preview_Rejects]
INTO     #OBHandled
FROM     #ContactLogHeader AS CLH
         INNER JOIN
         [dbo].[Contact_Log_DetailQV] AS CLD
         ON CLD.Contact_ID = CLH.Contact_ID
WHERE    CLD.StartDate BETWEEN @start_date AND @end_date
         AND CLD.Contact_State = 4
GROUP BY CLH.Agent_No</td>
        <td>236</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   CLH.Agent_No AS Agent_No,
         0 AS [UnClassified],
         COUNT(*) AS [OB_Handled],
         SUM(CASE WHEN CEL.ContactEventID = 4 THEN 1 ELSE 0 END) AS [Preview_Rejects]
INTO     #OBHandledPreview
FROM     #ContactLogHeader AS CLH
         INNER JOIN
         [dbo].[Contact_Log_DetailQV] AS CLD
         ON CLD.Contact_ID = CLH.Contact_ID
         LEFT OUTER JOIN
         [dbo].[ContactEventLog] AS CEL
         ON CEL.Contact_ID = CLD.Contact_ID
            AND CLD.Contact_State = 25
WHERE    CLD.StartDate BETWEEN @start_date AND @end_date
         AND CLD.Contact_State = 25
GROUP BY CLH.Agent_No</td>
        <td>249</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   CLH.Agent_No,
         SUM(CASE WHEN CLH.ReportingGroupID = 1 THEN 1 ELSE 0 END) AS [Positive_Outcomes],
         SUM(CASE WHEN CLH.ReportingGroupID = 2 THEN 1 ELSE 0 END) AS [Negative_Outcomes],
         SUM(CASE WHEN CLH.ReportingGroupID = 3 THEN 1 ELSE 0 END) AS [Other_Completes],
         SUM(CASE WHEN CLH.ReportingGroupID = 4 THEN 1 ELSE 0 END) AS [Agent_Retries],
         SUM(CASE WHEN CLH.CommitmentAmount &gt; 0 THEN CLH.CommitmentAmount ELSE 0 END) AS [Total_Commitment_Amount]
INTO     #ContactMetrics
FROM     #ContactLogHeader AS CLH
GROUP BY CLH.Agent_No</td>
        <td>285</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   ALD.Agent_No,
         SUM(CASE WHEN CLH.ReportingGroupID = 1 THEN ALD.Duration ELSE 0 END) AS OB_Talk_Time_Positive,
         SUM(CASE WHEN CLH.ReportingGroupID = 2 THEN ALD.Duration ELSE 0 END) AS OB_Talk_Time_Negative,
         SUM(CASE WHEN CLH.ReportingGroupID = 3 THEN ALD.Duration ELSE 0 END) AS OB_Talk_Time_Others,
         SUM(CASE WHEN CLH.ReportingGroupID = 4 THEN ALD.Duration ELSE 0 END) AS OB_Talk_Time_Retries
INTO     #TimeMetrics
FROM     #AgentLogDetail AS ALD
         INNER JOIN
         #ContactLogHeader AS CLH
         ON ALD.Contact_Id = CLH.Contact_ID
WHERE    NOT CLH.ReportingGroupID IS NULL
         AND ALD.AgentStateID = 4
GROUP BY ALD.Agent_No</td>
        <td>298</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT AGNT.Agent_No,
       ISNULL([Preview_Time], 0) + ISNULL([Wait_Time], 0) + ISNULL([Unavailable_Time], 0) + ISNULL([OB_Talk_Time], 0) + ISNULL([ACW_Time], 0) AS [Skill_Time]
INTO   #SkillTime
FROM   #AgentTable AS AGNT
       LEFT OUTER JOIN
       #UnavailableTime AS UT
       ON UT.Agent_No = AGNT.Agent_No
       LEFT OUTER JOIN
       #AgentMetricsUnavailable AS AMU
       ON AMU.Agent_no = AGNT.Agent_No
       LEFT OUTER JOIN
       #AgentMetricsActive AS AMA
       ON AMA.Agent_no = AGNT.Agent_No
       LEFT OUTER JOIN
       #ACWTime AS ACW
       ON ACW.Agent_no = AGNT.Agent_No
WHERE  AMU.Agent_No IS NOT NULL
       OR AMA.Agent_No IS NOT NULL
       OR UT.Agent_No IS NOT NULL
       OR ACW.Agent_No IS NOT NULL</td>
        <td>314</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@CampaignList)</td>
        <td>52</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@TeamNoList)</td>
        <td>58</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@AgentNoList)</td>
        <td>64</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@SkillNoList)</td>
        <td>70</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@OutstatesList)</td>
        <td>76</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@OutboundStrategyList)</td>
        <td>82</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#TeamNoList AS TList</td>
        <td>100</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentNoList AS AList</td>
        <td>101</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#SkillNoList AS SklList</td>
        <td>102</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#CampaignList AS CampaignList</td>
        <td>103</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS AT</td>
        <td>127</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS AT</td>
        <td>156</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#SkillNoList AS SklList</td>
        <td>159</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#CampaignList AS CampaignList</td>
        <td>160</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#OutboundStrategyList AS OSList</td>
        <td>161</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogDetail AS ALD</td>
        <td>184</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#SkillNoList AS skl</td>
        <td>185</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#CampaignList AS cl</td>
        <td>186</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogDetail AS ALD</td>
        <td>196</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#SkillNoList AS skl</td>
        <td>197</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#CampaignList AS cl</td>
        <td>198</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogDetail AS ALD</td>
        <td>211</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#SkillNoList AS SkillList</td>
        <td>212</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#CampaignList AS CampaignList</td>
        <td>213</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogDetail AS ALD</td>
        <td>224</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#OutstatesList AS OSList</td>
        <td>226</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS CLH</td>
        <td>242</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS CLH</td>
        <td>255</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#OBHandled</td>
        <td>264</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#OBHandledPreview AS OBP</td>
        <td>266</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#OBHandled</td>
        <td>270</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#OBHandledPreview AS OBP</td>
        <td>276</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#OBHandled AS OB</td>
        <td>277</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS CLH</td>
        <td>293</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogDetail AS ALD</td>
        <td>305</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS CLH</td>
        <td>306</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS AGNT</td>
        <td>317</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#UnavailableTime AS UT</td>
        <td>318</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentMetricsUnavailable AS AMU</td>
        <td>319</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentMetricsActive AS AMA</td>
        <td>320</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ACWTime AS ACW</td>
        <td>321</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS AGNT</td>
        <td>396</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactMetrics AS CM</td>
        <td>397</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#OBHandled AS OH</td>
        <td>398</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#TimeMetrics AS TM</td>
        <td>399</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#UnavailableTime AS UT</td>
        <td>400</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#SkillTime AS ST</td>
        <td>401</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentMetricsUnavailable AS AMU</td>
        <td>402</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentMetricsActive AS AMA</td>
        <td>403</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ACWTime AS ACW</td>
        <td>404</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN ALD.Outstate_Code = 0 THEN -1 ELSE ALD.Outstate_Code END</td>
        <td>120</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ALD.Outstate_Code = -4 THEN ALD.Duration ELSE 0 END</td>
        <td>180</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ALD.Outstate_Code = -13 THEN ALD.Duration ELSE 0 END</td>
        <td>181</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID IS NULL
          AND NOT CLH.Contact_ID IS NULL THEN 1 ELSE 0 END</td>
        <td>238</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CEL.ContactEventID = 4 THEN 1 ELSE 0 END</td>
        <td>253</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID = 1 THEN 1 ELSE 0 END</td>
        <td>287</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID = 2 THEN 1 ELSE 0 END</td>
        <td>288</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID = 3 THEN 1 ELSE 0 END</td>
        <td>289</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID = 4 THEN 1 ELSE 0 END</td>
        <td>290</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.CommitmentAmount &gt; 0 THEN CLH.CommitmentAmount ELSE 0 END</td>
        <td>291</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID = 1 THEN ALD.Duration ELSE 0 END</td>
        <td>300</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID = 2 THEN ALD.Duration ELSE 0 END</td>
        <td>301</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID = 3 THEN ALD.Duration ELSE 0 END</td>
        <td>302</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CLH.ReportingGroupID = 4 THEN ALD.Duration ELSE 0 END</td>
        <td>303</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Positive_Outcomes] + [Negative_Outcomes] &gt; 0 THEN CAST (ISNULL(([Positive_Outcomes] * 1.0 / ([Positive_Outcomes] + [Negative_Outcomes])), 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>345</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Skill_Time] &gt; 0 THEN CAST (ISNULL([Positive_Outcomes] / (((([Skill_Time] * 1.0) / 1000) / 60) / 60), 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>348</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Positive_Outcomes] &gt; 0 THEN CAST (ISNULL(([Total_Commitment_Amount] * 1.0 / [Positive_Outcomes]), 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>351</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ([Positive_Outcomes] + [Negative_Outcomes]) &gt; 0 THEN CAST (ISNULL(Total_Commitment_Amount * 1.0 / ([Positive_Outcomes] + [Negative_Outcomes]), 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>354</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Skill_Time] &gt; 0 THEN CAST (ISNULL(([Positive_Outcomes] + [Negative_Outcomes]) / (((([Skill_Time] * 1.0) / 1000) / 60) / 60), 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>357</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Skill_Time] &gt; 0 THEN CAST (ISNULL(([Positive_Outcomes] + [Negative_Outcomes] + [Other_Completes]) / (((([Skill_Time] * 1.0) / 1000) / 60) / 60), 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>360</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Skill_Time] &gt; 0 THEN CAST (ISNULL([OB_Handled] / (((([Skill_Time] * 1.0) / 1000) / 60) / 60), 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>363</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [OB_Handled] &gt; 0 THEN CAST (ISNULL([OB_Talk_Time] * 1.0 / [OB_Handled], 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>378</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Positive_Outcomes] &gt; 0 THEN CAST (ISNULL([OB_Talk_Time_Positive] * 1.0 / [Positive_Outcomes], 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>381</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Negative_Outcomes] &gt; 0 THEN CAST (ISNULL([OB_Talk_Time_Negative] * 1.0 / [Negative_Outcomes], 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>384</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Agent_Retries] &gt; 0 THEN CAST (ISNULL([OB_Talk_Time_Retries] * 1.0 / [Agent_Retries], 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>387</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [Other_Completes] &gt; 0 THEN CAST (ISNULL([OB_Talk_Time_Others] * 1.0 / [Other_Completes], 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>390</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [OB_Handled] &gt; 0 THEN CAST (ISNULL([Wait_Time] * 1.0 / [OB_Handled], 0) AS DECIMAL (18, 4)) ELSE 0 END</td>
        <td>393</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT OBP.[Preview_Rejects]
 FROM   #OBHandledPreview AS OBP
 WHERE  OBP.Agent_No = #OBHandled.Agent_No)</td>
        <td>265</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">UPDATE with FROM clause</td>
        <td colspan="1">
FROM #OBHandledPreview AS OBP</td>
        <td>266</td>
      </tr>
    </table>
  </body>
</html>