<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_NetAmerica_CampaignSummary]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_NetAmerica_CampaignSummary]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT c.contact_code,
       IsNull(c.ContactAddress, 'CallBack') AS contact_name,
       c.status,
       a.bus_no,
       c.contact_type
INTO   #dw_POC2
FROM   dbo.PointOfContact AS c
       INNER JOIN
       dbo.skills AS s
       ON c.default_skill_no = s.skill_no
       INNER JOIN
       dbo.campaign AS a
       ON s.campaign_no = a.campaign_no
WHERE  c.contact_type = 1
       AND a.bus_no = @Bus_no
UNION
SELECT c.contact_code,
       s.description,
       c.status,
       b.bus_no,
       c.contact_type
FROM   dbo.PointOfContact AS c
       INNER JOIN
       dbo.contact_types AS s
       ON c.contact_type = s.contact_type CROSS JOIN dbo.business_unit AS b
WHERE  default_skill_no IS NULL
       AND b.bus_no = @Bus_no
OPTION (MAXDOP 2)</td>
        <td>10</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT d.[contact_id]
INTO   [#Agent_data]
FROM   dbo.Agent_Log_Header AS h
       INNER JOIN
       dbo.Agent_Log_Summary AS s
       ON s.[Agent_Session_ID] = h.[Agent_Session_ID]
       INNER JOIN
       dbo.Agent_Log_Detail AS d
       ON d.[Agent_Session_ID] = s.[Agent_Session_ID]
WHERE  h.[bus_no] = @bus_no
       AND h.[start_date] BETWEEN @Start_Date AND @End_Date
       AND d.[outstate_code] = 500885
OPTION (MAXDOP 2)</td>
        <td>35</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT p.contact_name AS contact_name,
       k.skill_name AS skill_name,
       c.campaign_name AS campaign_name,
       h.start_Date AS start_date,
       s.PreQueue_time / 1000.0 / 60.0 AS PreQueue_Time,
       s.InQueue_time / 1000.0 / 60.0 AS InQueue_time,
       s.Abandon_time / 1000.0 / 60.0 AS Abandon_time,
       s.agent_time / 1000.0 / 60.0 AS Agent_Time,
       s.PostQueue_time / 1000.0 / 60.0 AS PostQueue_time,
       s.Total_time / 1000.0 / 60.0 AS total_time,
       CASE WHEN s.InQueue_time &gt; 0 THEN 1 ELSE 0 END AS InQueue_Cnt,
       CASE WHEN f.[Abandon] = 'Y' THEN 1 ELSE 0 END AS Abandon_Cnt,
       CASE WHEN s.Agent_time &gt; 0 THEN 1 ELSE 0 END AS Agent_cnt,
       CASE WHEN s.PostQueue_time &gt; 0 THEN 1 ELSE 0 END AS PostQueue_Cnt,
       CASE WHEN s.[sla] &gt;= 0 THEN 1 ELSE 0 END AS In_SLA,
       CASE WHEN f.[Inbound] = 'T'
                 AND s.[sla] &gt; 0 THEN 1 ELSE 0 END AS Out_SLA,
       CASE WHEN h.[Contact_ID] IN (SELECT Contact_ID
                                    FROM   [#Agent_Data]) THEN s.[ACW_Time] / 1000.0 / 60.0 ELSE 0.0 END AS WrapUp
INTO   [#Contact_data]
FROM   dbo.Contact_Log_header AS h
       INNER JOIN
       dbo.Contact_Log_Footer AS f
       ON f.[Contact_ID] = h.[Contact_ID]
       INNER JOIN
       dbo.Contact_Log_Summary AS s
       ON s.[Contact_ID] = h.[Contact_ID]
       INNER JOIN
       dbo.skills AS k
       ON k.skill_no = f.skill_no
       INNER JOIN
       dbo.campaign AS c
       ON c.campaign_no = k.campaign_no
       INNER JOIN
       [#dw_POC2] AS p
       ON h.bus_no = p.bus_no
          AND h.contact_code = p.contact_code
WHERE  h.bus_no = @bus_no
       AND h.Start_Date BETWEEN @Start_Date AND @End_Date
       AND (@media IS NULL
            OR @media LIKE '%,' + CONVERT (NVARCHAR, k.media_type) + ',%')
       AND (@POC IS NULL
            OR @POC LIKE '%,' + CONVERT (NVARCHAR, h.contact_code) + ',%')
       AND (@Skill IS NULL
            OR @Skill LIKE '%,' + CONVERT (NVARCHAR, k.skill_no) + ',%')
       AND (@Campaign IS NULL
            OR @Campaign LIKE '%,' + CONVERT (NVARCHAR, k.campaign_no) + ',%')
       AND (@InboundOutbound &gt;= 2
            OR k.Outbound_skill = @InboundOutbound)
OPTION (MAXDOP 2)</td>
        <td>45</td>
      </tr>
      <tr valign="top">
        <td colspan="1">MAXDOP</td>
        <td colspan="1">MAXDOP 2</td>
        <td>33</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>43</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>103</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN s.InQueue_time &gt; 0 THEN 1 ELSE 0 END</td>
        <td>55</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[Abandon] = 'Y' THEN 1 ELSE 0 END</td>
        <td>58</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.Agent_time &gt; 0 THEN 1 ELSE 0 END</td>
        <td>61</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.PostQueue_time &gt; 0 THEN 1 ELSE 0 END</td>
        <td>64</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.[sla] &gt;= 0 THEN 1 ELSE 0 END</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[Inbound] = 'T'
          AND s.[sla] &gt; 0 THEN 1 ELSE 0 END</td>
        <td>70</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN h.[Contact_ID] IN (SELECT Contact_ID
                             FROM   [#Agent_Data]) THEN s.[ACW_Time] / 1000.0 / 60.0 ELSE 0.0 END</td>
        <td>74</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">[#Agent_Data]</td>
        <td>75</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">[#dw_POC2] AS p</td>
        <td>84</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">[#Contact_data] AS c</td>
        <td>123</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">LIKE</td>
        <td colspan="1">@media LIKE '%,' + CONVERT (NVARCHAR, k.media_type) + ',%'</td>
        <td>89</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@POC LIKE '%,' + CONVERT (NVARCHAR, h.contact_code) + ',%'</td>
        <td>92</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@Skill LIKE '%,' + CONVERT (NVARCHAR, k.skill_no) + ',%'</td>
        <td>95</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@Campaign LIKE '%,' + CONVERT (NVARCHAR, k.campaign_no) + ',%'</td>
        <td>98</td>
      </tr>
    </table>
  </body>
</html>