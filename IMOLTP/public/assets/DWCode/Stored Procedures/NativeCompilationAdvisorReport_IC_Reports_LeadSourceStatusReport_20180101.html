<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_LeadSourceStatusReport]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_LeadSourceStatusReport]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:12 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #SkillNoList
FROM   dbo.fn_SplitOptionalInt(@SkillNoList)</td>
        <td>35</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #TeamNoList
FROM   dbo.fn_SplitOptionalInt(@TeamNoList)</td>
        <td>41</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT IDMin,
       IDMax
INTO   #AgentNoList
FROM   dbo.fn_SplitOptionalInt(@AgentNoList)</td>
        <td>47</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@SkillNoList)</td>
        <td>38</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@TeamNoList)</td>
        <td>44</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@AgentNoList)</td>
        <td>50</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#AgentTable</td>
        <td>61</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentNoList AS ANL</td>
        <td>70</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#TeamNoList AS TNL</td>
        <td>71</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS agt</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS agt</td>
        <td>89</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#SkillNoList AS SNL</td>
        <td>139</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">OutboundDetailRecords AS o</td>
        <td>149</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">OutboundDetailRecords AS o</td>
        <td>157</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS agt</td>
        <td>162</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentNoList</td>
        <td>164</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#TeamNoList</td>
        <td>165</td>
      </tr>
      <tr valign="top">
        <td colspan="1">COALESCE</td>
        <td colspan="1">COALESCE (lastODR.ProspectiveContactDestinationValue, lastODR.PhoneNumber)</td>
        <td>79</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">COALESCE (lastODR.ProspectiveContactDestinationDesc, 'PhoneNumber')</td>
        <td>80</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COALESCE (cdt.ProspectiveContactDestinationType, 'Unknown')</td>
        <td>134</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN pcs.CallbackAgent_No IS NOT NULL THEN pcs.CallbackAgent_No WHEN c.Agent_No IS NOT NULL
                                                                          AND c.Agent_No &gt; 0 THEN c.Agent_No ELSE NULL END</td>
        <td>82</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN pcs.CallbackAgent_No IS NOT NULL THEN (SELECT agt.AgentName
                                                 FROM   #AgentTable AS agt
                                                 WHERE  pcs.CallbackAgent_No = agt.Agent_No) WHEN c.Agent_No IS NOT NULL
                                                                                                  AND c.Agent_No &gt; 0 THEN (SELECT agt.AgentName
                                                                                                                           FROM   #AgentTable AS agt
                                                                                                                           WHERE  c.Agent_No = agt.Agent_No) ELSE '' END</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN pcs.Attempts &gt; 1 THEN dbo.fn_ConvertUTCToTargetTimeZone(firstODR.TimeInitiated, @DefaultBuTZ) ELSE dbo.fn_ConvertUTCToTargetTimeZone(lastODR.TimeInitiated, @DefaultBuTZ) END</td>
        <td>97</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN pcs.finalized = 0 THEN 'Active' WHEN pcs.ContactDisposedFinal = 1 THEN 'ContactDisposedFinal' WHEN pcs.ContactDNC = 1
                                                                                                             AND pcs.CheckedIn = 0 THEN 'ContactDNC' WHEN pcs.ContactDNC = 1
                                                                                                                                                          AND pcs.CheckedIn = 1 THEN 'ContactDNCCheckedIn' WHEN pcs.ContactExhausted = 1 THEN 'ContactExhausted' WHEN pcs.ContactExpired = 1 THEN 'ContactExpired' WHEN pcs.Removed = 1
                                                                                                                                                                                                                                                                                                                        AND pcs.CheckedIn = 0 THEN 'Remove' WHEN pcs.Removed = 1
                                                                                                                                                                                                                                                                                                                                                                 AND pcs.CheckedIn = 1 THEN 'Removed' WHEN pcs.SourceRemoved = 1
                                                                                                                                                                                                                                                                                                                                                                                                           AND pcs.CheckedIn = 0 THEN 'SourceRemoved' WHEN pcs.SourceRemoved = 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND pcs.CheckedIn = 1 THEN 'SourceRemovedCheckedIn' END</td>
        <td>107</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">APPLY</td>
        <td colspan="1">dbo.OutboundDetailRecords AS lastODR
INNER JOIN
dbo.ProspectiveContactSummaries AS pcs
ON pcs.ProspectiveContactId = lastODR.ProspectiveContactId
   AND pcs.LastODR = lastODR.OutboundDetailRecordId
INNER JOIN
dbo.ProspectiveContacts AS c
ON c.ProspectiveContactId = lastODR.ProspectiveContactId
INNER JOIN
#SkillNoList AS SNL
ON c.Skill_No BETWEEN SNL.IDMin AND SNL.IDMax
INNER JOIN
dbo.Skills AS s
ON s.Skill_No = c.Skill_No
INNER JOIN
dbo.Dispositions AS d
ON d.Disposition_Code = lastODR.CPADispCode
LEFT OUTER JOIN
dbo.DispositionClassifications AS dc
ON dc.DispositionClassificationID = lastODR.DispositionClassificationID
LEFT OUTER JOIN
dbo.PositiveDispositions AS pd
ON pd.contact_id = lastODR.contact_id
LEFT OUTER JOIN
[dbo].ContactDeliveryTypes_VW AS dt
ON dt.ContactDeliveryTypeID = lastODR.ContactDeliveryTypeID
LEFT OUTER JOIN
dbo.ProspectiveContactDestinationTypes_VW AS cdt
ON cdt.ProspectiveContactDestinationTypeId = lastODR.ProspectiveContactDestinationTypeId OUTER APPLY (SELECT   TOP 1 TimeInitiated
                                                                                                      FROM     OutboundDetailRecords AS o
                                                                                                      WHERE    o.ProspectiveContactId = lastODR.ProspectiveContactId
                                                                                                      ORDER BY TimeInitiated ASC) AS firstODR OUTER APPLY (SELECT   TOP 1 o.Agent_No AS Last_Agent_No
                                                                                                                                                           FROM     OutboundDetailRecords AS o
                                                                                                                                                           WHERE    o.ProspectiveContactId = lastODR.ProspectiveContactId
                                                                                                                                                                    AND Agent_No IS NOT NULL
                                                                                                                                                           ORDER BY TimeInitiated DESC) AS lastAgentODR</td>
        <td>135</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.OutboundDetailRecords AS lastODR
INNER JOIN
dbo.ProspectiveContactSummaries AS pcs
ON pcs.ProspectiveContactId = lastODR.ProspectiveContactId
   AND pcs.LastODR = lastODR.OutboundDetailRecordId
INNER JOIN
dbo.ProspectiveContacts AS c
ON c.ProspectiveContactId = lastODR.ProspectiveContactId
INNER JOIN
#SkillNoList AS SNL
ON c.Skill_No BETWEEN SNL.IDMin AND SNL.IDMax
INNER JOIN
dbo.Skills AS s
ON s.Skill_No = c.Skill_No
INNER JOIN
dbo.Dispositions AS d
ON d.Disposition_Code = lastODR.CPADispCode
LEFT OUTER JOIN
dbo.DispositionClassifications AS dc
ON dc.DispositionClassificationID = lastODR.DispositionClassificationID
LEFT OUTER JOIN
dbo.PositiveDispositions AS pd
ON pd.contact_id = lastODR.contact_id
LEFT OUTER JOIN
[dbo].ContactDeliveryTypes_VW AS dt
ON dt.ContactDeliveryTypeID = lastODR.ContactDeliveryTypeID
LEFT OUTER JOIN
dbo.ProspectiveContactDestinationTypes_VW AS cdt
ON cdt.ProspectiveContactDestinationTypeId = lastODR.ProspectiveContactDestinationTypeId OUTER APPLY (SELECT   TOP 1 TimeInitiated
                                                                                                      FROM     OutboundDetailRecords AS o
                                                                                                      WHERE    o.ProspectiveContactId = lastODR.ProspectiveContactId
                                                                                                      ORDER BY TimeInitiated ASC) AS firstODR</td>
        <td>135</td>
      </tr>
    </table>
  </body>
</html>