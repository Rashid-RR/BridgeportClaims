<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_KnockOutDebt_AgentStats]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_KnockOutDebt_AgentStats]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   h.[agent_no],
         a.[first_name] + ' ' + a.[last_name] AS agent_name,
         CONVERT (NVARCHAR (10), [dbo].[fn_ConvertUTCToTargetTimeZone](t.[startdate], @TimeZone), 120) AS DateOnly,
         CASE WHEN MIN(h.[start_date]) &lt; t.[startdate] THEN [dbo].[fn_ConvertUTCToTargetTimeZone](t.startdate, @TimeZone) ELSE [dbo].[fn_ConvertUTCToTargetTimeZone](MIN(h.[start_date]), @TimeZone) END AS logged_on,
         CASE WHEN MAX(s.[End_Date]) &gt; t.[enddate] THEN [dbo].[fn_ConvertUTCToTargetTimeZone](t.enddate, @TimeZone) ELSE [dbo].[fn_ConvertUTCToTargetTimeZone](MAX(s.[End_Date]), @TimeZone) END AS logged_off,
         SUM(DATEDIFF(s, CASE WHEN h.[start_date] &lt; t.[startdate] THEN t.[startdate] ELSE h.[start_date] END, CASE WHEN s.[End_Date] &gt; t.[enddate] THEN t.[enddate] ELSE s.[End_Date] END)) AS Dur
INTO     [#Agents]
FROM     dbo.[Agent_Log_Header] AS h
         INNER JOIN
         dbo.[Agents] AS a
         ON a.[Agent_No] = h.[Agent_No]
         INNER JOIN
         dbo.[Agent_Log_Summary] AS s
         ON s.[Agent_Session_ID] = h.[Agent_Session_ID]
         INNER JOIN
         @TimeIntervals AS t
         ON t.[startdate] &lt;= s.[End_Date]
            AND t.[enddate] &gt;= h.[start_date]
WHERE    h.[bus_no] = @Bus_No
GROUP BY h.[agent_no], a.[first_name] + ' ' + a.[last_name], t.[startdate], t.[enddate]</td>
        <td>41</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   f.[Agent_No],
         CONVERT (NVARCHAR (10), [dbo].[fn_ConvertUTCToTargetTimeZone](h.[start_date], @TimeZone), 120) AS DateOnly,
         SUM(CASE WHEN f.[inbound] = 'T' THEN 1 ELSE 0 END) AS inbound_handled,
         SUM(CASE WHEN f.[inbound] = 'T' THEN CEILING(CAST (s.[Total_Time] AS NUMERIC) / 1000) ELSE 0 END) AS time_inbound,
         SUM(CASE WHEN f.[outbound] = 'T' THEN 1 ELSE 0 END) AS outbound_handled,
         SUM(CASE WHEN f.[outbound] = 'T' THEN CEILING(CAST (s.[Total_Time] AS NUMERIC) / 1000) ELSE 0 END) AS time_outbound
INTO     [#Contacts]
FROM     [dbo].[Contact_Log_Header] AS h
         INNER JOIN
         [dbo].[Contact_Log_Footer] AS f
         ON f.[contact_id] = h.[contact_id]
         INNER JOIN
         [dbo].[Contact_Log_Summary] AS s
         ON s.[contact_id] = f.[contact_id]
WHERE    h.[Bus_no] = @Bus_No
         AND h.[start_date] BETWEEN @start_date AND @end_date
         AND f.[Agent_No] IS NOT NULL
GROUP BY f.[Agent_No], CONVERT (NVARCHAR (10), [dbo].[fn_ConvertUTCToTargetTimeZone](h.[start_date], @TimeZone), 120)</td>
        <td>70</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN MIN(h.[start_date]) &lt; t.[startdate] THEN [dbo].[fn_ConvertUTCToTargetTimeZone](t.startdate, @TimeZone) ELSE [dbo].[fn_ConvertUTCToTargetTimeZone](MIN(h.[start_date]), @TimeZone) END</td>
        <td>44</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN MAX(s.[End_Date]) &gt; t.[enddate] THEN [dbo].[fn_ConvertUTCToTargetTimeZone](t.enddate, @TimeZone) ELSE [dbo].[fn_ConvertUTCToTargetTimeZone](MAX(s.[End_Date]), @TimeZone) END</td>
        <td>47</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN h.[start_date] &lt; t.[startdate] THEN t.[startdate] ELSE h.[start_date] END</td>
        <td>50</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.[End_Date] &gt; t.[enddate] THEN t.[enddate] ELSE s.[End_Date] END</td>
        <td>52</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[inbound] = 'T' THEN 1 ELSE 0 END</td>
        <td>72</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[inbound] = 'T' THEN CEILING(CAST (s.[Total_Time] AS NUMERIC) / 1000) ELSE 0 END</td>
        <td>75</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[outbound] = 'T' THEN 1 ELSE 0 END</td>
        <td>78</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[outbound] = 'T' THEN CEILING(CAST (s.[Total_Time] AS NUMERIC) / 1000) ELSE 0 END</td>
        <td>81</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">FULL OUTER JOIN</td>
        <td colspan="1">[#Agents] AS a
FULL OUTER JOIN
[#Contacts] AS c
ON c.[Agent_No] = a.[Agent_No]
   AND c.[DateOnly] = a.[DateOnly]</td>
        <td>104</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">[#Agents] AS a</td>
        <td>104</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">[#Contacts] AS c</td>
        <td>105</td>
      </tr>
      <tr valign="top">
        <td colspan="1">MAXDOP</td>
        <td colspan="1">MAXDOP 2</td>
        <td>109</td>
      </tr>
    </table>
  </body>
</html>