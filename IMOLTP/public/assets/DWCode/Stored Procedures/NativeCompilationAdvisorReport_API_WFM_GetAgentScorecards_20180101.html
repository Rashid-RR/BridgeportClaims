<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[API_WFM_GetAgentScorecards]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[API_WFM_GetAgentScorecards]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:12 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT a.Bus_No,
       a.Agent_No,
       a.StartDate,
       a.Duration,
       a.AgentStateID,
       a.Skill_No,
       a.Outstate_Code,
       a.Contact_Id
INTO   #Agent_Log_DetailQV_BU
FROM   dbo.Agent_Log_DetailQV AS a
WHERE  a.Bus_No = @Bus_No
       AND a.StartDate BETWEEN @StartDate AND @EndDate</td>
        <td>10</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT bumt.BusNo,
       bumt.Mediatype,
       bumt.Outbound
INTO   #Enabled_Mediatypes
FROM   dbo.[Business_Unit_MediaTypes] AS bumt
WHERE  bumt.BusNo = @Bus_No</td>
        <td>25</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Bus_No,
         a.Agent_No,
         MIN(a.StartDate) AS LoginTime
INTO     #AgentLogins
FROM     #Agent_Log_DetailQV_BU AS a
         INNER JOIN
         dbo.Agents AS agts
         ON agts.Agent_No = a.Agent_No
            AND agts.Bus_No = a.Bus_No
         INNER JOIN
         dbo.fn_GetDataRoleFilterItems(@SecurityProfileId, 'teams') AS v
         ON v.intValue = agts.Team_No
            OR v.intValue = 0
GROUP BY a.Bus_No, a.Agent_No</td>
        <td>33</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(CAST (ISNULL(a.Duration, 0) AS BIGINT)) AS TotalTime,
         SUM(CASE WHEN c.isACW = 'T'
                       AND c.isSystemOutState = 0
                       AND d.Outbound_Skill = enabledMedia.Outbound THEN ISNULL(a.Duration, 0) ELSE 0 END) AS ACWTime,
         SUM(CASE WHEN a.AgentStateID IN (0, 2, 8) THEN ISNULL(a.Duration, 0) ELSE 0 END) AS AuxTime,
         SUM(CASE WHEN e.IsAvailable = 0
                       AND d.Outbound_Skill = 0 THEN ISNULL(a.Duration, 0) ELSE 0 END) AS AuxInTime,
         SUM(CASE WHEN e.IsAvailable = 0
                       AND d.Outbound_Skill = 1 THEN ISNULL(a.Duration, 0) ELSE 0 END) AS AuxOutTime,
         SUM(CASE WHEN e.AgentStateID = 1 THEN CAST (ISNULL(a.Duration, 0) AS BIGINT) ELSE 0 END) AS IdleTime
INTO     #AgentStats
FROM     #Agent_Log_DetailQV_BU AS a
         INNER JOIN
         #AgentLogins AS b
         ON a.Agent_No = b.Agent_No
            AND a.Bus_No = b.Bus_No
         INNER JOIN
         dbo.AgentState AS e
         ON a.AgentStateID = e.AgentStateID
         LEFT OUTER JOIN
         dbo.Skills AS d
         ON a.Skill_No = d.Skill_No
         LEFT OUTER JOIN
         #Enabled_Mediatypes AS enabledMedia
         ON enabledMedia.BusNo = a.Bus_No
            AND enabledMedia.Outbound = d.Outbound_skill
            AND enabledMedia.MediaType = d.Media_Type
         LEFT OUTER JOIN
         dbo.Outstates AS c
         ON a.Outstate_Code = c.outstate_code
GROUP BY a.Agent_No</td>
        <td>44</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT a.Contact_ID,
       a.Agent_No,
       a.Bus_No,
       a.Duration,
       a.Contact_State,
       a.Direction,
       a.Skill_No
INTO   #ContactsQV
FROM   dbo.Contact_Log_DetailQV AS a
       INNER JOIN
       #AgentLogins AS al
       ON al.Agent_No = a.Agent_No
          AND al.Bus_No = a.Bus_No
       INNER JOIN
       dbo.Skills AS s
       ON s.Skill_No = a.Skill_No
       INNER JOIN
       #Enabled_Mediatypes AS enabledMedia
       ON enabledMedia.BusNo = a.Bus_No
          AND enabledMedia.Outbound = s.Outbound_skill
          AND enabledMedia.MediaType = s.Media_Type
WHERE  a.StartDate BETWEEN @StartDate AND @EndDate
       AND a.Bus_No = @Bus_No</td>
        <td>61</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   b.Agent_No,
         SUM(CASE WHEN a.Contact_State IN (4, 14) THEN CAST (ISNULL(a.Duration, 0) AS BIGINT) ELSE 0 END) AS TalkTime,
         SUM(CASE WHEN a.Contact_State = 8 THEN CAST (ISNULL(a.Duration, 0) AS BIGINT) ELSE 0 END) AS HoldTime,
         COUNT(DISTINCT (CASE WHEN a.Duration &gt; 0
                                   AND a.Contact_State = 4 THEN a.contact_Id END)) AS Handled,
         COUNT(DISTINCT a.contact_ID) AS TotalCalls,
         COUNT(DISTINCT (CASE WHEN a.Contact_State = 24
                                   AND a.Direction = 1 THEN a.contact_Id END)) AS AbandonCalls
INTO     #ContactStats
FROM     #ContactsQV AS a
         INNER JOIN
         #AgentLogins AS b
         ON a.Agent_No = b.Agent_No
GROUP BY b.Agent_No</td>
        <td>80</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#Agent_Log_DetailQV_BU AS a</td>
        <td>37</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Agent_Log_DetailQV_BU AS a</td>
        <td>52</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS b</td>
        <td>53</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Enabled_Mediatypes AS enabledMedia</td>
        <td>57</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS al</td>
        <td>70</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Enabled_Mediatypes AS enabledMedia</td>
        <td>73</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactsQV AS a</td>
        <td>87</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS b</td>
        <td>88</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS a</td>
        <td>106</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentStats AS b</td>
        <td>107</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactStats AS c</td>
        <td>108</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_GetDataRoleFilterItems(@SecurityProfileId, 'teams') AS v</td>
        <td>39</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN c.isACW = 'T'
          AND c.isSystemOutState = 0
          AND d.Outbound_Skill = enabledMedia.Outbound THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>46</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.AgentStateID IN (0, 2, 8) THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>47</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN e.IsAvailable = 0
          AND d.Outbound_Skill = 0 THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>48</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN e.IsAvailable = 0
          AND d.Outbound_Skill = 1 THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>49</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN e.AgentStateID = 1 THEN CAST (ISNULL(a.Duration, 0) AS BIGINT) ELSE 0 END</td>
        <td>50</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.Contact_State IN (4, 14) THEN CAST (ISNULL(a.Duration, 0) AS BIGINT) ELSE 0 END</td>
        <td>81</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.Contact_State = 8 THEN CAST (ISNULL(a.Duration, 0) AS BIGINT) ELSE 0 END</td>
        <td>82</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.Duration &gt; 0
          AND a.Contact_State = 4 THEN a.contact_Id END</td>
        <td>83</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.Contact_State = 24
          AND a.Direction = 1 THEN a.contact_Id END</td>
        <td>85</td>
      </tr>
      <tr valign="top">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT (CASE WHEN a.Duration &gt; 0
                          AND a.Contact_State = 4 THEN a.contact_Id END))</td>
        <td>83</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT a.contact_ID)</td>
        <td>84</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT (CASE WHEN a.Contact_State = 24
                          AND a.Direction = 1 THEN a.contact_Id END))</td>
        <td>85</td>
      </tr>
    </table>
  </body>
</html>