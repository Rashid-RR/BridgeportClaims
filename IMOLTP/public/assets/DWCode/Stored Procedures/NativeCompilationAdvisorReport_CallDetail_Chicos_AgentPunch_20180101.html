<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_Chicos_AgentPunch]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_Chicos_AgentPunch]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:12 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>1</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top">
        <td colspan="1">BEGIN TRANSACTION</td>
        <td colspan="1">BEGIN TRANSACTION</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">EXECUTE LockCriticalSection 'CallDetail_Chicos_AgentPunch'</td>
        <td>12</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#MainData AS D</td>
        <td>63</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#MainData</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#MainDataOutLunch</td>
        <td>70</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT H.Team_No AS Org_CD,
       D.StateIndex AS Org_Level_CD,
       A.SecondaryID AS Emp_CD,
       CASE WHEN D.StateIndex = 1 THEN dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone) ELSE dbo.fn_ConvertUTCToTargetTimeZone(D.Start_Date, @p_TimeZone) END AS [Date],
       CASE WHEN D.log_State = 0 THEN 'in punch' WHEN D.log_State = 2 THEN 'out punch' WHEN D.outstate_Code = 209 THEN 'in lunch' ELSE NULL END AS Punch_Type,
       DS.Duration_Seconds,
       H.Agent_No AS inContactID,
       H.Agent_Session_ID AS SessionID
INTO   #MainData
FROM   dbo.Agent_Log_Header AS H
       INNER JOIN
       dbo.Agent_Log_Detail AS D
       ON H.Agent_Session_ID = D.Agent_Session_ID
       INNER JOIN
       dbo.Agent_Log_Detail_Summary AS DS
       ON H.Agent_Session_ID = DS.Agent_Session_ID
          AND D.StateIndex = DS.StateINdex
       INNER JOIN
       dbo.Agents AS A
       ON H.Agent_no = A.Agent_no
WHERE  H.bus_no = @P_bus_no
       AND H.start_date BETWEEN @P_UTCStart_Date AND @P_UTCEnd_Date
       AND (D.log_state = 0
            OR D.log_state = 2
            OR d.outstate_code = 209)</td>
        <td>30</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT Org_CD,
       D.Org_Level_CD + 1 AS Org_Level_CD,
       Emp_CD,
       DateAdd(s, (D.Duration_Seconds - 1), D.Date) AS [Date],
       'out lunch' AS Punch_Type,
       0 AS Duration_Seconds,
       inContactID,
       SessionID
INTO   #MainDataOutLunch
FROM   #MainData AS D
WHERE  Punch_Type = 'in lunch'</td>
        <td>54</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN D.StateIndex = 1 THEN dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone) ELSE dbo.fn_ConvertUTCToTargetTimeZone(D.Start_Date, @p_TimeZone) END</td>
        <td>34</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN D.log_State = 0 THEN 'in punch' WHEN D.log_State = 2 THEN 'out punch' WHEN D.outstate_Code = 209 THEN 'in lunch' ELSE NULL END</td>
        <td>38</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">COMMIT TRANSACTION</td>
        <td colspan="1">COMMIT TRANSACTION</td>
        <td>76</td>
      </tr>
    </table>
  </body>
</html>