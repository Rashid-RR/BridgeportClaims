<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_OutboundAgentlessProductivity]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_OutboundAgentlessProductivity]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT dbo.fn_ConvertTimeZoneToUTC(b.StartDateInterval, @DefaultBuTZ) AS StartDateUTC,
       dbo.fn_ConvertTimeZoneToUTC(CASE WHEN DATEADD(DAY, +1, CONVERT (VARCHAR, b.StartDateInterval, 101)) &gt; a.stopTime THEN a.stopTime ELSE DATEADD(DAY, +1, CONVERT (VARCHAR, b.StartDateInterval, 101)) END, @DefaultBuTZ) AS EndDateUTC
INTO   #tmpC
FROM   (SELECT dbo.fn_ConvertUTCToTargetTimeZone(aoe.EventDateTime, @DefaultBuTZ) AS startTime,
               dbo.fn_ConvertUTCToTargetTimeZone(ISNULL((SELECT   TOP 1 s.EventDateTime
                                                         FROM     dbo.AutoOutboundEvents AS s
                                                         WHERE    s.Bus_No = aoe.Bus_No
                                                                  AND s.Skill_No = aoe.Skill_No
                                                                  AND s.AutoOutboundEventTypeId = 3
                                                                  AND (s.NewValue = 2
                                                                       OR s.NewValue = 1)
                                                                  AND aoe.EventDateTime &lt; s.EventDateTime
                                                         ORDER BY s.EventDateTime), DATEADD(DAY, +1, CONVERT (VARCHAR, aoe.EventDateTime, 101))), @DefaultBuTZ) AS stopTime
        FROM   dbo.AutoOutboundEvents AS aoe
        WHERE  aoe.AutoOutboundEventTypeId = 3
               AND aoe.NewValue = 1
               AND aoe.Bus_No = @busNo
               AND aoe.Skill_No = @SkillNo) AS a CROSS APPLY dbo.SplitDatesToIntervals(a.startTime, a.stopTime, 8640000000, 86400) AS b</td>
        <td>9</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN DATEADD(DAY, +1, CONVERT (VARCHAR, b.StartDateInterval, 101)) &gt; a.stopTime THEN a.stopTime ELSE DATEADD(DAY, +1, CONVERT (VARCHAR, b.StartDateInterval, 101)) END</td>
        <td>11</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEDIFF(ss, d.EarliestRecordCalled, d.LastRecordDisposed) = 0 THEN 0 ELSE CAST (TotalPortSeconds / DATEDIFF(ss, d.EarliestRecordCalled, d.LastRecordDisposed) AS NUMERIC (10, 1)) END</td>
        <td>41</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN p.PortSessionStart &lt; p.ContactBoundStart THEN p.ContactBoundStart ELSE p.PortSessionStart END</td>
        <td>75</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN p.PortSessionEnd &gt; p.ContactBoundEnd THEN p.ContactBoundEnd ELSE p.PortSessionEnd END</td>
        <td>78</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ISNUMERIC(p.CurPorts) = 1 THEN p.CurPorts ELSE 0 END</td>
        <td>80</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN odr.TimeConnected IS NOT NULL THEN odr.OutboundDetailRecordId END</td>
        <td>133</td>
      </tr>
      <tr valign="top">
        <td colspan="1">APPLY</td>
        <td colspan="1">(SELECT dbo.fn_ConvertUTCToTargetTimeZone(aoe.EventDateTime, @DefaultBuTZ) AS startTime,
        dbo.fn_ConvertUTCToTargetTimeZone(ISNULL((SELECT   TOP 1 s.EventDateTime
                                                  FROM     dbo.AutoOutboundEvents AS s
                                                  WHERE    s.Bus_No = aoe.Bus_No
                                                           AND s.Skill_No = aoe.Skill_No
                                                           AND s.AutoOutboundEventTypeId = 3
                                                           AND (s.NewValue = 2
                                                                OR s.NewValue = 1)
                                                           AND aoe.EventDateTime &lt; s.EventDateTime
                                                  ORDER BY s.EventDateTime), DATEADD(DAY, +1, CONVERT (VARCHAR, aoe.EventDateTime, 101))), @DefaultBuTZ) AS stopTime
 FROM   dbo.AutoOutboundEvents AS aoe
 WHERE  aoe.AutoOutboundEventTypeId = 3
        AND aoe.NewValue = 1
        AND aoe.Bus_No = @busNo
        AND aoe.Skill_No = @SkillNo) AS a CROSS APPLY dbo.SplitDatesToIntervals(a.startTime, a.stopTime, 8640000000, 86400) AS b</td>
        <td>16</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tmpC AS c OUTER APPLY (SELECT   MIN(odr.TimeInitiated) AS EarliestRecordCalled,
                                 MAX(odr.TimeDisposed) AS LastRecordDisposed,
                                 COUNT(DISTINCT odr.OutboundDetailRecordId) AS Presented,
                                 COUNT(h.Master_Contact_Id) AS Reskilled,
                                 CAST (SUM(DATEDIFF(ss, Header_Start_Date, End_Date) / 60.0 / 60.0) AS NUMERIC (10, 3)) AS PortHrs
                        FROM     dbo.OutboundDetailRecords AS odr
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Footer AS f
                                 ON f.Contact_Id = odr.Contact_Id
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Header AS h
                                 ON h.Master_Contact_Id = odr.Contact_Id
                                    AND h.Master_Contact_Id &lt;&gt; h.Contact_Id
                        WHERE    odr.Bus_No = @busNo
                                 AND odr.Skill_No = @SkillNo
                                 AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                        GROUP BY odr.Skill_No) AS d OUTER APPLY (SELECT MAX(p.CurPorts) AS MaxPorts,
                                                                        MIN(p.CurPorts) AS MinPorts,
                                                                        SUM((CAST (DATEDIFF(ss, CASE WHEN p.PortSessionStart &lt; p.ContactBoundStart THEN p.ContactBoundStart ELSE p.PortSessionStart END, CASE WHEN p.PortSessionEnd &gt; p.ContactBoundEnd THEN p.ContactBoundEnd ELSE p.PortSessionEnd END) AS NUMERIC (10, 1)) * CASE WHEN ISNUMERIC(p.CurPorts) = 1 THEN p.CurPorts ELSE 0 END)) AS TotalPortSeconds
                                                                 FROM   (SELECT oae.NewValue AS CurPorts,
                                                                                oae.EventDateTime AS PortSessionStart,
                                                                                ISNULL((SELECT   TOP 1 e.EventDateTime
                                                                                        FROM     dbo.AutoOutboundEvents AS e
                                                                                        WHERE    e.EventDateTime &gt; oae.EventDateTime
                                                                                                 AND e.AutoOutboundEventTypeId = 2
                                                                                                 AND e.Skill_No = @SkillNo
                                                                                        ORDER BY e.EventDateTime), @EndDate) AS PortSessionEnd,
                                                                                d.EarliestRecordCalled AS ContactBoundStart,
                                                                                d.LastRecordDisposed AS ContactBoundEnd
                                                                         FROM   dbo.AutoOutboundEvents AS oae
                                                                         WHERE  oae.Skill_No = @SkillNo
                                                                                AND oae.AutoOutboundEventTypeId = 2
                                                                                AND oae.EventDateTime BETWEEN DATEADD(second, -1, c.StartDateUTC) AND c.EndDateUTC) AS p
                                                                 WHERE  (p.PortSessionStart BETWEEN d.EarliestRecordCalled AND d.LastRecordDisposed
                                                                         OR p.PortSessionEnd BETWEEN d.EarliestRecordCalled AND d.LastRecordDisposed
                                                                         OR (p.PortSessionStart &lt; d.EarliestRecordCalled
                                                                             AND p.PortSessionEnd &gt; d.LastRecordDisposed))) AS e OUTER APPLY (SELECT p.[1] + p.[2] AS Positive,
                                                                                                                                                     p.[3] + p.[4] + p.[5] AS Negative,
                                                                                                                                                     p.[6] AS Other,
                                                                                                                                                     p.[7] + p.[8] AS Followup,
                                                                                                                                                     p.[1] + p.[2] + p.[3] + p.[4] + p.[5] + p.[6] + p.[7] + p.[8] + p.[9] + p.[10] + p.[36] + p.[48] AS LiveVoice,
                                                                                                                                                     p.[11] + p.[12] + p.[14] + p.[19] AS AnsMach
                                                                                                                                              FROM   (SELECT dc.DispositionClassificationId,
                                                                                                                                                             ISNULL(odrclass.DispClassCount, 0) AS DispClassCount
                                                                                                                                                      FROM   dbo.DispositionClassifications AS dc
                                                                                                                                                             LEFT OUTER JOIN
                                                                                                                                                             (SELECT   odr.DispositionClassificationId,
                                                                                                                                                                       COUNT(*) AS DispClassCount
                                                                                                                                                              FROM     dbo.[ProspectiveContactSummaries] AS pcs
                                                                                                                                                                       INNER JOIN
                                                                                                                                                                       dbo.[OutboundDetailRecords] AS odr
                                                                                                                                                                       ON pcs.Bus_No = @busNo
                                                                                                                                                                          AND pcs.Skill_No = @SkillNo
                                                                                                                                                                          AND pcs.LastODR = odr.OutboundDetailRecordId
                                                                                                                                                              WHERE    odr.OverrideFinalDisposition = 0
                                                                                                                                                                       AND odr.Bus_No = @busNo
                                                                                                                                                                       AND odr.Skill_No = @SkillNo
                                                                                                                                                                       AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                                                                                                                                                              GROUP BY odr.DispositionClassificationId) AS odrclass
                                                                                                                                                             ON dc.DispositionClassificationId = odrclass.DispositionClassificationId) AS b PIVOT (SUM (DispClassCount) FOR b.DispositionClassificationId IN ([1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12], [14], [19], [20], [36], [48])) AS p) AS f OUTER APPLY (SELECT   COUNT(DISTINCT odr.OutboundDetailRecordId) AS Attempted,
                                                                                                                                                                                                                                                                                                                                                                                                                                             COUNT(DISTINCT CASE WHEN odr.TimeConnected IS NOT NULL THEN odr.OutboundDetailRecordId END) AS Answered
                                                                                                                                                                                                                                                                                                                                                                                                                                    FROM     dbo.OutboundDetailRecords AS odr
                                                                                                                                                                                                                                                                                                                                                                                                                                    WHERE    odr.Bus_No = @BusNo
                                                                                                                                                                                                                                                                                                                                                                                                                                             AND odr.Skill_No = @SkillNo
                                                                                                                                                                                                                                                                                                                                                                                                                                             AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                                                                                                                                                                                                                                                                                                                                                                                                                                    GROUP BY odr.Skill_No) AS g OUTER APPLY (SELECT SUM(pd.[CommitmentAmount]) AS Amount
                                                                                                                                                                                                                                                                                                                                                                                                                                                                             FROM   dbo.OutboundDetailRecords AS odr
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    INNER JOIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    dbo.PositiveDispositions AS pd
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ON pd.contact_id = odr.contact_id
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    INNER JOIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    dbo.Dispositions AS d
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ON d.Disposition_Code = pd.Disposition_Code
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    INNER JOIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    dbo.DispositionClassifications AS dc
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ON d.DispositionClassificationID = dc.DispositionClassificationID
                                                                                                                                                                                                                                                                                                                                                                                                                                                                             WHERE  odr.Skill_No = @SkillNo
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    AND odr.Bus_No = @busNo
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    AND dc.DispositionClassificationID = 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC) AS h</td>
        <td>56</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tmpC AS c OUTER APPLY (SELECT   MIN(odr.TimeInitiated) AS EarliestRecordCalled,
                                 MAX(odr.TimeDisposed) AS LastRecordDisposed,
                                 COUNT(DISTINCT odr.OutboundDetailRecordId) AS Presented,
                                 COUNT(h.Master_Contact_Id) AS Reskilled,
                                 CAST (SUM(DATEDIFF(ss, Header_Start_Date, End_Date) / 60.0 / 60.0) AS NUMERIC (10, 3)) AS PortHrs
                        FROM     dbo.OutboundDetailRecords AS odr
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Footer AS f
                                 ON f.Contact_Id = odr.Contact_Id
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Header AS h
                                 ON h.Master_Contact_Id = odr.Contact_Id
                                    AND h.Master_Contact_Id &lt;&gt; h.Contact_Id
                        WHERE    odr.Bus_No = @busNo
                                 AND odr.Skill_No = @SkillNo
                                 AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                        GROUP BY odr.Skill_No) AS d OUTER APPLY (SELECT MAX(p.CurPorts) AS MaxPorts,
                                                                        MIN(p.CurPorts) AS MinPorts,
                                                                        SUM((CAST (DATEDIFF(ss, CASE WHEN p.PortSessionStart &lt; p.ContactBoundStart THEN p.ContactBoundStart ELSE p.PortSessionStart END, CASE WHEN p.PortSessionEnd &gt; p.ContactBoundEnd THEN p.ContactBoundEnd ELSE p.PortSessionEnd END) AS NUMERIC (10, 1)) * CASE WHEN ISNUMERIC(p.CurPorts) = 1 THEN p.CurPorts ELSE 0 END)) AS TotalPortSeconds
                                                                 FROM   (SELECT oae.NewValue AS CurPorts,
                                                                                oae.EventDateTime AS PortSessionStart,
                                                                                ISNULL((SELECT   TOP 1 e.EventDateTime
                                                                                        FROM     dbo.AutoOutboundEvents AS e
                                                                                        WHERE    e.EventDateTime &gt; oae.EventDateTime
                                                                                                 AND e.AutoOutboundEventTypeId = 2
                                                                                                 AND e.Skill_No = @SkillNo
                                                                                        ORDER BY e.EventDateTime), @EndDate) AS PortSessionEnd,
                                                                                d.EarliestRecordCalled AS ContactBoundStart,
                                                                                d.LastRecordDisposed AS ContactBoundEnd
                                                                         FROM   dbo.AutoOutboundEvents AS oae
                                                                         WHERE  oae.Skill_No = @SkillNo
                                                                                AND oae.AutoOutboundEventTypeId = 2
                                                                                AND oae.EventDateTime BETWEEN DATEADD(second, -1, c.StartDateUTC) AND c.EndDateUTC) AS p
                                                                 WHERE  (p.PortSessionStart BETWEEN d.EarliestRecordCalled AND d.LastRecordDisposed
                                                                         OR p.PortSessionEnd BETWEEN d.EarliestRecordCalled AND d.LastRecordDisposed
                                                                         OR (p.PortSessionStart &lt; d.EarliestRecordCalled
                                                                             AND p.PortSessionEnd &gt; d.LastRecordDisposed))) AS e OUTER APPLY (SELECT p.[1] + p.[2] AS Positive,
                                                                                                                                                     p.[3] + p.[4] + p.[5] AS Negative,
                                                                                                                                                     p.[6] AS Other,
                                                                                                                                                     p.[7] + p.[8] AS Followup,
                                                                                                                                                     p.[1] + p.[2] + p.[3] + p.[4] + p.[5] + p.[6] + p.[7] + p.[8] + p.[9] + p.[10] + p.[36] + p.[48] AS LiveVoice,
                                                                                                                                                     p.[11] + p.[12] + p.[14] + p.[19] AS AnsMach
                                                                                                                                              FROM   (SELECT dc.DispositionClassificationId,
                                                                                                                                                             ISNULL(odrclass.DispClassCount, 0) AS DispClassCount
                                                                                                                                                      FROM   dbo.DispositionClassifications AS dc
                                                                                                                                                             LEFT OUTER JOIN
                                                                                                                                                             (SELECT   odr.DispositionClassificationId,
                                                                                                                                                                       COUNT(*) AS DispClassCount
                                                                                                                                                              FROM     dbo.[ProspectiveContactSummaries] AS pcs
                                                                                                                                                                       INNER JOIN
                                                                                                                                                                       dbo.[OutboundDetailRecords] AS odr
                                                                                                                                                                       ON pcs.Bus_No = @busNo
                                                                                                                                                                          AND pcs.Skill_No = @SkillNo
                                                                                                                                                                          AND pcs.LastODR = odr.OutboundDetailRecordId
                                                                                                                                                              WHERE    odr.OverrideFinalDisposition = 0
                                                                                                                                                                       AND odr.Bus_No = @busNo
                                                                                                                                                                       AND odr.Skill_No = @SkillNo
                                                                                                                                                                       AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                                                                                                                                                              GROUP BY odr.DispositionClassificationId) AS odrclass
                                                                                                                                                             ON dc.DispositionClassificationId = odrclass.DispositionClassificationId) AS b PIVOT (SUM (DispClassCount) FOR b.DispositionClassificationId IN ([1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12], [14], [19], [20], [36], [48])) AS p) AS f OUTER APPLY (SELECT   COUNT(DISTINCT odr.OutboundDetailRecordId) AS Attempted,
                                                                                                                                                                                                                                                                                                                                                                                                                                             COUNT(DISTINCT CASE WHEN odr.TimeConnected IS NOT NULL THEN odr.OutboundDetailRecordId END) AS Answered
                                                                                                                                                                                                                                                                                                                                                                                                                                    FROM     dbo.OutboundDetailRecords AS odr
                                                                                                                                                                                                                                                                                                                                                                                                                                    WHERE    odr.Bus_No = @BusNo
                                                                                                                                                                                                                                                                                                                                                                                                                                             AND odr.Skill_No = @SkillNo
                                                                                                                                                                                                                                                                                                                                                                                                                                             AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                                                                                                                                                                                                                                                                                                                                                                                                                                    GROUP BY odr.Skill_No) AS g</td>
        <td>56</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tmpC AS c OUTER APPLY (SELECT   MIN(odr.TimeInitiated) AS EarliestRecordCalled,
                                 MAX(odr.TimeDisposed) AS LastRecordDisposed,
                                 COUNT(DISTINCT odr.OutboundDetailRecordId) AS Presented,
                                 COUNT(h.Master_Contact_Id) AS Reskilled,
                                 CAST (SUM(DATEDIFF(ss, Header_Start_Date, End_Date) / 60.0 / 60.0) AS NUMERIC (10, 3)) AS PortHrs
                        FROM     dbo.OutboundDetailRecords AS odr
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Footer AS f
                                 ON f.Contact_Id = odr.Contact_Id
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Header AS h
                                 ON h.Master_Contact_Id = odr.Contact_Id
                                    AND h.Master_Contact_Id &lt;&gt; h.Contact_Id
                        WHERE    odr.Bus_No = @busNo
                                 AND odr.Skill_No = @SkillNo
                                 AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                        GROUP BY odr.Skill_No) AS d OUTER APPLY (SELECT MAX(p.CurPorts) AS MaxPorts,
                                                                        MIN(p.CurPorts) AS MinPorts,
                                                                        SUM((CAST (DATEDIFF(ss, CASE WHEN p.PortSessionStart &lt; p.ContactBoundStart THEN p.ContactBoundStart ELSE p.PortSessionStart END, CASE WHEN p.PortSessionEnd &gt; p.ContactBoundEnd THEN p.ContactBoundEnd ELSE p.PortSessionEnd END) AS NUMERIC (10, 1)) * CASE WHEN ISNUMERIC(p.CurPorts) = 1 THEN p.CurPorts ELSE 0 END)) AS TotalPortSeconds
                                                                 FROM   (SELECT oae.NewValue AS CurPorts,
                                                                                oae.EventDateTime AS PortSessionStart,
                                                                                ISNULL((SELECT   TOP 1 e.EventDateTime
                                                                                        FROM     dbo.AutoOutboundEvents AS e
                                                                                        WHERE    e.EventDateTime &gt; oae.EventDateTime
                                                                                                 AND e.AutoOutboundEventTypeId = 2
                                                                                                 AND e.Skill_No = @SkillNo
                                                                                        ORDER BY e.EventDateTime), @EndDate) AS PortSessionEnd,
                                                                                d.EarliestRecordCalled AS ContactBoundStart,
                                                                                d.LastRecordDisposed AS ContactBoundEnd
                                                                         FROM   dbo.AutoOutboundEvents AS oae
                                                                         WHERE  oae.Skill_No = @SkillNo
                                                                                AND oae.AutoOutboundEventTypeId = 2
                                                                                AND oae.EventDateTime BETWEEN DATEADD(second, -1, c.StartDateUTC) AND c.EndDateUTC) AS p
                                                                 WHERE  (p.PortSessionStart BETWEEN d.EarliestRecordCalled AND d.LastRecordDisposed
                                                                         OR p.PortSessionEnd BETWEEN d.EarliestRecordCalled AND d.LastRecordDisposed
                                                                         OR (p.PortSessionStart &lt; d.EarliestRecordCalled
                                                                             AND p.PortSessionEnd &gt; d.LastRecordDisposed))) AS e OUTER APPLY (SELECT p.[1] + p.[2] AS Positive,
                                                                                                                                                     p.[3] + p.[4] + p.[5] AS Negative,
                                                                                                                                                     p.[6] AS Other,
                                                                                                                                                     p.[7] + p.[8] AS Followup,
                                                                                                                                                     p.[1] + p.[2] + p.[3] + p.[4] + p.[5] + p.[6] + p.[7] + p.[8] + p.[9] + p.[10] + p.[36] + p.[48] AS LiveVoice,
                                                                                                                                                     p.[11] + p.[12] + p.[14] + p.[19] AS AnsMach
                                                                                                                                              FROM   (SELECT dc.DispositionClassificationId,
                                                                                                                                                             ISNULL(odrclass.DispClassCount, 0) AS DispClassCount
                                                                                                                                                      FROM   dbo.DispositionClassifications AS dc
                                                                                                                                                             LEFT OUTER JOIN
                                                                                                                                                             (SELECT   odr.DispositionClassificationId,
                                                                                                                                                                       COUNT(*) AS DispClassCount
                                                                                                                                                              FROM     dbo.[ProspectiveContactSummaries] AS pcs
                                                                                                                                                                       INNER JOIN
                                                                                                                                                                       dbo.[OutboundDetailRecords] AS odr
                                                                                                                                                                       ON pcs.Bus_No = @busNo
                                                                                                                                                                          AND pcs.Skill_No = @SkillNo
                                                                                                                                                                          AND pcs.LastODR = odr.OutboundDetailRecordId
                                                                                                                                                              WHERE    odr.OverrideFinalDisposition = 0
                                                                                                                                                                       AND odr.Bus_No = @busNo
                                                                                                                                                                       AND odr.Skill_No = @SkillNo
                                                                                                                                                                       AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                                                                                                                                                              GROUP BY odr.DispositionClassificationId) AS odrclass
                                                                                                                                                             ON dc.DispositionClassificationId = odrclass.DispositionClassificationId) AS b PIVOT (SUM (DispClassCount) FOR b.DispositionClassificationId IN ([1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12], [14], [19], [20], [36], [48])) AS p) AS f</td>
        <td>56</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tmpC AS c OUTER APPLY (SELECT   MIN(odr.TimeInitiated) AS EarliestRecordCalled,
                                 MAX(odr.TimeDisposed) AS LastRecordDisposed,
                                 COUNT(DISTINCT odr.OutboundDetailRecordId) AS Presented,
                                 COUNT(h.Master_Contact_Id) AS Reskilled,
                                 CAST (SUM(DATEDIFF(ss, Header_Start_Date, End_Date) / 60.0 / 60.0) AS NUMERIC (10, 3)) AS PortHrs
                        FROM     dbo.OutboundDetailRecords AS odr
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Footer AS f
                                 ON f.Contact_Id = odr.Contact_Id
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Header AS h
                                 ON h.Master_Contact_Id = odr.Contact_Id
                                    AND h.Master_Contact_Id &lt;&gt; h.Contact_Id
                        WHERE    odr.Bus_No = @busNo
                                 AND odr.Skill_No = @SkillNo
                                 AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                        GROUP BY odr.Skill_No) AS d OUTER APPLY (SELECT MAX(p.CurPorts) AS MaxPorts,
                                                                        MIN(p.CurPorts) AS MinPorts,
                                                                        SUM((CAST (DATEDIFF(ss, CASE WHEN p.PortSessionStart &lt; p.ContactBoundStart THEN p.ContactBoundStart ELSE p.PortSessionStart END, CASE WHEN p.PortSessionEnd &gt; p.ContactBoundEnd THEN p.ContactBoundEnd ELSE p.PortSessionEnd END) AS NUMERIC (10, 1)) * CASE WHEN ISNUMERIC(p.CurPorts) = 1 THEN p.CurPorts ELSE 0 END)) AS TotalPortSeconds
                                                                 FROM   (SELECT oae.NewValue AS CurPorts,
                                                                                oae.EventDateTime AS PortSessionStart,
                                                                                ISNULL((SELECT   TOP 1 e.EventDateTime
                                                                                        FROM     dbo.AutoOutboundEvents AS e
                                                                                        WHERE    e.EventDateTime &gt; oae.EventDateTime
                                                                                                 AND e.AutoOutboundEventTypeId = 2
                                                                                                 AND e.Skill_No = @SkillNo
                                                                                        ORDER BY e.EventDateTime), @EndDate) AS PortSessionEnd,
                                                                                d.EarliestRecordCalled AS ContactBoundStart,
                                                                                d.LastRecordDisposed AS ContactBoundEnd
                                                                         FROM   dbo.AutoOutboundEvents AS oae
                                                                         WHERE  oae.Skill_No = @SkillNo
                                                                                AND oae.AutoOutboundEventTypeId = 2
                                                                                AND oae.EventDateTime BETWEEN DATEADD(second, -1, c.StartDateUTC) AND c.EndDateUTC) AS p
                                                                 WHERE  (p.PortSessionStart BETWEEN d.EarliestRecordCalled AND d.LastRecordDisposed
                                                                         OR p.PortSessionEnd BETWEEN d.EarliestRecordCalled AND d.LastRecordDisposed
                                                                         OR (p.PortSessionStart &lt; d.EarliestRecordCalled
                                                                             AND p.PortSessionEnd &gt; d.LastRecordDisposed))) AS e</td>
        <td>56</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tmpC AS c OUTER APPLY (SELECT   MIN(odr.TimeInitiated) AS EarliestRecordCalled,
                                 MAX(odr.TimeDisposed) AS LastRecordDisposed,
                                 COUNT(DISTINCT odr.OutboundDetailRecordId) AS Presented,
                                 COUNT(h.Master_Contact_Id) AS Reskilled,
                                 CAST (SUM(DATEDIFF(ss, Header_Start_Date, End_Date) / 60.0 / 60.0) AS NUMERIC (10, 3)) AS PortHrs
                        FROM     dbo.OutboundDetailRecords AS odr
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Footer AS f
                                 ON f.Contact_Id = odr.Contact_Id
                                 LEFT OUTER JOIN
                                 dbo.Contact_Log_Header AS h
                                 ON h.Master_Contact_Id = odr.Contact_Id
                                    AND h.Master_Contact_Id &lt;&gt; h.Contact_Id
                        WHERE    odr.Bus_No = @busNo
                                 AND odr.Skill_No = @SkillNo
                                 AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
                        GROUP BY odr.Skill_No) AS d</td>
        <td>56</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.SplitDatesToIntervals(a.startTime, a.stopTime, 8640000000, 86400) AS b</td>
        <td>32</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#tmpC AS c</td>
        <td>56</td>
      </tr>
      <tr valign="top">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT odr.OutboundDetailRecordId)</td>
        <td>60</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT odr.OutboundDetailRecordId)</td>
        <td>132</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT CASE WHEN odr.TimeConnected IS NOT NULL THEN odr.OutboundDetailRecordId END)</td>
        <td>133</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">ISNUMERIC</td>
        <td colspan="1">ISNUMERIC(p.CurPorts)</td>
        <td>80</td>
      </tr>
      <tr valign="top">
        <td colspan="1">PIVOT</td>
        <td colspan="1">(SELECT dc.DispositionClassificationId,
        ISNULL(odrclass.DispClassCount, 0) AS DispClassCount
 FROM   dbo.DispositionClassifications AS dc
        LEFT OUTER JOIN
        (SELECT   odr.DispositionClassificationId,
                  COUNT(*) AS DispClassCount
         FROM     dbo.[ProspectiveContactSummaries] AS pcs
                  INNER JOIN
                  dbo.[OutboundDetailRecords] AS odr
                  ON pcs.Bus_No = @busNo
                     AND pcs.Skill_No = @SkillNo
                     AND pcs.LastODR = odr.OutboundDetailRecordId
         WHERE    odr.OverrideFinalDisposition = 0
                  AND odr.Bus_No = @busNo
                  AND odr.Skill_No = @SkillNo
                  AND odr.TimeInitiated BETWEEN c.StartDateUTC AND c.EndDateUTC
         GROUP BY odr.DispositionClassificationId) AS odrclass
        ON dc.DispositionClassificationId = odrclass.DispositionClassificationId) AS b PIVOT (SUM (DispClassCount) FOR b.DispositionClassificationId IN ([1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12], [14], [19], [20], [36], [48])) AS p</td>
        <td>111</td>
      </tr>
    </table>
  </body>
</html>