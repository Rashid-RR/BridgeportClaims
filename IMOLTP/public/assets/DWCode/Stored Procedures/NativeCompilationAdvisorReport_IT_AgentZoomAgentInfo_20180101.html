<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IT_AgentZoomAgentInfo]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IT_AgentZoomAgentInfo]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT o.Outstate_Code AS state_code,
       o.description
INTO   #dw_agentstate
FROM   dbo.Outstates AS o
WHERE  o.Bus_No = @Bus_No
       OR (o.Status = 'CURR'
           AND o.IsSystemOutstate = 1)
UNION
SELECT 0,
       'Available'
UNION
SELECT 1,
       'ACD'
UNION
SELECT 2,
       'Outbound'
UNION
SELECT 3,
       'Unavailable'</td>
        <td>11</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   SUM(h.Duration) AS dur,
         a.Description,
         (CASE WHEN a.State_Code IN (0, 1, 2, 3) THEN a.State_Code ELSE 3 END) AS state_code
INTO     #dw_historical
FROM     dbo.dw_Agent_ByQtrHour AS h
         INNER JOIN
         #dw_agentstate AS a
         ON a.State_Code = h.Agent_State_Code
WHERE    h.Bus_No = @Bus_No
         AND h.Agent_No = ISNULL(@Agent_No, h.Agent_No)
         AND h.Start_Date BETWEEN @UTCStart_Date AND @UTCEnd_Date
GROUP BY a.Description, a.State_Code</td>
        <td>23</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   TOP 1 (CASE WHEN a.AgentStateId = 0 THEN DATEDIFF(SECOND, d.Header_Start_date, d.start_date) ELSE DATEDIFF(SECOND, d.start_date, (ISNULL(dn.start_date, GETUTCDATE()))) END) AS duration,
               ISNULL(a.AgentStateName, '') AS outstate_description,
               (CASE WHEN d.AgentStateID = 0 THEN 3 WHEN d.AgentStateID = 1 THEN 0 WHEN d.AgentStateID = 2 THEN 3 WHEN d.AgentStateID = 3 THEN 1 WHEN d.AgentStateID = 4 THEN 2 WHEN d.AgentStateID = 5 THEN 1 WHEN d.AgentStateID = 6 THEN 2 ELSE 3 END) AS state_code
INTO     #dw_currentState
FROM     dbo.Agent_Log_Detail AS d
         LEFT OUTER JOIN
         dbo.AgentState AS a
         ON d.AgentStateId = a.AgentStateId
         LEFT OUTER JOIN
         dbo.Agent_Log_Detail AS dn
         ON dn.agent_session_id = d.agent_session_id
            AND dn.StateIndex = d.StateIndex + 1
WHERE    d.agent_no = @Agent_No
         AND d.start_date BETWEEN @UTCStart_Date AND @UTCEnd_Date
ORDER BY d.start_date DESC</td>
        <td>43</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN a.State_Code IN (0, 1, 2, 3) THEN a.State_Code ELSE 3 END</td>
        <td>25</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.AgentStateId = 0 THEN DATEDIFF(SECOND, d.Header_Start_date, d.start_date) ELSE DATEDIFF(SECOND, d.start_date, (ISNULL(dn.start_date, GETUTCDATE()))) END</td>
        <td>43</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN d.AgentStateID = 0 THEN 3 WHEN d.AgentStateID = 1 THEN 0 WHEN d.AgentStateID = 2 THEN 3 WHEN d.AgentStateID = 3 THEN 1 WHEN d.AgentStateID = 4 THEN 2 WHEN d.AgentStateID = 5 THEN 1 WHEN d.AgentStateID = 6 THEN 2 ELSE 3 END</td>
        <td>48</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#dw_agentstate AS a</td>
        <td>31</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#dw_historical</td>
        <td>67</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#dw_currentState</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#dw_historical</td>
        <td>70</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">*</td>
        <td colspan="1">SELECT *
FROM   #dw_historical</td>
        <td>70</td>
      </tr>
    </table>
  </body>
</html>