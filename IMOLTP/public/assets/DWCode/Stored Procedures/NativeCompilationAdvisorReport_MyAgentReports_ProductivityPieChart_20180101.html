<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[MyAgentReports_ProductivityPieChart]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[MyAgentReports_ProductivityPieChart]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   Outstate_Code AS state_code,
         'Available' AS description,
         sum(duration) AS dur
INTO     #temp_Available
FROM     dbo.Agent_Log_DetailQV
WHERE    Bus_No = @Bus_No
         AND StartDate BETWEEN @StartDateUTC AND @EndDateUTC
         AND agent_no = @Agent_No
         AND Outstate_Code = 0
         AND AgentStateID = 1
GROUP BY Outstate_Code</td>
        <td>17</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   i.Agent_State_Code AS State_Code,
         CASE WHEN Agent_State_Code = 1 THEN 'ACD' WHEN Agent_State_Code = 2 THEN 'Outbound' END AS [Description],
         sum(i.duration * 1000) AS dur
INTO     #temp_ACD
FROM     [dbo].[dw_Agent_ByQtrHour] AS i
WHERE    i.Bus_No = @Bus_No
         AND i.Agent_State_Code IN (1, 2)
         AND i.Start_Date BETWEEN @StartDateUTC AND @EndDateUTC
         AND i.Agent_No = @Agent_No
GROUP BY i.Agent_State_Code</td>
        <td>32</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT outstate_code AS state_code,
       description AS StateDescription,
       CASE WHEN IsSystemOutstate = 1 THEN 1 WHEN (IsSystemOutstate = 0
                                                   AND IsACW = 'T') THEN 2 ELSE 3 END AS OutstateType
INTO   #temp_AgentState
FROM   dbo.Outstates
WHERE  bus_no = @bus_no
       OR IsSystemOutstate = 1</td>
        <td>48</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.state_code AS state_code,
         CASE WHEN (ald.AgentStateID = 2
                    AND a.StateDescription IS NULL) THEN 'Unavailable' END AS StateDescription,
         sum(ald.duration) AS dur
INTO     #temp_unavailable
FROM     dbo.Agent_Log_DetailQV AS ald
         LEFT OUTER JOIN
         #temp_AgentState AS a
         ON a.state_code = ald.Outstate_Code
WHERE    ald.bus_no = @Bus_No
         AND ald.agent_no = @Agent_No
         AND ald.startDate BETWEEN @StartDateUTC AND @EndDateUTC
GROUP BY a.state_code, ald.AgentStateID, a.StateDescription</td>
        <td>65</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN Agent_State_Code = 1 THEN 'ACD' WHEN Agent_State_Code = 2 THEN 'Outbound' END</td>
        <td>33</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsSystemOutstate = 1 THEN 1 WHEN (IsSystemOutstate = 0
                                            AND IsACW = 'T') THEN 2 ELSE 3 END</td>
        <td>52</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN (ald.AgentStateID = 2
           AND a.StateDescription IS NULL) THEN 'Unavailable' END</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#temp_AgentState AS a</td>
        <td>73</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dw_agentstate AS s</td>
        <td>97</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#temp_unavailable AS u</td>
        <td>106</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#temp_Available</td>
        <td>112</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#temp_ACD</td>
        <td>117</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">WITH clause</td>
        <td colspan="1">WITH dw_agentstate (state_code, description)
AS (SELECT outstate_code AS state_code,
           description
    FROM   dbo.outstates
    WHERE  (Bus_No = @Bus_No
            OR (IsSystemOutstate = 1
                AND [status] = 'CURR'))
    UNION
    SELECT 1,
           'ACD'
    UNION
    SELECT 2,
           'Outbound')</td>
        <td>79</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1"> dw_agentstate (state_code, description)
AS (SELECT outstate_code AS state_code,
           description
    FROM   dbo.outstates
    WHERE  (Bus_No = @Bus_No
            OR (IsSystemOutstate = 1
                AND [status] = 'CURR'))
    UNION
    SELECT 1,
           'ACD'
    UNION
    SELECT 2,
           'Outbound')</td>
        <td>79</td>
      </tr>
    </table>
  </body>
</html>