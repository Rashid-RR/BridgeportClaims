<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[WFMDC_GetOutboundStatisticsForAllEnabledBusinessUnits]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[WFMDC_GetOutboundStatisticsForAllEnabledBusinessUnits]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:12 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT DISTINCT bu.Business_Unit_Name,
                bu.Bus_No
INTO   #WFM_BUs
FROM   dbo.Business_Unit AS bu
       INNER JOIN
       dbo.ProductTeamAssignments AS pta
       ON pta.Bus_No = bu.Bus_No
       INNER JOIN
       dbo.Business_Unit_Verint_Server AS buvs
       ON buvs.Bus_No = pta.Bus_No
WHERE  pta.ProductID IN (26, 24, 18, 20)
       AND buvs.VerintServerID = @VerintServerID
       AND bu.Bus_No = ISNULL(@Local_Bus_No, bu.Bus_No)</td>
        <td>20</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT cld.Contact_id,
       cld.Bus_No,
       dbo.fn_CalcQtrHourDateTime(ISNULL(cld.START_DATE, @Local_Start_Date)) AS QtrStartDate
INTO   #Contacts
FROM   #WFM_BUs AS wfm
       INNER JOIN
       dbo.Contact_Log_Header AS cld
       ON cld.Bus_No = wfm.Bus_No
WHERE  (cld.start_date &gt;= @Local_Start_Date
        AND cld.start_date &lt; @Local_End_Date)
       OR (cld.start_date &gt;= @Local_Start_Date_Previous
           AND cld.start_date &lt; @Local_End_Date_Previous)</td>
        <td>31</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT bu.Bus_No,
                bu.Business_Unit_Name,
                ps.QtrStartDate
INTO   #Combined
FROM   #WFM_BUs AS bu CROSS JOIN (SELECT DISTINCT Bus_No,
                                                  QtrStartDate
                                  FROM   #Contacts) AS ps</td>
        <td>82</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT cb.Bus_No,
       cb.Business_Unit_Name,
       cb.QtrStartDate,
       c.Contact_ID
INTO   #CompleteContacts
FROM   #Combined AS cb
       LEFT OUTER JOIN
       #Contacts AS c
       ON c.QtrStartDate = cb.QtrStartDate
          AND c.Bus_No = cb.Bus_No</td>
        <td>93</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT c.Bus_No,
       c.Business_Unit_Name,
       c.QtrStartDate,
       c.Contact_ID,
       cld.Contact_State,
       cld.Direction,
       cld.Duration,
       sk.Skill_No,
       sk.Skill_Name,
       sk.Outbound_Skill AS IsOB,
       dis.DispositionClassificationID,
       discls.ReportingGroupID
INTO   #ContactLogHeader
FROM   #CompleteContacts AS c
       LEFT OUTER JOIN
       dbo.Contact_Log_DetailQV AS cld
       ON c.Contact_ID = cld.Contact_ID
       LEFT OUTER JOIN
       dbo.Skills AS sk
       ON sk.Skill_no = cld.Skill_No
          AND sk.Media_Type = 4
          AND (sk.IsDialer = 1
               OR sk.IsNaturalCalling = 1)
       LEFT OUTER JOIN
       dbo.Contact_Log_Dispositions AS cldis
       ON cldis.Contact_ID = cld.Contact_Id
       LEFT OUTER JOIN
       dbo.Dispositions AS dis
       ON cldis.Disposition_Code = dis.Disposition_Code
       LEFT OUTER JOIN
       dbo.DispositionClassifications AS discls
       ON dis.DispositionClassificationID = discls.DispositionClassificationID
       LEFT OUTER JOIN
       dbo.ReportingGroups_VW AS rgs
       ON discls.ReportingGroupID = rgs.ReportingGroupID</td>
        <td>103</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   clh.Skill_No,
         QtrStartDate,
         CAST (SUM(ISNULL(clh.Duration, 0)) AS BIGINT) AS Total_Talk_Time
INTO     #TotalTalkTime
FROM     #ContactLogHeader AS clh
WHERE    clh.Contact_ID IN (SELECT Contact_ID
                            FROM   #ContactLogHeader
                            WHERE  Contact_State IN (4))
GROUP BY clh.Skill_No, QtrStartDate</td>
        <td>144</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   rud.Skill_No,
         QtrStartDate,
         SUM(rud.Positive_Outcomes) AS [Positive_Outcomes],
         SUM(rud.Negative_Outcomes) AS [Negative_Outcomes]
INTO     #RightPartyConnects
FROM     (SELECT   clh.Contact_ID,
                   clh.Skill_No,
                   clh.QtrStartDate,
                   CASE WHEN clh.ReportingGroupID = 1 THEN 1 ELSE 0 END AS [Positive_Outcomes],
                   CASE WHEN clh.ReportingGroupID = 2 THEN 1 ELSE 0 END AS [Negative_Outcomes]
          FROM     #ContactLogHeader AS clh
          GROUP BY clh.Contact_ID, clh.Skill_No, clh.QtrStartDate, clh.ReportingGroupID) AS rud
GROUP BY rud.Skill_No, QtrStartDate</td>
        <td>157</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   rud.Skill_No,
         QtrStartDate,
         SUM(rud.OB_Talk_Time_Positive_Values) AS OB_Talk_Time_Positive,
         SUM(rud.OB_Talk_Time_Negative_Values) AS OB_Talk_Time_Negative
INTO     #TimeMetrics
FROM     (SELECT   clh.Skill_No,
                   clh.QtrStartDate,
                   CASE WHEN clh.IsOB = 1
                             AND clh.ReportingGroupID = 1 THEN clh.Duration ELSE 0 END AS OB_Talk_Time_Positive_Values,
                   CASE WHEN clh.IsOB = 1
                             AND clh.ReportingGroupID = 2 THEN clh.Duration ELSE 0 END AS OB_Talk_Time_Negative_Values
          FROM     #ContactLogHeader AS clh
          GROUP BY clh.Skill_No, clh.QtrStartDate, clh.IsOB, clh.ReportingGroupID, clh.Duration) AS rud
GROUP BY rud.Skill_No, QtrStartDate</td>
        <td>177</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#WFM_BUs AS wfm</td>
        <td>35</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">cts</td>
        <td>41</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Contacts AS cts</td>
        <td>42</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#WFM_BUs AS wb</td>
        <td>46</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Contacts</td>
        <td>51</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#WFM_BUs</td>
        <td>64</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#WFM_BUs</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#WFM_BUs AS bu</td>
        <td>86</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Contacts</td>
        <td>90</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Combined AS cb</td>
        <td>98</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Contacts AS c</td>
        <td>99</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#CompleteContacts AS c</td>
        <td>116</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">clh</td>
        <td>130</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS clh</td>
        <td>131</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS clh2</td>
        <td>135</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS clh</td>
        <td>148</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader</td>
        <td>151</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS clh</td>
        <td>168</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS clh</td>
        <td>187</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS clh</td>
        <td>216</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader</td>
        <td>222</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader</td>
        <td>231</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeader AS clh</td>
        <td>240</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#TotalTalkTime AS tt</td>
        <td>245</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RightPartyConnects AS rpc</td>
        <td>247</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#TimeMetrics AS tm</td>
        <td>249</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">DELETE with FROM clause</td>
        <td colspan="1">
FROM #Contacts AS cts</td>
        <td>42</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM dbo.Contact_Log_Detail AS cld
     INNER JOIN
     #WFM_BUs AS wb
     ON wb.Bus_No = cld.Bus_No</td>
        <td>45</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #ContactLogHeader AS clh</td>
        <td>131</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM #ContactLogHeader AS clh2</td>
        <td>135</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT Contact_Id
 FROM   dbo.Contact_Log_Detail AS cld
        INNER JOIN
        #WFM_BUs AS wb
        ON wb.Bus_No = cld.Bus_No
 WHERE  cld.Direction = 2
        AND cld.Contact_State IN (29, 4, 28, 7, 31))</td>
        <td>43</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">(SELECT Contact_ID
 FROM   #Contacts)</td>
        <td>51</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">(SELECT clh2.*
 FROM   #ContactLogHeader AS clh2
 WHERE  clh2.QtrStartDate = clh.QtrStartDate
        AND clh2.Bus_No = clh.Bus_No
        AND clh2.Skill_No IS NOT NULL)</td>
        <td>133</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN clh.ReportingGroupID = 1 THEN 1 ELSE 0 END</td>
        <td>166</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clh.ReportingGroupID = 2 THEN 1 ELSE 0 END</td>
        <td>167</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clh.IsOB = 1
          AND clh.ReportingGroupID = 1 THEN clh.Duration ELSE 0 END</td>
        <td>185</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clh.IsOB = 1
          AND clh.ReportingGroupID = 2 THEN clh.Duration ELSE 0 END</td>
        <td>186</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (ISNULL(oh.OB_Handled, 0) + ISNULL(oab.OB_Abandoned, 0) AS DECIMAL (18, 2)) &gt; 0 THEN CAST ((ROUND(ISNULL(tt.Total_Talk_Time, 0) / 1000.0, 2) / (oh.[OB_Handled] + ISNULL(oab.OB_Abandoned, 0))) AS DECIMAL (18, 2)) ELSE 0.00 END</td>
        <td>208</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (ISNULL(rpc.Positive_Outcomes, 0) + ISNULL(rpc.Negative_Outcomes, 0) AS DECIMAL (18, 2)) &gt; 0 THEN CAST ((ROUND(ISNULL((tm.OB_Talk_Time_Positive + tm.OB_Talk_Time_Negative), 0) / 1000.0, 2) / (rpc.[Positive_Outcomes] + rpc.[Negative_Outcomes])) AS DECIMAL (18, 2)) ELSE 0.00 END</td>
        <td>212</td>
      </tr>
      <tr valign="top">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT Contact_ID)</td>
        <td>221</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT Contact_Id)</td>
        <td>230</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT clh.Contact_Id)</td>
        <td>239</td>
      </tr>
    </table>
  </body>
</html>