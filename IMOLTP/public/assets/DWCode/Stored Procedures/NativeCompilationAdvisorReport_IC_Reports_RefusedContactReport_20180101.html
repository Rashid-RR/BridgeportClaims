<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_RefusedContactReport]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_RefusedContactReport]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   a.bus_no,
         a.Business_Unit_Name AS Business_Unit_Name,
         a.Date,
         COUNT(*) AS BusUnitContacts
INTO     #TotalContacts_ByBusNo
FROM     (SELECT CONVERT (NVARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(h.start_date, @TimeZone), 101) AS Date,
                 h.bus_no,
                 b.Business_Unit_Name
          FROM   dbo.Contact_Log_Header AS h
                 INNER JOIN
                 dbo.Business_unit AS b
                 ON b.bus_no = h.bus_no
          WHERE  h.Start_Date BETWEEN @StartDate AND @EndDate) AS a
GROUP BY a.Date, a.bus_no, a.Business_Unit_Name</td>
        <td>8</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Bus_No,
         a.Reason,
         a.Date,
         COUNT(*) AS Refusals
INTO     #Refusals_ByBusNo_Reason
FROM     (SELECT r.bus_no,
                 r.reason,
                 CONVERT (NVARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(r.refuse_time, @TimeZone), 101) AS Date
          FROM   dbo.RefusedContactLog AS r
          WHERE  r.Refuse_Time BETWEEN @StartDate AND @EndDate
                 AND (@Reason IS NULL
                      OR r.reason = @Reason)) AS a
GROUP BY a.Date, a.Reason, a.Bus_No</td>
        <td>24</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT date,
                reason
INTO   #Distinct_Refusals_ByBusNo_Reason
FROM   #Refusals_ByBusNo_Reason</td>
        <td>42</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   b.date,
         b.reason,
         t.bus_no,
         SUM(t.BusUnitContacts) AS BusUnitContacts
INTO     #Refusals_Contacts_ByBusNo_Reason
FROM     #Distinct_Refusals_ByBusNo_Reason AS b
         INNER JOIN
         #TotalContacts_ByBusNo AS t
         ON t.Date = b.Date
GROUP BY b.date, b.reason, t.bus_no</td>
        <td>47</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   q.Date,
         q.Reason,
         SUM(ISNULL(r.Refusals, 0)) AS Refusals,
         SUM(q.BusUnitContacts) AS TotalContacts,
         STDEVP(ISNULL(r.Refusals, 0)) AS RefusalsStdev,
         CONVERT (DECIMAL (8, 2), STDEVP(ISNULL(r.Refusals, 0))) AS RefusalsStdevp,
         COUNT(*) AS TotalBusUnitCount,
         SUM(CASE WHEN r.bus_no IS NOT NULL THEN 1 ELSE 0 END) AS BusUnitWithRefusals
INTO     #Refusals_ByReason
FROM     #Refusals_Contacts_ByBusNo_Reason AS q
         LEFT OUTER JOIN
         #Refusals_ByBusNo_Reason AS r
         ON r.Date = q.Date
            AND r.reason = q.reason
            AND r.bus_No = q.bus_No
GROUP BY q.Date, q.Reason</td>
        <td>61</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#Refusals_ByBusNo_Reason</td>
        <td>45</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Distinct_Refusals_ByBusNo_Reason AS b</td>
        <td>52</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#TotalContacts_ByBusNo AS t</td>
        <td>53</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Refusals_Contacts_ByBusNo_Reason AS q</td>
        <td>72</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Refusals_ByBusNo_Reason AS r</td>
        <td>73</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Refusals_ByReason AS r</td>
        <td>92</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Refusals_ByReason AS b</td>
        <td>119</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Refusals_ByBusNo_Reason AS r</td>
        <td>120</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#TotalContacts_ByBusNo AS t</td>
        <td>122</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">STDEVP</td>
        <td colspan="1">STDEVP(ISNULL(r.Refusals, 0))</td>
        <td>65</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">STDEVP(ISNULL(r.Refusals, 0))</td>
        <td>66</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN r.bus_no IS NOT NULL THEN 1 ELSE 0 END</td>
        <td>68</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_GetDataRoleFilterItems(@profileID, 'BusinessUnits') AS v</td>
        <td>124</td>
      </tr>
    </table>
  </body>
</html>