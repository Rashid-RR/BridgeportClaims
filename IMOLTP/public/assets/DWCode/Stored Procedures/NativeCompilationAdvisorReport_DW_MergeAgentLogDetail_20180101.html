<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[DW_MergeAgentLogDetail]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[DW_MergeAgentLogDetail]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top">
        <td colspan="1">MERGE</td>
        <td colspan="1">MERGE INTO [Staging].[Agent_Log_Detail]
 AS target
USING [ETLStaging].[Agent_Log_Detail] AS source ON (target.Agent_Session_ID = source.Agent_Session_ID
                                                    AND target.StateIndex = source.StateIndex)
WHEN MATCHED AND source.ActionID IN (1, 2, 3)
                 AND (source.lastTouched &gt; target.lastTouched
                      OR target.lastTouched IS NULL) THEN UPDATE 
SET ActionID               = source.ActionID,
    start_date             = source.start_date,
    AgentStateID           = source.AgentStateID,
    working                = source.working,
    available              = source.available,
    outstate_code          = source.outstate_code,
    log_state              = source.log_state,
    skill_no               = source.skill_no,
    Contact_Id             = source.Contact_Id,
    TargetAgent_No         = source.TargetAgent_No,
    Bus_No                 = source.Bus_No,
    Header_Start_Date      = source.Header_Start_Date,
    PreviousStart_date     = source.PreviousStart_date,
    PreviousWorking        = source.PreviousWorking,
    PreviousAvailable      = source.PreviousAvailable,
    PreviousOutstate_code  = source.PreviousOutstate_code,
    PreviousContact_Id     = source.PreviousContact_Id,
    PreviousSkill_no       = source.PreviousSkill_no,
    Agent_No               = source.Agent_No,
    PreviousTargetAgent_No = source.PreviousTargetAgent_No,
    FailOverCount          = source.FailOverCount,
    PreviousAgentStateID   = source.PreviousAgentStateID,
    lastTouched            = source.lastTouched
WHEN NOT MATCHED AND source.ActionID IN (1, 2, 3) THEN INSERT (ActionID, Agent_Session_ID, StateIndex, start_date, AgentStateID, working, available, outstate_code, log_state, skill_no, Contact_Id, TargetAgent_No, Bus_No, Header_Start_Date, PreviousStart_date, PreviousWorking, PreviousAvailable, PreviousOutstate_code, PreviousContact_Id, PreviousSkill_no, Agent_No, PreviousTargetAgent_No, FailOverCount, PreviousAgentStateID, lastTouched) VALUES (source.ActionID, source.Agent_Session_ID, source.StateIndex, source.start_date, source.AgentStateID, source.working, source.available, source.outstate_code, source.log_state, source.skill_no, source.Contact_Id, source.TargetAgent_No, source.Bus_No, source.Header_Start_Date, source.PreviousStart_date, source.PreviousWorking, source.PreviousAvailable, source.PreviousOutstate_code, source.PreviousContact_Id, source.PreviousSkill_no, source.Agent_No, source.PreviousTargetAgent_No, source.FailOverCount, source.PreviousAgentStateID, source.lastTouched)</td>
        <td>5</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MERGE INTO [Staging].[Agent_Log_Detail]
 AS target
USING [ETLStaging].[Agent_Log_Detail] AS source ON (target.Agent_Session_ID = source.Agent_Session_ID
                                                    AND target.StateIndex = source.StateIndex)
WHEN MATCHED AND source.ActionID IN (1, 2, 3)
                 AND (source.lastTouched &gt; target.lastTouched
                      OR target.lastTouched IS NULL) THEN UPDATE 
SET ActionID               = source.ActionID,
    start_date             = source.start_date,
    AgentStateID           = source.AgentStateID,
    working                = source.working,
    available              = source.available,
    outstate_code          = source.outstate_code,
    log_state              = source.log_state,
    skill_no               = source.skill_no,
    Contact_Id             = source.Contact_Id,
    TargetAgent_No         = source.TargetAgent_No,
    Bus_No                 = source.Bus_No,
    Header_Start_Date      = source.Header_Start_Date,
    PreviousStart_date     = source.PreviousStart_date,
    PreviousWorking        = source.PreviousWorking,
    PreviousAvailable      = source.PreviousAvailable,
    PreviousOutstate_code  = source.PreviousOutstate_code,
    PreviousContact_Id     = source.PreviousContact_Id,
    PreviousSkill_no       = source.PreviousSkill_no,
    Agent_No               = source.Agent_No,
    PreviousTargetAgent_No = source.PreviousTargetAgent_No,
    FailOverCount          = source.FailOverCount,
    PreviousAgentStateID   = source.PreviousAgentStateID,
    lastTouched            = source.lastTouched
WHEN NOT MATCHED AND source.ActionID IN (1, 2, 3) THEN INSERT (ActionID, Agent_Session_ID, StateIndex, start_date, AgentStateID, working, available, outstate_code, log_state, skill_no, Contact_Id, TargetAgent_No, Bus_No, Header_Start_Date, PreviousStart_date, PreviousWorking, PreviousAvailable, PreviousOutstate_code, PreviousContact_Id, PreviousSkill_no, Agent_No, PreviousTargetAgent_No, FailOverCount, PreviousAgentStateID, lastTouched) VALUES (source.ActionID, source.Agent_Session_ID, source.StateIndex, source.start_date, source.AgentStateID, source.working, source.available, source.outstate_code, source.log_state, source.skill_no, source.Contact_Id, source.TargetAgent_No, source.Bus_No, source.Header_Start_Date, source.PreviousStart_date, source.PreviousWorking, source.PreviousAvailable, source.PreviousOutstate_code, source.PreviousContact_Id, source.PreviousSkill_no, source.Agent_No, source.PreviousTargetAgent_No, source.FailOverCount, source.PreviousAgentStateID, source.lastTouched)</td>
        <td>5</td>
      </tr>
    </table>
  </body>
</html>