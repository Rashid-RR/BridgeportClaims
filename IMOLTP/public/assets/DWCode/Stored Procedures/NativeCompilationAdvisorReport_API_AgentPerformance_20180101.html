<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[API_AgentPerformance]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[API_AgentPerformance]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT Agent_No
 FROM   dbo.Agents
 WHERE  Agent_No = @agent
        AND Bus_No = @bus_no)</td>
        <td>6</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">(SELECT Team_No
 FROM   dbo.Team
 WHERE  Team_No = @team
        AND Bus_No = @bus_no)</td>
        <td>9</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT agt.Agent_No AS Agent_No,
       [last_name] + ', ' + [first_name] AS Agent_Name,
       agt.Team_No AS Team_No
INTO   #AgentTable
FROM   [dbo].[Agents] AS agt
       INNER JOIN
       dbo.Security_DataRoles AS dr
       ON (agt.Team_No = dr.EntityID
           OR dr.ViewAllAndFuture = 1)
       INNER JOIN
       dbo.Security_DataRoleEntityTypes AS dret
       ON (dr.DataRoleEntityTypeID = dret.DataRoleEntityTypeID)
WHERE  agt.Bus_No = @bus_no
       AND agt.Status = 'CURR'
       AND ((@agent IS NULL
             AND @team IS NULL)
            OR (@agent IS NOT NULL
                AND agt.Agent_No = @agent)
            OR (@team IS NOT NULL
                AND agt.Team_No = @team))
       AND dret.DataRoleEntityTypeName = 'teams'
       AND dr.SecurityProfileID = @ProfileID</td>
        <td>12</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT cld.Agent_No,
       cld.Contact_Id,
       cld.Contact_State,
       cld.Direction,
       cld.Duration,
       cld.Skill_No
INTO   #ContactLog
FROM   [dbo].[Contact_Log_DetailQV] AS cld
       INNER JOIN
       #AgentTable AS agt
       ON cld.Agent_No = agt.Agent_No
WHERE  Bus_No = @bus_no
       AND startdate BETWEEN @start_date AND @end_date</td>
        <td>28</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT ald.Agent_No,
       ald.AgentStateID,
       ald.Duration,
       ald.Outstate_Code
INTO   #AgentLog
FROM   [dbo].[Agent_Log_DetailQV] AS ald
       INNER JOIN
       #AgentTable AS agt
       ON ald.Agent_No = agt.Agent_No
WHERE  Bus_No = @bus_no
       AND startdate BETWEEN @start_date AND @end_date</td>
        <td>43</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No AS Agent_No,
         COUNT(DISTINCT contact_id) AS [Agent_Offered]
INTO     #Agent_Offered
FROM     #ContactLog
WHERE    Contact_State = 2
         AND Direction = 1
GROUP BY Agent_No</td>
        <td>56</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No AS Agent_No,
         COUNT(DISTINCT contact_id) AS [Inbound_Handled]
INTO     #Inbound_Handled
FROM     #ContactLog
WHERE    Contact_State = 4
         AND Direction = 1
GROUP BY Agent_No</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         SUM(Duration) AS Inbound_Time
INTO     #Inbound_Time
FROM     #AgentLog
WHERE    AgentStateID = 3
GROUP BY Agent_No</td>
        <td>78</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         SUM(Duration) AS Inbound_Talk_Time
INTO     #Inbound_Talk_Time
FROM     #ContactLog
WHERE    Contact_State IN (4, 8, 14)
         AND Direction = 1
GROUP BY Agent_No</td>
        <td>88</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         Count(DISTINCT contact_id) AS [Outbound_Handled]
INTO     #Outbound_Handled
FROM     #ContactLog
WHERE    Contact_State = 4
         AND Direction = 2
GROUP BY Agent_No</td>
        <td>99</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         SUM(Duration) AS Outbound_Time
INTO     #Outbound_Time
FROM     #AgentLog
WHERE    AgentStateID IN (4)
GROUP BY Agent_No</td>
        <td>110</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         SUM(Duration) AS [Outbound_talk_time]
INTO     #Outbound_Talk_Time
FROM     #ContactLog
WHERE    Contact_State IN (4, 8, 14)
         AND direction = 2
GROUP BY Agent_No</td>
        <td>120</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         SUM(Duration) AS Consult_Time
INTO     #Consult_Time
FROM     #AgentLog
WHERE    AgentStateID IN (5, 6)
GROUP BY Agent_No</td>
        <td>131</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         SUM(Duration) AS Available_Time
INTO     #Available_Time
FROM     #AgentLog
WHERE    AgentStateID = 1
GROUP BY Agent_No</td>
        <td>141</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         SUM(Duration) AS Unavailable_Time
INTO     #Unavailable_Time
FROM     #AgentLog
WHERE    AgentStateID IN (0, 8, 2)
GROUP BY Agent_No</td>
        <td>151</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   al.Agent_No,
         SUM(Duration) AS ACW_Time
INTO     #ACW_Time
FROM     #AgentLog AS al
         INNER JOIN
         [dbo].[Outstates] AS os
         ON al.Outstate_Code = os.Outstate_Code
WHERE    os.IsACW = 'T'
         AND os.IsSystemOutstate = 0
GROUP BY al.Agent_No</td>
        <td>161</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         COUNT(DISTINCT contact_id) AS Refused
INTO     #Refused
FROM     #ContactLog
WHERE    Contact_State = 24
         AND Direction = 1
GROUP BY Agent_No</td>
        <td>173</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   Agent_No,
         SUM(Duration) AS Login_Time
INTO     #Login_Time
FROM     #AgentLog
GROUP BY Agent_No</td>
        <td>184</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#AgentTable AS agt</td>
        <td>37</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS agt</td>
        <td>50</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLog</td>
        <td>60</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLog</td>
        <td>71</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLog</td>
        <td>82</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLog</td>
        <td>92</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLog</td>
        <td>103</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLog</td>
        <td>114</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLog</td>
        <td>124</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLog</td>
        <td>135</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLog</td>
        <td>145</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLog</td>
        <td>155</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLog AS al</td>
        <td>165</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLog</td>
        <td>177</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLog</td>
        <td>188</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ResultTable AS b</td>
        <td>267</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentTable AS a</td>
        <td>226</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Agent_Offered AS ao</td>
        <td>227</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Inbound_Handled AS c</td>
        <td>228</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Inbound_Time AS d</td>
        <td>229</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Inbound_Talk_Time AS e</td>
        <td>230</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Outbound_Handled AS f</td>
        <td>231</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Outbound_Time AS g</td>
        <td>232</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Outbound_talk_time AS h</td>
        <td>233</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Consult_Time AS i</td>
        <td>234</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Available_Time AS j</td>
        <td>235</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Unavailable_Time AS k</td>
        <td>236</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ACW_Time AS l</td>
        <td>237</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Refused AS m</td>
        <td>238</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Login_Time AS n</td>
        <td>239</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT contact_id)</td>
        <td>58</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT contact_id)</td>
        <td>69</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Count(DISTINCT contact_id)</td>
        <td>101</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT contact_id)</td>
        <td>175</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">NULLIF</td>
        <td colspan="1">NULLIF ([Inbound_Handled], 0)</td>
        <td>248</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NULLIF ([Outbound_Handled], 0)</td>
        <td>252</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NULLIF ((ISNULL(Inbound_Handled, 0) + ISNULL(Outbound_Handled, 0)) * 1.0, 0)</td>
        <td>255</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NULLIF ((ISNULL(Inbound_Handled, 0) + ISNULL(Outbound_Handled, 0)) * 1.0, 0)</td>
        <td>256</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NULLIF (ISNULL(Agent_Offered, 0), 0)</td>
        <td>262</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NULLIF (Login_Time, 0)</td>
        <td>264</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NULLIF (((ISNULL(ACW_Time, 0) + ISNULL(Inbound_talk_time, 0) + ISNULL(Outbound_talk_time, 0)) + ISNULL(Available_Time, 0)), 0)</td>
        <td>265</td>
      </tr>
      <tr valign="top">
        <td colspan="1">WITH clause</td>
        <td colspan="1">WITH ResultTable (Agent_No, Team_No, Agent_Offered, Inbound_Handled, Inbound_Time, Inbound_Talk_Time, Outbound_Handled, Outbound_Time, Outbound_Talk_Time, Consult_Time, Available_Time, Unavailable_Time, ACW_Time, Refused, Login_Time)
AS (SELECT a.Agent_No,
           Team_No,
           Agent_Offered,
           Inbound_Handled,
           Inbound_Time,
           Inbound_Talk_Time,
           Outbound_Handled,
           Outbound_Time,
           Outbound_talk_time,
           Consult_Time,
           Available_Time,
           Unavailable_Time,
           ACW_Time,
           Refused,
           Login_Time
    FROM   #AgentTable AS a
           LEFT OUTER JOIN
           #Agent_Offered AS ao
           ON a.Agent_No = ao.Agent_No
           LEFT OUTER JOIN
           #Inbound_Handled AS c
           ON a.Agent_No = c.Agent_No
           LEFT OUTER JOIN
           #Inbound_Time AS d
           ON a.Agent_No = d.Agent_No
           LEFT OUTER JOIN
           #Inbound_Talk_Time AS e
           ON a.Agent_No = e.Agent_No
           LEFT OUTER JOIN
           #Outbound_Handled AS f
           ON a.Agent_No = f.Agent_No
           LEFT OUTER JOIN
           #Outbound_Time AS g
           ON a.Agent_No = g.Agent_No
           LEFT OUTER JOIN
           #Outbound_talk_time AS h
           ON a.Agent_No = h.Agent_No
           LEFT OUTER JOIN
           #Consult_Time AS i
           ON a.Agent_No = i.Agent_No
           LEFT OUTER JOIN
           #Available_Time AS j
           ON a.Agent_No = j.Agent_No
           LEFT OUTER JOIN
           #Unavailable_Time AS k
           ON a.Agent_No = k.Agent_No
           LEFT OUTER JOIN
           #ACW_Time AS l
           ON a.Agent_No = l.Agent_No
           LEFT OUTER JOIN
           #Refused AS m
           ON a.Agent_No = m.Agent_No
           LEFT OUTER JOIN
           #Login_Time AS n
           ON a.Agent_No = n.Agent_No)</td>
        <td>192</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1"> ResultTable (Agent_No, Team_No, Agent_Offered, Inbound_Handled, Inbound_Time, Inbound_Talk_Time, Outbound_Handled, Outbound_Time, Outbound_Talk_Time, Consult_Time, Available_Time, Unavailable_Time, ACW_Time, Refused, Login_Time)
AS (SELECT a.Agent_No,
           Team_No,
           Agent_Offered,
           Inbound_Handled,
           Inbound_Time,
           Inbound_Talk_Time,
           Outbound_Handled,
           Outbound_Time,
           Outbound_talk_time,
           Consult_Time,
           Available_Time,
           Unavailable_Time,
           ACW_Time,
           Refused,
           Login_Time
    FROM   #AgentTable AS a
           LEFT OUTER JOIN
           #Agent_Offered AS ao
           ON a.Agent_No = ao.Agent_No
           LEFT OUTER JOIN
           #Inbound_Handled AS c
           ON a.Agent_No = c.Agent_No
           LEFT OUTER JOIN
           #Inbound_Time AS d
           ON a.Agent_No = d.Agent_No
           LEFT OUTER JOIN
           #Inbound_Talk_Time AS e
           ON a.Agent_No = e.Agent_No
           LEFT OUTER JOIN
           #Outbound_Handled AS f
           ON a.Agent_No = f.Agent_No
           LEFT OUTER JOIN
           #Outbound_Time AS g
           ON a.Agent_No = g.Agent_No
           LEFT OUTER JOIN
           #Outbound_talk_time AS h
           ON a.Agent_No = h.Agent_No
           LEFT OUTER JOIN
           #Consult_Time AS i
           ON a.Agent_No = i.Agent_No
           LEFT OUTER JOIN
           #Available_Time AS j
           ON a.Agent_No = j.Agent_No
           LEFT OUTER JOIN
           #Unavailable_Time AS k
           ON a.Agent_No = k.Agent_No
           LEFT OUTER JOIN
           #ACW_Time AS l
           ON a.Agent_No = l.Agent_No
           LEFT OUTER JOIN
           #Refused AS m
           ON a.Agent_No = m.Agent_No
           LEFT OUTER JOIN
           #Login_Time AS n
           ON a.Agent_No = n.Agent_No)</td>
        <td>192</td>
      </tr>
    </table>
  </body>
</html>