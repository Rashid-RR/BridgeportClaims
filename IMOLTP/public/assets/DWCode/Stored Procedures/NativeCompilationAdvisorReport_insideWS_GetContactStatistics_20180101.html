<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[insideWS_GetContactStatistics]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[insideWS_GetContactStatistics]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:12 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN @CurQtrHour_Code = 95 THEN 0 ELSE @CurQtrHour_Code + 1 END</td>
        <td>86</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN r.Abandon = 'Y' THEN 1 ELSE 0 END</td>
        <td>99</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">Business_unit</td>
        <td>93</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Skill AS sk</td>
        <td>137</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Skill AS ts</td>
        <td>161</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Agent AS ag</td>
        <td>162</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   r.Skill_No,
         COUNT(*) AS [Calls],
         AVG((s.PreQueue_time + s.InQueue_time + s.Agent_time + s.PostQueue_time + s.Hold_time) / 1000) AS [AHT],
         SUM(CASE WHEN r.Abandon = 'Y' THEN 1 ELSE 0 END) AS [AB],
         ISNULL(ROUND((CAST (SUM(in_sla) AS DECIMAL) / CAST (SUM(Total_Cnt) AS DECIMAL)) * 100, 0), 0) AS [SL],
         AVG((s.PreQueue_time + s.InQueue_time + s.Hold_time) / 1000) AS [ASA]
INTO     #Skill
FROM     dbo.Contact_Log_Header AS l
         LEFT OUTER JOIN
         dbo.Contact_Log_Footer AS r
         ON r.Bus_No = l.Bus_No
            AND r.Contact_ID = l.Contact_ID
         LEFT OUTER JOIN
         dbo.Contact_Log_Summary AS s
         ON s.Bus_No = l.Bus_No
            AND s.Contact_ID = l.Contact_ID
         LEFT OUTER JOIN
         dbo.dw_sla_Skill_ByQtrHour AS sl
         ON s.Bus_No = sl.Bus_No
            AND r.Skill_No = sl.Skill_No
WHERE    l.Bus_No = @BusNo
         AND (l.QtrHour_Code = @CurQtrHour_Code
              OR l.QtrHour_Code = @CurQtrHour_Code_Next)
         AND l.start_date &gt;= @startdate
         AND l.start_date &lt; @enddate
         AND sl.QtrHour_Code = @CurQtrHour_Code
GROUP BY r.Skill_No</td>
        <td>95</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   ak.skill_no,
         AVG(d.Total_time / 60) AS Total_time
INTO     #agent
FROM     dbo.dw_agent_team_byQtrHour AS d
         INNER JOIN
         dbo.AgentSkl AS ak
         ON d.Bus_No = ak.Bus_No
            AND d.agent_no = ak.agent_no
            AND ak.Status = 'CURR'
         INNER JOIN
         #Skill AS sk
         ON ak.skill_no = sk.skill_no
WHERE    d.Bus_No = @BusNo
         AND ((d.qtrhour_code = @CurQtrHour_Code)
              OR (d.qtrhour_code = @CurQtrHour_Code_Next))
         AND d.start_date &gt;= @startdate
         AND d.start_date &lt; @enddate
GROUP BY ak.skill_no</td>
        <td>127</td>
      </tr>
    </table>
  </body>
</html>