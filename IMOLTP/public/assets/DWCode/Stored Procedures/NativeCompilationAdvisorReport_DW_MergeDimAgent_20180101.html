<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[DW_MergeDimAgent]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[DW_MergeDimAgent]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top">
        <td colspan="1">MERGE</td>
        <td colspan="1">MERGE INTO dbo.DimAgent
 AS target
USING ETL.DimAgent AS source ON target.AgentNo = source.AgentNo
WHEN NOT MATCHED THEN INSERT (BusNo, AgentNo, TeamNo, TeamNoCurrent, ReportsTo, ReportsToCurrent, FirstName, MiddleName, LastName, Status, EffectiveDate) VALUES (source.BusNo, source.AgentNo, source.TeamNo, source.TeamNo, source.ReportsTo, source.ReportsTo, source.FirstName, source.MiddleName, source.LastName, source.Status, source.EffectiveDate)
WHEN MATCHED AND (source.BusNo != target.BusNo
                  OR source.TeamNo != target.TeamNoCurrent
                  OR source.ReportsTo != target.ReportsToCurrent
                  OR source.FirstName != target.FirstName
                  OR source.MiddleName != target.MiddleName
                  OR source.LastName != target.LastName
                  OR source.Status != target.Status) THEN UPDATE 
SET BusNo            = source.BusNo,
    TeamNoCurrent    = source.TeamNo,
    ReportsToCurrent = source.ReportsTo,
    FirstName        = source.FirstName,
    MiddleName       = source.MiddleName,
    LastName         = source.LastName,
    Status           = source.Status,
    EndDate          = CASE WHEN target.EndDate IS NULL
                                 AND (source.TeamNo != target.TeamNoCurrent
                                      OR source.ReportsTo != target.ReportsToCurrent) THEN source.EffectiveDate ELSE EndDate END,
    IsInferred       = 0
OUTPUT source.BusNo, source.AgentNo, source.TeamNo, source.ReportsTo, source.FirstName, source.MiddleName, source.LastName, source.Status, source.EffectiveDate, CASE WHEN deleted.EndDate IS NULL
                                                                                                                                                                           AND inserted.EndDate IS NOT NULL THEN 1 ELSE 0 END AS HistoricalChange INTO @HistoricalInsert</td>
        <td>19</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MERGE INTO dbo.DimAgent
 AS target
USING ETL.DimAgent AS source ON target.AgentNo = source.AgentNo
WHEN NOT MATCHED THEN INSERT (BusNo, AgentNo, TeamNo, TeamNoCurrent, ReportsTo, ReportsToCurrent, FirstName, MiddleName, LastName, Status, EffectiveDate) VALUES (source.BusNo, source.AgentNo, source.TeamNo, source.TeamNo, source.ReportsTo, source.ReportsTo, source.FirstName, source.MiddleName, source.LastName, source.Status, source.EffectiveDate)
WHEN MATCHED AND (source.BusNo != target.BusNo
                  OR source.TeamNo != target.TeamNoCurrent
                  OR source.ReportsTo != target.ReportsToCurrent
                  OR source.FirstName != target.FirstName
                  OR source.MiddleName != target.MiddleName
                  OR source.LastName != target.LastName
                  OR source.Status != target.Status) THEN UPDATE 
SET BusNo            = source.BusNo,
    TeamNoCurrent    = source.TeamNo,
    ReportsToCurrent = source.ReportsTo,
    FirstName        = source.FirstName,
    MiddleName       = source.MiddleName,
    LastName         = source.LastName,
    Status           = source.Status,
    EndDate          = CASE WHEN target.EndDate IS NULL
                                 AND (source.TeamNo != target.TeamNoCurrent
                                      OR source.ReportsTo != target.ReportsToCurrent) THEN source.EffectiveDate ELSE EndDate END,
    IsInferred       = 0
OUTPUT source.BusNo, source.AgentNo, source.TeamNo, source.ReportsTo, source.FirstName, source.MiddleName, source.LastName, source.Status, source.EffectiveDate, CASE WHEN deleted.EndDate IS NULL
                                                                                                                                                                           AND inserted.EndDate IS NOT NULL THEN 1 ELSE 0 END AS HistoricalChange INTO @HistoricalInsert</td>
        <td>19</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN deleted.EndDate IS NULL
          AND inserted.EndDate IS NOT NULL THEN 1 ELSE 0 END</td>
        <td>84</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.EndDate IS NULL
          AND (source.TeamNo != target.TeamNoCurrent
               OR source.ReportsTo != target.ReportsToCurrent) THEN source.EffectiveDate ELSE EndDate END</td>
        <td>72</td>
      </tr>
    </table>
  </body>
</html>