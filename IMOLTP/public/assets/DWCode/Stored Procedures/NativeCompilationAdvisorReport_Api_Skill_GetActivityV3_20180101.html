<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[Api_Skill_GetActivityV3]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[Api_Skill_GetActivityV3]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">@@servername</td>
        <td colspan="1">@@ServerName</td>
        <td>18</td>
      </tr>
      <tr valign="top">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT r.[agent_no],
       r.[bus_no],
       CONVERT (INT, r.[working]) AS [working],
       CONVERT (INT, r.[available]) AS [available],
       r.[skill_no],
       r.[outstate_code]
INTO   #temprtagents
FROM   [dbo].[rt_agent_log] AS r</td>
        <td>57</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   h.[skill_no],
         Sum(h.[in_sla]) AS In_SLA,
         Sum(h.[out_sla]) AS Out_SLA
INTO     #tempsla
FROM     [dbo].[dw_sla_skill_byqtrhour] AS h
         INNER JOIN
         [dbo].[skills] AS s
         ON s.[skill_no] = h.[skill_no]
         INNER JOIN
         dbo.business_unit AS b
         ON b.bus_no = s.bus_no
         INNER JOIN
         @TimeZoneDates AS t
         ON t.timezone = b.defaulttimezone
WHERE    s.[status] = 'CURR'
         AND h.start_date BETWEEN t.utcstartdate AND t.utcenddate
GROUP BY h.[skill_no]</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   r.[skill_no],
         Sum(CASE c.category1 WHEN 'InQueue' THEN 1 ELSE 0 END) AS QueueCount,
         Sum(CASE WHEN c.[state_description] = 'ACTIVE' THEN 1 ELSE 0 END) AS ActiveContacts
INTO     #temprtcontacts
FROM     [dbo].[rt_contact_log] AS r
         INNER JOIN
         [dbo].[skills] AS s
         ON s.[skill_no] = r.[skill_no]
         INNER JOIN
         [dbo].[contact_state] AS c
         ON c.[contact_state] = r.[current_contact_state]
WHERE    s.[status] = 'CURR'
GROUP BY r.[skill_no]
UNION ALL
SELECT   p.[skill_no],
         Sum(CASE c.category1 WHEN 'InQueue' THEN 1 ELSE 0 END) AS QueueCount,
         Sum(CASE WHEN c.[state_description] = 'ACTIVE' THEN 1 ELSE 0 END) AS ActiveContacts
FROM     [dbo].[persistentcontactlog] AS p
         INNER JOIN
         [dbo].[skills] AS s
         ON s.[skill_no] = p.[skill_no]
         INNER JOIN
         [dbo].[contact_state] AS c
         ON c.[contact_state] = p.[current_contact_state]
WHERE    s.[status] = 'CURR'
GROUP BY p.[skill_no]</td>
        <td>83</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.[skill_no],
         Count(r.[agent_no]) AS AgentsloggedIn,
         Sum(CASE WHEN r.[skill_no] = s.[skill_no] THEN 1 ELSE 0 END) AS AgentsWorking,
         Sum(CASE Isnull(r.[working], -1) WHEN 0 THEN CASE Isnull(r.[available], -1) WHEN 1 THEN 1 ELSE 0 END ELSE 0 END) AS AgentsIdle,
         Sum(CASE Isnull(r.[working], -1) WHEN 0 THEN CASE Isnull(r.[available], -1) WHEN 0 THEN 1 ELSE 0 END ELSE 0 END) AS AgentsUnavailable,
         Sum(CASE Isnull(r.[available], 0) WHEN 1 THEN 1 ELSE 0 END) AS AgentsAvailable,
         Sum(CASE WHEN o.[isacw] = 'T'
                       AND o.[issystemoutstate] = 0 THEN 1 ELSE 0 END) AS AgentsAcw
INTO     #temprtagentskills
FROM     [dbo].[agentskl] AS a
         INNER JOIN
         [dbo].[skills] AS s
         ON s.[skill_no] = a.[skill_no]
         INNER JOIN
         [#temprtagents] AS r
         ON r.[agent_no] = a.[agent_no]
         LEFT OUTER JOIN
         [dbo].[outstates] AS o
         ON o.[outstate_code] = r.[outstate_code]
WHERE    a.[status] = 'CURR'
         AND s.[status] = 'CURR'
GROUP BY a.[skill_no]</td>
        <td>121</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE c.category1 WHEN 'InQueue' THEN 1 ELSE 0 END</td>
        <td>84</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN c.[state_description] = 'ACTIVE' THEN 1 ELSE 0 END</td>
        <td>88</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE c.category1 WHEN 'InQueue' THEN 1 ELSE 0 END</td>
        <td>103</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN c.[state_description] = 'ACTIVE' THEN 1 ELSE 0 END</td>
        <td>107</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN r.[skill_no] = s.[skill_no] THEN 1 ELSE 0 END</td>
        <td>123</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE Isnull(r.[working], -1) WHEN 0 THEN CASE Isnull(r.[available], -1) WHEN 1 THEN 1 ELSE 0 END ELSE 0 END</td>
        <td>127</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE Isnull(r.[available], -1) WHEN 1 THEN 1 ELSE 0 END</td>
        <td>129</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE Isnull(r.[working], -1) WHEN 0 THEN CASE Isnull(r.[available], -1) WHEN 0 THEN 1 ELSE 0 END ELSE 0 END</td>
        <td>135</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE Isnull(r.[available], -1) WHEN 0 THEN 1 ELSE 0 END</td>
        <td>137</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE Isnull(r.[available], 0) WHEN 1 THEN 1 ELSE 0 END</td>
        <td>143</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN o.[isacw] = 'T'
          AND o.[issystemoutstate] = 0 THEN 1 ELSE 0 END</td>
        <td>147</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE (ISNULL(a.[In_SLA], 0) + ISNULL(a.[Out_SLA], 0)) WHEN 0 THEN 100 ELSE CONVERT (INT, ROUND(((1.0 * ISNULL(a.[In_SLA], 0)) / (ISNULL(a.[In_SLA], 0) + ISNULL(a.[Out_SLA], 0))) * 100, 0)) END</td>
        <td>170</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">[#temprtagents] AS r</td>
        <td>156</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">[#tempsla] AS a</td>
        <td>196</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">[#temprtcontacts] AS r</td>
        <td>198</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">[#temprtagentskills] AS k</td>
        <td>200</td>
      </tr>
    </table>
  </body>
</html>