<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[DW_MergeRTAgentLog]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[DW_MergeRTAgentLog]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:09 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top">
        <td colspan="1">MERGE</td>
        <td colspan="1">MERGE INTO [dbo].[RT_Agent_Log]
 AS target
USING (SELECT Agent_Session_ID,
              agent_no,
              team_no,
              bus_no,
              start_date,
              working,
              available,
              outstate_code,
              log_state,
              skill_no,
              Contact_Id,
              Station_Id,
              StationPhoneNumber,
              Proficiency,
              InDeliveryProcess,
              TargetAgent_No,
              AgentStateID,
              DialerLogoutRequested,
              DialerLoginRequested
       FROM   (SELECT Agent_Session_ID,
                      agent_no,
                      team_no,
                      bus_no,
                      start_date,
                      working,
                      available,
                      outstate_code,
                      log_state,
                      skill_no,
                      Contact_Id,
                      Station_Id,
                      StationPhoneNumber,
                      Proficiency,
                      InDeliveryProcess,
                      TargetAgent_No,
                      AgentStateID,
                      DialerLogoutRequested,
                      DialerLoginRequested,
                      ROW_NUMBER() OVER (PARTITION BY Agent_Session_ID ORDER BY Agent_Session_ID) AS RowNum
               FROM   [ETL].[RT_Agent_Log]) AS dup
       WHERE  dup.RowNum = 1) AS source ON (target.Agent_Session_ID = source.Agent_Session_ID)
WHEN MATCHED AND (target.agent_no != source.agent_no
                  OR target.team_no != source.team_no
                  OR target.bus_no != source.bus_no
                  OR target.start_date != source.start_date
                  OR target.working != source.working
                  OR target.available != source.available
                  OR CASE WHEN target.outstate_code = source.outstate_code
                               OR target.outstate_code IS NULL
                                  AND source.outstate_code IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.log_state = source.log_state
                               OR target.log_state IS NULL
                                  AND source.log_state IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.skill_no = source.skill_no
                               OR target.skill_no IS NULL
                                  AND source.skill_no IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.Contact_Id = source.Contact_Id
                               OR target.Contact_Id IS NULL
                                  AND source.Contact_Id IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.Station_Id = source.Station_Id
                               OR target.Station_Id IS NULL
                                  AND source.Station_Id IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.StationPhoneNumber = source.StationPhoneNumber
                               OR target.StationPhoneNumber IS NULL
                                  AND source.StationPhoneNumber IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.Proficiency = source.Proficiency
                               OR target.Proficiency IS NULL
                                  AND source.Proficiency IS NULL THEN 0 END IS NULL
                  OR target.InDeliveryProcess != source.InDeliveryProcess
                  OR CASE WHEN target.TargetAgent_No = source.TargetAgent_No
                               OR target.TargetAgent_No IS NULL
                                  AND source.TargetAgent_No IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.AgentStateID = source.AgentStateID
                               OR target.AgentStateID IS NULL
                                  AND source.AgentStateID IS NULL THEN 0 END IS NULL
                  OR target.DialerLogoutRequested != source.DialerLogoutRequested
                  OR target.DialerLoginRequested != source.DialerLoginRequested) THEN UPDATE 
SET agent_no              = source.agent_no,
    team_no               = source.team_no,
    bus_no                = source.bus_no,
    start_date            = source.start_date,
    working               = source.working,
    available             = source.available,
    outstate_code         = source.outstate_code,
    log_state             = source.log_state,
    skill_no              = source.skill_no,
    Contact_Id            = source.Contact_Id,
    Station_Id            = source.Station_Id,
    StationPhoneNumber    = source.StationPhoneNumber,
    Proficiency           = source.Proficiency,
    InDeliveryProcess     = source.InDeliveryProcess,
    TargetAgent_No        = source.TargetAgent_No,
    AgentStateID          = source.AgentStateID,
    DialerLogoutRequested = source.DialerLogoutRequested,
    DialerLoginRequested  = source.DialerLoginRequested
WHEN NOT MATCHED THEN INSERT (Agent_Session_ID, agent_no, team_no, bus_no, start_date, working, available, outstate_code, log_state, skill_no, Contact_Id, Station_Id, StationPhoneNumber, Proficiency, InDeliveryProcess, TargetAgent_No, AgentStateID, DialerLogoutRequested, DialerLoginRequested) VALUES (source.Agent_Session_ID, source.agent_no, source.team_no, source.bus_no, source.start_date, source.working, source.available, source.outstate_code, source.log_state, source.skill_no, source.Contact_Id, source.Station_Id, source.StationPhoneNumber, source.Proficiency, source.InDeliveryProcess, source.TargetAgent_No, source.AgentStateID, source.DialerLogoutRequested, source.DialerLoginRequested)
WHEN NOT MATCHED BY SOURCE THEN DELETE</td>
        <td>5</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MERGE INTO [dbo].[RT_Agent_Log]
 AS target
USING (SELECT Agent_Session_ID,
              agent_no,
              team_no,
              bus_no,
              start_date,
              working,
              available,
              outstate_code,
              log_state,
              skill_no,
              Contact_Id,
              Station_Id,
              StationPhoneNumber,
              Proficiency,
              InDeliveryProcess,
              TargetAgent_No,
              AgentStateID,
              DialerLogoutRequested,
              DialerLoginRequested
       FROM   (SELECT Agent_Session_ID,
                      agent_no,
                      team_no,
                      bus_no,
                      start_date,
                      working,
                      available,
                      outstate_code,
                      log_state,
                      skill_no,
                      Contact_Id,
                      Station_Id,
                      StationPhoneNumber,
                      Proficiency,
                      InDeliveryProcess,
                      TargetAgent_No,
                      AgentStateID,
                      DialerLogoutRequested,
                      DialerLoginRequested,
                      ROW_NUMBER() OVER (PARTITION BY Agent_Session_ID ORDER BY Agent_Session_ID) AS RowNum
               FROM   [ETL].[RT_Agent_Log]) AS dup
       WHERE  dup.RowNum = 1) AS source ON (target.Agent_Session_ID = source.Agent_Session_ID)
WHEN MATCHED AND (target.agent_no != source.agent_no
                  OR target.team_no != source.team_no
                  OR target.bus_no != source.bus_no
                  OR target.start_date != source.start_date
                  OR target.working != source.working
                  OR target.available != source.available
                  OR CASE WHEN target.outstate_code = source.outstate_code
                               OR target.outstate_code IS NULL
                                  AND source.outstate_code IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.log_state = source.log_state
                               OR target.log_state IS NULL
                                  AND source.log_state IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.skill_no = source.skill_no
                               OR target.skill_no IS NULL
                                  AND source.skill_no IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.Contact_Id = source.Contact_Id
                               OR target.Contact_Id IS NULL
                                  AND source.Contact_Id IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.Station_Id = source.Station_Id
                               OR target.Station_Id IS NULL
                                  AND source.Station_Id IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.StationPhoneNumber = source.StationPhoneNumber
                               OR target.StationPhoneNumber IS NULL
                                  AND source.StationPhoneNumber IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.Proficiency = source.Proficiency
                               OR target.Proficiency IS NULL
                                  AND source.Proficiency IS NULL THEN 0 END IS NULL
                  OR target.InDeliveryProcess != source.InDeliveryProcess
                  OR CASE WHEN target.TargetAgent_No = source.TargetAgent_No
                               OR target.TargetAgent_No IS NULL
                                  AND source.TargetAgent_No IS NULL THEN 0 END IS NULL
                  OR CASE WHEN target.AgentStateID = source.AgentStateID
                               OR target.AgentStateID IS NULL
                                  AND source.AgentStateID IS NULL THEN 0 END IS NULL
                  OR target.DialerLogoutRequested != source.DialerLogoutRequested
                  OR target.DialerLoginRequested != source.DialerLoginRequested) THEN UPDATE 
SET agent_no              = source.agent_no,
    team_no               = source.team_no,
    bus_no                = source.bus_no,
    start_date            = source.start_date,
    working               = source.working,
    available             = source.available,
    outstate_code         = source.outstate_code,
    log_state             = source.log_state,
    skill_no              = source.skill_no,
    Contact_Id            = source.Contact_Id,
    Station_Id            = source.Station_Id,
    StationPhoneNumber    = source.StationPhoneNumber,
    Proficiency           = source.Proficiency,
    InDeliveryProcess     = source.InDeliveryProcess,
    TargetAgent_No        = source.TargetAgent_No,
    AgentStateID          = source.AgentStateID,
    DialerLogoutRequested = source.DialerLogoutRequested,
    DialerLoginRequested  = source.DialerLoginRequested
WHEN NOT MATCHED THEN INSERT (Agent_Session_ID, agent_no, team_no, bus_no, start_date, working, available, outstate_code, log_state, skill_no, Contact_Id, Station_Id, StationPhoneNumber, Proficiency, InDeliveryProcess, TargetAgent_No, AgentStateID, DialerLogoutRequested, DialerLoginRequested) VALUES (source.Agent_Session_ID, source.agent_no, source.team_no, source.bus_no, source.start_date, source.working, source.available, source.outstate_code, source.log_state, source.skill_no, source.Contact_Id, source.Station_Id, source.StationPhoneNumber, source.Proficiency, source.InDeliveryProcess, source.TargetAgent_No, source.AgentStateID, source.DialerLogoutRequested, source.DialerLoginRequested)
WHEN NOT MATCHED BY SOURCE THEN DELETE</td>
        <td>5</td>
      </tr>
      <tr valign="top">
        <td colspan="1">ROW_NUMBER</td>
        <td colspan="1">ROW_NUMBER() OVER (PARTITION BY Agent_Session_ID ORDER BY Agent_Session_ID)</td>
        <td>50</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">OVER</td>
        <td colspan="1">OVER (PARTITION BY Agent_Session_ID ORDER BY Agent_Session_ID)</td>
        <td>50</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN target.outstate_code = source.outstate_code
          OR target.outstate_code IS NULL
             AND source.outstate_code IS NULL THEN 0 END</td>
        <td>69</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.log_state = source.log_state
          OR target.log_state IS NULL
             AND source.log_state IS NULL THEN 0 END</td>
        <td>70</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.skill_no = source.skill_no
          OR target.skill_no IS NULL
             AND source.skill_no IS NULL THEN 0 END</td>
        <td>71</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.Contact_Id = source.Contact_Id
          OR target.Contact_Id IS NULL
             AND source.Contact_Id IS NULL THEN 0 END</td>
        <td>72</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.Station_Id = source.Station_Id
          OR target.Station_Id IS NULL
             AND source.Station_Id IS NULL THEN 0 END</td>
        <td>73</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.StationPhoneNumber = source.StationPhoneNumber
          OR target.StationPhoneNumber IS NULL
             AND source.StationPhoneNumber IS NULL THEN 0 END</td>
        <td>74</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.Proficiency = source.Proficiency
          OR target.Proficiency IS NULL
             AND source.Proficiency IS NULL THEN 0 END</td>
        <td>75</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.TargetAgent_No = source.TargetAgent_No
          OR target.TargetAgent_No IS NULL
             AND source.TargetAgent_No IS NULL THEN 0 END</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN target.AgentStateID = source.AgentStateID
          OR target.AgentStateID IS NULL
             AND source.AgentStateID IS NULL THEN 0 END</td>
        <td>78</td>
      </tr>
    </table>
  </body>
</html>