<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_SlaDataTrueInterval]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_SlaDataTrueInterval]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT skl.Skill_No,
       skl.skill_name,
       skl.includeOtherAbandons,
       skl.includeShortAbandons,
       skl.shortAbandonThreshold,
       CAST (skl.sla_seconds AS BIGINT) AS sla_seconds,
       skl.Outbound_Skill
INTO   #SkillsTemp
FROM   dbo.Skills AS skl
       INNER JOIN
       dbo.Security_DataRoles AS dr
       ON (skl.Campaign_no = dr.EntityID
           OR dr.ViewAllAndFuture = 1)
       INNER JOIN
       dbo.Security_DataRoleEntityTypes AS dret
       ON (dr.DataRoleEntityTypeID = dret.DataRoleEntityTypeID)
       INNER JOIN
       dbo.fn_SplitOptionalInt(@Campaign) AS CPGList
       ON skl.Campaign_no BETWEEN CPGList.IDMin AND CPGList.IDMax
       INNER JOIN
       dbo.fn_SplitOptionalInt(@Skills) AS SKLList
       ON skl.Skill_No BETWEEN SKLList.IDMin AND SKLList.IDMax
       INNER JOIN
       dbo.fn_SplitOptionalInt(@Media) AS MediaList
       ON skl.Media_Type BETWEEN MediaList.IDMin AND MediaList.IDMax
WHERE  skl.Bus_No = @BusNo
       AND dret.DataRoleEntityTypeName = 'campaigns'
       AND dr.SecurityProfileID = @profileID</td>
        <td>47</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT cld.Contact_ID,
                cld.Skill_No,
                cld.Direction,
                cld.ReskillIndicator
INTO   #ContactLogHeaderCTE
FROM   dbo.[Contact_Log_DetailQV] AS cld
WHERE  cld.Bus_No = @BusNo
       AND (cld.StartDate BETWEEN @StartDate AND @EndDate)</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT cld.Contact_ID,
                cld.Skill_No,
                1 AS IsAbandon
INTO   #AbandonContactsCTE
FROM   dbo.[Contact_Log_DetailQV] AS cld
WHERE  cld.BUS_No = @BusNo
       AND (cld.StartDate BETWEEN @StartDate AND @EndDate)
       AND cld.Contact_State = 1</td>
        <td>108</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT cld.Contact_ID,
                cld.Skill_No,
                1 AS Handled
INTO   #HandledContactsCTE
FROM   dbo.[Contact_Log_DetailQV] AS cld
WHERE  cld.BUS_No = @BusNo
       AND (cld.StartDate BETWEEN @StartDate AND @EndDate)
       AND cld.Duration &gt; 0
       AND cld.Contact_State = 4</td>
        <td>124</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT cld.Contact_ID,
                cld.Skill_No,
                1 AS Routed
INTO   #RoutedContactsCTE
FROM   dbo.[Contact_Log_DetailQV] AS cld
WHERE  cld.BUS_No = @BusNo
       AND (cld.StartDate BETWEEN @StartDate AND @EndDate)
       AND cld.ReskillIndicator &lt;= 1
       AND cld.Contact_State = 2</td>
        <td>140</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   cld.Contact_Id,
         cld.Skill_No,
         SUM(cld.Duration) AS InQueueTime
INTO     #InQueueTimeCTE
FROM     dbo.[Contact_Log_DetailQV] AS cld
         INNER JOIN
         dbo.Contact_State AS cs
         ON cld.Contact_State = cs.contact_state
WHERE    cld.BUS_No = @BusNo
         AND (cld.StartDate BETWEEN @StartDate AND @EndDate)
         AND cs.category1 = 'InQueue'
GROUP BY cld.Contact_Id, cld.Skill_No</td>
        <td>156</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   skl.Skill_No,
         SUM(cld.Duration) AS ContactHandleTime
INTO     #SkillHandleTime
FROM     #SkillsTemp AS skl
         INNER JOIN
         dbo.[Contact_Log_DetailQV] AS cld
         ON cld.skill_No = skl.skill_no
WHERE    cld.Bus_No = @BusNo
         AND (cld.StartDate BETWEEN @StartDate AND @EndDate)
         AND cld.Contact_State IN (4, 8, 14)
GROUP BY skl.Skill_No</td>
        <td>176</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   skl.Skill_No,
         SUM(ald.Duration) AS ACWTime
INTO     #SkillACWTime
FROM     #SkillsTemp AS skl
         INNER JOIN
         dbo.[Agent_Log_DetailQV] AS ald
         ON ald.skill_No = skl.skill_no
         INNER JOIN
         dbo.Outstates AS os
         ON ald.Outstate_Code = os.outstate_code
WHERE    ald.Bus_No = @BusNo
         AND (ald.StartDate BETWEEN @StartDate AND @EndDate)
         AND os.IsACW = 'T'
         AND os.IsSystemOutstate = 0
GROUP BY skl.Skill_No</td>
        <td>194</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@Campaign) AS CPGList</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@Skills) AS SKLList</td>
        <td>68</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@Media) AS MediaList</td>
        <td>69</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#SkillsTemp AS skl</td>
        <td>181</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#SkillsTemp AS skl</td>
        <td>199</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogHeaderCTE</td>
        <td>279</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#SkillsTemp AS skl</td>
        <td>286</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AbandonContactsCTE AS ab</td>
        <td>288</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#HandledContactsCTE AS hc</td>
        <td>289</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RoutedContactsCTE AS rc</td>
        <td>290</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#InQueueTimeCTE AS iq</td>
        <td>291</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#SkillHandleTime AS sklht</td>
        <td>293</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#SkillACWTime AS sklACW</td>
        <td>294</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN sla.includeOtherAbandons = 1 THEN SUM(SLAOtherAbandon) ELSE 0 END</td>
        <td>224</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN sla.includeShortAbandons = 1 THEN SUM(sla.SLAShortAbandon) ELSE 0 END</td>
        <td>228</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN sla.includeOtherAbandons = 1 THEN SUM(SLAOtherAbandon) ELSE 0 END</td>
        <td>235</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN sla.includeShortAbandons = 1 THEN SUM(sla.SLAShortAbandon) ELSE 0 END</td>
        <td>239</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clh.Direction = 1
          AND clh.ReskillIndicator = 0 THEN 1 ELSE 0 END</td>
        <td>255</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clh.Direction = 2
          AND skl.Outbound_Skill = 1 THEN 1 ELSE 0 END</td>
        <td>256</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clh.Direction = 1
          AND rc.Routed = 1 THEN 1 ELSE 0 END</td>
        <td>257</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clh.Direction = 1
          AND skl.Outbound_Skill = 0
          AND ISNULL(ab.IsAbandon, 0) = 1 THEN 1 ELSE 0 END</td>
        <td>259</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN NOT iq.InQueueTime IS NULL
          AND clh.Direction = 1
          AND clh.ReskillIndicator &lt;= 2 THEN 1 ELSE 0 END</td>
        <td>262</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ab.IsAbandon = 1
          AND clh.Direction = 1
          AND skl.Outbound_Skill = 0
          AND clh.ReskillIndicator &lt;= 1
          AND iq.InQueueTime &lt; (skl.shortAbandonThreshold * 1000) THEN 1 ELSE 0 END</td>
        <td>263</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ab.IsAbandon IS NULL
          AND clh.Direction = 1
          AND skl.Outbound_Skill = 0
          AND clh.ReskillIndicator &lt;= 1
          AND iq.InQueueTime &lt; (skl.sla_seconds * 1000) THEN 1 ELSE 0 END</td>
        <td>265</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ab.IsAbandon IS NULL
          AND clh.Direction = 1
          AND skl.Outbound_Skill = 0
          AND clh.ReskillIndicator &lt;= 1
          AND iq.InQueueTime &gt;= (skl.sla_seconds * 1000) THEN 1 ELSE 0 END</td>
        <td>266</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ab.IsAbandon = 1
          AND clh.Direction = 1
          AND skl.Outbound_Skill = 0
          AND clh.ReskillIndicator &lt;= 1
          AND skl.includeShortAbandons = 1
          AND iq.InQueueTime &lt; (skl.shortAbandonThreshold * 1000) THEN 1 ELSE 0 END</td>
        <td>267</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ab.IsAbandon = 1
          AND clh.Direction = 1
          AND skl.Outbound_Skill = 0
          AND clh.ReskillIndicator &lt;= 1
          AND skl.includeOtherAbandons = 1
          AND iq.InQueueTime &gt;= (skl.shortAbandonThreshold * 1000) THEN 1 ELSE 0 END</td>
        <td>268</td>
      </tr>
    </table>
  </body>
</html>