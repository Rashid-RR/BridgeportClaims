<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_LLS_CustomScorecard]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_LLS_CustomScorecard]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top">
        <td colspan="1">BEGIN TRANSACTION</td>
        <td colspan="1">BEGIN TRANSACTION</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">EXECUTE LockCriticalSection 'CallDetail_LLS_CustomScorecard'</td>
        <td>13</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS b</td>
        <td>50</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS al</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactsQV AS a</td>
        <td>78</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS b</td>
        <td>79</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactsQV AS a</td>
        <td>85</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS b</td>
        <td>86</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactsQV AS c</td>
        <td>95</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#FilteredContacts AS fc</td>
        <td>100</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactsQV AS a</td>
        <td>107</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentStats AS ast</td>
        <td>108</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS al</td>
        <td>116</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogins AS a</td>
        <td>137</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentStats AS b</td>
        <td>138</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactStats AS c</td>
        <td>139</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#TotalCalls AS d</td>
        <td>140</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AbandonCalls AS e</td>
        <td>141</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentIdleTime AS f</td>
        <td>142</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#HandledStats AS g</td>
        <td>143</td>
      </tr>
      <tr valign="top">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   a.bus_no,
         a.Agent_No,
         MIN(dbo.fn_ConvertUTCToTargetTimeZone(a.StartDate, @TimeZone)) AS LoginTime
INTO     #AgentLogins
FROM     dbo.Agent_Log_DetailQV AS a
         INNER JOIN
         dbo.Agents AS agts
         ON agts.Agent_No = a.Agent_No
            AND agts.Bus_No = a.Bus_No
WHERE    a.StartDate BETWEEN @UTCStart_Date AND @UTCEnd_Date
         AND a.Bus_No = @Bus_No
GROUP BY a.Bus_No, a.Agent_No</td>
        <td>30</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(ISNULL(a.Duration, 0)) AS TotalTime,
         SUM(CASE WHEN c.isACW = 'T'
                       AND c.isSystemOutState = 0
                       AND d.Outbound_Skill = 0 THEN ISNULL(a.Duration, 0) ELSE 0 END) AS ACWTime,
         SUM(CASE WHEN a.AgentStateID IN (0, 2, 8) THEN ISNULL(a.Duration, 0) ELSE 0 END) AS AuxTime,
         SUM(CASE WHEN e.IsAvailable = 0
                       AND d.Outbound_Skill = 0 THEN ISNULL(a.Duration, 0) ELSE 0 END) AS AuxInTime,
         SUM(CASE WHEN e.IsAvailable = 0
                       AND d.Outbound_Skill = 1 THEN ISNULL(a.Duration, 0) ELSE 0 END) AS AuxOutTime
INTO     #AgentStats
FROM     dbo.Agent_Log_DetailQV AS a
         INNER JOIN
         #AgentLogins AS b
         ON a.Agent_No = b.Agent_No
            AND a.Bus_No = b.Bus_No
         INNER JOIN
         dbo.AgentState AS e
         ON a.AgentStateID = e.AgentStateID
         LEFT OUTER JOIN
         dbo.Skills AS d
         ON a.Skill_No = d.Skill_No
         LEFT OUTER JOIN
         dbo.Outstates AS c
         ON a.Outstate_Code = c.outstate_code
WHERE    a.StartDate BETWEEN @UTCStart_Date AND @UTCEnd_Date
GROUP BY a.Agent_No</td>
        <td>42</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT a.Contact_ID,
       a.Agent_No,
       a.Bus_No,
       a.Duration,
       a.Contact_State,
       a.Direction,
       a.Skill_No
INTO   #ContactsQV
FROM   dbo.Contact_Log_DetailQV AS a
       INNER JOIN
       #AgentLogins AS al
       ON al.Agent_No = a.Agent_No
          AND al.Bus_No = a.Bus_No
       INNER JOIN
       dbo.Skills AS s
       ON s.Skill_No = a.Skill_No
WHERE  a.StartDate BETWEEN @UTCStart_Date AND @UTCEnd_Date
       AND s.Outbound_Skill = 0
       AND s.Media_Type = 4</td>
        <td>58</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   b.Agent_No,
         SUM(CASE WHEN a.Contact_State IN (4, 14) THEN ISNULL(a.Duration, 0) ELSE 0 END) AS TalkTime,
         SUM(CASE WHEN a.Contact_State = 8 THEN a.Duration ELSE 0 END) AS HoldTime
INTO     #ContactStats
FROM     #ContactsQV AS a
         INNER JOIN
         #AgentLogins AS b
         ON a.Agent_No = b.Agent_No
GROUP BY b.Agent_No</td>
        <td>74</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   b.Agent_No,
         COUNT(DISTINCT a.Contact_Id) AS Handled
INTO     #HandledStats
FROM     #ContactsQV AS a
         INNER JOIN
         #AgentLogins AS b
         ON a.Agent_No = b.Agent_No
WHERE    a.Duration &gt; 0
         AND a.Contact_State = 4
GROUP BY b.Agent_No</td>
        <td>82</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT c.Contact_ID,
                c.Agent_No,
                c.skill_no
INTO   #FilteredContacts
FROM   #ContactsQV AS c</td>
        <td>91</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   fc.Agent_No,
         COUNT(DISTINCT fc.Contact_ID) AS TotalCalls
INTO     #TotalCalls
FROM     #FilteredContacts AS fc
WHERE    fc.Skill_No IS NOT NULL
GROUP BY fc.Agent_No</td>
        <td>97</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         COUNT(DISTINCT a.Contact_ID) AS AbandonCalls
INTO     #AbandonCalls
FROM     #ContactsQV AS a
         INNER JOIN
         #AgentStats AS ast
         ON ast.Agent_No = a.Agent_No
            AND a.Contact_State = 24
            AND a.Direction = 1
GROUP BY a.Agent_No</td>
        <td>104</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   al.Agent_No,
         SUM(ISNULL(a.Duration, 0)) AS IdleTime
INTO     #AgentIdleTime
FROM     #AgentLogins AS al
         INNER JOIN
         dbo.Agent_Log_DetailQV AS a
         ON a.Agent_No = al.Agent_No
            AND a.Bus_No = al.Bus_No
WHERE    AgentStateID = 1
         AND a.StartDate BETWEEN @UTCStart_Date AND @UTCEnd_Date
GROUP BY al.Agent_No</td>
        <td>113</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN c.isACW = 'T'
          AND c.isSystemOutState = 0
          AND d.Outbound_Skill = 0 THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>44</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.AgentStateID IN (0, 2, 8) THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>45</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN e.IsAvailable = 0
          AND d.Outbound_Skill = 0 THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>46</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN e.IsAvailable = 0
          AND d.Outbound_Skill = 1 THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>47</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.Contact_State IN (4, 14) THEN ISNULL(a.Duration, 0) ELSE 0 END</td>
        <td>75</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.Contact_State = 8 THEN a.Duration ELSE 0 END</td>
        <td>76</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT a.Contact_Id)</td>
        <td>83</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT fc.Contact_ID)</td>
        <td>98</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT a.Contact_ID)</td>
        <td>105</td>
      </tr>
      <tr valign="top">
        <td colspan="1">COMMIT TRANSACTION</td>
        <td colspan="1">COMMIT TRANSACTION</td>
        <td>146</td>
      </tr>
    </table>
  </body>
</html>