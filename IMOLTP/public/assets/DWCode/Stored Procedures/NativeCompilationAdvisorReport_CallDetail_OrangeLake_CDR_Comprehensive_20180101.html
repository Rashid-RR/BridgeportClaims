<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_OrangeLake_CDR_Comprehensive]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_OrangeLake_CDR_Comprehensive]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top">
        <td colspan="1">BEGIN TRANSACTION</td>
        <td colspan="1">BEGIN TRANSACTION</td>
        <td>20</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">EXECUTE LockCriticalSection @busno_str</td>
        <td>24</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#HeadContactIDs AS hc</td>
        <td>63</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">tags AS t</td>
        <td>71</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#app AS a</td>
        <td>77</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#CLSummary AS cls</td>
        <td>105</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Tags AS t</td>
        <td>106</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#app AS agg</td>
        <td>107</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Contacts AS c</td>
        <td>121</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Contacts AS c</td>
        <td>131</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogLastDisposition AS clld</td>
        <td>132</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Contacts AS c</td>
        <td>214</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogDisposition AS cld</td>
        <td>221</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl1</td>
        <td>222</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl2</td>
        <td>223</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl3</td>
        <td>224</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl4</td>
        <td>225</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl5</td>
        <td>226</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl6</td>
        <td>227</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl7</td>
        <td>228</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl8</td>
        <td>229</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl9</td>
        <td>230</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl11</td>
        <td>231</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl12</td>
        <td>232</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl13</td>
        <td>233</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl14</td>
        <td>234</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl15</td>
        <td>235</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl16</td>
        <td>236</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl17</td>
        <td>237</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl18</td>
        <td>238</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl19</td>
        <td>239</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl20</td>
        <td>240</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl21</td>
        <td>241</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl22</td>
        <td>242</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl23</td>
        <td>243</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl24</td>
        <td>244</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl25</td>
        <td>245</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl26</td>
        <td>246</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl27</td>
        <td>247</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl28</td>
        <td>248</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl29</td>
        <td>249</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl30</td>
        <td>250</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl31</td>
        <td>251</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl32</td>
        <td>252</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl33</td>
        <td>253</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl34</td>
        <td>254</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl35</td>
        <td>255</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl36</td>
        <td>256</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl37</td>
        <td>257</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl38</td>
        <td>258</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl39</td>
        <td>259</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl40</td>
        <td>260</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl41</td>
        <td>261</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl42</td>
        <td>262</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Custom_Contact_Log AS ccl43</td>
        <td>263</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   qv.[Contact_ID],
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[category1] = 'PreQueue' THEN Duration END) / 1000.0, 0) AS INT), 0) AS prequeue,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[category1] = 'InQueue' THEN Duration END) / 1000.0, 0) AS INT), 0) AS inqueue,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[contact_State] = 2 THEN Duration END) / 1000.0, 0) AS INT), 0) AS routing,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[category1] = 'Agent' THEN Duration END) / 1000.0, 0) AS INT), 0) AS agent,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[category1] = 'PostQueue' THEN Duration END) / 1000.0, 0) AS INT), 0) AS postqueue,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[contact_State] = 15 THEN Duration END) / 1000.0, 0) AS INT), 0) AS callback,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[contact_State] = 8 THEN Duration END) / 1000.0, 0) AS INT), 0) AS hold
INTO     #app
FROM     [dbo].[Contact_Log_DetailQV] AS qv
         INNER JOIN
         [dbo].[Contact_State] AS cs
         ON cs.[Contact_State] = qv.[Contact_state]
WHERE    qv.[bus_no] = @_bus_no
         AND qv.[StartDate] BETWEEN @_start_date AND @_end_date
GROUP BY qv.[contact_ID]
OPTION (TABLE HINT(qv, INDEX ([CL_Contact_Log_DetailQV_Bus_No_StartDate_RowVersion])))</td>
        <td>27</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT clh.[Contact_ID]
INTO   #HeadContactIDs
FROM   [dbo].[Contact_Log_Header] AS clh
WHERE  clh.[bus_no] = @_bus_no
       AND clh.[start_date] BETWEEN @_summary_start_date AND @_summary_end_date
OPTION (TABLE HINT(clh, INDEX ([IX_Contact_Log_Header_Bus_no_start_date])))</td>
        <td>46</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT cls.[Contact_ID],
       cls.[sla],
       cls.[acw_Time] / 1000 AS ACW_Time,
       cls.[Abandon_Seconds]
INTO   #CLSummary
FROM   [dbo].[Contact_Log_Summary] AS cls
       INNER JOIN
       #HeadContactIDs AS hc
       ON hc.[Contact_ID] = cls.[Contact_ID]</td>
        <td>56</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT st2.[Contact_ID],
                STUFF((SELECT   ',' + t.name AS [text()]
                       FROM     [dbo].[contact_log_Tags] AS st1
                                LEFT OUTER JOIN
                                tags AS t
                                ON t.[TagID] = st1.[TagID]
                       WHERE    st1.[Contact_ID] = st2.[Contact_ID]
                       ORDER BY st1.[Contact_ID]
                       FOR      XML PATH ('')), 1, 1, '') AS [Tags]
INTO   #Tags
FROM   [dbo].[contact_log_Tags] AS st2
       INNER JOIN
       #app AS a
       ON st2.Contact_ID = a.Contact_ID</td>
        <td>67</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   clh.[Contact_ID],
         clh.[Master_Contact_ID],
         [dbo].[fn_ConvertUTCToTargetTimeZone](clh.[Start_Date], @_TimeZone) AS [Start_Date],
         clh.[Contact_Code],
         REPLACE(REPLACE(REPLACE(clf.[To_Addr], CHAR(13), ''), CHAR(10), ''), CHAR(9), '') AS To_Addr,
         REPLACE(REPLACE(REPLACE(clf.[From_Addr], CHAR(13), ''), CHAR(10), ''), CHAR(9), '') AS From_Addr,
         clf.[Agent_No],
         clf.[Skill_No],
         clf.[Abandon],
         ISNULL(cls.[SLA], 0) AS SLA,
         agg.[prequeue] AS Prequeue_Time,
         agg.[inqueue] AS Inqueue_Time,
         agg.[routing] AS Routing_Time,
         agg.[agent] AS Agent_Time,
         agg.[postqueue] AS Postqueue_Time,
         agg.[callback] AS Callback_Time,
         ISNULL(cls.[ACW_Time], 0) AS ACW_Time,
         agg.[hold] AS Hold_Time,
         ISNULL(cls.[Abandon_Seconds], 0) AS Abandon_Time,
         t.Tags
INTO     #Contacts
FROM     [dbo].[Contact_Log_Header] AS clh
         INNER JOIN
         [dbo].[Contact_Log_Footer] AS clf
         ON clf.[Contact_ID] = clh.[Contact_ID]
         LEFT OUTER JOIN
         #CLSummary AS cls
         ON cls.[Contact_ID] = clh.[Contact_ID]
         LEFT OUTER JOIN
         #Tags AS t
         ON t.Contact_ID = clh.Contact_ID
         INNER JOIN
         #app AS agg
         ON agg.[Contact_ID] = clh.[Contact_ID]
WHERE    clh.[Bus_No] = @_bus_no
         AND clh.[Start_Date] BETWEEN @_start_Date AND @_end_date
ORDER BY clh.[Contact_ID]
OPTION (TABLE HINT(clh, INDEX ([IX_Contact_Log_Header_Bus_no_start_date])))</td>
        <td>81</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   c.[Contact_ID],
         MAX(clds.[Start_Date]) AS [Start_Date]
INTO     #ContactLogLastDisposition
FROM     #Contacts AS c
         LEFT OUTER JOIN
         [dbo].[Contact_Log_Dispositions] AS clds
         ON clds.[Contact_ID] = c.[Contact_ID]
GROUP BY c.[Contact_ID]</td>
        <td>117</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT c.[Contact_ID],
       d.[Description],
       clds.[Disposition_Comments],
       clds.[Disposition_Code]
INTO   #ContactLogDisposition
FROM   #Contacts AS c
       LEFT OUTER JOIN
       #ContactLogLastDisposition AS clld
       ON clld.[Contact_ID] = c.[Contact_ID]
       LEFT OUTER JOIN
       [dbo].[Contact_Log_Dispositions] AS clds
       ON clds.[Contact_ID] = clld.[Contact_ID]
          AND clds.[Start_Date] = clld.[Start_Date]
       INNER JOIN
       [dbo].[Dispositions] AS d
       ON d.[Disposition_Code] = clds.[Disposition_Code]</td>
        <td>125</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN cs.[category1] = 'PreQueue' THEN Duration END</td>
        <td>29</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[category1] = 'InQueue' THEN Duration END</td>
        <td>30</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[contact_State] = 2 THEN Duration END</td>
        <td>31</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[category1] = 'Agent' THEN Duration END</td>
        <td>32</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[category1] = 'PostQueue' THEN Duration END</td>
        <td>33</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[contact_State] = 15 THEN Duration END</td>
        <td>34</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[contact_State] = 8 THEN Duration END</td>
        <td>35</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.[Outbound_Skill] = 1 THEN c.[To_Addr] ELSE c.[From_Addr] END</td>
        <td>143</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clg.[contact_id] IS NOT NULL THEN 'Y' ELSE 'N' END</td>
        <td>165</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">STUFF</td>
        <td colspan="1">STUFF((SELECT   ',' + t.name AS [text()]
       FROM     [dbo].[contact_log_Tags] AS st1
                LEFT OUTER JOIN
                tags AS t
                ON t.[TagID] = st1.[TagID]
       WHERE    st1.[Contact_ID] = st2.[Contact_ID]
       ORDER BY st1.[Contact_ID]
       FOR      XML PATH ('')), 1, 1, '')</td>
        <td>69</td>
      </tr>
      <tr valign="top">
        <td colspan="1">FOR XML</td>
        <td colspan="1">XML PATH ('')</td>
        <td>74</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">REPLACE</td>
        <td colspan="1">REPLACE(REPLACE(REPLACE(clf.[To_Addr], CHAR(13), ''), CHAR(10), ''), CHAR(9), '')</td>
        <td>86</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(REPLACE(clf.[To_Addr], CHAR(13), ''), CHAR(10), '')</td>
        <td>86</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(clf.[To_Addr], CHAR(13), '')</td>
        <td>86</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(REPLACE(REPLACE(clf.[From_Addr], CHAR(13), ''), CHAR(10), ''), CHAR(9), '')</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(REPLACE(clf.[From_Addr], CHAR(13), ''), CHAR(10), '')</td>
        <td>87</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(clf.[From_Addr], CHAR(13), '')</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CHAR</td>
        <td colspan="1">CHAR(13)</td>
        <td>86</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CHAR(10)</td>
        <td>86</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CHAR(9)</td>
        <td>86</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CHAR(13)</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CHAR(10)</td>
        <td>87</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CHAR(9)</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">COMMIT TRANSACTION</td>
        <td colspan="1">COMMIT TRANSACTION</td>
        <td>267</td>
      </tr>
    </table>
  </body>
</html>