<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_AgentSkillProficiency]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_AgentSkillProficiency]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT DISTINCT CAST (a.agent_no AS INT) AS agent_no,
                CAST (a.first_name AS NVARCHAR (MAX)) AS first_name,
                CAST (a.last_name AS NVARCHAR (MAX)) AS last_name,
                CAST (s.skill_name AS NVARCHAR (MAX)) AS skill_name,
                CAST (s.campaign_no AS INT) AS campaign_no,
                CAST (s.skill_no AS INT) AS skill_no,
                CAST (ask.Proficiency AS INT) AS Proficiency,
                CAST ((CASE WHEN ask.[Status] = 'CURR' THEN 1 ELSE 0 END) AS BIT) AS IsEnabled
INTO   dbo.[#AgentSkillProficiencies]
FROM   dbo.skills AS s
       INNER JOIN
       dbo.Campaign AS c
       ON (s.campaign_no = c.campaign_no)
       INNER JOIN
       dbo.Agentskl AS ask
       ON (ask.skill_no = s.Skill_No
           AND ask.[Status] = 'CURR')
       INNER JOIN
       dbo.Agents AS a
       ON (a.Agent_no = ask.Agent_No)
       INNER JOIN
       dbo.fn_SplitOptionalInt(@CampaignNoList) AS CampaignKeys
       ON (s.campaign_no BETWEEN CampaignKeys.IDMin AND CampaignKeys.IDMax)
       INNER JOIN
       dbo.fn_SplitOptionalInt(@SkillNoList) AS SkillKeys
       ON (s.skill_no BETWEEN SkillKeys.IDMin AND SkillKeys.IDMax)
       INNER JOIN
       dbo.Security_DataRoles AS tdr
       ON (a.Team_No = tdr.EntityID
           OR tdr.ViewAllAndFuture = 1)
       INNER JOIN
       dbo.Security_DataRoleEntityTypes AS tdret
       ON (tdr.DataRoleEntityTypeID = tdret.DataRoleEntityTypeID)
       INNER JOIN
       dbo.Security_DataRoles AS cdr
       ON (s.Campaign_no = cdr.EntityID
           OR cdr.ViewAllAndFuture = 1)
       INNER JOIN
       dbo.Security_DataRoleEntityTypes AS cdret
       ON (cdr.DataRoleEntityTypeID = cdret.DataRoleEntityTypeID)
WHERE  a.Bus_No = @Bus_No
       AND (a.[Status] = 'CURR'
            OR @ActiveAgentOnly &lt;&gt; 1)
       AND (c.[Status] = 'CURR'
            OR @ActiveCampaignOnly &lt;&gt; 1
            OR c.[Status] IS NULL)
       AND (s.[Status] = 'CURR'
            OR @ActiveSkillOnly &lt;&gt; 1
            OR s.[Status] IS NULL)
       AND cdret.DataRoleEntityTypeName = 'campaigns'
       AND cdr.SecurityProfileID = @profileID
       AND tdret.DataRoleEntityTypeName = 'teams'
       AND tdr.SecurityProfileID = @profileID</td>
        <td>11</td>
      </tr>
      <tr valign="top">
        <td colspan="1">nvarchar(MAX)</td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>13</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>14</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>15</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>78</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>79</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>103</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>104</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>105</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>119</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>120</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>121</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>136</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>137</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NVARCHAR (MAX)</td>
        <td>138</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN ask.[Status] = 'CURR' THEN 1 ELSE 0 END</td>
        <td>19</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Proficiency &gt;= 5 THEN 5 ELSE Proficiency END</td>
        <td>108</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Proficiency &gt;= 5 THEN 5 ELSE Proficiency END</td>
        <td>124</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@CampaignNoList) AS CampaignKeys</td>
        <td>28</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@SkillNoList) AS SkillKeys</td>
        <td>29</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@CampaignNoList) AS CampaignKeys</td>
        <td>145</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@SkillNoList) AS SkillKeys</td>
        <td>146</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#AgentSkillProficiencies</td>
        <td>91</td>
      </tr>
    </table>
  </body>
</html>