<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_Omniglobe_CognosV3_n2]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_Omniglobe_CognosV3_n2]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top">
        <td colspan="1">BEGIN TRANSACTION</td>
        <td colspan="1">BEGIN TRANSACTION</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">EXECUTE LockCriticalSection 'CallDetail_Omniglobe_CognosV3_n2'</td>
        <td>13</td>
      </tr>
      <tr valign="top">
        <td colspan="1">REPLACE</td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>830</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>34</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>36</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>60</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>61</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>572</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>573</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>598</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-')</td>
        <td>599</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>830</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>830</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>830</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>830</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>34</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>34</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>34</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>34</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>36</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>36</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>36</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>36</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN F.Skill_No = 155806 THEN '44SE' WHEN F.Skill_No = 155807 THEN '46SW' WHEN F.Skill_No = 155808 THEN '52MW' WHEN F.Skill_No = 155809 THEN '51EA' WHEN F.Skill_No = 155810 THEN '47WS' WHEN F.Skill_No = 155812 THEN '55WS' WHEN F.Skill_No = 155813 THEN '64WL' WHEN F.Skill_No = 155814 THEN '68BE' WHEN F.Skill_No = 155815 THEN '63UV' WHEN F.Skill_No = 155816 THEN '66UC' WHEN F.Skill_No = 155817 THEN '62ST' WHEN F.Skill_No = 155818 THEN '61SS' WHEN F.Skill_No = 155819 THEN '60NB' WHEN F.Skill_No = 155820 THEN '59WN' WHEN F.Skill_No = 155821 THEN '69DC' WHEN F.Skill_No = 155822 THEN '57WF' WHEN F.Skill_No = 155823 THEN '65WE' WHEN F.Skill_No = 155824 THEN '56DS' WHEN F.Skill_No = 155827
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    AND CAST (REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-') AS DATE) &lt; '7/11/2013' THEN '41PA' WHEN F.Skill_No = 155827
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             AND CAST (REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-') AS DATE) &gt;= '7/11/2013' THEN 'A040502' WHEN F.Skill_No = 155828 THEN '43PG' WHEN F.Skill_No = 155830 THEN '54PV' WHEN F.Skill_No = 156428 THEN '040301' WHEN F.Skill_No = 157132 THEN '040901' WHEN F.Skill_No = 157133 THEN '040501' WHEN F.Skill_No = 216009 THEN '040101' WHEN F.Skill_No = 216010 THEN '040102' WHEN F.Skill_No = 216011 THEN '040103' WHEN F.Skill_No = 216012 THEN '040104' WHEN F.Skill_No = 182860 THEN '040302' WHEN F.Skill_No = 182861 THEN '040303' WHEN F.Skill_No = 182863 THEN '040304' WHEN F.Skill_No = 182866 THEN '040305' WHEN F.Skill_No = 182868 THEN '040306' WHEN F.Skill_No = 218007 THEN '040105' WHEN F.Skill_No = 218008 THEN '040106' WHEN F.Skill_No = 218009 THEN '040107' WHEN F.Skill_No = 218010 THEN '040108' WHEN F.Skill_No = 218011 THEN '040109' WHEN F.Skill_No = 218012 THEN '040110' WHEN F.Skill_No = 218015 THEN '040111' WHEN F.Skill_No = 218016 THEN '040112' WHEN F.Skill_No = 232901 THEN 'A040503' WHEN F.Skill_No = 232902 THEN 'A040504' WHEN F.Skill_No = 232903 THEN 'A042201' WHEN F.Skill_No = 239721 THEN 'A040403' WHEN F.Skill_No = 239722 THEN 'A040402' WHEN F.Skill_No = 239742 THEN '040307' WHEN F.Skill_No = 246424 THEN 'A042212' WHEN F.Skill_No = 246426 THEN 'A040505' WHEN F.Skill_No = 246427 THEN 'A040506' WHEN F.Skill_No = 246429 THEN 'A040508' WHEN F.Skill_No = 246430 THEN 'A040509' WHEN F.Skill_No = 246431 THEN 'A040510' WHEN F.Skill_No = 290226 THEN 'A042202' WHEN F.Skill_No = 290227 THEN 'A042203' WHEN F.Skill_No = 290228 THEN 'A042204' WHEN F.Skill_No = 290229 THEN 'A042205' WHEN F.Skill_No = 307554 THEN 'A042206' WHEN F.Skill_No = 307555 THEN 'A042207' WHEN F.Skill_No = 307556 THEN 'A042208' WHEN F.Skill_No = 307557 THEN 'A042209' WHEN F.Skill_No = 307558 THEN 'A042210' WHEN F.Skill_No = 307559 THEN 'A042211' WHEN F.Skill_No = 307560 THEN 'A040511' WHEN F.Skill_No = 307410 THEN 'A042213' WHEN F.Skill_No = 312270 THEN 'A040308' WHEN F.Skill_No = 330594 THEN 'A042214' WHEN F.Skill_No = 330595 THEN 'A042215' WHEN F.Skill_No = 330596 THEN 'A042216' WHEN F.Skill_No = 330597 THEN 'A042217' WHEN F.Skill_No = 330598 THEN 'A042218' WHEN F.Skill_No = 330599 THEN 'A042276' WHEN F.Skill_No = 330600 THEN 'A042277' WHEN F.Skill_No = 330601 THEN 'A042278' WHEN F.Skill_No = 330602 THEN 'A042279' WHEN F.Skill_No = 330603 THEN 'A042280' WHEN F.Skill_No = 330604 THEN 'A042281' WHEN F.Skill_No = 330605 THEN 'A042282' WHEN F.Skill_No = 330606 THEN 'A042220' WHEN F.Skill_No = 330607 THEN 'A042221' WHEN F.Skill_No = 330608 THEN 'A042222' WHEN F.Skill_No = 330609 THEN 'A042223' WHEN F.Skill_No = 330610 THEN 'A042224' WHEN F.Skill_No = 330611 THEN 'A042225' WHEN F.Skill_No = 330612 THEN 'A042226' WHEN F.Skill_No = 330613 THEN 'A042227' WHEN F.Skill_No = 330615 THEN 'A042228' WHEN F.Skill_No = 330616 THEN 'A042229' WHEN F.Skill_No = 330617 THEN 'A042230' WHEN F.Skill_No = 330625 THEN 'A042231' WHEN F.Skill_No = 330628 THEN 'A042232' WHEN F.Skill_No = 330629 THEN 'A042233' WHEN F.Skill_No = 330630 THEN 'A042234' WHEN F.Skill_No = 330631 THEN 'A042235' WHEN F.Skill_No = 330632 THEN 'A042236' WHEN F.Skill_No = 330633 THEN 'A042237' WHEN F.Skill_No = 330634 THEN 'A042238' WHEN F.Skill_No = 330635 THEN 'A042239' WHEN F.Skill_No = 330636 THEN 'A042240' WHEN F.Skill_No = 330637 THEN 'A042241' WHEN F.Skill_No = 330639 THEN 'A042242' WHEN F.Skill_No = 330640 THEN 'A042243' WHEN F.Skill_No = 330641 THEN 'A042244' WHEN F.Skill_No = 330642 THEN 'A042245' WHEN F.Skill_No = 330643 THEN 'A042246' WHEN F.Skill_No = 330644 THEN 'A042247' WHEN F.Skill_No = 330645 THEN 'A042248' WHEN F.Skill_No = 330646 THEN 'A042249' WHEN F.Skill_No = 330647 THEN 'A042250' WHEN F.Skill_No = 330648 THEN 'A042251' WHEN F.Skill_No = 330649 THEN 'A042252' WHEN F.Skill_No = 330650 THEN 'A042253' WHEN F.Skill_No = 330651 THEN 'A042254' WHEN F.Skill_No = 330653 THEN 'A042255' WHEN F.Skill_No = 330654 THEN 'A042256' WHEN F.Skill_No = 330655 THEN 'A042257' WHEN F.Skill_No = 330656 THEN 'A042258' WHEN F.Skill_No = 330657 THEN 'A042259' WHEN F.Skill_No = 330658 THEN 'A042260' WHEN F.Skill_No = 330659 THEN 'A042261' WHEN F.Skill_No = 330660 THEN 'A042262' WHEN F.Skill_No = 330661 THEN 'A042263' WHEN F.Skill_No = 330662 THEN 'A042264' WHEN F.Skill_No = 330664 THEN 'A042265' WHEN F.Skill_No = 330665 THEN 'A042266' WHEN F.Skill_No = 330667 THEN 'A042267' WHEN F.Skill_No = 330668 THEN 'A042268' WHEN F.Skill_No = 330669 THEN 'A042269' WHEN F.Skill_No = 330670 THEN 'A042270' WHEN F.Skill_No = 330671 THEN 'A042271' WHEN F.Skill_No = 330672 THEN 'A042272' WHEN F.Skill_No = 330942 THEN 'A0422118' WHEN F.Skill_No = 330947 THEN 'A0422119' WHEN F.Skill_No = 330944 THEN 'A0422120' WHEN F.Skill_No = 330946 THEN 'A0422149' WHEN F.Skill_No = 330948 THEN 'A0422126' WHEN F.Skill_No = 330949 THEN 'A0422123' WHEN F.Skill_No = 330950 THEN 'A0422124' WHEN F.Skill_No = 330951 THEN 'A0422125' WHEN F.Skill_No = 330952 THEN 'A0422150' WHEN F.Skill_No = 330953 THEN 'A0422152' WHEN F.Skill_No = 330954 THEN 'A040321' WHEN F.Skill_No = 330955 THEN 'A040314' WHEN F.Skill_No = 330956 THEN 'A0422130' WHEN F.Skill_No = 330957 THEN 'A0422131' WHEN F.Skill_No = 330958 THEN 'A0422132' WHEN F.Skill_No = 330959 THEN 'A040315' WHEN F.Skill_No = 330960 THEN 'A0422134' WHEN F.Skill_No = 330961 THEN 'A040316' WHEN F.Skill_No = 330962 THEN 'A0422136' WHEN F.Skill_No = 330963 THEN 'A0422137' WHEN F.Skill_No = 330978 THEN 'A0422138' WHEN F.Skill_No = 330979 THEN 'A040317' WHEN F.Skill_No = 330980 THEN 'A0422140' WHEN F.Skill_No = 330981 THEN 'A040318' WHEN F.Skill_No = 330982 THEN 'A040319' WHEN F.Skill_No = 330983 THEN 'A0422143' WHEN F.Skill_No = 330997 THEN 'A0422144' WHEN F.Skill_No = 330998 THEN 'A0422145' WHEN F.Skill_No = 330999 THEN 'A0422146' WHEN F.Skill_No = 331000 THEN 'A0422147' WHEN F.Skill_No = 331001 THEN 'A040320' WHEN F.Skill_No = 331011 THEN 'A040322' WHEN F.Skill_No = 331016 THEN 'A040323' WHEN F.Skill_No = 331019 THEN 'A040324' WHEN F.Skill_No = 331020 THEN 'A040325' WHEN F.Skill_No = 331021 THEN 'A0422153' WHEN F.Skill_No = 331022 THEN 'A0422154' WHEN F.Skill_No = 331024 THEN 'A0422155' WHEN F.Skill_No = 331025 THEN 'A0422156' WHEN F.Skill_No = 331026 THEN 'A040326' WHEN F.Skill_No = 331027 THEN 'A0422158' WHEN F.Skill_No = 331028 THEN 'A0422159' WHEN F.Skill_No = 331029 THEN 'A0422160' WHEN F.Skill_No = 331030 THEN 'A0422161' WHEN F.Skill_No = 331031 THEN 'A0422162' WHEN F.Skill_No = 350052 THEN 'A0422163' WHEN F.Skill_No = 350053 THEN 'A0422164' WHEN F.Skill_No = 350054 THEN 'A0422165' WHEN F.Skill_No = 350063 THEN 'A0422166' WHEN F.Skill_No = 350064 THEN 'A0422167' WHEN F.Skill_No = 350065 THEN 'A0422168' WHEN F.Skill_No = 350066 THEN 'A0422169' WHEN F.Skill_No = 350067 THEN 'A0422170' WHEN F.Skill_No = 350068 THEN 'A0422171' WHEN F.Skill_No = 350069 THEN 'A0422172' WHEN F.Skill_No = 350070 THEN 'A0422173' WHEN F.Skill_No = 350071 THEN 'A0422174' WHEN F.Skill_No = 350072 THEN 'A0422175' WHEN F.Skill_No = 350073 THEN 'A0422176' WHEN F.Skill_No = 350074 THEN 'A0422177' WHEN F.Skill_No = 350075 THEN 'A0422178' WHEN F.Skill_No = 350076 THEN 'A0422179' WHEN F.Skill_No = 350077 THEN 'A0422180' WHEN F.Skill_No = 350078 THEN 'A0422181' WHEN F.Skill_No = 350079 THEN 'A0422182' WHEN F.Skill_No = 350080 THEN 'A0422183' WHEN F.Skill_No = 350081 THEN 'A0422184' WHEN F.Skill_No = 350082 THEN 'A0422185' WHEN F.Skill_No = 330941 THEN 'A040309' WHEN F.Skill_No = 362679 THEN 'A040310' WHEN F.Skill_No = 362680 THEN 'A0422121' WHEN F.Skill_No = 362681 THEN 'A0422127' WHEN F.Skill_No = 362682 THEN 'A040311' WHEN F.Skill_No = 362683 THEN 'A040312' WHEN F.Skill_No = 362684 THEN 'A040313' WHEN F.Skill_No = 362685 THEN 'A0422151' WHEN F.Skill_No = 362686 THEN 'A0422157' WHEN F.Skill_No = 362797 THEN 'A0422201' WHEN F.Skill_No = 362798 THEN 'A0422202' WHEN F.Skill_No = 362799 THEN 'A0422203' WHEN F.Skill_No = 362827 THEN 'A0422205' WHEN F.Skill_No = 362828 THEN 'A0422204' WHEN F.Skill_No = 362829 THEN 'A0422206' WHEN F.Skill_No = 362830 THEN 'A0422186' WHEN F.Skill_No = 362831 THEN 'A0422187' WHEN F.Skill_No = 362832 THEN 'A0422133' WHEN F.Skill_No = 362834 THEN 'A0422189' WHEN F.Skill_No = 362835 THEN 'A0422135' WHEN F.Skill_No = 362836 THEN 'A0422190' WHEN F.Skill_No = 362837 THEN 'A0422191' WHEN F.Skill_No = 362838 THEN 'A0422192' WHEN F.Skill_No = 362839 THEN 'A0422139' WHEN F.Skill_No = 362840 THEN 'A0422194' WHEN F.Skill_No = 362841 THEN 'A0422141' WHEN F.Skill_No = 362842 THEN 'A0422142' WHEN F.Skill_No = 362843 THEN 'A0422196' WHEN F.Skill_No = 362844 THEN 'A0422207' WHEN F.Skill_No = 362845 THEN 'A0422197' WHEN F.Skill_No = 362846 THEN 'A0422198' WHEN F.Skill_No = 362847 THEN 'A0422199' WHEN F.Skill_No = 362848 THEN 'A0422148' WHEN F.Skill_No = 362838 THEN 'A042289' WHEN F.Skill_No = 330597 THEN 'A042291' WHEN F.Skill_No = 422442 THEN 'A042292' WHEN F.Skill_No = 422443 THEN 'A042293' WHEN F.Skill_No = 422444 THEN 'A042294' WHEN F.Skill_No = 422445 THEN 'A042295' WHEN F.Skill_No = 422446 THEN 'A042296' WHEN F.Skill_No = 422447 THEN 'A042297' WHEN F.Skill_No = 422448 THEN 'A042298' WHEN F.Skill_No = 422449 THEN 'A042285' WHEN F.Skill_No = 422450 THEN 'A042286' WHEN F.Skill_No = 422451 THEN 'A042287' WHEN F.Skill_No = 422452 THEN 'A042288' WHEN F.Skill_No = 422453 THEN 'A042290' ELSE '    ' END</td>
        <td>41</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>60</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>60</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>60</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>60</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>61</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>61</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>61</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>61</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.inqueue_time &gt; 0
          AND S.IsShortAbandon = 0 THEN 1 ELSE 0 END</td>
        <td>290</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.Agent_Time &gt; 0
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0) THEN 1 ELSE 0 END</td>
        <td>291</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.Abandon_Time &gt; 0
          AND S.IsShortAbandon = 0 THEN 1 ELSE 0 END</td>
        <td>292</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN SUM(CASE WHEN Inbound = 'T'
                        AND S.Agent_Time &gt; 0
                        OR (S.agent_time = 0
                            AND S.inqueue_Time &gt; 0
                            AND S.Abandon_Time = 0
                            AND S.IsShortAbandon = 0
                            AND Inbound = 'T') THEN 1 ELSE 0 END) = 0 THEN 0 ELSE SUM(CASE WHEN Inbound = 'T'
                                                                                                AND S.Agent_Time &gt; 0
                                                                                                OR (S.agent_time = 0
                                                                                                    AND S.inqueue_Time &gt; 0
                                                                                                    AND S.Abandon_Time = 0
                                                                                                    AND S.IsShortAbandon = 0
                                                                                                    AND Inbound = 'T') THEN S.INQueue_Seconds ELSE 0 END) / SUM(CASE WHEN Inbound = 'T'
                                                                                                                                                                          AND S.Agent_Time &gt; 0
                                                                                                                                                                          OR (S.agent_time = 0
                                                                                                                                                                              AND S.inqueue_Time &gt; 0
                                                                                                                                                                              AND S.Abandon_Time = 0
                                                                                                                                                                              AND S.IsShortAbandon = 0
                                                                                                                                                                              AND Inbound = 'T') THEN 1 ELSE 0 END) END</td>
        <td>293</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inbound = 'T'
          AND S.Agent_Time &gt; 0
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND Inbound = 'T') THEN 1 ELSE 0 END</td>
        <td>293</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inbound = 'T'
          AND S.Agent_Time &gt; 0
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND Inbound = 'T') THEN S.INQueue_Seconds ELSE 0 END</td>
        <td>293</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inbound = 'T'
          AND S.Agent_Time &gt; 0
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND Inbound = 'T') THEN 1 ELSE 0 END</td>
        <td>293</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.Agent_Time &gt; 0
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0) THEN S.Agent_Seconds ELSE 0 END</td>
        <td>294</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.Agent_Time &gt; 0
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0) THEN S.ACW_Seconds ELSE 0 END</td>
        <td>295</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.Abandon_Time &gt; 0
          AND S.IsShortAbandon = 1 THEN 1 ELSE 0 END</td>
        <td>296</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.SLA = 1
          AND S.Agent_Time &gt; 0
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND S.SLA = 1) THEN 1 ELSE 0 END</td>
        <td>298</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inbound = 'T'
          AND S.Agent_Time &gt; 0
          AND S.INQueue_Time &lt;= 30000
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND S.INQueue_Time &lt;= 30000) THEN 1 ELSE 0 END</td>
        <td>299</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inbound = 'T'
          AND S.Agent_Time &gt; 0
          AND S.INQueue_Time &lt;= 45000
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND S.INQueue_Time &lt;= 45000) THEN 1 ELSE 0 END</td>
        <td>300</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inbound = 'T'
          AND S.Agent_Time &gt; 0
          AND S.INQueue_Time &lt; 60000
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND S.INQueue_Time &lt; 60000)
          OR (S.INQueue_Time &gt;= 60000
              AND s.sla = 0
              AND Inbound = 'T'
              AND S.Agent_Time &gt; 0) THEN 1 ELSE 0 END</td>
        <td>301</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.Abandon_Time &gt; 0
          AND S.IsShortAbandon = 0 THEN 1 ELSE 0 END</td>
        <td>303</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.Agent_Time &gt; 0
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0) THEN S.inQueue_seconds ELSE 0 END</td>
        <td>305</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN S.Abandon_Time &gt; 0
          AND S.IsShortAbandon = 0 THEN S.prequeue_seconds + S.inqueue_seconds ELSE 0 END</td>
        <td>306</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inbound = 'T'
          AND S.Agent_Time &gt; 0
          AND S.INQueue_Time &lt;= 120000
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND S.INQueue_Time &lt; 120000) THEN 1 ELSE 0 END</td>
        <td>307</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inbound = 'T'
          AND S.Agent_Time &gt; 0
          AND S.INQueue_Time &lt;= 180000
          OR (S.agent_time = 0
              AND S.inqueue_Time &gt; 0
              AND S.Abandon_Time = 0
              AND S.IsShortAbandon = 0
              AND S.INQueue_Time &lt; 180000) THEN 1 ELSE 0 END</td>
        <td>308</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>572</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>572</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>572</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>572</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>573</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>573</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>573</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>573</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN F.Skill_No = 155806 THEN '44SE' WHEN F.Skill_No = 155807 THEN '46SW' WHEN F.Skill_No = 155808 THEN '52MW' WHEN F.Skill_No = 155809 THEN '51EA' WHEN F.Skill_No = 155810 THEN '47WS' WHEN F.Skill_No = 155812 THEN '55WS' WHEN F.Skill_No = 155813 THEN '64WL' WHEN F.Skill_No = 155814 THEN '68BE' WHEN F.Skill_No = 155815 THEN '63UV' WHEN F.Skill_No = 155816 THEN '66UC' WHEN F.Skill_No = 155817 THEN '62ST' WHEN F.Skill_No = 155818 THEN '61SS' WHEN F.Skill_No = 155819 THEN '60NB' WHEN F.Skill_No = 155820 THEN '59WN' WHEN F.Skill_No = 155821 THEN '69DC' WHEN F.Skill_No = 155822 THEN '57WF' WHEN F.Skill_No = 155823 THEN '65WE' WHEN F.Skill_No = 155824 THEN '56DS' WHEN F.Skill_No = 155827
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    AND CAST (REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-') AS DATE) &lt; '7/11/2013' THEN '41PA' WHEN F.Skill_No = 155827
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             AND CAST (REPLACE(CAST (CONVERT (VARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone), 111) AS VARCHAR) + ' ' + CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END + ':' + CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END + ':00', '/', '-') AS DATE) &gt;= '7/11/2013' THEN 'A040502' WHEN F.Skill_No = 155828 THEN '43PG' WHEN F.Skill_No = 155830 THEN '54PV' WHEN F.Skill_No = 156428 THEN '040301' WHEN F.Skill_No = 157132 THEN '040901' WHEN F.Skill_No = 157133 THEN '040501' WHEN F.Skill_No = 216009 THEN '040101' WHEN F.Skill_No = 216010 THEN '040102' WHEN F.Skill_No = 216011 THEN '040103' WHEN F.Skill_No = 216012 THEN '040104' WHEN F.Skill_No = 182860 THEN '040302' WHEN F.Skill_No = 182861 THEN '040303' WHEN F.Skill_No = 182863 THEN '040304' WHEN F.Skill_No = 182866 THEN '040305' WHEN F.Skill_No = 182868 THEN '040306' WHEN F.Skill_No = 218007 THEN '040105' WHEN F.Skill_No = 218008 THEN '040106' WHEN F.Skill_No = 218009 THEN '040107' WHEN F.Skill_No = 218010 THEN '040108' WHEN F.Skill_No = 218011 THEN '040109' WHEN F.Skill_No = 218012 THEN '040110' WHEN F.Skill_No = 218015 THEN '040111' WHEN F.Skill_No = 218016 THEN '040112' WHEN F.Skill_No = 232901 THEN 'A040503' WHEN F.Skill_No = 232902 THEN 'A040504' WHEN F.Skill_No = 232903 THEN 'A042201' WHEN F.Skill_No = 239721 THEN 'A040403' WHEN F.Skill_No = 239722 THEN 'A040402' WHEN F.Skill_No = 239742 THEN '040307' WHEN F.Skill_No = 246424 THEN 'A042212' WHEN F.Skill_No = 246426 THEN 'A040505' WHEN F.Skill_No = 246427 THEN 'A040506' WHEN F.Skill_No = 246429 THEN 'A040508' WHEN F.Skill_No = 246430 THEN 'A040509' WHEN F.Skill_No = 246431 THEN 'A040510' WHEN F.Skill_No = 290226 THEN 'A042202' WHEN F.Skill_No = 290227 THEN 'A042203' WHEN F.Skill_No = 290228 THEN 'A042204' WHEN F.Skill_No = 290229 THEN 'A042205' WHEN F.Skill_No = 307554 THEN 'A042206' WHEN F.Skill_No = 307555 THEN 'A042207' WHEN F.Skill_No = 307556 THEN 'A042208' WHEN F.Skill_No = 307557 THEN 'A042209' WHEN F.Skill_No = 307558 THEN 'A042210' WHEN F.Skill_No = 307559 THEN 'A042211' WHEN F.Skill_No = 307560 THEN 'A040511' WHEN F.Skill_No = 307410 THEN 'A042213' WHEN F.Skill_No = 312270 THEN 'A040308' WHEN F.Skill_No = 330594 THEN 'A042214' WHEN F.Skill_No = 330595 THEN 'A042215' WHEN F.Skill_No = 330596 THEN 'A042216' WHEN F.Skill_No = 330597 THEN 'A042217' WHEN F.Skill_No = 330598 THEN 'A042218' WHEN F.Skill_No = 330599 THEN 'A042276' WHEN F.Skill_No = 330600 THEN 'A042277' WHEN F.Skill_No = 330601 THEN 'A042278' WHEN F.Skill_No = 330602 THEN 'A042279' WHEN F.Skill_No = 330603 THEN 'A042280' WHEN F.Skill_No = 330604 THEN 'A042281' WHEN F.Skill_No = 330605 THEN 'A042282' WHEN F.Skill_No = 330606 THEN 'A042220' WHEN F.Skill_No = 330607 THEN 'A042221' WHEN F.Skill_No = 330608 THEN 'A042222' WHEN F.Skill_No = 330609 THEN 'A042223' WHEN F.Skill_No = 330610 THEN 'A042224' WHEN F.Skill_No = 330611 THEN 'A042225' WHEN F.Skill_No = 330612 THEN 'A042226' WHEN F.Skill_No = 330613 THEN 'A042227' WHEN F.Skill_No = 330615 THEN 'A042228' WHEN F.Skill_No = 330616 THEN 'A042229' WHEN F.Skill_No = 330617 THEN 'A042230' WHEN F.Skill_No = 330625 THEN 'A042231' WHEN F.Skill_No = 330628 THEN 'A042232' WHEN F.Skill_No = 330629 THEN 'A042233' WHEN F.Skill_No = 330630 THEN 'A042234' WHEN F.Skill_No = 330631 THEN 'A042235' WHEN F.Skill_No = 330632 THEN 'A042236' WHEN F.Skill_No = 330633 THEN 'A042237' WHEN F.Skill_No = 330634 THEN 'A042238' WHEN F.Skill_No = 330635 THEN 'A042239' WHEN F.Skill_No = 330636 THEN 'A042240' WHEN F.Skill_No = 330637 THEN 'A042241' WHEN F.Skill_No = 330639 THEN 'A042242' WHEN F.Skill_No = 330640 THEN 'A042243' WHEN F.Skill_No = 330641 THEN 'A042244' WHEN F.Skill_No = 330642 THEN 'A042245' WHEN F.Skill_No = 330643 THEN 'A042246' WHEN F.Skill_No = 330644 THEN 'A042247' WHEN F.Skill_No = 330645 THEN 'A042248' WHEN F.Skill_No = 330646 THEN 'A042249' WHEN F.Skill_No = 330647 THEN 'A042250' WHEN F.Skill_No = 330648 THEN 'A042251' WHEN F.Skill_No = 330649 THEN 'A042252' WHEN F.Skill_No = 330650 THEN 'A042253' WHEN F.Skill_No = 330651 THEN 'A042254' WHEN F.Skill_No = 330653 THEN 'A042255' WHEN F.Skill_No = 330654 THEN 'A042256' WHEN F.Skill_No = 330655 THEN 'A042257' WHEN F.Skill_No = 330656 THEN 'A042258' WHEN F.Skill_No = 330657 THEN 'A042259' WHEN F.Skill_No = 330658 THEN 'A042260' WHEN F.Skill_No = 330659 THEN 'A042261' WHEN F.Skill_No = 330660 THEN 'A042262' WHEN F.Skill_No = 330661 THEN 'A042263' WHEN F.Skill_No = 330662 THEN 'A042264' WHEN F.Skill_No = 330664 THEN 'A042265' WHEN F.Skill_No = 330665 THEN 'A042266' WHEN F.Skill_No = 330667 THEN 'A042267' WHEN F.Skill_No = 330668 THEN 'A042268' WHEN F.Skill_No = 330669 THEN 'A042269' WHEN F.Skill_No = 330670 THEN 'A042270' WHEN F.Skill_No = 330671 THEN 'A042271' WHEN F.Skill_No = 330672 THEN 'A042272' WHEN F.Skill_No = 330942 THEN 'A0422118' WHEN F.Skill_No = 330947 THEN 'A0422119' WHEN F.Skill_No = 330944 THEN 'A0422120' WHEN F.Skill_No = 330946 THEN 'A0422149' WHEN F.Skill_No = 330948 THEN 'A0422126' WHEN F.Skill_No = 330949 THEN 'A0422123' WHEN F.Skill_No = 330950 THEN 'A0422124' WHEN F.Skill_No = 330951 THEN 'A0422125' WHEN F.Skill_No = 330952 THEN 'A0422150' WHEN F.Skill_No = 330953 THEN 'A0422152' WHEN F.Skill_No = 330954 THEN 'A040321' WHEN F.Skill_No = 330955 THEN 'A040314' WHEN F.Skill_No = 330956 THEN 'A0422130' WHEN F.Skill_No = 330957 THEN 'A0422131' WHEN F.Skill_No = 330958 THEN 'A0422132' WHEN F.Skill_No = 330959 THEN 'A040315' WHEN F.Skill_No = 330960 THEN 'A0422134' WHEN F.Skill_No = 330961 THEN 'A040316' WHEN F.Skill_No = 330962 THEN 'A0422136' WHEN F.Skill_No = 330963 THEN 'A0422137' WHEN F.Skill_No = 330978 THEN 'A0422138' WHEN F.Skill_No = 330979 THEN 'A040317' WHEN F.Skill_No = 330980 THEN 'A0422140' WHEN F.Skill_No = 330981 THEN 'A040318' WHEN F.Skill_No = 330982 THEN 'A040319' WHEN F.Skill_No = 330983 THEN 'A0422143' WHEN F.Skill_No = 330997 THEN 'A0422144' WHEN F.Skill_No = 330998 THEN 'A0422145' WHEN F.Skill_No = 330999 THEN 'A0422146' WHEN F.Skill_No = 331000 THEN 'A0422147' WHEN F.Skill_No = 331001 THEN 'A040320' WHEN F.Skill_No = 331011 THEN 'A040322' WHEN F.Skill_No = 331016 THEN 'A040323' WHEN F.Skill_No = 331019 THEN 'A040324' WHEN F.Skill_No = 331020 THEN 'A040325' WHEN F.Skill_No = 331021 THEN 'A0422153' WHEN F.Skill_No = 331022 THEN 'A0422154' WHEN F.Skill_No = 331024 THEN 'A0422155' WHEN F.Skill_No = 331025 THEN 'A0422156' WHEN F.Skill_No = 331026 THEN 'A040326' WHEN F.Skill_No = 331027 THEN 'A0422158' WHEN F.Skill_No = 331028 THEN 'A0422159' WHEN F.Skill_No = 331029 THEN 'A0422160' WHEN F.Skill_No = 331030 THEN 'A0422161' WHEN F.Skill_No = 331031 THEN 'A0422162' WHEN F.Skill_No = 350052 THEN 'A0422163' WHEN F.Skill_No = 350053 THEN 'A0422164' WHEN F.Skill_No = 350054 THEN 'A0422165' WHEN F.Skill_No = 350063 THEN 'A0422166' WHEN F.Skill_No = 350064 THEN 'A0422167' WHEN F.Skill_No = 350065 THEN 'A0422168' WHEN F.Skill_No = 350066 THEN 'A0422169' WHEN F.Skill_No = 350067 THEN 'A0422170' WHEN F.Skill_No = 350068 THEN 'A0422171' WHEN F.Skill_No = 350069 THEN 'A0422172' WHEN F.Skill_No = 350070 THEN 'A0422173' WHEN F.Skill_No = 350071 THEN 'A0422174' WHEN F.Skill_No = 350072 THEN 'A0422175' WHEN F.Skill_No = 350073 THEN 'A0422176' WHEN F.Skill_No = 350074 THEN 'A0422177' WHEN F.Skill_No = 350075 THEN 'A0422178' WHEN F.Skill_No = 350076 THEN 'A0422179' WHEN F.Skill_No = 350077 THEN 'A0422180' WHEN F.Skill_No = 350078 THEN 'A0422181' WHEN F.Skill_No = 350079 THEN 'A0422182' WHEN F.Skill_No = 350080 THEN 'A0422183' WHEN F.Skill_No = 350081 THEN 'A0422184' WHEN F.Skill_No = 350082 THEN 'A0422185' WHEN F.Skill_No = 330941 THEN 'A040309' WHEN F.Skill_No = 362679 THEN 'A040310' WHEN F.Skill_No = 362680 THEN 'A0422121' WHEN F.Skill_No = 362681 THEN 'A0422127' WHEN F.Skill_No = 362682 THEN 'A040311' WHEN F.Skill_No = 362683 THEN 'A040312' WHEN F.Skill_No = 362684 THEN 'A040313' WHEN F.Skill_No = 362685 THEN 'A0422151' WHEN F.Skill_No = 362686 THEN 'A0422157' WHEN F.Skill_No = 362797 THEN 'A0422201' WHEN F.Skill_No = 362798 THEN 'A0422202' WHEN F.Skill_No = 362799 THEN 'A0422203' WHEN F.Skill_No = 362827 THEN 'A0422205' WHEN F.Skill_No = 362828 THEN 'A0422204' WHEN F.Skill_No = 362829 THEN 'A0422206' WHEN F.Skill_No = 362830 THEN 'A0422186' WHEN F.Skill_No = 362831 THEN 'A0422187' WHEN F.Skill_No = 362832 THEN 'A0422133' WHEN F.Skill_No = 362834 THEN 'A0422189' WHEN F.Skill_No = 362835 THEN 'A0422135' WHEN F.Skill_No = 362836 THEN 'A0422190' WHEN F.Skill_No = 362837 THEN 'A0422191' WHEN F.Skill_No = 362838 THEN 'A0422192' WHEN F.Skill_No = 362839 THEN 'A0422139' WHEN F.Skill_No = 362840 THEN 'A0422194' WHEN F.Skill_No = 362841 THEN 'A0422141' WHEN F.Skill_No = 362842 THEN 'A0422142' WHEN F.Skill_No = 362843 THEN 'A0422196' WHEN F.Skill_No = 362844 THEN 'A0422207' WHEN F.Skill_No = 362845 THEN 'A0422197' WHEN F.Skill_No = 362846 THEN 'A0422198' WHEN F.Skill_No = 362847 THEN 'A0422199' WHEN F.Skill_No = 362848 THEN 'A0422148' WHEN F.Skill_No = 362838 THEN 'A042289' WHEN F.Skill_No = 330597 THEN 'A042291' WHEN F.Skill_No = 422442 THEN 'A042292' WHEN F.Skill_No = 422443 THEN 'A042293' WHEN F.Skill_No = 422444 THEN 'A042294' WHEN F.Skill_No = 422445 THEN 'A042295' WHEN F.Skill_No = 422446 THEN 'A042296' WHEN F.Skill_No = 422447 THEN 'A042297' WHEN F.Skill_No = 422448 THEN 'A042298' WHEN F.Skill_No = 422449 THEN 'A042285' WHEN F.Skill_No = 422450 THEN 'A042286' WHEN F.Skill_No = 422451 THEN 'A042287' WHEN F.Skill_No = 422452 THEN 'A042288' WHEN F.Skill_No = 422453 THEN 'A042290' ELSE '    ' END</td>
        <td>579</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>598</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>598</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>598</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>598</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) &lt; 10 THEN '0' + CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) ELSE CAST (DATEPART(hour, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) AS VARCHAR) END</td>
        <td>599</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 15 THEN '00' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
                                                                                                                       AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                                                                                                                                        AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END END</td>
        <td>599</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &gt; 15
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30 THEN '15' ELSE CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
                                                                                                                           AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END END</td>
        <td>599</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 30
          AND DATEPART(minute, dbo.fn_ConvertUTCToTargetTimeZone(H.Start_Date, @p_TimeZone)) &lt; 45 THEN '30' ELSE '45' END</td>
        <td>599</td>
      </tr>
      <tr valign="top">
        <td colspan="1">COMMIT TRANSACTION</td>
        <td colspan="1">COMMIT TRANSACTION</td>
        <td>832</td>
      </tr>
    </table>
  </body>
</html>