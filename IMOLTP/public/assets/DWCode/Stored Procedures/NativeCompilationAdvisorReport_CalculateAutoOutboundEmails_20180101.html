<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[CalculateAutoOutboundEmails]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[CalculateAutoOutboundEmails]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:09 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#BusNoQtrHourData</td>
        <td>18</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#BusNoQtrHourData AS qtr</td>
        <td>27</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tempRoll AS S</td>
        <td>36</td>
      </tr>
      <tr valign="top">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   Bus_no AS Bus_no,
         COUNT(clh.Contact_Id) AS EmailsSent,
         qtr.UTCQtrHourStartDate AS UTCStartDate
INTO     #tempRoll
FROM     #BusNoQtrHourData AS qtr
         INNER JOIN
         dbo.Contact_Log_Header AS clh
         ON clh.start_date BETWEEN qtr.UTCQtrHourStartDate AND qtr.UTCQtrHourEndDate
WHERE    clh.Contact_Code = 11
GROUP BY qtr.UTCQtrHourStartDate, Bus_no</td>
        <td>22</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">MERGE</td>
        <td colspan="1">MERGE INTO dbo.AutoOutboundEmailRollUp
 AS T
USING #tempRoll AS S ON T.Bus_no = S.Bus_no
                        AND T.UTCStartDate = S.UTCStartDate
WHEN MATCHED THEN UPDATE 
SET T.EmailsSent = S.EmailsSent
WHEN NOT MATCHED THEN INSERT (Bus_no, EmailsSent, UTCStartDate) VALUES (S.Bus_no, S.EmailsSent, S.UTCStartDate)</td>
        <td>35</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MERGE INTO dbo.AutoOutboundEmailRollUp
 AS T
USING #tempRoll AS S ON T.Bus_no = S.Bus_no
                        AND T.UTCStartDate = S.UTCStartDate
WHEN MATCHED THEN UPDATE 
SET T.EmailsSent = S.EmailsSent
WHEN NOT MATCHED THEN INSERT (Bus_no, EmailsSent, UTCStartDate) VALUES (S.Bus_no, S.EmailsSent, S.UTCStartDate)</td>
        <td>35</td>
      </tr>
    </table>
  </body>
</html>