<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[Surveys_SatisfactionPerformanceReport_GetAnswers]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[Surveys_SatisfactionPerformanceReport_GetAnswers]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT RankID,
       RowCountTotal,
       SurveyName,
       ResultID,
       Metric,
       Answer,
       CommentKey,
       Comment,
       AgentNo,
       FirstLastName,
       TeamNo,
       TeamName,
       SurveyStartDateQH,
       SurveyStartDateQHOffset,
       Value10scale,
       Value10scaleMax
INTO   #Page
FROM   (SELECT DENSE_RANK() OVER (ORDER BY fa.ResultKey) AS RankID,
               DENSE_RANK() OVER (ORDER BY fa.ResultKey DESC) AS RowCountTotal,
               ds.SurveyName,
               fr.ResultID,
               dq.Metric,
               da.Answer,
               dc.CommentKey,
               dc.Comment,
               dag.AgentNo,
               dag.FirstLastName,
               dag.TeamNo,
               dt.TeamName,
               dbo.fn_ConvertUTCToTargetTimeZone(fa.SurveyStartDateQH, @TimeZone) AS SurveyStartDateQH,
               fa.AnswerCount,
               fa.SurveyStartDateQHOffset,
               fa.Value10scale,
               fa.Value10scaleMax
        FROM   dbo.fn_Split(@SurveyIDList, ',') AS s
               INNER JOIN
               dbo.DimSurvey AS ds WITH (FORCESEEK)
               ON ds.SurveyID = CONVERT (INT, s.Value)
               INNER JOIN
               dbo.DimQuestion AS dq
               ON ds.SurveyKey = dq.SurveyKey
               INNER JOIN
               dbo.DimAnswer AS da
               ON da.QuestionKey = dq.QuestionKey
               INNER JOIN
               dbo.FactAnswer AS fa
               ON da.AnswerKey = fa.AnswerKey
               INNER JOIN
               dbo.DimComment AS dc
               ON dc.CommentKey = fa.CommentKey
               INNER JOIN
               dbo.DimAgent AS dag
               ON dag.AgentKey = fa.AgentKey
               INNER JOIN
               dbo.DimTeam AS dt
               ON dag.TeamNo = dt.TeamNo
               INNER JOIN
               dbo.FactResult AS fr
               ON fa.ResultKey = fr.ResultKey
        WHERE  dag.BusNo = @BusNo
               AND dag.TeamNoCurrent BETWEEN ISNULL(@TeamNo, -2147483648) AND ISNULL(@TeamNo, 2147483647)
               AND dag.AgentNo BETWEEN ISNULL(@AgentNo, -2147483648) AND ISNULL(@AgentNo, 2147483647)
               AND dag.ReportsTo BETWEEN ISNULL(@SupervisorID, -2147483648) AND ISNULL(@SupervisorID, 2147483647)
               AND fa.SurveyStartDateQH BETWEEN ISNULL(@DateStartUTC, 0) AND ISNULL(@DateEndUTC, '9999')) AS q
WHERE  q.RankID BETWEEN ISNULL(@ResultIDOffset, 0) + 1 AND ISNULL(ISNULL(@ResultIDOffset, 0) + @ResultIDFetch, 2147483647)
       OR q.RankID = 1</td>
        <td>8</td>
      </tr>
      <tr valign="top">
        <td colspan="1">DENSE_RANK</td>
        <td colspan="1">DENSE_RANK() OVER (ORDER BY fa.ResultKey)</td>
        <td>29</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">DENSE_RANK() OVER (ORDER BY fa.ResultKey DESC)</td>
        <td>30</td>
      </tr>
      <tr valign="top">
        <td colspan="1">OVER</td>
        <td colspan="1">OVER (ORDER BY fa.ResultKey)</td>
        <td>29</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY fa.ResultKey DESC)</td>
        <td>30</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_Split(@SurveyIDList, ',') AS s</td>
        <td>45</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#Page AS p</td>
        <td>88</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Page AS p</td>
        <td>94</td>
      </tr>
    </table>
  </body>
</html>