<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_FamilySearch_ContactStatsBaseMod]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_FamilySearch_ContactStatsBaseMod]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top">
        <td colspan="1">BEGIN TRANSACTION</td>
        <td colspan="1">BEGIN TRANSACTION</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT s.skill_no AS SkillNo,
       s.skill_name AS SkillName,
       c.campaign_no AS CampaignNo,
       c.campaign_name AS CampaignName,
       b.business_unit_name AS BusName
INTO   #MySkills
FROM   dbo.Skills AS s
       INNER JOIN
       dbo.Campaign AS c
       ON s.campaign_no = c.campaign_no
       INNER JOIN
       dbo.business_unit AS b
       ON c.bus_no = b.bus_no
WHERE  b.bus_no = @Bus_No
       AND s.status = 'Curr'
       AND c.status = 'Curr'
       AND (@campaign LIKE '%,' + CONVERT (NVARCHAR, c.campaign_no) + ',%'
            OR @campaign IS NULL)
       AND (@skill LIKE '%,' + CONVERT (NVARCHAR, s.skill_no) + ',%'
            OR @skill IS NULL)
OPTION (MAXDOP 2)</td>
        <td>55</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   bus_no,
         contact_code,
         skill_no,
         dbo.fn_StartDateTimeFromHalfHourCode(Start_date, HalfHour_Code) AS start_date,
         HalfHour_code,
         Sum(PreQueue_Time) AS PreQueue_Time,
         Sum(InQueue_time) AS InQueue_time,
         Sum(InQueue_Cnt) AS InQueue_Cnt,
         Sum(Abandon_Cnt) AS Abandon_Cnt,
         Sum(Abandon_time) AS Abandon_time,
         Sum(Agent_cnt) AS Agent_cnt,
         Sum(Agent_Time) AS Agent_Time,
         Sum(PostQueue_time) AS PostQueue_time,
         Sum(PostQueue_Cnt) AS PostQueue_Cnt,
         Sum(Total_cnt) AS Total_cnt,
         Sum(ReSkill_cnt) AS ReSkill_cnt,
         Sum(total_time) AS total_time,
         Sum(In_SLA) AS In_SLA,
         Sum(Out_SLA) AS Out_SLA,
         Sum(Release_Time) AS Release_Time,
         Sum(Hold_Time) AS Hold_Time,
         Sum(HoldTotal_Cnt) AS HoldTotal_Cnt,
         Sum(HoldContacts_cnt) AS HoldContacts_cnt,
         Sum(ACW_Time) AS ACW_Time,
         Sum(ACW_Cnt) AS ACW_Cnt,
         Sum(Conf_Time) AS Conf_Time,
         Sum(Conf_Cnt) AS Conf_Cnt,
         Sum(Abandon_InSLA_Time) AS Abandon_InSLA_Time,
         Sum(Abandon_InSLA_Cnt) AS Abandon_InSLA_Cnt,
         Max(Max_ACW_Time) AS Max_ACW_Time,
         Max(Max_Conf_Time) AS Max_Conf_Time,
         Max(Max_PreQueue_Time) AS Max_PreQueue_Time,
         Max(Max_InQueue_Time) AS Max_InQueue_Time,
         Max(Max_Abandon_Time) AS Max_Abandon_Time,
         Max(Max_Agent_Time) AS Max_Agent_Time,
         Max(Max_PostQueue_Time) AS Max_PostQueue_Time,
         Max(Max_Total_Time) AS Max_Total_Time,
         Max(Max_Hold_Time) AS Max_Hold_Time,
         Max(Max_Release_Time) AS Max_Release_Time
INTO     #dw_POC_ByHalfHour
FROM     dbo.dw_POC_ByQtrHour
WHERE    bus_no = @Bus_no
         AND start_date BETWEEN @start_date AND @END_date
GROUP BY bus_no, contact_code, skill_no, dbo.fn_StartDateTimeFromHalfHourCode(Start_date, HalfHour_Code), HalfHour_Code</td>
        <td>75</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT c.contact_code,
       IsNull(c.ContactAddress, 'CallBack') AS contact_name,
       c.status,
       a.bus_no,
       c.contact_type
INTO   #dw_POC
FROM   dbo.PointOfContact AS c
       INNER JOIN
       dbo.skills AS s
       ON c.default_skill_no = s.skill_no
       INNER JOIN
       dbo.campaign AS a
       ON s.campaign_no = a.campaign_no
WHERE  c.contact_type = 1
       AND a.bus_no = @Bus_no
UNION
SELECT c.contact_code,
       s.description,
       c.status,
       b.bus_no,
       c.contact_type
FROM   dbo.PointOfContact AS c
       INNER JOIN
       dbo.contact_types AS s
       ON c.contact_type = s.contact_type CROSS JOIN dbo.business_unit AS b
WHERE  default_skill_no IS NULL
       AND b.bus_no = @Bus_no</td>
        <td>128</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   F.Campaign_no,
         F.Skill_No,
         h.Contact_Code,
         CONVERT (NVARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(h.Start_Date, @TimeZone), 120) AS Start_Date,
         dbo.fn_CalcTimeZoneHalfHourCodeFromUTC(h.Start_Date, @TimeZone) AS HHCode,
         SUM(CASE WHEN isShortAbandon = 1 THEN 1 ELSE 0 END) AS ShortAbandons,
         SUM(CASE WHEN isShortAbandon = 1 THEN S.inQueue_SEconds ELSE 0 END) AS ShortAbandonTime
INTO     #ShortAbandons
FROM     dbo.Contact_Log_Header AS H
         INNER JOIN
         dbo.Contact_Log_Footer AS F
         ON h.Contact_id = F.Contact_ID
         INNER JOIN
         dbo.Contact_Log_Summary AS S
         ON h.Contact_id = S.Contact_ID
WHERE    H.bus_no = @Bus_No
         AND H.Start_Date BETWEEN @start_date AND @end_date
GROUP BY F.Campaign_no, F.Skill_No, h.Contact_Code, CONVERT (NVARCHAR (10), dbo.fn_ConvertUTCToTargetTimeZone(h.Start_Date, @TimeZone), 120), dbo.fn_CalcTimeZoneHalfHourCodeFromUTC(h.Start_Date, @TimeZone)</td>
        <td>216</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">LIKE</td>
        <td colspan="1">@campaign LIKE '%,' + CONVERT (NVARCHAR, c.campaign_no) + ',%'</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@skill LIKE '%,' + CONVERT (NVARCHAR, s.skill_no) + ',%'</td>
        <td>70</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">MAXDOP</td>
        <td colspan="1">MAXDOP 2</td>
        <td>73</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>214</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>274</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#MyContactStats</td>
        <td>174</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#dw_POC_ByHalfHour AS h</td>
        <td>208</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Myskills AS ms</td>
        <td>262</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#MyContactStats AS mc</td>
        <td>264</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#dw_POC AS ci</td>
        <td>265</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ShortAbandons AS s</td>
        <td>268</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN isShortAbandon = 1 THEN 1 ELSE 0 END</td>
        <td>222</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN isShortAbandon = 1 THEN S.inQueue_SEconds ELSE 0 END</td>
        <td>223</td>
      </tr>
      <tr valign="top">
        <td colspan="1">COMMIT TRANSACTION</td>
        <td colspan="1">COMMIT TRANSACTION</td>
        <td>283</td>
      </tr>
    </table>
  </body>
</html>