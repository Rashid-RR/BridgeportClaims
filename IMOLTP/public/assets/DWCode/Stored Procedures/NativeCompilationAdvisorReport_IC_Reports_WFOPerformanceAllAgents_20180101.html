<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_WFOPerformanceAllAgents]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_WFOPerformanceAllAgents]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT A.Bus_No,
       A.Agent_No,
       A.First_Name,
       A.Last_Name,
       T.Team_No,
       T.Team_Name,
       SM_A.CalcDate,
       SM.Name,
       SM_A.ActualValue
INTO   #AgentScores
FROM   WFOSourceMeasure_AgentScores AS SM_A
       INNER JOIN
       Agents AS A
       ON A.Agent_No = SM_A.AgentNo
          AND A.Agent_No IN (SELECT Value
                             FROM   [fn_Split3](ISNULL(@AgentFilter, A.Agent_No), ','))
          AND A.[Status] = 'CURR'
       INNER JOIN
       Team AS T
       ON T.Team_No = A.Team_No
          AND T.Team_No IN (SELECT Value
                            FROM   [fn_Split3](ISNULL(@TeamFilter, T.Team_No), ','))
          AND T.[Status] = 'CURR'
       INNER JOIN
       WFOSourceMeasure AS SM
       ON SM.SourceMeasureID = SM_A.SourceMeasureID
          AND SM.[TYPE] = 'KPI'
       INNER JOIN
       [fn_GetDataRoleFilterItems](@profileID, 'Teams') AS filter
       ON T.Team_No = filter.intValue
          OR filter.intvalue = 0
WHERE  SM_A.BusNo = @Bus_No
       AND SM_A.CalcDate BETWEEN @UTCStart_Date AND @UTCEnd_Date</td>
        <td>6</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">WFOSourceMeasure_AgentScores AS SM_A</td>
        <td>16</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Agents AS A</td>
        <td>17</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Team AS T</td>
        <td>18</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">WFOSourceMeasure AS SM</td>
        <td>19</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentScores</td>
        <td>24</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentScores AS A</td>
        <td>34</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">WFOSourceMeasure_TeamScores AS T</td>
        <td>35</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">WFOSourceMeasure AS SM</td>
        <td>36</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentScores</td>
        <td>52</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">[fn_Split3](ISNULL(@AgentFilter, A.Agent_No), ',')</td>
        <td>17</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">[fn_Split3](ISNULL(@TeamFilter, T.Team_No), ',')</td>
        <td>18</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">[fn_GetDataRoleFilterItems](@profileID, 'Teams') AS filter</td>
        <td>20</td>
      </tr>
      <tr valign="top">
        <td colspan="1">PIVOT</td>
        <td colspan="1">(SELECT Bus_No,
        Agent_No,
        First_Name,
        Last_Name,
        Team_No,
        Team_Name,
        CalcDate,
        Name,
        ActualValue
 FROM   #AgentScores) AS T PIVOT (MAX (ActualValue) FOR Name IN ([% Time in Adherence], [Total Average Quality Score], [Overall Average Score], [Team Overall Average Score])) AS PIV</td>
        <td>50</td>
      </tr>
    </table>
  </body>
</html>