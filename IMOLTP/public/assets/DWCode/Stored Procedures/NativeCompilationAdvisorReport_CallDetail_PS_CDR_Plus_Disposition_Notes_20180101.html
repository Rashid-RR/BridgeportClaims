<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_PS_CDR_Plus_Disposition_Notes]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[CallDetail_PS_CDR_Plus_Disposition_Notes]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:12 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>1</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top">
        <td colspan="1">BEGIN TRANSACTION</td>
        <td colspan="1">BEGIN TRANSACTION</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">EXECUTE LockCriticalSection @busno_str</td>
        <td>8</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#HeadContactIDs AS hc</td>
        <td>86</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">tags AS t</td>
        <td>94</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#app AS a</td>
        <td>100</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#CLSummary AS cls</td>
        <td>128</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Tags AS t</td>
        <td>129</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#app AS agg</td>
        <td>139</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Contacts AS c</td>
        <td>153</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Contacts AS c</td>
        <td>163</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogLastDisposition AS clld</td>
        <td>164</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Contacts AS c</td>
        <td>204</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogDisposition AS cld</td>
        <td>211</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   qv.[Contact_ID],
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[category1] = 'PreQueue' THEN Duration END) / 1000.0, 0) AS INT), 0) AS prequeue,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[category1] = 'InQueue' THEN Duration END) / 1000.0, 0) AS INT), 0) AS inqueue,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[contact_State] = 2 THEN Duration END) / 1000.0, 0) AS INT), 0) AS routing,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[category1] = 'Agent' THEN Duration END) / 1000.0, 0) AS INT), 0) AS agent,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[category1] = 'PostQueue' THEN Duration END) / 1000.0, 0) AS INT), 0) AS postqueue,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[contact_State] = 15 THEN Duration END) / 1000.0, 0) AS INT), 0) AS callback,
         ISNULL(CAST (ROUND(SUM(CASE WHEN cs.[contact_State] = 8 THEN Duration END) / 1000.0, 0) AS INT), 0) AS hold
INTO     #app
FROM     [dbo].[Contact_Log_DetailQV] AS qv
         INNER JOIN
         [dbo].[Contact_State] AS cs
         ON cs.[Contact_State] = qv.[Contact_state]
WHERE    qv.[bus_no] = @_bus_no
         AND qv.[StartDate] BETWEEN @_start_date AND @_end_date
GROUP BY qv.[contact_ID]
OPTION (TABLE HINT(qv, INDEX ([CL_Contact_Log_DetailQV_Bus_No_StartDate_RowVersion])))</td>
        <td>50</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT clh.[Contact_ID]
INTO   #HeadContactIDs
FROM   [dbo].[Contact_Log_Header] AS clh
WHERE  clh.[bus_no] = @_bus_no
       AND clh.[start_date] BETWEEN @_summary_start_date AND @_summary_end_date
OPTION (TABLE HINT(clh, INDEX ([IX_Contact_Log_Header_Bus_no_start_date])))</td>
        <td>69</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT cls.[Contact_ID],
       cls.[sla],
       cls.[acw_Time] / 1000 AS ACW_Time,
       cls.[Abandon_Seconds]
INTO   #CLSummary
FROM   [dbo].[Contact_Log_Summary] AS cls
       INNER JOIN
       #HeadContactIDs AS hc
       ON hc.[Contact_ID] = cls.[Contact_ID]</td>
        <td>79</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT st2.[Contact_ID],
                STUFF((SELECT   ',' + t.name AS [text()]
                       FROM     [dbo].[contact_log_Tags] AS st1
                                LEFT OUTER JOIN
                                tags AS t
                                ON t.[TagID] = st1.[TagID]
                       WHERE    st1.[Contact_ID] = st2.[Contact_ID]
                       ORDER BY st1.[Contact_ID]
                       FOR      XML PATH ('')), 1, 1, '') AS [Tags]
INTO   #Tags
FROM   [dbo].[contact_log_Tags] AS st2
       INNER JOIN
       #app AS a
       ON st2.Contact_ID = a.Contact_ID</td>
        <td>90</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   clh.[Contact_ID],
         clh.[Master_Contact_ID],
         [dbo].[fn_ConvertUTCToTargetTimeZone](clh.[Start_Date], @_TimeZone) AS [Start_Date],
         clh.[Contact_Code],
         REPLACE(REPLACE(REPLACE(clf.[To_Addr], CHAR(13), ''), CHAR(10), ''), CHAR(9), '') AS To_Addr,
         REPLACE(REPLACE(REPLACE(clf.[From_Addr], CHAR(13), ''), CHAR(10), ''), CHAR(9), '') AS From_Addr,
         clf.[Agent_No],
         clf.[Skill_No],
         clf.[Abandon],
         ISNULL(cls.[SLA], 0) AS SLA,
         agg.[prequeue] AS Prequeue_Time,
         agg.[inqueue] AS Inqueue_Time,
         agg.[routing] AS Routing_Time,
         agg.[agent] AS Agent_Time,
         agg.[postqueue] AS Postqueue_Time,
         agg.[callback] AS Callback_Time,
         ISNULL(cls.[ACW_Time], 0) AS ACW_Time,
         agg.[hold] AS Hold_Time,
         ISNULL(cls.[Abandon_Seconds], 0) AS Abandon_Time,
         t.Tags
INTO     #Contacts
FROM     [dbo].[Contact_Log_Header] AS clh
         INNER JOIN
         [dbo].[Contact_Log_Footer] AS clf
         ON clf.[Contact_ID] = clh.[Contact_ID]
         LEFT OUTER JOIN
         #CLSummary AS cls
         ON cls.[Contact_ID] = clh.[Contact_ID]
         LEFT OUTER JOIN
         #Tags AS t
         ON t.Contact_ID = clh.Contact_ID
         INNER JOIN
         #app AS agg
         ON agg.[Contact_ID] = clh.[Contact_ID]
WHERE    clh.[Bus_No] = @_bus_no
         AND clh.[Start_Date] BETWEEN @_start_Date AND @_end_date
ORDER BY clh.[Contact_ID]
OPTION (TABLE HINT(clh, INDEX ([IX_Contact_Log_Header_Bus_no_start_date])), QUERYTRACEON 9481)</td>
        <td>104</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   c.[Contact_ID],
         MAX(clds.[Start_Date]) AS [Start_Date]
INTO     #ContactLogLastDisposition
FROM     #Contacts AS c
         LEFT OUTER JOIN
         [dbo].[Contact_Log_Dispositions] AS clds
         ON clds.[Contact_ID] = c.[Contact_ID]
GROUP BY c.[Contact_ID]</td>
        <td>149</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT c.[Contact_ID],
       d.[Description],
       clds.[Disposition_Comments],
       clds.[Disposition_Code]
INTO   #ContactLogDisposition
FROM   #Contacts AS c
       LEFT OUTER JOIN
       #ContactLogLastDisposition AS clld
       ON clld.[Contact_ID] = c.[Contact_ID]
       LEFT OUTER JOIN
       [dbo].[Contact_Log_Dispositions] AS clds
       ON clds.[Contact_ID] = clld.[Contact_ID]
          AND clds.[Start_Date] = clld.[Start_Date]
       INNER JOIN
       [dbo].[Dispositions] AS d
       ON d.[Disposition_Code] = clds.[Disposition_Code]</td>
        <td>157</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN cs.[category1] = 'PreQueue' THEN Duration END</td>
        <td>52</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[category1] = 'InQueue' THEN Duration END</td>
        <td>53</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[contact_State] = 2 THEN Duration END</td>
        <td>54</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[category1] = 'Agent' THEN Duration END</td>
        <td>55</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[category1] = 'PostQueue' THEN Duration END</td>
        <td>56</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[contact_State] = 15 THEN Duration END</td>
        <td>57</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cs.[contact_State] = 8 THEN Duration END</td>
        <td>58</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.[Outbound_Skill] = 1 THEN c.[To_Addr] ELSE c.[From_Addr] END</td>
        <td>175</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN clg.[contact_id] IS NOT NULL THEN 'Y' ELSE 'N' END</td>
        <td>197</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">STUFF</td>
        <td colspan="1">STUFF((SELECT   ',' + t.name AS [text()]
       FROM     [dbo].[contact_log_Tags] AS st1
                LEFT OUTER JOIN
                tags AS t
                ON t.[TagID] = st1.[TagID]
       WHERE    st1.[Contact_ID] = st2.[Contact_ID]
       ORDER BY st1.[Contact_ID]
       FOR      XML PATH ('')), 1, 1, '')</td>
        <td>92</td>
      </tr>
      <tr valign="top">
        <td colspan="1">FOR XML</td>
        <td colspan="1">XML PATH ('')</td>
        <td>97</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">REPLACE</td>
        <td colspan="1">REPLACE(REPLACE(REPLACE(clf.[To_Addr], CHAR(13), ''), CHAR(10), ''), CHAR(9), '')</td>
        <td>109</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(REPLACE(clf.[To_Addr], CHAR(13), ''), CHAR(10), '')</td>
        <td>109</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(clf.[To_Addr], CHAR(13), '')</td>
        <td>109</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(REPLACE(REPLACE(clf.[From_Addr], CHAR(13), ''), CHAR(10), ''), CHAR(9), '')</td>
        <td>110</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(REPLACE(clf.[From_Addr], CHAR(13), ''), CHAR(10), '')</td>
        <td>110</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">REPLACE(clf.[From_Addr], CHAR(13), '')</td>
        <td>110</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CHAR</td>
        <td colspan="1">CHAR(13)</td>
        <td>109</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CHAR(10)</td>
        <td>109</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CHAR(9)</td>
        <td>109</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CHAR(13)</td>
        <td>110</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CHAR(10)</td>
        <td>110</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CHAR(9)</td>
        <td>110</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">QUERY TRACE ON</td>
        <td colspan="1">QUERYTRACEON 9481</td>
        <td>143</td>
      </tr>
      <tr valign="top">
        <td colspan="1">COMMIT TRANSACTION</td>
        <td colspan="1">COMMIT TRANSACTION</td>
        <td>215</td>
      </tr>
    </table>
  </body>
</html>