<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[WFOProcessSMData]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[WFOProcessSMData]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:12 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT *
INTO   #UnProcessedRecords
FROM   [STAGING].[WFOSourceMeasureData]
WHERE  [PROCESSED] = 0</td>
        <td>7</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT DISTINCT (DIMBASEMEASUREID),
                SOURCESYSTEMCODE
INTO   #DistinctSourceMeasure
FROM   #UnProcessedRecords AS UP</td>
        <td>12</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT A.[AGENT_NO],
       B.[BUS_NO],
       T.[ORGANIZATIONNAME],
       T.[ID],
       T.[DIMBASEMEASUREID],
       T.[SOURCESYSTEMCODE],
       T.[ACTUALVALUE],
       T.[PERIODICITY],
       T.PERIODDATE AS CALCDATE,
       @CurrentDate AS CREATEDATE
INTO   #UnProcessedRecordsWithAgentDetails
FROM   #UnProcessedRecords AS T
       INNER JOIN
       AGENTS AS A
       ON A.AGENT_NO = T.AGENTNO
       INNER JOIN
       BUSINESS_UNIT AS B
       ON A.BUS_NO = B.BUS_NO</td>
        <td>24</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">*</td>
        <td colspan="1">SELECT *
INTO   #UnProcessedRecords
FROM   [STAGING].[WFOSourceMeasureData]
WHERE  [PROCESSED] = 0</td>
        <td>7</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#UnProcessedRecords AS UP</td>
        <td>14</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#DistinctSourceMeasure AS SM</td>
        <td>19</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#UnProcessedRecords AS T</td>
        <td>35</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">AGENTS AS A</td>
        <td>36</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">BUSINESS_UNIT AS B</td>
        <td>37</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#UnProcessedRecordsWithAgentDetails AS UP</td>
        <td>42</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#UnProcessedRecordsWithAgentDetails AS UP</td>
        <td>81</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">STAGE</td>
        <td>85</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#UnProcessedRecords AS UP</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">MERGE</td>
        <td colspan="1">MERGE INTO [DBO].[WFOSourceMeasure_AgentScores]
 AS Dest
USING (SELECT UP.[AGENT_NO],
              UP.[ORGANIZATIONNAME],
              UP.[CALCDATE],
              SM.SourceMeasureID
       FROM   #UnProcessedRecordsWithAgentDetails AS UP
              INNER JOIN
              [DBO].[WFOSourceMeasure] AS SM
              ON SM.VerintInternalID = UP.DIMBASEMEASUREID) AS Source ON Dest.[AGENTNO] = Source.[AGENT_NO]
                                                                         AND Dest.[ORGANIZATIONNAME] = Source.[ORGANIZATIONNAME]
                                                                         AND Dest.[CALCDATE] = Source.[CALCDATE]
                                                                         AND Dest.SourceMeasureID = Source.SourceMeasureID
WHEN MATCHED THEN DELETE</td>
        <td>40</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MERGE INTO [DBO].[WFOSourceMeasure_AgentScores]
 AS Dest
USING (SELECT UP.[AGENT_NO],
              UP.[ORGANIZATIONNAME],
              UP.[CALCDATE],
              SM.SourceMeasureID
       FROM   #UnProcessedRecordsWithAgentDetails AS UP
              INNER JOIN
              [DBO].[WFOSourceMeasure] AS SM
              ON SM.VerintInternalID = UP.DIMBASEMEASUREID) AS Source ON Dest.[AGENTNO] = Source.[AGENT_NO]
                                                                         AND Dest.[ORGANIZATIONNAME] = Source.[ORGANIZATIONNAME]
                                                                         AND Dest.[CALCDATE] = Source.[CALCDATE]
                                                                         AND Dest.SourceMeasureID = Source.SourceMeasureID
WHEN MATCHED THEN DELETE</td>
        <td>40</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">UPDATE with FROM clause</td>
        <td colspan="1">
FROM [STAGING].[WFOSourceMeasureData] AS STAGE
     INNER JOIN
     #UnProcessedRecords AS UP
     ON UP.ID = STAGE.ID</td>
        <td>86</td>
      </tr>
    </table>
  </body>
</html>