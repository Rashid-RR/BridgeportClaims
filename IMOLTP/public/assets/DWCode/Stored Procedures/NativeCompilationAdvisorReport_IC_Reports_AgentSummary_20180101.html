<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_AgentSummary]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_AgentSummary]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@agent)</td>
        <td>10</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@team) AS TeamKeys</td>
        <td>281</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT a.Agent_No AS Agent_No,
       [last_name] + ', ' + [first_name] AS Agent_Name,
       a.Team_No AS Team_No
INTO   #Agent_name
FROM   [dbo].[Agents] AS a
       INNER JOIN
       @AgentTable AS b
       ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
       INNER JOIN
       dbo.Security_DataRoles AS dr
       ON (a.Team_No = dr.EntityID
           OR dr.ViewAllAndFuture = 1)
       INNER JOIN
       dbo.Security_DataRoleEntityTypes AS dret
       ON (dr.DataRoleEntityTypeID = dret.DataRoleEntityTypeID)
WHERE  a.Bus_No = @bus_no
       AND dret.DataRoleEntityTypeName = 'teams'
       AND dr.SecurityProfileID = @ProfileID</td>
        <td>12</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No AS Agent_No,
         COUNT(DISTINCT contact_id) AS [Inbound_Handled]
INTO     #Inbound_Handled
FROM     [dbo].[Contact_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    contact_state = 4
         AND Bus_No = @bus_no
         AND direction = 1
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>28</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS Inbound_Talk_Time
INTO     #Inbound_Talk_Time
FROM     [dbo].[Contact_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    Bus_No = @bus_no
         AND Contact_State IN (4, 8, 14)
         AND direction = 1
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>42</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         COUNT(DISTINCT contact_id) AS Outbound_Contacts
INTO     #Outbound_Contacts
FROM     [dbo].[Contact_Log_DetailQV] AS a
         INNER JOIN
         [dbo].[Skills] AS b
         ON a.Skill_No = b.Skill_No
         INNER JOIN
         @AgentTable AS c
         ON a.Agent_No BETWEEN c.IDMin AND c.IDMax
WHERE    a.Bus_No = @bus_no
         AND a.Direction = 2
         AND b.outbound_skill = 1
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>59</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         Count(DISTINCT contact_id) AS [Outbound_Handled]
INTO     #Outbound_Handled
FROM     [dbo].[Contact_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    Bus_No = @bus_no
         AND contact_state = 4
         AND Direction = 2
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>75</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS [Outbound_talk_time]
INTO     #Outbound_Talk_Time
FROM     [dbo].[Contact_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    Bus_No = @bus_no
         AND Contact_State IN (4, 8, 14)
         AND direction = 2
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>89</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS Outbound_Time
INTO     #Outbound_Time
FROM     [dbo].[Agent_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    Bus_No = @bus_no
         AND AgentStateID IN (4)
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>106</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS Available_Time
INTO     #Available_Time
FROM     [dbo].[Agent_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    Bus_No = @bus_no
         AND AgentStateID = 1
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>119</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS Unavailable_Time
INTO     #Unavailable_Time
FROM     [dbo].[Agent_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    a.Bus_No = @bus_no
         AND a.AgentStateID IN (0, 8, 2)
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>132</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         COUNT(DISTINCT contact_id) AS Refused
INTO     #Refused
FROM     [dbo].[Contact_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    Bus_No = @bus_no
         AND contact_state = 24
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>145</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS Login_Time
INTO     #Login_Time
FROM     [dbo].[Agent_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    Bus_No = @bus_no
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>158</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS ACW_Time
INTO     #ACW_Time
FROM     [dbo].[Agent_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
         INNER JOIN
         [dbo].[Outstates] AS c
         ON a.Outstate_Code = c.outstate_code
WHERE    a.Bus_No = @bus_no
         AND c.IsACW = 'T'
         AND c.IsSystemOutstate = 0
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>171</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS Inbound_Time
INTO     #Inbound_Time
FROM     [dbo].[Agent_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    a.Bus_No = @bus_no
         AND AgentStateID = 3
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>188</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.Agent_No,
         SUM(Duration) AS Consult_Time
INTO     #Consult_Time
FROM     [dbo].[Agent_Log_DetailQV] AS a
         INNER JOIN
         @AgentTable AS b
         ON a.Agent_No BETWEEN b.IDMin AND b.IDMax
WHERE    a.Bus_No = @bus_no
         AND AgentStateID IN (5, 6)
         AND startdate BETWEEN @start_date AND @end_date
GROUP BY a.Agent_No</td>
        <td>202</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT contact_id)</td>
        <td>30</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT contact_id)</td>
        <td>61</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Count(DISTINCT contact_id)</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT contact_id)</td>
        <td>147</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#Inbound_Handled</td>
        <td>55</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Outbound_Handled</td>
        <td>102</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ResultTable AS b</td>
        <td>280</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Agent_name AS a</td>
        <td>251</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Outbound_Contacts AS b</td>
        <td>252</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Outbound_Handled AS c</td>
        <td>253</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Outbound_Time AS d</td>
        <td>254</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Refused AS f</td>
        <td>255</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Login_Time AS g</td>
        <td>256</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Available_Time AS h</td>
        <td>257</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Unavailable_Time AS i</td>
        <td>258</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ACW_Time AS j</td>
        <td>259</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Inbound_Time AS k</td>
        <td>260</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Consult_Time AS l</td>
        <td>261</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Inbound_Handled AS n</td>
        <td>262</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Inbound_Talk_Time AS m</td>
        <td>263</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Outbound_talk_time AS o</td>
        <td>264</td>
      </tr>
      <tr valign="top">
        <td colspan="1">NULLIF</td>
        <td colspan="1">NULLIF (((ISNULL(ACW_Time, 0) + ISNULL(Inbound_talk_time, 0) + ISNULL(Outbound_talk_time, 0)) + ISNULL(Available_Time, 0)), 0)</td>
        <td>278</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">WITH clause</td>
        <td colspan="1">WITH ResultTable (Agent_No, Agent_Name, Inbound_Handled, Inbound_Talk_Time, Outbound_Contacts, Outbound_Handled, Outbound_Time, Outbound_talk_time, Refused, Login_Time, Available_Time, Unavailable_Time, ACW_Time, Inbound_Time, Consult_Time, Team_No)
AS (SELECT a.Agent_No,
           Agent_Name,
           Inbound_Handled,
           Inbound_Talk_Time,
           Outbound_Contacts,
           Outbound_Handled,
           Outbound_Time,
           Outbound_talk_time,
           Refused,
           Login_Time,
           Available_Time,
           Unavailable_Time,
           ACW_Time,
           Inbound_Time,
           Consult_Time,
           Team_No
    FROM   #Agent_name AS a
           LEFT OUTER JOIN
           #Outbound_Contacts AS b
           ON a.Agent_No = b.Agent_No
           LEFT OUTER JOIN
           #Outbound_Handled AS c
           ON a.Agent_No = c.Agent_No
           LEFT OUTER JOIN
           #Outbound_Time AS d
           ON a.Agent_No = d.Agent_No
           LEFT OUTER JOIN
           #Refused AS f
           ON a.Agent_No = f.Agent_No
           LEFT OUTER JOIN
           #Login_Time AS g
           ON a.Agent_No = g.Agent_No
           LEFT OUTER JOIN
           #Available_Time AS h
           ON a.Agent_No = h.Agent_No
           LEFT OUTER JOIN
           #Unavailable_Time AS i
           ON a.Agent_No = i.Agent_No
           LEFT OUTER JOIN
           #ACW_Time AS j
           ON a.Agent_No = j.Agent_No
           LEFT OUTER JOIN
           #Inbound_Time AS k
           ON a.Agent_No = k.Agent_No
           LEFT OUTER JOIN
           #Consult_Time AS l
           ON a.Agent_No = l.Agent_No
           LEFT OUTER JOIN
           #Inbound_Handled AS n
           ON a.Agent_No = n.Agent_No
           LEFT OUTER JOIN
           #Inbound_Talk_Time AS m
           ON a.Agent_No = m.Agent_No
           LEFT OUTER JOIN
           #Outbound_talk_time AS o
           ON a.Agent_No = o.Agent_No)</td>
        <td>215</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1"> ResultTable (Agent_No, Agent_Name, Inbound_Handled, Inbound_Talk_Time, Outbound_Contacts, Outbound_Handled, Outbound_Time, Outbound_talk_time, Refused, Login_Time, Available_Time, Unavailable_Time, ACW_Time, Inbound_Time, Consult_Time, Team_No)
AS (SELECT a.Agent_No,
           Agent_Name,
           Inbound_Handled,
           Inbound_Talk_Time,
           Outbound_Contacts,
           Outbound_Handled,
           Outbound_Time,
           Outbound_talk_time,
           Refused,
           Login_Time,
           Available_Time,
           Unavailable_Time,
           ACW_Time,
           Inbound_Time,
           Consult_Time,
           Team_No
    FROM   #Agent_name AS a
           LEFT OUTER JOIN
           #Outbound_Contacts AS b
           ON a.Agent_No = b.Agent_No
           LEFT OUTER JOIN
           #Outbound_Handled AS c
           ON a.Agent_No = c.Agent_No
           LEFT OUTER JOIN
           #Outbound_Time AS d
           ON a.Agent_No = d.Agent_No
           LEFT OUTER JOIN
           #Refused AS f
           ON a.Agent_No = f.Agent_No
           LEFT OUTER JOIN
           #Login_Time AS g
           ON a.Agent_No = g.Agent_No
           LEFT OUTER JOIN
           #Available_Time AS h
           ON a.Agent_No = h.Agent_No
           LEFT OUTER JOIN
           #Unavailable_Time AS i
           ON a.Agent_No = i.Agent_No
           LEFT OUTER JOIN
           #ACW_Time AS j
           ON a.Agent_No = j.Agent_No
           LEFT OUTER JOIN
           #Inbound_Time AS k
           ON a.Agent_No = k.Agent_No
           LEFT OUTER JOIN
           #Consult_Time AS l
           ON a.Agent_No = l.Agent_No
           LEFT OUTER JOIN
           #Inbound_Handled AS n
           ON a.Agent_No = n.Agent_No
           LEFT OUTER JOIN
           #Inbound_Talk_Time AS m
           ON a.Agent_No = m.Agent_No
           LEFT OUTER JOIN
           #Outbound_talk_time AS o
           ON a.Agent_No = o.Agent_No)</td>
        <td>215</td>
      </tr>
    </table>
  </body>
</html>