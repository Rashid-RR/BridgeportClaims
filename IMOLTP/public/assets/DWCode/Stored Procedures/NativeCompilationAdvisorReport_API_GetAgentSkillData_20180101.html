<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[API_GetAgentSkillData]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[API_GetAgentSkillData]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT *
 FROM   dbo.Agents
 WHERE  Agent_No = @Agent_No
        AND Bus_No = @Bus_No)</td>
        <td>15</td>
      </tr>
      <tr valign="top">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT DISTINCT agt.Bus_No AS Bus_No,
                agt.Agent_No AS Agent_No
INTO   #FilteredAgentTable
FROM   [dbo].[Agents] AS agt
       INNER JOIN
       dbo.Security_DataRoles AS dr
       ON (agt.Team_No = dr.EntityID
           OR dr.ViewAllAndFuture = 1)
       INNER JOIN
       dbo.Security_DataRoleEntityTypes AS dret
       ON (dr.DataRoleEntityTypeID = dret.DataRoleEntityTypeID)
WHERE  agt.Status = 'CURR'
       AND (dret.DataRoleEntityTypeName = 'Teams'
            OR dret.DataRoleEntityTypeName = 'Campaigns')
       AND dr.SecurityProfileID = @ProfileID
       AND agt.Bus_No = @Bus_No
       AND (@Agent_No IS NULL
            OR agt.Agent_No = @Agent_No)</td>
        <td>23</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT cld.Bus_No,
       cld.Agent_No,
       cld.direction,
       cld.contact_id,
       cld.contact_state,
       cld.Skill_No,
       DurationInterval AS Duration,
       clh.Media_Type AS MediaTypeId,
       CAST (CASE s.Outbound_Skill WHEN 1 THEN 1 ELSE 0 END AS BIT) AS IsOutbound,
       s.skill_name AS Skill_Name
INTO   #ContactLogDetail
FROM   [dbo].[Contact_Log_DetailQV] AS cld
       INNER JOIN
       #FilteredAgentTable AS agt
       ON cld.Agent_No = agt.Agent_No
       INNER JOIN
       Contact_Log_Header AS clh
       ON cld.Contact_ID = clh.contact_id
       INNER JOIN
       Skills AS s
       ON cld.Skill_No = s.Skill_No CROSS APPLY dbo.SplitToIntervals(cld.StartDate, cld.duration, DEFAULT, DEFAULT) AS cldqh
WHERE  cld.Skill_No IS NOT NULL
       AND cldqh.StartDateInterval &gt;= @startdate
       AND cldqh.StartDateInterval &lt; @enddate
       AND cld.StartDate &gt;= @startDate
       AND cld.StartDate &lt; @endDate
       AND cld.Bus_No = @Bus_No
       AND clh.Media_Type = ISNULL(@MediaTypeId, clh.Media_Type)
       AND (@IsOutbound IS NULL
            OR (s.Outbound_Skill = CASE @IsOutbound WHEN 1 THEN 1 ELSE 0 END))</td>
        <td>38</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT ald.Bus_No,
       ald.Agent_No,
       ald.AgentStateID,
       Skill_No,
       DurationInterval AS Duration,
       outstate_code
INTO   #AgentLogDetail
FROM   [dbo].[Agent_Log_DetailQV] AS ald
       INNER JOIN
       #FilteredAgentTable AS agt
       ON ald.Agent_No = agt.Agent_No CROSS APPLY dbo.SplitToIntervals(StartDate, ald.duration, DEFAULT, DEFAULT) AS aldqh
WHERE  ald.Skill_no IS NOT NULL
       AND aldqh.StartDateInterval &gt;= @startdate
       AND aldqh.StartDateInterval &lt; @enddate
       AND ald.StartDate &gt;= @startDate
       AND ald.StartDate &lt; @endDate
       AND ald.Bus_No = @Bus_No</td>
        <td>74</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   cld.Agent_No,
         cld.Skill_No,
         cld.Bus_No,
         cld.Skill_Name,
         COUNT_BIG(DISTINCT CASE WHEN cld.contact_state = 2
                                      AND cld.direction = 1 THEN contact_id END) AS Offered,
         COUNT_BIG(DISTINCT CASE WHEN cld.contact_state = 4 THEN contact_id END) AS Handled,
         COUNT_BIG(DISTINCT CASE WHEN cld.contact_state = 8 THEN contact_id END) AS Held,
         SUM(CASE WHEN cld.contact_state = 4 THEN Duration END) AS ActiveTalkTime,
         SUM(CASE WHEN cld.contact_state = 14 THEN Duration END) AS ConferenceTime,
         SUM(CASE WHEN cld.contact_state = 8 THEN Duration END) AS HoldTime,
         cld.IsOutbound,
         cld.MediaTypeId
INTO     #AgentSkillData_Contacts
FROM     #ContactLogDetail AS cld
GROUP BY cld.Agent_No, cld.Skill_No, cld.Skill_Name, cld.Bus_No, cld.IsOutbound, cld.MediaTypeId
ORDER BY cld.Agent_No, cld.Skill_No</td>
        <td>92</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   ald.Agent_No,
         ald.skill_no,
         SUM(Duration) AS ACWTime
INTO     #AgentSkillData_Agents
FROM     #AgentLogDetail AS ald
         INNER JOIN
         dbo.Outstates AS os
         ON os.outstate_code = ald.outstate_code
WHERE    os.IsACW = 'T'
         AND os.IsSystemOutstate = 0
GROUP BY ald.Agent_No, ald.skill_no
ORDER BY ald.Agent_No, ald.skill_no</td>
        <td>118</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE s.Outbound_Skill WHEN 1 THEN 1 ELSE 0 END</td>
        <td>47</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE @IsOutbound WHEN 1 THEN 1 ELSE 0 END</td>
        <td>64</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.contact_state = 2
          AND cld.direction = 1 THEN contact_id END</td>
        <td>96</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.contact_state = 4 THEN contact_id END</td>
        <td>97</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.contact_state = 8 THEN contact_id END</td>
        <td>98</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.contact_state = 4 THEN Duration END</td>
        <td>99</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.contact_state = 14 THEN Duration END</td>
        <td>100</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.contact_state = 8 THEN Duration END</td>
        <td>101</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">APPLY</td>
        <td colspan="1">[dbo].[Contact_Log_DetailQV] AS cld
INNER JOIN
#FilteredAgentTable AS agt
ON cld.Agent_No = agt.Agent_No
INNER JOIN
Contact_Log_Header AS clh
ON cld.Contact_ID = clh.contact_id
INNER JOIN
Skills AS s
ON cld.Skill_No = s.Skill_No CROSS APPLY dbo.SplitToIntervals(cld.StartDate, cld.duration, DEFAULT, DEFAULT) AS cldqh</td>
        <td>50</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">[dbo].[Agent_Log_DetailQV] AS ald
INNER JOIN
#FilteredAgentTable AS agt
ON ald.Agent_No = agt.Agent_No CROSS APPLY dbo.SplitToIntervals(StartDate, ald.duration, DEFAULT, DEFAULT) AS aldqh</td>
        <td>82</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#FilteredAgentTable AS agt</td>
        <td>51</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Contact_Log_Header AS clh</td>
        <td>52</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Skills AS s</td>
        <td>53</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#FilteredAgentTable AS agt</td>
        <td>83</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#ContactLogDetail AS cld</td>
        <td>105</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentLogDetail AS ald</td>
        <td>123</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#FilteredAgentTable AS a</td>
        <td>147</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentSkillData_Contacts AS csdr</td>
        <td>148</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentSkillData_Agents AS asdr</td>
        <td>149</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.SplitToIntervals(cld.StartDate, cld.duration, DEFAULT, DEFAULT) AS cldqh</td>
        <td>54</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.SplitToIntervals(StartDate, ald.duration, DEFAULT, DEFAULT) AS aldqh</td>
        <td>84</td>
      </tr>
      <tr valign="top">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT_BIG(DISTINCT CASE WHEN cld.contact_state = 2
                             AND cld.direction = 1 THEN contact_id END)</td>
        <td>96</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">COUNT_BIG(DISTINCT CASE WHEN cld.contact_state = 4 THEN contact_id END)</td>
        <td>97</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">COUNT_BIG(DISTINCT CASE WHEN cld.contact_state = 8 THEN contact_id END)</td>
        <td>98</td>
      </tr>
    </table>
  </body>
</html>