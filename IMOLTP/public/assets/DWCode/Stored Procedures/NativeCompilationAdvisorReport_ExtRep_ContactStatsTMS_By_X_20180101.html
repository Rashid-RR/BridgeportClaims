<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_ContactStatsTMS_By_X]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_ContactStatsTMS_By_X]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>1</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">BEGIN TRANSACTION</td>
        <td colspan="1">BEGIN TRANSACTION</td>
        <td>2</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">EXECUTE LockCriticalSection 'ExtRep_ContactStatsTMS_By_X'</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Skills AS s</td>
        <td>35</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Campaign AS c</td>
        <td>35</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">business_unit AS b</td>
        <td>36</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Myskills AS ms</td>
        <td>146</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#MyContactStats AS mc</td>
        <td>148</td>
      </tr>
      <tr valign="top">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT s.skill_no AS SkillNo,
       s.skill_name AS SkillName,
       c.campaign_no AS CampaignNo,
       c.campaign_name AS CampaignName,
       b.business_unit_name AS BusName
INTO   #MySkills
FROM   Skills AS s
       INNER JOIN
       Campaign AS c
       ON s.campaign_no = c.campaign_no
       INNER JOIN
       business_unit AS b
       ON c.bus_no = b.bus_no
WHERE  b.bus_no = @t_Bus_No
       AND s.status = 'Curr'
       AND c.status = 'Curr'
       AND (@t_campaign LIKE '%,' + CONVERT (VARCHAR (5), c.campaign_no) + ',%'
            OR @t_campaign IS NULL)
       AND (@t_skill LIKE '%,' + CONVERT (VARCHAR (5), s.skill_no) + ',%'
            OR @t_skill IS NULL)
OPTION (MAXDOP 2)</td>
        <td>29</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   h.Contact_Code AS Contact_Code,
         p.Contact_Name AS Contact_Desc,
         Sum(Total_cnt) AS CallsOffered,
         Sum(InQueue_Cnt) AS CallsQueued,
         Sum(Agent_cnt) AS CallsDelivered,
         Sum(Abandon_cnt) AS CallsAbandoned,
         0 AS CallsAbandonedUndertwo,
         SUM(CASE WHEN Abandon_cnt &gt; in_sla THEN 1 ELSE 0 END) AS AbandonOverSLA,
         h.skill_no AS SkillNo,
         MAX(h.Max_InQueue_Time) AS MaxQueue,
         SUM(h.inqueue_time) AS TotalQueue,
         SUM(h.agent_time) AS TotalTalkTime,
         SUM(h.prequeue_time + h.inqueue_time + h.agent_time + h.postqueue_time) AS TotalDur,
         dbo.fn_ConvertUTCToTargetTimeZone(h.Start_Date, 'Mountain') AS Start_Date,
         dbo.fn_CalcTimeZoneHalfHourCodeFromUTC(h.Start_Date, 'mountain') AS HHCode,
         SUM(in_sla) AS InServiceLevel,
         SUM(out_sla) AS OutServiceLevel,
         CASE WHEN SUM(h.agent_cnt) = 0 THEN 0 ELSE SUM(h.agent_time + h.hold_time + h.ACW_time) / SUM(CAST (h.agent_cnt AS NUMERIC)) END AS AverageHandle,
         CASE WHEN SUM(h.agent_cnt) = 0 THEN 0 ELSE SUM(h.hold_time) / SUM(CAST (h.agent_cnt AS NUMERIC)) END AS AverageHoldTime,
         CASE WHEN SUM(h.agent_cnt) = 0 THEN 0 ELSE SUM(h.ACW_time) / SUM(CAST (h.agent_cnt AS NUMERIC)) END AS AverageACW
INTO     #MyContactStats
FROM     dbo.dw_POC_ByQtrHour AS h
         LEFT OUTER JOIN
         dbo.PointofContact AS p
         ON h.Contact_Code = p.Contact_Code
WHERE    h.bus_no = 4593670
         AND h.start_date BETWEEN '10/14/2015' AND '10/15/2015'
GROUP BY h.Contact_Code, h.skill_no, p.contact_name, h.start_date
OPTION (MAXDOP 2)</td>
        <td>51</td>
      </tr>
      <tr valign="top">
        <td colspan="1">LIKE</td>
        <td colspan="1">@t_campaign LIKE '%,' + CONVERT (VARCHAR (5), c.campaign_no) + ',%'</td>
        <td>40</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@t_skill LIKE '%,' + CONVERT (VARCHAR (5), s.skill_no) + ',%'</td>
        <td>43</td>
      </tr>
      <tr valign="top">
        <td colspan="1">MAXDOP</td>
        <td colspan="1">MAXDOP 2</td>
        <td>46</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>91</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>154</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN Abandon_cnt &gt; in_sla THEN 1 ELSE 0 END</td>
        <td>58</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN SUM(h.agent_cnt) = 0 THEN 0 ELSE SUM(h.agent_time + h.hold_time + h.ACW_time) / SUM(CAST (h.agent_cnt AS NUMERIC)) END</td>
        <td>71</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN SUM(h.agent_cnt) = 0 THEN 0 ELSE SUM(h.hold_time) / SUM(CAST (h.agent_cnt AS NUMERIC)) END</td>
        <td>75</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN SUM(h.agent_cnt) = 0 THEN 0 ELSE SUM(h.ACW_time) / SUM(CAST (h.agent_cnt AS NUMERIC)) END</td>
        <td>79</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">COMMIT TRANSACTION</td>
        <td colspan="1">COMMIT TRANSACTION</td>
        <td>158</td>
      </tr>
    </table>
  </body>
</html>