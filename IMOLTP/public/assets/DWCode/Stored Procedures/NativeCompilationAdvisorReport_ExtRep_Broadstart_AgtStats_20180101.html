<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_Broadstart_AgtStats]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_Broadstart_AgtStats]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:09 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#AgentFilters</td>
        <td>16</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#TeamFilters</td>
        <td>27</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentFilters AS af</td>
        <td>51</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#TeamFilters AS tf</td>
        <td>52</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentFilters AS af</td>
        <td>88</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#TeamFilters AS tf</td>
        <td>89</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Contact_Log AS cl</td>
        <td>106</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#AgentFilters AS af</td>
        <td>137</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#TeamFilters AS tf</td>
        <td>138</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#agent_log AS a</td>
        <td>194</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#MyAgentTable AS A</td>
        <td>222</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#MyAgentTime AS T</td>
        <td>223</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#MyAgentContactStats AS C</td>
        <td>224</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_Split3(@agent, ',')</td>
        <td>21</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_Split3(@team, ',')</td>
        <td>32</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT a.agent_no AS Agent_no,
       a.first_name AS Agent_First,
       a.last_name AS Agent_Last,
       t.team_no AS Team_No,
       t.team_name AS Team_Name,
       b.business_unit_name AS Bus_Name
INTO   #MyAgentTable
FROM   dbo.Agents AS a
       INNER JOIN
       dbo.Team AS t
       ON a.team_no = t.team_no
       INNER JOIN
       dbo.Business_Unit AS b
       ON t.bus_no = b.bus_no
       LEFT OUTER JOIN
       #AgentFilters AS af
       ON af.agent_no = a.agent_no
       LEFT OUTER JOIN
       #TeamFilters AS tf
       ON tf.team_no = t.team_no
WHERE  t.bus_no = @Bus_No
       AND a.status = 'Curr'
       AND t.status = 'Curr'
       AND (@agent IS NULL
            OR af.agent_no = a.agent_no)
       AND (@team IS NULL
            OR tf.team_no = t.team_no)
OPTION (MAXDOP 2)</td>
        <td>41</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT l.Contact_Id,
       l.Master_Contact_Id,
       l.Bus_no,
       l.Contact_Code,
       r.Skill_No,
       r.Campaign_no,
       r.Agent_No,
       r.Team_No,
       l.start_date,
       l.QtrHour_Code,
       l.HalfHour_Code,
       s.sla,
       s.PreQueue_time,
       s.InQueue_time,
       s.Agent_time,
       s.PostQueue_time,
       s.Abandon_time,
       r.Abandon,
       r.To_addr,
       r.From_addr,
       s.Total_Time,
       r.End_Date,
       s.Hold_time,
       s.Release_Time
INTO   #Contact_Log
FROM   dbo.Contact_Log_Header AS l
       LEFT OUTER JOIN
       dbo.Contact_Log_Footer AS r
       ON r.Contact_ID = l.Contact_ID
       LEFT OUTER JOIN
       dbo.Contact_Log_Summary AS s
       ON s.Contact_ID = l.Contact_ID
       LEFT OUTER JOIN
       #AgentFilters AS af
       ON af.agent_no = r.agent_no
       LEFT OUTER JOIN
       #TeamFilters AS tf
       ON tf.team_no = r.team_no
WHERE  l.bus_no = @Bus_No
       AND l.start_date BETWEEN @start_date AND @END_date
       AND r.agent_no IS NOT NULL
       AND (@agent IS NULL
            OR af.agent_no = r.agent_no)
       AND (@team IS NULL
            OR tf.team_no = r.team_no)</td>
        <td>60</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   cl.agent_no AS Agent_No,
         SUM(CASE WHEN s.Outbound_skill = 0 THEN 1 ELSE 0 END) AS ACD_Contacts,
         SUM(CASE WHEN s.Outbound_skill = 1 THEN 1 ELSE 0 END) AS Outbound_Contacts,
         dbo.fn_CalcTimeZoneHalfHourCodeFromUTC(cl.Start_Date, @TimeZone) AS HHCode,
         dbo.fn_RemoveTime(dbo.fn_ConvertUTCToTargetTimeZone(cl.Start_Date, @TimeZone)) AS DateOnly
INTO     #MyAgentContactStats
FROM     #Contact_Log AS cl
         INNER JOIN
         dbo.Skills AS s
         ON cl.skill_no = s.skill_no
GROUP BY Agent_No, dbo.fn_CalcTimeZoneHalfHourCodeFromUTC(cl.Start_Date, @TimeZone), dbo.fn_RemoveTime(dbo.fn_ConvertUTCToTargetTimeZone(cl.Start_Date, @TimeZone))
OPTION (MAXDOP 2)</td>
        <td>95</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT h.Agent_Session_ID,
       d.StateIndex,
       h.agent_no,
       h.team_no,
       h.bus_no,
       d.start_date,
       d.working,
       d.available,
       d.outstate_code,
       s.duration,
       d.log_state,
       d.skill_no,
       (CASE WHEN d.working IN (1, 2, 3, 4) THEN d.working WHEN d.working = 0 THEN (CASE WHEN d.available = 1 THEN d.working WHEN (d.outstate_code &gt; -1)
                                                                                                                                  AND (d.outstate_code &lt; 10) THEN 3 ELSE d.outstate_code END) END) AS State_Code
INTO   #Agent_Log
FROM   dbo.Agent_Log_Header AS h
       LEFT OUTER JOIN
       dbo.Agent_Log_Detail AS d
       ON d.Agent_Session_ID = h.Agent_Session_ID
       LEFT OUTER JOIN
       dbo.Agent_Log_Detail_Summary AS s
       ON s.Agent_Session_ID = d.Agent_Session_ID
          AND s.StateIndex = d.StateIndex
       LEFT OUTER JOIN
       #AgentFilters AS af
       ON af.agent_no = h.agent_no
       LEFT OUTER JOIN
       #TeamFilters AS tf
       ON tf.team_no = h.team_no
WHERE  h.bus_no = @Bus_No
       AND h.start_date BETWEEN @start_date AND @END_date
       AND (@agent IS NULL
            OR af.agent_no = h.agent_no)
       AND (@team IS NULL
            OR tf.team_no = h.team_no)</td>
        <td>113</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.agent_no AS Agent_No,
         SUM(CASE WHEN a.available = 1
                       AND Working = 0 THEN (a.duration / 1000) ELSE 0 END) AS Avail_Time,
         SUM(CASE WHEN a.available = 0
                       AND Working = 0 THEN (a.duration / 1000) ELSE 0 END) AS Unavail_Time,
         SUM(CASE WHEN a.available = 0
                       AND Working = 0
                       AND a.Outstate_Code NOT IN (500346, 500347, 500348, 500349, 500350) THEN (a.duration / 1000) ELSE 0 END) AS Login_Time,
         SUM(CASE WHEN a.available = 0
                       AND Working = 0
                       AND a.Outstate_Code = 500346 THEN (a.duration / 1000) ELSE 0 END) AS Break_Time,
         SUM(CASE WHEN a.available = 0
                       AND Working = 0
                       AND a.Outstate_Code = 500347 THEN (a.duration / 1000) ELSE 0 END) AS Train_Time,
         SUM(CASE WHEN a.available = 0
                       AND Working = 0
                       AND a.Outstate_Code = 500348 THEN (a.duration / 1000) ELSE 0 END) AS Lunch_Time,
         SUM(CASE WHEN a.available = 0
                       AND Working = 0
                       AND a.Outstate_Code = 500349 THEN (a.duration / 1000) ELSE 0 END) AS Meet_Time,
         SUM(CASE WHEN a.available = 0
                       AND Working = 0
                       AND a.Outstate_Code = 500350 THEN (a.duration / 1000) ELSE 0 END) AS Wrap_Time,
         SUM(CASE s.Outbound_Skill WHEN 0 THEN (a.duration / 1000) ELSE 0 END) AS ACD_Time,
         SUM(CASE s.Outbound_Skill WHEN 1 THEN (a.duration / 1000) ELSE 0 END) AS OB_Time,
         SUM((a.duration / 1000)) AS Total_Time,
         dbo.fn_CalcTimeZoneHalfHourCodeFromUTC(a.start_date, @TimeZone) AS HHCode,
         dbo.fn_RemoveTime(dbo.fn_ConvertUTCToTargetTimeZone(a.start_date, @TimeZone)) AS DateOnly
INTO     #MyAgentTime
FROM     #agent_log AS a
         LEFT OUTER JOIN
         dbo.Skills AS s
         ON a.skill_no = s.skill_no
GROUP BY Agent_no, dbo.fn_CalcTimeZoneHalfHourCodeFromUTC(a.start_date, @TimeZone), dbo.fn_RemoveTime(dbo.fn_ConvertUTCToTargetTimeZone(a.start_date, @TimeZone))
OPTION (MAXDOP 2)</td>
        <td>144</td>
      </tr>
      <tr valign="top">
        <td colspan="1">MAXDOP</td>
        <td colspan="1">MAXDOP 2</td>
        <td>58</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>111</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>199</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MAXDOP 2</td>
        <td>227</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN s.Outbound_skill = 0 THEN 1 ELSE 0 END</td>
        <td>97</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN s.Outbound_skill = 1 THEN 1 ELSE 0 END</td>
        <td>100</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN d.working IN (1, 2, 3, 4) THEN d.working WHEN d.working = 0 THEN (CASE WHEN d.available = 1 THEN d.working WHEN (d.outstate_code &gt; -1)
                                                                                                                          AND (d.outstate_code &lt; 10) THEN 3 ELSE d.outstate_code END) END</td>
        <td>125</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN d.available = 1 THEN d.working WHEN (d.outstate_code &gt; -1)
                                              AND (d.outstate_code &lt; 10) THEN 3 ELSE d.outstate_code END</td>
        <td>126</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.available = 1
          AND Working = 0 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>145</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.available = 0
          AND Working = 0 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>149</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.available = 0
          AND Working = 0
          AND a.Outstate_Code NOT IN (500346, 500347, 500348, 500349, 500350) THEN (a.duration / 1000) ELSE 0 END</td>
        <td>153</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.available = 0
          AND Working = 0
          AND a.Outstate_Code = 500346 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>158</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.available = 0
          AND Working = 0
          AND a.Outstate_Code = 500347 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>163</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.available = 0
          AND Working = 0
          AND a.Outstate_Code = 500348 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>168</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.available = 0
          AND Working = 0
          AND a.Outstate_Code = 500349 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>173</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN a.available = 0
          AND Working = 0
          AND a.Outstate_Code = 500350 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>178</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE s.Outbound_Skill WHEN 0 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>183</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE s.Outbound_Skill WHEN 1 THEN (a.duration / 1000) ELSE 0 END</td>
        <td>186</td>
      </tr>
    </table>
  </body>
</html>