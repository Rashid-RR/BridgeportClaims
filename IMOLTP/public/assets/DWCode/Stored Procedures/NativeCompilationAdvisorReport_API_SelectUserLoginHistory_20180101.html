<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[API_SelectUserLoginHistory]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[API_SelectUserLoginHistory]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT 1
 FROM   agents
 WHERE  bus_no = @bus_no
        AND agent_no = @agent_no)</td>
        <td>8</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">(SELECT 1
 FROM   dbo.Agents AS a
        INNER JOIN
        dbo.fn_GetDataRoleFilterItems(@securityProfileId, 'teams') AS v
        ON v.intValue = a.Team_No
           OR v.intValue = 0
 WHERE  a.bus_no = @Bus_No
        AND a.agent_no = @agent_no)</td>
        <td>17</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">agents</td>
        <td>10</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">agent_station_log AS asl</td>
        <td>66</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">station AS s</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tmpStations</td>
        <td>89</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tmpStations</td>
        <td>101</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_GetDataRoleFilterItems(@securityProfileId, 'teams') AS v</td>
        <td>20</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   *
INTO     #tmpStations
FROM     (SELECT ROW_NUMBER() OVER (ORDER BY CASE WHEN @OrderColumn = 'StationPhoneNumber'
                                                       AND @OrderASC = 1 THEN asl.station_phone_num END ASC, CASE WHEN @OrderColumn = 'StationCallerId'
                                                                                                                       AND @OrderASC = 1 THEN asl.station_caller_id END ASC, CASE WHEN @OrderColumn = 'StationId'
                                                                                                                                                                                       AND @OrderASC = 1 THEN asl.id END ASC, CASE WHEN @OrderColumn = 'StationName'
                                                                                                                                                                                                                                        AND @OrderASC = 1 THEN s.station_name END ASC, CASE WHEN @OrderColumn = 'LoginDate'
                                                                                                                                                                                                                                                                                                 AND @OrderASC = 1 THEN asl.login_date END ASC, CASE WHEN @OrderColumn = 'StationPhoneNumber'
                                                                                                                                                                                                                                                                                                                                                          AND @OrderASC = 0 THEN asl.station_phone_num END DESC, CASE WHEN @OrderColumn = 'StationCallerId'
                                                                                                                                                                                                                                                                                                                                                                                                                           AND @OrderASC = 0 THEN asl.station_caller_id END DESC, CASE WHEN @OrderColumn = 'StationId'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND @OrderASC = 0 THEN asl.id END DESC, CASE WHEN @OrderColumn = 'StationName'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              AND @OrderASC = 0 THEN s.station_name END DESC, CASE WHEN @OrderColumn = 'LoginDate'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        AND @OrderASC = 0 THEN asl.login_date END DESC) AS RowNumber,
                 asl.station_phone_num AS StationPhoneNumber,
                 asl.station_caller_id AS StationCallerId,
                 asl.id AS StationId,
                 s.station_name AS StationName,
                 asl.login_date AS LoginDate
          FROM   agent_station_log AS asl
                 LEFT OUTER JOIN
                 station AS s
                 ON s.station_id = asl.station_id
          WHERE  asl.bus_no = @bus_no
                 AND asl.agent_no = @agent_no
                 AND asl.login_date &gt;= ISNULL(@startDate, asl.login_date)
                 AND asl.login_date &lt;= ISNULL(@endDate, asl.login_date)
                 AND (@SearchString IS NULL
                      OR (asl.station_phone_num LIKE '%' + @SearchString + '%'
                          OR asl.station_caller_id LIKE '%' + @SearchString + '%'
                          OR s.station_name LIKE '%' + @SearchString + '%'
                          OR CONVERT (VARCHAR (25), asl.login_date, 126) LIKE '%' + @SearchString + '%'))) AS StationResults
ORDER BY StationResults.RowNumber</td>
        <td>36</td>
      </tr>
      <tr valign="top">
        <td colspan="1">*</td>
        <td colspan="1">SELECT   *
INTO     #tmpStations
FROM     (SELECT ROW_NUMBER() OVER (ORDER BY CASE WHEN @OrderColumn = 'StationPhoneNumber'
                                                       AND @OrderASC = 1 THEN asl.station_phone_num END ASC, CASE WHEN @OrderColumn = 'StationCallerId'
                                                                                                                       AND @OrderASC = 1 THEN asl.station_caller_id END ASC, CASE WHEN @OrderColumn = 'StationId'
                                                                                                                                                                                       AND @OrderASC = 1 THEN asl.id END ASC, CASE WHEN @OrderColumn = 'StationName'
                                                                                                                                                                                                                                        AND @OrderASC = 1 THEN s.station_name END ASC, CASE WHEN @OrderColumn = 'LoginDate'
                                                                                                                                                                                                                                                                                                 AND @OrderASC = 1 THEN asl.login_date END ASC, CASE WHEN @OrderColumn = 'StationPhoneNumber'
                                                                                                                                                                                                                                                                                                                                                          AND @OrderASC = 0 THEN asl.station_phone_num END DESC, CASE WHEN @OrderColumn = 'StationCallerId'
                                                                                                                                                                                                                                                                                                                                                                                                                           AND @OrderASC = 0 THEN asl.station_caller_id END DESC, CASE WHEN @OrderColumn = 'StationId'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            AND @OrderASC = 0 THEN asl.id END DESC, CASE WHEN @OrderColumn = 'StationName'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              AND @OrderASC = 0 THEN s.station_name END DESC, CASE WHEN @OrderColumn = 'LoginDate'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        AND @OrderASC = 0 THEN asl.login_date END DESC) AS RowNumber,
                 asl.station_phone_num AS StationPhoneNumber,
                 asl.station_caller_id AS StationCallerId,
                 asl.id AS StationId,
                 s.station_name AS StationName,
                 asl.login_date AS LoginDate
          FROM   agent_station_log AS asl
                 LEFT OUTER JOIN
                 station AS s
                 ON s.station_id = asl.station_id
          WHERE  asl.bus_no = @bus_no
                 AND asl.agent_no = @agent_no
                 AND asl.login_date &gt;= ISNULL(@startDate, asl.login_date)
                 AND asl.login_date &lt;= ISNULL(@endDate, asl.login_date)
                 AND (@SearchString IS NULL
                      OR (asl.station_phone_num LIKE '%' + @SearchString + '%'
                          OR asl.station_caller_id LIKE '%' + @SearchString + '%'
                          OR s.station_name LIKE '%' + @SearchString + '%'
                          OR CONVERT (VARCHAR (25), asl.login_date, 126) LIKE '%' + @SearchString + '%'))) AS StationResults
ORDER BY StationResults.RowNumber</td>
        <td>36</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">ROW_NUMBER</td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY CASE WHEN @OrderColumn = 'StationPhoneNumber'
                                      AND @OrderASC = 1 THEN asl.station_phone_num END ASC, CASE WHEN @OrderColumn = 'StationCallerId'
                                                                                                      AND @OrderASC = 1 THEN asl.station_caller_id END ASC, CASE WHEN @OrderColumn = 'StationId'
                                                                                                                                                                      AND @OrderASC = 1 THEN asl.id END ASC, CASE WHEN @OrderColumn = 'StationName'
                                                                                                                                                                                                                       AND @OrderASC = 1 THEN s.station_name END ASC, CASE WHEN @OrderColumn = 'LoginDate'
                                                                                                                                                                                                                                                                                AND @OrderASC = 1 THEN asl.login_date END ASC, CASE WHEN @OrderColumn = 'StationPhoneNumber'
                                                                                                                                                                                                                                                                                                                                         AND @OrderASC = 0 THEN asl.station_phone_num END DESC, CASE WHEN @OrderColumn = 'StationCallerId'
                                                                                                                                                                                                                                                                                                                                                                                                          AND @OrderASC = 0 THEN asl.station_caller_id END DESC, CASE WHEN @OrderColumn = 'StationId'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           AND @OrderASC = 0 THEN asl.id END DESC, CASE WHEN @OrderColumn = 'StationName'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             AND @OrderASC = 0 THEN s.station_name END DESC, CASE WHEN @OrderColumn = 'LoginDate'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       AND @OrderASC = 0 THEN asl.login_date END DESC)</td>
        <td>39</td>
      </tr>
      <tr valign="top">
        <td colspan="1">OVER</td>
        <td colspan="1">OVER (ORDER BY CASE WHEN @OrderColumn = 'StationPhoneNumber'
                         AND @OrderASC = 1 THEN asl.station_phone_num END ASC, CASE WHEN @OrderColumn = 'StationCallerId'
                                                                                         AND @OrderASC = 1 THEN asl.station_caller_id END ASC, CASE WHEN @OrderColumn = 'StationId'
                                                                                                                                                         AND @OrderASC = 1 THEN asl.id END ASC, CASE WHEN @OrderColumn = 'StationName'
                                                                                                                                                                                                          AND @OrderASC = 1 THEN s.station_name END ASC, CASE WHEN @OrderColumn = 'LoginDate'
                                                                                                                                                                                                                                                                   AND @OrderASC = 1 THEN asl.login_date END ASC, CASE WHEN @OrderColumn = 'StationPhoneNumber'
                                                                                                                                                                                                                                                                                                                            AND @OrderASC = 0 THEN asl.station_phone_num END DESC, CASE WHEN @OrderColumn = 'StationCallerId'
                                                                                                                                                                                                                                                                                                                                                                                             AND @OrderASC = 0 THEN asl.station_caller_id END DESC, CASE WHEN @OrderColumn = 'StationId'
                                                                                                                                                                                                                                                                                                                                                                                                                                                              AND @OrderASC = 0 THEN asl.id END DESC, CASE WHEN @OrderColumn = 'StationName'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                AND @OrderASC = 0 THEN s.station_name END DESC, CASE WHEN @OrderColumn = 'LoginDate'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          AND @OrderASC = 0 THEN asl.login_date END DESC)</td>
        <td>39</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN @OrderColumn = 'StationPhoneNumber'
          AND @OrderASC = 1 THEN asl.station_phone_num END</td>
        <td>40</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'StationCallerId'
          AND @OrderASC = 1 THEN asl.station_caller_id END</td>
        <td>42</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'StationId'
          AND @OrderASC = 1 THEN asl.id END</td>
        <td>44</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'StationName'
          AND @OrderASC = 1 THEN s.station_name END</td>
        <td>46</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'LoginDate'
          AND @OrderASC = 1 THEN asl.login_date END</td>
        <td>48</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'StationPhoneNumber'
          AND @OrderASC = 0 THEN asl.station_phone_num END</td>
        <td>50</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'StationCallerId'
          AND @OrderASC = 0 THEN asl.station_caller_id END</td>
        <td>52</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'StationId'
          AND @OrderASC = 0 THEN asl.id END</td>
        <td>54</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'StationName'
          AND @OrderASC = 0 THEN s.station_name END</td>
        <td>56</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderColumn = 'LoginDate'
          AND @OrderASC = 0 THEN asl.login_date END</td>
        <td>58</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">LIKE</td>
        <td colspan="1">asl.station_phone_num LIKE '%' + @SearchString + '%'</td>
        <td>75</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">asl.station_caller_id LIKE '%' + @SearchString + '%'</td>
        <td>76</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">s.station_name LIKE '%' + @SearchString + '%'</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CONVERT (VARCHAR (25), asl.login_date, 126) LIKE '%' + @SearchString + '%'</td>
        <td>78</td>
      </tr>
    </table>
  </body>
</html>