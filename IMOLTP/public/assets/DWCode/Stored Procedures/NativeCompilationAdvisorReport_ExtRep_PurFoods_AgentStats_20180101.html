<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_PurFoods_AgentStats]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_PurFoods_AgentStats]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT s.skill_no,
       s.skill_name,
       CASE WHEN s.skill_no IN (33873, 33911, 33884, 33889, 33894, 33899, 33904) THEN 'Inbound Sales' WHEN s.skill_no IN (33875, 33880, 33885, 33890, 33895, 33900, 33905) THEN 'Inbound C.S.' WHEN s.skill_no = 33486 THEN 'Inbound MM' WHEN s.skill_no IN (33877, 33882, 33887, 33892, 33897, 33902, 33907) THEN 'Outbound Re-up' WHEN s.skill_no IN (33876, 33881, 33886, 33891, 33896, 33901, 33906) THEN 'Outbound C.S.' WHEN s.skill_no IN (33878, 33883, 33888, 33893, 33898, 33903, 33908) THEN 'Outbound Prospects' WHEN s.skill_no IN (34354, 34229, 34231, 34232, 34233, 34230) THEN 'Outbound MM' ELSE NULL END AS skill_groups
INTO   [#Skills]
FROM   dbo.campaign AS c
       INNER JOIN
       dbo.skills AS s
       ON s.campaign_no = c.campaign_no
WHERE  c.bus_no = @bus_no</td>
        <td>7</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   a.[agent_no],
         s.[skill_no],
         s.[skill_groups] AS skill_groups,
         s.[skill_name] AS Skill_name,
         a.[first_name] AS Agent_First,
         a.[last_name] AS Agent_Last,
         a.[Team_no] AS Team_No,
         t.[team_name] AS Team_Name
INTO     [#Agent_Team_Skills]
FROM     [#Skills] AS s
         INNER JOIN
         dbo.agentskl AS k
         ON k.[Skill_no] = s.[Skill_no]
            AND k.Status = 'CURR'
         INNER JOIN
         dbo.Agents AS a
         ON a.[Agent_no] = k.[Agent_no]
         INNER JOIN
         dbo.Team AS t
         ON t.[Team_no] = a.[Team_no]
WHERE    t.[bus_no] = @bus_no
         AND (@team LIKE '%,' + CONVERT (NVARCHAR, t.team_no) + ',%'
              OR @team IS NULL)
         AND (@agent LIKE '%,' + CONVERT (NVARCHAR, a.agent_no) + ',%'
              OR @agent IS NULL)
GROUP BY a.[agent_no], s.[skill_no], s.[skill_groups], s.[skill_name], a.[first_name], a.[last_name], a.[Team_no], t.[team_name]</td>
        <td>32</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   f.[Agent_no],
         f.[Skill_no],
         COUNT(r.[RefusedContactlogID]) AS RefusedCalls,
         SUM(CASE WHEN f.[Inbound] = 'T' THEN 1 ELSE 0 END) AS ACDContacts,
         SUM(CASE WHEN f.[Outbound] = 'T' THEN 1 ELSE 0 END) AS OBContacts,
         SUM(CASE WHEN f.[Inbound] = 'T' THEN s.[Total_time] ELSE 0 END) AS ACD_Time,
         SUM(CASE WHEN f.[Outbound] = 'T' THEN s.[Total_time] ELSE 0 END) AS OB_Time
INTO     [#Contacts]
FROM     dbo.Contact_Log_Header AS h
         INNER JOIN
         dbo.Contact_Log_Footer AS f
         ON f.[Contact_ID] = h.[Contact_ID]
         INNER JOIN
         dbo.Contact_Log_Summary AS s
         ON s.[Contact_ID] = f.[Contact_ID]
         LEFT OUTER JOIN
         dbo.RefusedContactLog AS r
         ON r.[Contact_ID] = s.[Contact_ID]
WHERE    h.[Start_date] BETWEEN @Start_date AND @End_date
         AND h.[Bus_no] = @bus_no
GROUP BY f.agent_no, f.skill_no
OPTION (MAXDOP 2)</td>
        <td>64</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN s.skill_no IN (33873, 33911, 33884, 33889, 33894, 33899, 33904) THEN 'Inbound Sales' WHEN s.skill_no IN (33875, 33880, 33885, 33890, 33895, 33900, 33905) THEN 'Inbound C.S.' WHEN s.skill_no = 33486 THEN 'Inbound MM' WHEN s.skill_no IN (33877, 33882, 33887, 33892, 33897, 33902, 33907) THEN 'Outbound Re-up' WHEN s.skill_no IN (33876, 33881, 33886, 33891, 33896, 33901, 33906) THEN 'Outbound C.S.' WHEN s.skill_no IN (33878, 33883, 33888, 33893, 33898, 33903, 33908) THEN 'Outbound Prospects' WHEN s.skill_no IN (34354, 34229, 34231, 34232, 34233, 34230) THEN 'Outbound MM' ELSE NULL END</td>
        <td>9</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[Inbound] = 'T' THEN 1 ELSE 0 END</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[Outbound] = 'T' THEN 1 ELSE 0 END</td>
        <td>70</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[Inbound] = 'T' THEN s.[Total_time] ELSE 0 END</td>
        <td>73</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN f.[Outbound] = 'T' THEN s.[Total_time] ELSE 0 END</td>
        <td>76</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN SUM(c.[ACDContacts]) &gt; 0 THEN SUM(CAST (c.[ACD_Time] AS NUMERIC)) / SUM(c.[ACDContacts]) / 1000 ELSE 0.0 END</td>
        <td>104</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN SUM(c.[OBContacts]) &gt; 0 THEN SUM(CAST (c.[OB_Time] AS NUMERIC)) / SUM(c.[OBContacts]) / 1000 ELSE 0.0 END</td>
        <td>107</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#Skills</td>
        <td>29</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">[#Skills] AS s</td>
        <td>41</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">[#Agent_Team_Skills] AS a</td>
        <td>110</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">[#Contacts] AS c</td>
        <td>111</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">LIKE</td>
        <td colspan="1">@team LIKE '%,' + CONVERT (NVARCHAR, t.team_no) + ',%'</td>
        <td>48</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@agent LIKE '%,' + CONVERT (NVARCHAR, a.agent_no) + ',%'</td>
        <td>52</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">MAXDOP</td>
        <td colspan="1">MAXDOP 2</td>
        <td>88</td>
      </tr>
      <tr valign="top">
        <td colspan="1">FULL OUTER JOIN</td>
        <td colspan="1">[#Agent_Team_Skills] AS a
FULL OUTER JOIN
[#Contacts] AS c
ON c.[Agent_no] = a.[Agent_no]
   AND c.[Skill_no] = a.[Skill_no]</td>
        <td>110</td>
      </tr>
    </table>
  </body>
</html>