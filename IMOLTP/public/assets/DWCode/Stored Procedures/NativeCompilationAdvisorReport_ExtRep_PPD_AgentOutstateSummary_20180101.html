<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_PPD_AgentOutstateSummary]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[ExtRep_PPD_AgentOutstateSummary]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:11 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET XACT_ABORT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>3</td>
      </tr>
      <tr valign="top">
        <td colspan="1">BEGIN TRANSACTION</td>
        <td colspan="1">BEGIN TRANSACTION</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">EXECUTE LockCriticalSection 'ExtRep_PPD_AgentOutstateSummary'</td>
        <td>13</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#TotalDuration AS TD</td>
        <td>67</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT   SUM(DS.Duration_Seconds) AS TotalDuration,
         H.Agent_No AS Agent_no
INTO     #TotalDuration
FROM     dbo.Agent_Log_Header AS H
         INNER JOIN
         dbo.Agent_Log_Detail AS D
         ON H.Agent_Session_ID = D.Agent_Session_ID
         INNER JOIN
         dbo.Agent_Log_Detail_Summary AS DS
         ON D.Agent_Session_ID = DS.Agent_Session_ID
            AND D.StateIndex = DS.StateIndex
WHERE    H.Bus_No = @Bus_No
         AND H.Start_Date BETWEEN @start_date AND @end_date
         AND (@team LIKE '%,' + CONVERT (VARCHAR, H.[team_no]) + ',%'
              OR @team IS NULL)
         AND (@agent LIKE '%,' + CONVERT (VARCHAR, H.[agent_no]) + ',%'
              OR @agent IS NULL)
         AND (@skill LIKE '%,' + CONVERT (VARCHAR, D.[skill_no]) + ',%'
              OR @skill IS NULL)
GROUP BY H.Agent_no</td>
        <td>27</td>
      </tr>
      <tr valign="top">
        <td colspan="1">LIKE</td>
        <td colspan="1">@team LIKE '%,' + CONVERT (VARCHAR, H.[team_no]) + ',%'</td>
        <td>37</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@agent LIKE '%,' + CONVERT (VARCHAR, H.[agent_no]) + ',%'</td>
        <td>40</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@skill LIKE '%,' + CONVERT (VARCHAR, D.[skill_no]) + ',%'</td>
        <td>43</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@team LIKE '%,' + CONVERT (VARCHAR, H.[team_no]) + ',%'</td>
        <td>71</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@agent LIKE '%,' + CONVERT (VARCHAR, H.[agent_no]) + ',%'</td>
        <td>74</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@skill LIKE '%,' + CONVERT (VARCHAR, D.[skill_no]) + ',%'</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN D.Log_State = 0 THEN 'LogIn' WHEN D.Log_State = 2 THEN 'LogOut' WHEN O.Description IS NULL
                                                                               AND D.Available = 1 THEN 'On Call' WHEN O.Description IS NULL
                                                                                                                       AND D.Working = 0
                                                                                                                       AND D.Available = 1 THEN 'Available' ELSE ISNULL(O.Description, 'Other') END</td>
        <td>51</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN D.Log_State = 0 THEN 'LogIn' WHEN D.Log_State = 2 THEN 'LogOut' WHEN O.Description IS NULL
                                                                               AND D.Available = 1 THEN 'On Call' WHEN O.Description IS NULL
                                                                                                                       AND D.Working = 0
                                                                                                                       AND D.Available = 1 THEN 'Available' ELSE ISNULL(O.Description, 'Other') END</td>
        <td>80</td>
      </tr>
      <tr valign="top">
        <td colspan="1">COMMIT TRANSACTION</td>
        <td colspan="1">COMMIT TRANSACTION</td>
        <td>87</td>
      </tr>
    </table>
  </body>
</html>