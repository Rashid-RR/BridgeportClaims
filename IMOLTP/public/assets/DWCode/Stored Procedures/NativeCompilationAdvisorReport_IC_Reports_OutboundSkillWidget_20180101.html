<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_OutboundSkillWidget]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [DWCode].[IC_Reports_OutboundSkillWidget]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:10 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>4</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT skl.Skill_No,
       skl.Skill_Name,
       cpg.Campaign_No,
       cpg.Campaign_Name,
       '' AS MasterCampaignName,
       CAST (0 AS BIT) AS IsAgentless
INTO   #Skills
FROM   dbo.Skills AS skl
       INNER JOIN
       dbo.Campaign AS cpg
       ON skl.Campaign_No = cpg.Campaign_No
       INNER JOIN
       dbo.Security_DataRoles AS dr
       ON (skl.Campaign_no = dr.EntityID
           OR dr.ViewAllAndFuture = 1)
       INNER JOIN
       dbo.Security_DataRoleEntityTypes AS dret
       ON (dr.DataRoleEntityTypeID = dret.DataRoleEntityTypeID)
       INNER JOIN
       dbo.fn_SplitOptionalInt(@CampaignNoList) AS CPGList
       ON skl.Campaign_no BETWEEN CPGList.IDMin AND CPGList.IDMax
       INNER JOIN
       dbo.fn_SplitOptionalInt(@SkillNoList) AS SKLList
       ON skl.Skill_No BETWEEN SKLList.IDMin AND SKLList.IDMax
WHERE  skl.Bus_No = @BusNo
       AND skl.[Status] = 'CURR'
       AND skl.Outbound_Skill = 1
       AND skl.IsDialer = 1
       AND dret.DataRoleEntityTypeName = 'campaigns'
       AND dr.SecurityProfileID = @profileID</td>
        <td>11</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   ald.Skill_No,
         SUM(CASE WHEN ald.Outstate_Code = -13 THEN ald.Duration ELSE 0 END) AS PreviewTime,
         SUM(CASE WHEN ald.Outstate_Code = -4 THEN ald.Duration ELSE 0 END) AS WaitTime,
         SUM(CASE WHEN ald.AgentStateID = 4 THEN ald.Duration ELSE 0 END) AS TalkTime,
         SUM(CASE WHEN ald.Outstate_Code &gt; 0
                       AND os.IsACW = 'T'
                       AND os.IsSystemOutstate = 0 THEN ald.Duration ELSE 0 END) AS ACWTime,
         SUM(CASE WHEN ald.AgentStateID IN (0, 2, 8)
                       AND os.IsACW = 'F' THEN ald.Duration ELSE 0 END) AS UnavailableTime
INTO     #AgentMetrics
FROM     dbo.Agent_Log_DetailQV AS ald
         INNER JOIN
         #Skills AS skl
         ON ald.Skill_No = skl.Skill_No
         LEFT OUTER JOIN
         dbo.Outstates AS os
         ON ald.Outstate_Code = os.Outstate_Code
WHERE    ald.Bus_No = @BusNo
         AND ald.StartDate BETWEEN @StartDate AND @EndDate
         AND NOT ald.Skill_No IS NULL
         AND (ald.Outstate_Code = -13
              OR ald.Outstate_Code = -4
              OR ald.AgentStateID = 4
              OR (ald.Outstate_Code &gt; 0
                  AND os.IsACW = 'T')
              OR (ald.AgentStateID IN (0, 2, 8)))
GROUP BY ald.Skill_No</td>
        <td>43</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   skl.Skill_No,
         ISNULL(CASE WHEN skl.IsAgentless = 1 THEN SUM(CASE WHEN cld.Contact_State IN (4, 8, 14) THEN cld.Duration ELSE 0 END) ELSE am.TalkTime END, 0) AS TalkTime,
         ISNULL(SUM(CASE WHEN cld.Contact_State = 25 THEN 1 ELSE 0 END), 0) AS PreviewContacts,
         ISNULL(SUM(CASE WHEN cld.Contact_State = 25
                              AND cel.ContactEventID = 4 THEN 1 ELSE 0 END), 0) AS PreviewRejects,
         ISNULL(am.PreviewTime, 0) AS PreviewTime,
         ISNULL(am.WaitTime, 0) AS WaitTime,
         ISNULL(am.ACWTime, 0) AS ACWTime,
         ISNULL(am.UnavailableTime, 0) AS UnavailableTime,
         ISNULL(am.PreviewTime, 0) + ISNULL(am.WaitTime, 0) + ISNULL(am.ACWTime, 0) + ISNULL(am.UnavailableTime, 0) + ISNULL(CASE WHEN skl.IsAgentless = 1 THEN SUM(CASE WHEN cld.Contact_State IN (4, 8, 14) THEN cld.Duration ELSE 0 END) ELSE am.TalkTime END, 0) AS SkillTime
INTO     #ContactMetrics
FROM     dbo.Contact_Log_DetailQV AS cld
         INNER JOIN
         #Skills AS skl
         ON cld.Skill_No = skl.Skill_No
         LEFT OUTER JOIN
         #AgentMetrics AS am
         ON am.Skill_No = skl.Skill_No
         LEFT OUTER JOIN
         ContactEventLog AS cel
         ON cel.Contact_ID = cld.Contact_ID
            AND cld.Contact_State = 25
WHERE    cld.Bus_No = @BusNo
         AND cld.StartDate BETWEEN @StartDate AND @EndDate
         AND cld.Contact_State IN (25, 4, 8, 14)
GROUP BY skl.Skill_No, skl.IsAgentless, am.PreviewTime, am.WaitTime, am.TalkTime, am.ACWTime, am.UnavailableTime</td>
        <td>74</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">SELECT   clf.Skill_No,
         COUNT(cldis.Disposition_Code) AS Abandons
INTO     #Abandons
FROM     dbo.Contact_Log_Dispositions AS cldis
         INNER JOIN
         dbo.Contact_Log_Footer AS clf
         ON cldis.Contact_ID = clf.Contact_Id
         INNER JOIN
         dbo.Dispositions AS dis
         ON cldis.Disposition_Code = dis.Disposition_Code
WHERE    cldis.Bus_No = @BusNo
         AND (cldis.Start_Date BETWEEN @StartDate AND @EndDate)
         AND dis.DispositionClassificationID IN (24, 25)
GROUP BY clf.Skill_No</td>
        <td>123</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   DISTINCT cld.Skill_No,
                  COUNT(DISTINCT cld.Contact_ID) AS HandledContacts
INTO     #HandledContacts
FROM     dbo.[Contact_Log_DetailQV] AS cld
         INNER JOIN
         #Skills AS skl
         ON cld.Skill_No = skl.Skill_No
WHERE    cld.BUS_No = @BusNo
         AND (cld.StartDate BETWEEN @StartDate AND @EndDate)
         AND cld.Duration &gt; 0
         AND cld.Contact_State = 4
GROUP BY cld.Skill_No</td>
        <td>141</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@CampaignNoList) AS CPGList</td>
        <td>28</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fn_SplitOptionalInt(@SkillNoList) AS SKLList</td>
        <td>29</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN ald.Outstate_Code = -13 THEN ald.Duration ELSE 0 END</td>
        <td>45</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ald.Outstate_Code = -4 THEN ald.Duration ELSE 0 END</td>
        <td>46</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ald.AgentStateID = 4 THEN ald.Duration ELSE 0 END</td>
        <td>47</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ald.Outstate_Code &gt; 0
          AND os.IsACW = 'T'
          AND os.IsSystemOutstate = 0 THEN ald.Duration ELSE 0 END</td>
        <td>48</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ald.AgentStateID IN (0, 2, 8)
          AND os.IsACW = 'F' THEN ald.Duration ELSE 0 END</td>
        <td>49</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN skl.IsAgentless = 1 THEN SUM(CASE WHEN cld.Contact_State IN (4, 8, 14) THEN cld.Duration ELSE 0 END) ELSE am.TalkTime END</td>
        <td>76</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.Contact_State IN (4, 8, 14) THEN cld.Duration ELSE 0 END</td>
        <td>77</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.Contact_State = 25 THEN 1 ELSE 0 END</td>
        <td>80</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.Contact_State = 25
          AND cel.ContactEventID = 4 THEN 1 ELSE 0 END</td>
        <td>81</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN skl.IsAgentless = 1 THEN SUM(CASE WHEN cld.Contact_State IN (4, 8, 14) THEN cld.Duration ELSE 0 END) ELSE am.TalkTime END</td>
        <td>92</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cld.Contact_State IN (4, 8, 14) THEN cld.Duration ELSE 0 END</td>
        <td>93</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cm.PreviewContacts &gt; 0 THEN cm.PreviewTime * 1.0 / cm.PreviewContacts * 1.0 ELSE 0 END</td>
        <td>184</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cm.SkillTime &gt; 0 THEN cm.PreviewTime * 1.0 / cm.SkillTime * 100 ELSE 0 END</td>
        <td>190</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN ISNULL(hc.HandledContacts, 0) + ISNULL(ab.Abandons, 0) &gt; 0 THEN (ab.abandons * 1.0 / (ISNULL(hc.HandledContacts, 0) + ISNULL(ab.Abandons, 0)) * 1.0) * 100 ELSE 0 END</td>
        <td>199</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN hc.HandledContacts &gt; 0 THEN (cm.WaitTime * 1.0 / hc.HandledContacts * 1.0) ELSE 0 END</td>
        <td>208</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cm.SkillTime &gt; 0 THEN cm.WaitTime * 1.0 / cm.SkillTime * 100 ELSE 0 END</td>
        <td>214</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN hc.HandledContacts &gt; 0 THEN (cm.TalkTime * 1.0 / hc.HandledContacts * 1.0) ELSE 0 END</td>
        <td>222</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cm.SkillTime &gt; 0 THEN cm.TalkTime * 1.0 / cm.SkillTime * 100 ELSE 0 END</td>
        <td>228</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN hc.HandledContacts &gt; 0 THEN (cm.ACWTime * 1.0 / hc.HandledContacts * 1.0) ELSE 0 END</td>
        <td>236</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cm.SkillTime &gt; 0 THEN cm.ACWTime * 1.0 / cm.SkillTime * 100 ELSE 0 END</td>
        <td>241</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN hc.HandledContacts &gt; 0 THEN (cm.UnavailableTime * 1.0 / hc.HandledContacts * 1.0) ELSE 0 END</td>
        <td>249</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cm.SkillTime &gt; 0 THEN cm.UnavailableTime * 1.0 / cm.SkillTime * 100 ELSE 0 END</td>
        <td>254</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN skl.CampaignType = 2 THEN CASE WHEN cm.PreviewContacts &gt; 0 THEN (cm.SkillTime * 1.0) / (cm.PreviewContacts * 1.0) ELSE 0 END ELSE CASE WHEN hc.HandledContacts &gt; 0 THEN (cm.SkillTime * 1.0) / (hc.HandledContacts * 1.0) ELSE 0 END END</td>
        <td>262</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cm.PreviewContacts &gt; 0 THEN (cm.SkillTime * 1.0) / (cm.PreviewContacts * 1.0) ELSE 0 END</td>
        <td>264</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN hc.HandledContacts &gt; 0 THEN (cm.SkillTime * 1.0) / (hc.HandledContacts * 1.0) ELSE 0 END</td>
        <td>266</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN cm.SkillTime &gt; 0 THEN (cm.PreviewTime + cm.WaitTime + cm.TalkTime + cm.ACWTime + cm.UnavailableTime) * 1.0 / cm.SkillTime * 100 ELSE 0 END</td>
        <td>272</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">#Skills AS skl</td>
        <td>54</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Skills AS skl</td>
        <td>99</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#AgentMetrics AS am</td>
        <td>100</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ContactEventLog AS cel</td>
        <td>101</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Skills AS skl</td>
        <td>147</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#Skills AS skl</td>
        <td>283</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#ContactMetrics AS cm</td>
        <td>284</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#HandledContacts AS hc</td>
        <td>285</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#Abandons AS ab</td>
        <td>286</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT cld.Contact_ID)</td>
        <td>143</td>
      </tr>
    </table>
  </body>
</html>