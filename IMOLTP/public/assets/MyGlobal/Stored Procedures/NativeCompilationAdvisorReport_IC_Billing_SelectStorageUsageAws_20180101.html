<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [MyGlobal].[IC_Billing_SelectStorageUsageAws]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [MyGlobal].[IC_Billing_SelectStorageUsageAws]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 5:27 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT (CASE @OrderColumn WHEN 'Query_Date' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Query_Date) ELSE ROW_NUMBER() OVER (ORDER BY a.Query_Date DESC) END) WHEN 'Active' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Active) ELSE ROW_NUMBER() OVER (ORDER BY a.Active DESC) END) WHEN 'LongTermRetrieval' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.ArchiveRetrieval) ELSE ROW_NUMBER() OVER (ORDER BY a.ArchiveRetrieval DESC) END) WHEN 'Usage_GB' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Usage_GB) ELSE ROW_NUMBER() OVER (ORDER BY a.Usage_GB DESC) END) WHEN 'LongTerm' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Archived) ELSE ROW_NUMBER() OVER (ORDER BY a.Archived DESC) END) END) AS RowNumber,
       Query_Date,
       Active,
       ArchiveRetrieval,
       Archived,
       Usage_GB
INTO   #tempBilling_ProductUsage
FROM   (SELECT   queryDate AS Query_Date,
                 MAX(Active) AS Active,
                 MAX(ArchiveRetrieval) AS ArchiveRetrieval,
                 MAX(Archived) AS Archived,
                 MAX(Active) + MAX(Archived) AS Usage_GB
        FROM     (SELECT queryDate,
                         CASE WHEN [prodTypeID] = 7
                                   AND StorageType = 'Active' THEN prodAmt ELSE 0 END AS Active,
                         CASE WHEN [prodTypeID] = 107 THEN prodAmt ELSE 0 END AS ArchiveRetrieval,
                         CASE WHEN [prodTypeID] = 108 THEN prodAmt ELSE 0 END AS Archived
                  FROM   Billing_ProductUsage
                  WHERE  prodTypeID IN (7, 107, 108)
                         AND bus_no = @BusNo
                         AND queryDate BETWEEN @StartDate AND @EndDate) AS dataSet
        GROUP BY queryDate) AS a</td>
        <td>12</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SELECT   RANK() OVER (ORDER BY t.Usage_Gb DESC) AS group#,
         t.Query_Date,
         t.Usage_Gb
INTO     #tempMaxPeak
FROM     #tempBilling_ProductUsage AS t
ORDER BY t.Usage_Gb DESC</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE @OrderColumn WHEN 'Query_Date' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Query_Date) ELSE ROW_NUMBER() OVER (ORDER BY a.Query_Date DESC) END) WHEN 'Active' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Active) ELSE ROW_NUMBER() OVER (ORDER BY a.Active DESC) END) WHEN 'LongTermRetrieval' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.ArchiveRetrieval) ELSE ROW_NUMBER() OVER (ORDER BY a.ArchiveRetrieval DESC) END) WHEN 'Usage_GB' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Usage_GB) ELSE ROW_NUMBER() OVER (ORDER BY a.Usage_GB DESC) END) WHEN 'LongTerm' THEN (CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Archived) ELSE ROW_NUMBER() OVER (ORDER BY a.Archived DESC) END) END</td>
        <td>12</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Query_Date) ELSE ROW_NUMBER() OVER (ORDER BY a.Query_Date DESC) END</td>
        <td>12</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Active) ELSE ROW_NUMBER() OVER (ORDER BY a.Active DESC) END</td>
        <td>15</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.ArchiveRetrieval) ELSE ROW_NUMBER() OVER (ORDER BY a.ArchiveRetrieval DESC) END</td>
        <td>18</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Usage_GB) ELSE ROW_NUMBER() OVER (ORDER BY a.Usage_GB DESC) END</td>
        <td>21</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN @OrderASC = 1 THEN ROW_NUMBER() OVER (ORDER BY a.Archived) ELSE ROW_NUMBER() OVER (ORDER BY a.Archived DESC) END</td>
        <td>24</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [prodTypeID] = 7
          AND StorageType = 'Active' THEN prodAmt ELSE 0 END</td>
        <td>39</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [prodTypeID] = 107 THEN prodAmt ELSE 0 END</td>
        <td>43</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN [prodTypeID] = 108 THEN prodAmt ELSE 0 END</td>
        <td>47</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">ROW_NUMBER</td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.Query_Date)</td>
        <td>12</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.Query_Date DESC)</td>
        <td>13</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.Active)</td>
        <td>15</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.Active DESC)</td>
        <td>16</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.ArchiveRetrieval)</td>
        <td>18</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.ArchiveRetrieval DESC)</td>
        <td>19</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.Usage_GB)</td>
        <td>21</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.Usage_GB DESC)</td>
        <td>22</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.Archived)</td>
        <td>24</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ROW_NUMBER() OVER (ORDER BY a.Archived DESC)</td>
        <td>25</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">OVER</td>
        <td colspan="1">OVER (ORDER BY a.Query_Date)</td>
        <td>12</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.Query_Date DESC)</td>
        <td>13</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.Active)</td>
        <td>15</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.Active DESC)</td>
        <td>16</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.ArchiveRetrieval)</td>
        <td>18</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.ArchiveRetrieval DESC)</td>
        <td>19</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.Usage_GB)</td>
        <td>21</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.Usage_GB DESC)</td>
        <td>22</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.Archived)</td>
        <td>24</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY a.Archived DESC)</td>
        <td>25</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">OVER (ORDER BY t.Usage_Gb DESC)</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">Billing_ProductUsage</td>
        <td>51</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tempBilling_ProductUsage AS b</td>
        <td>70</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tempBilling_ProductUsage AS t</td>
        <td>81</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#tempMaxPeak</td>
        <td>92</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#tempBilling_ProductUsage AS b</td>
        <td>117</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">RANK</td>
        <td colspan="1">RANK() OVER (ORDER BY t.Usage_Gb DESC)</td>
        <td>77</td>
      </tr>
    </table>
  </body>
</html>