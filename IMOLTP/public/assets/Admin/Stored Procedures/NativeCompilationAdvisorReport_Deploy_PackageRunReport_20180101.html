<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [Admin].[Deploy_PackageRunReport]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [Admin].[Deploy_PackageRunReport]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 4:59 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">CTE</td>
        <td>18</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">deployLog AS dl</td>
        <td>2</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">DeployPackage AS dp</td>
        <td>3</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">DeployPackageStep AS dps</td>
        <td>4</td>
      </tr>
      <tr valign="top">
        <td colspan="1">WITH clause</td>
        <td colspan="1">WITH CTE
AS (SELECT   dp.PackageName,
             dl.UniqueDeployID,
             dps.StepName,
             dps.StepNumber,
             dps.StepOrder,
             MAX(dl.DeployLogID) AS mxDLSID,
             Max(CASE WHEN dl.DeployStatus = 'Started' THEN dl.ExecutionDate END) AS StartDate,
             Max(CASE WHEN dl.DeployStatus IN ('Success', 'Failure') THEN dl.ExecutionDate END) AS EndDate
    FROM     deployLog AS dl
             INNER JOIN
             DeployPackage AS dp
             ON dl.PackageID = dp.PackageID
             INNER JOIN
             DeployPackageStep AS dps
             ON dl.StepID = dps.DeployPackageStepID
    WHERE    dp.PackageID = @PackageID
    GROUP BY dp.PackageName, dl.UniqueDeployID, dps.StepName, dps.StepNumber, dps.StepOrder, dl.UniqueDeployID)</td>
        <td>1</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1"> CTE
AS (SELECT   dp.PackageName,
             dl.UniqueDeployID,
             dps.StepName,
             dps.StepNumber,
             dps.StepOrder,
             MAX(dl.DeployLogID) AS mxDLSID,
             Max(CASE WHEN dl.DeployStatus = 'Started' THEN dl.ExecutionDate END) AS StartDate,
             Max(CASE WHEN dl.DeployStatus IN ('Success', 'Failure') THEN dl.ExecutionDate END) AS EndDate
    FROM     deployLog AS dl
             INNER JOIN
             DeployPackage AS dp
             ON dl.PackageID = dp.PackageID
             INNER JOIN
             DeployPackageStep AS dps
             ON dl.StepID = dps.DeployPackageStepID
    WHERE    dp.PackageID = @PackageID
    GROUP BY dp.PackageName, dl.UniqueDeployID, dps.StepName, dps.StepNumber, dps.StepOrder, dl.UniqueDeployID)</td>
        <td>1</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN dl.DeployStatus = 'Started' THEN dl.ExecutionDate END</td>
        <td>1</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN dl.DeployStatus IN ('Success', 'Failure') THEN dl.ExecutionDate END</td>
        <td>1</td>
      </tr>
    </table>
  </body>
</html>