<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [Admin].[CurrentTransactionIsolationLevels]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [Admin].[CurrentTransactionIsolationLevels]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 4:59 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SELECT INTO</td>
        <td colspan="1">SELECT @@servername AS server,
       x.spid AS spid,
       host_name,
       transaction_isolation_level,
       x.db,
       x.login_name,
       x.program_name,
       x.last_batch,
       datediff(ss, x.last_batch, getdate()) AS 'sec_since_last_batch',
       x.status,
       (SELECT text AS [text()]
        FROM   sys.dm_exec_sql_text(x.sql_handle)) AS SQL
INTO   #tmp
FROM   (SELECT   r.spid,
                 s.host_name,
                 CASE s.transaction_isolation_level WHEN 0 THEN 'Unspecified' WHEN 1 THEN 'Read Uncommitted' WHEN 2 THEN 'Read Committed' WHEN 3 THEN 'Repeatable Read' WHEN 4 THEN 'Serializable' WHEN 5 THEN 'Snapshot' END AS transaction_isolation_level,
                 db_name(r.dbid) AS 'db',
                 s.login_name,
                 r.program_name,
                 r.last_batch,
                 r.sql_handle,
                 r.status
        FROM     sys.dm_exec_sessions AS s
                 INNER JOIN
                 master..sysprocesses AS r
                 ON s.session_id = r.spid
        WHERE    s.host_name IS NOT NULL
                 AND s.transaction_isolation_level &lt;&gt; 1
                 AND r.program_name NOT LIKE '%' + @@servername + '%'
                 AND r.program_name NOT LIKE '%DatabaseMail%'
                 AND r.program_name NOT LIKE '%SQLAgent%'
                 AND r.program_name NOT LIKE '%Ignite%'
                 AND r.program_name NOT IN ('Replication Merge History', 'SQBCoreService.exe', 'Report Server', 'Microsoft SQL Server Management Studio')
        GROUP BY r.spid, r.status, s.transaction_isolation_level, s.host_name, r.program_name, db_name(r.dbid), s.login_name, r.last_batch, r.sql_handle) AS x</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">@@servername</td>
        <td colspan="1">@@servername</td>
        <td>2</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@@servername</td>
        <td>35</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">sys.dm_exec_sql_text(x.sql_handle)</td>
        <td>11</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE s.transaction_isolation_level WHEN 0 THEN 'Unspecified' WHEN 1 THEN 'Read Uncommitted' WHEN 2 THEN 'Read Committed' WHEN 3 THEN 'Repeatable Read' WHEN 4 THEN 'Serializable' WHEN 5 THEN 'Snapshot' END</td>
        <td>18</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">DB_NAME</td>
        <td colspan="1">db_name(r.dbid)</td>
        <td>26</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">db_name(r.dbid)</td>
        <td>40</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Three-part names</td>
        <td colspan="1">master..sysprocesses</td>
        <td>32</td>
      </tr>
      <tr valign="top">
        <td colspan="1">LIKE</td>
        <td colspan="1">r.program_name NOT LIKE '%' + @@servername + '%'</td>
        <td>35</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">r.program_name NOT LIKE '%DatabaseMail%'</td>
        <td>36</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">r.program_name NOT LIKE '%SQLAgent%'</td>
        <td>37</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">r.program_name NOT LIKE '%Ignite%'</td>
        <td>38</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">sql NOT LIKE '%Read%Uncommitted%'</td>
        <td>46</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">sql NOT LIKE '%WAITFOR (RECEIVE message_body FROM WMIEventProviderNotificationQueue%'</td>
        <td>47</td>
      </tr>
      <tr valign="top">
        <td colspan="1">*</td>
        <td colspan="1">SELECT   *
FROM     #tmp
WHERE    sql NOT LIKE '%Read%Uncommitted%'
         AND sql NOT LIKE '%WAITFOR (RECEIVE message_body FROM WMIEventProviderNotificationQueue%'
ORDER BY last_batch DESC</td>
        <td>43</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">#tmp</td>
        <td>45</td>
      </tr>
    </table>
  </body>
</html>