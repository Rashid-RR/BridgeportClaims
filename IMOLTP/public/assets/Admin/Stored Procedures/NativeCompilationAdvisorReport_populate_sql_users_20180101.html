<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [Admin].[populate_sql_users]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [Admin].[populate_sql_users]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>1/1/2018 4:59 PM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>1</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">@@version</td>
        <td colspan="1">@@version</td>
        <td>4</td>
      </tr>
      <tr valign="top">
        <td colspan="1">OBJECT_ID</td>
        <td colspan="1">OBJECT_ID('sql_users')</td>
        <td>6</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">LIKE</td>
        <td colspan="1">@vers LIKE '%2000%'</td>
        <td>22</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@vers NOT LIKE '%2000%'</td>
        <td>55</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">INSERT EXEC</td>
        <td colspan="1">INSERT INTO admin.dbo.sql_users
EXECUTE sp_MSForEachdb '
                
use  [?]
insert into admin.dbo.sql_users
            
 SELECT 
 @@SERVERNAME,
DB_NAME() as DBName,
 u.name As UserName,
 CASE 
 WHEN (r.uid IS NULL) THEN ''public''
 ELSE r.name
 END AS GroupName,
 l.name AS LoginName,
 NULL AS Default_db_Name,
 NULL as default_Schema_name,
 u.uid,
 u.sid
 FROM sysUsers u
 LEFT JOIN (sysMembers m 
 JOIN sysUsers r
 ON m.groupuid = r.uid)
 ON m.memberuid = u.uid
 LEFT JOIN master..sysLogins l
 ON u.sid = l.sid
 WHERE u.islogin = 1 OR u.isntname = 1 OR u.isntgroup = 1
 '</td>
        <td>24</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">INSERT INTO admin.dbo.sql_users
EXECUTE sp_MSForEachdb '
use  [?]
insert into admin.dbo.sql_users

 SELECT 
 @@SERVERNAME,
DB_NAME() db,
 u.name,
 CASE 
 WHEN (r.principal_id IS NULL) THEN ''public''
 ELSE r.name
 END GroupName,
 l.name LoginName,
 l.default_database_name,
 u.default_schema_name,
 u.principal_id,
 u.sid
 FROM sys.database_principals u
 LEFT JOIN (sys.database_role_members m
 JOIN sys.database_principals r 
 ON m.role_principal_id = r.principal_id)
 ON m.member_principal_id = u.principal_id
 LEFT JOIN sys.server_principals l
 ON u.sid = l.sid
 WHERE u.TYPE &lt;&gt; ''R''
 '</td>
        <td>57</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Three-part names</td>
        <td colspan="1">admin.dbo.sql_users</td>
        <td>24</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">admin.dbo.sql_users</td>
        <td>57</td>
      </tr>
    </table>
  </body>
</html>