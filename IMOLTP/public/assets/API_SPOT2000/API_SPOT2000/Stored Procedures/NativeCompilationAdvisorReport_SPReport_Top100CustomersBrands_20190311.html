<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [API_SPOT2000].[SPReport_Top100CustomersBrands]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [API_SPOT2000].[SPReport_Top100CustomersBrands]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>3/11/2019 10:32 AM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>20</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>91</td>
      </tr>
      <tr valign="top">
        <td colspan="1">DISTINCT</td>
        <td colspan="1">COUNT(DISTINCT Visit.InstanceNumber)</td>
        <td>28</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">COUNT(DISTINCT Visit.InstanceNumber)</td>
        <td>98</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">ALL_Invoice AS Invoice WITH (NOLOCK)</td>
        <td>29</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount WITH (NOLOCK)</td>
        <td>30</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ALL_Visit AS Visit WITH (NOLOCK)</td>
        <td>33</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount</td>
        <td>66</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ESM_SPAccountNode AS SPAccountNode WITH (NOLOCK)</td>
        <td>67</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ALL_Invoice AS INV WITH (NOLOCK)</td>
        <td>73</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ALL_InvoiceItem AS INVI WITH (NOLOCK)</td>
        <td>76</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ALL_InvoiceItemDetail AS INVID WITH (NOLOCK)</td>
        <td>78</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Invoice WITH (NOLOCK)</td>
        <td>99</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount WITH (NOLOCK)</td>
        <td>100</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Visit WITH (NOLOCK)</td>
        <td>103</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount</td>
        <td>136</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ESM_SPAccountNode AS SPAccountNode WITH (NOLOCK)</td>
        <td>137</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Invoice AS INV WITH (NOLOCK)</td>
        <td>143</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">InvoiceItem AS INVI WITH (NOLOCK)</td>
        <td>146</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">InvoiceItemDetail AS INVID WITH (NOLOCK)</td>
        <td>148</td>
      </tr>
      <tr valign="top">
        <td colspan="1">NOLOCK</td>
        <td colspan="1">NOLOCK</td>
        <td>29</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>30</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>33</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>67</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>73</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>76</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>78</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>99</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>100</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>103</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>137</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>143</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>146</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>148</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">fnGUIDListToTable(@SelectedSites) AS SITES</td>
        <td>32</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>55</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>56</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>57</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>58</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>59</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>60</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>61</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>62</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>63</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>64</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">fnGUIDListToTable(@SelectedSites) AS SELECTED_SITES</td>
        <td>68</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">fnGUIDListToTable(@SelectedSites) AS SITES</td>
        <td>102</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>125</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>126</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>127</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>128</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>129</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>130</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>131</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>132</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>133</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnVarCharListToTable(CBrand.Brands) AS B5</td>
        <td>134</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">fnGUIDListToTable(@SelectedSites) AS SELECTED_SITES</td>
        <td>138</td>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION OFF</td>
        <td colspan="1">SET NOCOUNT OFF</td>
        <td>39</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">SET NOCOUNT OFF</td>
        <td>109</td>
      </tr>
      <tr valign="top">
        <td colspan="1">APPLY</td>
        <td colspan="1">@TempCustomer AS TempCA
INNER JOIN
ClientAccount
ON TempCA.ClientAccountID = ClientAccount.InstanceID
INNER JOIN
ESM_SPAccountNode AS SPAccountNode WITH (NOLOCK)
ON SPAccountNode.InstanceID = ClientAccount.SPAccountNodeID
INNER JOIN
fnGUIDListToTable(@SelectedSites) AS SELECTED_SITES
ON SPAccountNode.InstanceID = SELECTED_SITES.ID OUTER APPLY (SELECT ClientAccountID,
                                                                    STUFF((SELECT   DISTINCT TOP 5 ',' + INVID.Name,
                                                                                                   ',',
                                                                                                   COUNT(INVID.Name)
                                                                           FROM     @TempCustomer AS CA
                                                                                    INNER JOIN
                                                                                    ALL_Invoice AS INV WITH (NOLOCK)
                                                                                    ON CA.ClientAccountID = INV.ClientAccountID
                                                                                       AND INV.InitialVisitDateTime BETWEEN @StartDate AND @EndDate
                                                                                       AND INV.Voided = 0
                                                                                    INNER JOIN
                                                                                    ALL_InvoiceItem AS INVI WITH (NOLOCK)
                                                                                    ON INV.InstanceID = INVI.InvoiceID
                                                                                       AND INVI.Voided = 0
                                                                                    INNER JOIN
                                                                                    ALL_InvoiceItemDetail AS INVID WITH (NOLOCK)
                                                                                    ON INVI.InstanceID = INVID.InvoiceItemID
                                                                                       AND INVID.DescriptorType = 'Brands'
                                                                           WHERE    CA.ClientAccountID = ClientAccount.InstanceID
                                                                           GROUP BY CA.ClientAccountID, INV.ClientAccountID, INVID.Name
                                                                           ORDER BY COUNT(INVID.Name) DESC
                                                                           FOR      XML PATH ('')), 1, 1, '') AS Brands) AS CBrand</td>
        <td>65</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@TempCustomer AS TempCA
INNER JOIN
ClientAccount
ON TempCA.ClientAccountID = ClientAccount.InstanceID
INNER JOIN
ESM_SPAccountNode AS SPAccountNode WITH (NOLOCK)
ON SPAccountNode.InstanceID = ClientAccount.SPAccountNodeID
INNER JOIN
fnGUIDListToTable(@SelectedSites) AS SELECTED_SITES
ON SPAccountNode.InstanceID = SELECTED_SITES.ID OUTER APPLY (SELECT ClientAccountID,
                                                                    STUFF((SELECT   DISTINCT TOP 5 ',' + INVID.Name,
                                                                                                   ',',
                                                                                                   COUNT(INVID.Name)
                                                                           FROM     @TempCustomer AS CA
                                                                                    INNER JOIN
                                                                                    Invoice AS INV WITH (NOLOCK)
                                                                                    ON CA.ClientAccountID = INV.ClientAccountID
                                                                                       AND INV.InitialVisitDateTime BETWEEN @StartDate AND @EndDate
                                                                                       AND INV.Voided = 0
                                                                                    INNER JOIN
                                                                                    InvoiceItem AS INVI WITH (NOLOCK)
                                                                                    ON INV.InstanceID = INVI.InvoiceID
                                                                                       AND INVI.Voided = 0
                                                                                    INNER JOIN
                                                                                    InvoiceItemDetail AS INVID WITH (NOLOCK)
                                                                                    ON INVI.InstanceID = INVID.InvoiceItemID
                                                                                       AND INVID.DescriptorType = 'Brands'
                                                                           WHERE    CA.ClientAccountID = ClientAccount.InstanceID
                                                                           GROUP BY CA.ClientAccountID, INV.ClientAccountID, INVID.Name
                                                                           ORDER BY COUNT(INVID.Name) DESC
                                                                           FOR      XML PATH ('')), 1, 1, '') AS Brands) AS CBrand</td>
        <td>135</td>
      </tr>
      <tr valign="top">
        <td colspan="1">STUFF</td>
        <td colspan="1">STUFF((SELECT   DISTINCT TOP 5 ',' + INVID.Name,
                               ',',
                               COUNT(INVID.Name)
       FROM     @TempCustomer AS CA
                INNER JOIN
                ALL_Invoice AS INV WITH (NOLOCK)
                ON CA.ClientAccountID = INV.ClientAccountID
                   AND INV.InitialVisitDateTime BETWEEN @StartDate AND @EndDate
                   AND INV.Voided = 0
                INNER JOIN
                ALL_InvoiceItem AS INVI WITH (NOLOCK)
                ON INV.InstanceID = INVI.InvoiceID
                   AND INVI.Voided = 0
                INNER JOIN
                ALL_InvoiceItemDetail AS INVID WITH (NOLOCK)
                ON INVI.InstanceID = INVID.InvoiceItemID
                   AND INVID.DescriptorType = 'Brands'
       WHERE    CA.ClientAccountID = ClientAccount.InstanceID
       GROUP BY CA.ClientAccountID, INV.ClientAccountID, INVID.Name
       ORDER BY COUNT(INVID.Name) DESC
       FOR      XML PATH ('')), 1, 1, '')</td>
        <td>71</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">STUFF((SELECT   DISTINCT TOP 5 ',' + INVID.Name,
                               ',',
                               COUNT(INVID.Name)
       FROM     @TempCustomer AS CA
                INNER JOIN
                Invoice AS INV WITH (NOLOCK)
                ON CA.ClientAccountID = INV.ClientAccountID
                   AND INV.InitialVisitDateTime BETWEEN @StartDate AND @EndDate
                   AND INV.Voided = 0
                INNER JOIN
                InvoiceItem AS INVI WITH (NOLOCK)
                ON INV.InstanceID = INVI.InvoiceID
                   AND INVI.Voided = 0
                INNER JOIN
                InvoiceItemDetail AS INVID WITH (NOLOCK)
                ON INVI.InstanceID = INVID.InvoiceItemID
                   AND INVID.DescriptorType = 'Brands'
       WHERE    CA.ClientAccountID = ClientAccount.InstanceID
       GROUP BY CA.ClientAccountID, INV.ClientAccountID, INVID.Name
       ORDER BY COUNT(INVID.Name) DESC
       FOR      XML PATH ('')), 1, 1, '')</td>
        <td>141</td>
      </tr>
      <tr valign="top">
        <td colspan="1">FOR XML</td>
        <td colspan="1">XML PATH ('')</td>
        <td>82</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">XML PATH ('')</td>
        <td>152</td>
      </tr>
    </table>
  </body>
</html>