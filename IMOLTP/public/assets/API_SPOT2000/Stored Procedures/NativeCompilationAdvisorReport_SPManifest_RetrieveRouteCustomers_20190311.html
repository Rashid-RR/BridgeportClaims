<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [API_SPOT2000].[SPManifest_RetrieveRouteCustomers]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [API_SPOT2000].[SPManifest_RetrieveRouteCustomers]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>3/11/2019 10:30 AM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">Route WITH (NOLOCK)</td>
        <td>127</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RouteStopClientAccount WITH (NOLOCK)</td>
        <td>244</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RouteStop WITH (NOLOCK)</td>
        <td>245</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Route WITH (NOLOCK)</td>
        <td>247</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount WITH (NOLOCK)</td>
        <td>248</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ESM_SPAccountNode AS SPAN WITH (NOLOCK)</td>
        <td>249</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RouteStop AS LinkedStop WITH (NOLOCK)</td>
        <td>250</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountRouteInfo WITH (NOLOCK)</td>
        <td>251</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountAccountsOnFile WITH (NOLOCK)</td>
        <td>252</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountAccountsOnFileTerm WITH (NOLOCK)</td>
        <td>253</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RouteStopClientAccount WITH (NOLOCK)</td>
        <td>344</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RouteStop WITH (NOLOCK)</td>
        <td>345</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Route WITH (NOLOCK)</td>
        <td>347</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount WITH (NOLOCK)</td>
        <td>348</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ESM_SPAccountNode AS SPAN WITH (NOLOCK)</td>
        <td>349</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountRouteInfo WITH (NOLOCK)</td>
        <td>350</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RouteStop AS LinkedStop WITH (NOLOCK)</td>
        <td>351</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountAccountsOnFile WITH (NOLOCK)</td>
        <td>352</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountAccountsOnFileTerm WITH (NOLOCK)</td>
        <td>353</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">R</td>
        <td>363</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">R</td>
        <td>390</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">R</td>
        <td>407</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Invoice WITH (NOLOCK)</td>
        <td>418</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">R</td>
        <td>425</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MRSession WITH (NOLOCK)</td>
        <td>431</td>
      </tr>
      <tr valign="top">
        <td colspan="1">NOLOCK</td>
        <td colspan="1">NOLOCK</td>
        <td>127</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>244</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>245</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>247</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>248</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>249</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>250</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>251</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>252</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>253</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>344</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>345</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>347</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>348</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>349</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>350</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>351</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>352</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>353</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>418</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>431</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.fnGUIDListToTable(@RouteIDList) AS RR</td>
        <td>128</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnGetClientAccountAddress(R.PickupAddressClientAccountID, R.PickupAddressTypeID) AS RouteAddress</td>
        <td>387</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">dbo.fnGetClientAccountAddress(R.DeliveryAddressClientAccountID, R.DeliveryAddressTypeID) AS RouteAddress</td>
        <td>403</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN Substring(RouteStop.DaysToVisit, 7, 1) = 'S' THEN 3 ELSE 0 END</td>
        <td>208</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Substring(RouteStop.DaysToVisit, 1, 1) = 'M' THEN 3 ELSE 0 END</td>
        <td>211</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Substring(RouteStop.DaysToVisit, 2, 1) = 'T' THEN 3 ELSE 0 END</td>
        <td>214</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Substring(RouteStop.DaysToVisit, 3, 1) = 'W' THEN 3 ELSE 0 END</td>
        <td>217</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Substring(RouteStop.DaysToVisit, 4, 1) = 'T' THEN 3 ELSE 0 END</td>
        <td>220</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Substring(RouteStop.DaysToVisit, 5, 1) = 'F' THEN 3 ELSE 0 END</td>
        <td>223</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Substring(RouteStop.DaysToVisit, 6, 1) = 'S' THEN 3 ELSE 0 END</td>
        <td>226</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(ClientAccount.Locker, '') IN ('Y', 'P') THEN 1 ELSE 0 END</td>
        <td>239</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(ClientAccountRouteInfo.EmailAddress, '') &lt;&gt; '' THEN ClientAccountRouteInfo.EmailAddress ELSE ClientAccount.EmailAddress END</td>
        <td>281</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.PickupType ELSE 0 END</td>
        <td>303</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.DeliveryType ELSE 0 END</td>
        <td>304</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.SundayVisitType WHEN Substring(RouteStop.DaysToVisit, 7, 1) = 'S' THEN 3 ELSE 0 END</td>
        <td>308</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.MondayVisitType WHEN Substring(RouteStop.DaysToVisit, 1, 1) = 'M' THEN 3 ELSE 0 END</td>
        <td>311</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.TuesdayVisitType WHEN Substring(RouteStop.DaysToVisit, 2, 1) = 'T' THEN 3 ELSE 0 END</td>
        <td>314</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.WednesdayVisitType WHEN Substring(RouteStop.DaysToVisit, 3, 1) = 'W' THEN 3 ELSE 0 END</td>
        <td>317</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.ThursdayVisitType WHEN Substring(RouteStop.DaysToVisit, 4, 1) = 'T' THEN 3 ELSE 0 END</td>
        <td>320</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.FridayVisitType WHEN Substring(RouteStop.DaysToVisit, 5, 1) = 'F' THEN 3 ELSE 0 END</td>
        <td>323</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteStop.DaysToVisit = '-------' THEN ClientAccountRouteInfo.SaturdayVisitType WHEN Substring(RouteStop.DaysToVisit, 6, 1) = 'S' THEN 3 ELSE 0 END</td>
        <td>326</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(ClientAccount.Locker, '') IN ('Y', 'P') THEN 1 ELSE 0 END</td>
        <td>339</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteAddress.AddressClientAccountID = R.ClientAccountID THEN RouteAddress.AddressUpdateID ELSE -1 END</td>
        <td>371</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteAddress.AddressClientAccountID = R.ClientAccountID THEN RouteAddress.AddressUpdateID ELSE -1 END</td>
        <td>382</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RouteAddress.AddressClientAccountID = R.ClientAccountID THEN RouteAddress.AddressUpdateID ELSE -1 END</td>
        <td>398</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Invoice.CurrentStatusID = 128 THEN 1 ELSE 0 END</td>
        <td>414</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Invoice.CurrentStatusID = 128 THEN Invoice.PieceCount ELSE 0 END</td>
        <td>415</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Invoice.CurrentStatusID = 129 THEN 1 ELSE 0 END</td>
        <td>416</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Invoice.CurrentStatusID = 129 THEN Invoice.PieceCount ELSE 0 END</td>
        <td>417</td>
      </tr>
      <tr valign="top">
        <td colspan="1">UPDATE with FROM clause</td>
        <td colspan="1">
FROM @Recordset AS R OUTER APPLY dbo.fnGetClientAccountAddress(R.PickupAddressClientAccountID, R.PickupAddressTypeID) AS RouteAddress</td>
        <td>386</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM @Recordset AS R OUTER APPLY dbo.fnGetClientAccountAddress(R.DeliveryAddressClientAccountID, R.DeliveryAddressTypeID) AS RouteAddress</td>
        <td>402</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM @Recordset AS R
     INNER JOIN
     @Routes AS RR
     ON RR.RouteID = R.RouteID OUTER APPLY (SELECT Sum(CASE WHEN Invoice.CurrentStatusID = 128 THEN 1 ELSE 0 END) AS OrderCountInProcess,
                                                   Sum(CASE WHEN Invoice.CurrentStatusID = 128 THEN Invoice.PieceCount ELSE 0 END) AS PieceCountInProcess,
                                                   Sum(CASE WHEN Invoice.CurrentStatusID = 129 THEN 1 ELSE 0 END) AS OrderCountReady,
                                                   Sum(CASE WHEN Invoice.CurrentStatusID = 129 THEN Invoice.PieceCount ELSE 0 END) AS PieceCountReady
                                            FROM   Invoice WITH (NOLOCK)
                                            WHERE  Invoice.ClientAccountID = R.ClientAccountID
                                                   AND Invoice.RouteID = R.RouteID
                                                   AND (Invoice.InvoiceMode &lt;&gt; 'Storage'
                                                        OR (RR.RackLocation &lt;&gt; ''
                                                            AND Invoice.Racklocation = RR.RackLocation))
                                                   AND Invoice.Voided = 0
                                                   AND ((Invoice.CurrentStatusID = 129
                                                         AND (RR.RackLocation = ''
                                                              OR Invoice.Racklocation = RR.RackLocation))
                                                        OR (Invoice.CurrentStatusID = 128
                                                            AND Invoice.PromisedDate &lt; @CurrentDateEnd))) AS OC</td>
        <td>412</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM Invoice WITH (NOLOCK)</td>
        <td>418</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM @Recordset AS R OUTER APPLY (SELECT   TOP 1 InstanceID AS MRSessionID,
                                                 ManifestID,
                                                 StartDateTime
                                  FROM     MRSession WITH (NOLOCK)
                                  WHERE    MRSession.RouteID = R.RouteID
                                           AND MRSession.StartDateTime &gt; @MRCutoff
                                           AND MRSession.EndDateTime IS NULL
                                  ORDER BY MRSession.InstanceNumber DESC) AS MR</td>
        <td>429</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM MRSession WITH (NOLOCK)</td>
        <td>431</td>
      </tr>
      <tr valign="top">
        <td colspan="1">APPLY</td>
        <td colspan="1">@Recordset AS R OUTER APPLY dbo.fnGetClientAccountAddress(R.PickupAddressClientAccountID, R.PickupAddressTypeID) AS RouteAddress</td>
        <td>386</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@Recordset AS R OUTER APPLY dbo.fnGetClientAccountAddress(R.DeliveryAddressClientAccountID, R.DeliveryAddressTypeID) AS RouteAddress</td>
        <td>402</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">@Recordset AS R
INNER JOIN
@Routes AS RR
ON RR.RouteID = R.RouteID OUTER APPLY (SELECT Sum(CASE WHEN Invoice.CurrentStatusID = 128 THEN 1 ELSE 0 END) AS OrderCountInProcess,
                                              Sum(CASE WHEN Invoice.CurrentStatusID = 128 THEN Invoice.PieceCount ELSE 0 END) AS PieceCountInProcess,
                                              Sum(CASE WHEN Invoice.CurrentStatusID = 129 THEN 1 ELSE 0 END) AS OrderCountReady,
                                              Sum(CASE WHEN Invoice.CurrentStatusID = 129 THEN Invoice.PieceCount ELSE 0 END) AS PieceCountReady
                                       FROM   Invoice WITH (NOLOCK)
                                       WHERE  Invoice.ClientAccountID = R.ClientAccountID
                                              AND Invoice.RouteID = R.RouteID
                                              AND (Invoice.InvoiceMode &lt;&gt; 'Storage'
                                                   OR (RR.RackLocation &lt;&gt; ''
                                                       AND Invoice.Racklocation = RR.RackLocation))
                                              AND Invoice.Voided = 0
                                              AND ((Invoice.CurrentStatusID = 129
                                                    AND (RR.RackLocation = ''
                                                         OR Invoice.Racklocation = RR.RackLocation))
                                                   OR (Invoice.CurrentStatusID = 128
                                                       AND Invoice.PromisedDate &lt; @CurrentDateEnd))) AS OC</td>
        <td>412</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">@Recordset AS R OUTER APPLY (SELECT   TOP 1 InstanceID AS MRSessionID,
                                            ManifestID,
                                            StartDateTime
                             FROM     MRSession WITH (NOLOCK)
                             WHERE    MRSession.RouteID = R.RouteID
                                      AND MRSession.StartDateTime &gt; @MRCutoff
                                      AND MRSession.EndDateTime IS NULL
                             ORDER BY MRSession.InstanceNumber DESC) AS MR</td>
        <td>429</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT Sum(CASE WHEN Invoice.CurrentStatusID = 128 THEN 1 ELSE 0 END) AS OrderCountInProcess,
        Sum(CASE WHEN Invoice.CurrentStatusID = 128 THEN Invoice.PieceCount ELSE 0 END) AS PieceCountInProcess,
        Sum(CASE WHEN Invoice.CurrentStatusID = 129 THEN 1 ELSE 0 END) AS OrderCountReady,
        Sum(CASE WHEN Invoice.CurrentStatusID = 129 THEN Invoice.PieceCount ELSE 0 END) AS PieceCountReady
 FROM   Invoice WITH (NOLOCK)
 WHERE  Invoice.ClientAccountID = R.ClientAccountID
        AND Invoice.RouteID = R.RouteID
        AND (Invoice.InvoiceMode &lt;&gt; 'Storage'
             OR (RR.RackLocation &lt;&gt; ''
                 AND Invoice.Racklocation = RR.RackLocation))
        AND Invoice.Voided = 0
        AND ((Invoice.CurrentStatusID = 129
              AND (RR.RackLocation = ''
                   OR Invoice.Racklocation = RR.RackLocation))
             OR (Invoice.CurrentStatusID = 128
                 AND Invoice.PromisedDate &lt; @CurrentDateEnd))) AS OC</td>
        <td>414</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">(SELECT   TOP 1 InstanceID AS MRSessionID,
                ManifestID,
                StartDateTime
 FROM     MRSession WITH (NOLOCK)
 WHERE    MRSession.RouteID = R.RouteID
          AND MRSession.StartDateTime &gt; @MRCutoff
          AND MRSession.EndDateTime IS NULL
 ORDER BY MRSession.InstanceNumber DESC) AS MR</td>
        <td>430</td>
      </tr>
      <tr valign="top">
        <td colspan="1">*</td>
        <td colspan="1">SELECT   *
FROM     @Recordset
ORDER BY ID</td>
        <td>446</td>
      </tr>
    </table>
  </body>
</html>