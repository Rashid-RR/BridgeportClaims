<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [API_SPOT2000].[SPManifest_RetrieveManifestByID]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [API_SPOT2000].[SPManifest_RetrieveManifestByID]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>3/11/2019 10:30 AM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">Subquery</td>
        <td colspan="1">(SELECT *
 FROM   ManifestHistoryInvoice WITH (NOLOCK)
 WHERE  ManifestID = @ManifestID
        AND ManifestHistoryStopID IS NULL)</td>
        <td>5</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">(SELECT *
 FROM   Invoice WITH (NOLOCK)
 WHERE  Invoice.InstanceID = MI.InvoiceID
        AND Invoice.ClientAccountID = MS.ClientAccountID)</td>
        <td>10</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">(SELECT   TOP 1 *
 FROM     ClientAccountRouteInfoExceptions WITH (NOLOCK)
 WHERE    ClientAccountID = RM.CustomerID
          AND RouteID = R.InstanceID
          AND EntryType = 'Visit'
          AND ExceptionDate &gt;= @StartDate
          AND ExceptionDate &lt; @EndDate
 ORDER BY InstanceNumber DESC) AS CARIE</td>
        <td>515</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">(SELECT   TOP 1 PromisedDate
 FROM     InvoiceHistory WITH (NOLOCK)
 WHERE    InvoiceHistory.InvoiceID = Inv.InstanceID
 ORDER BY InstanceNumber)</td>
        <td>534</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">(SELECT   TOP 1 ManifestHistory.InstanceID AS ManifestID,
                ManifestHistoryStopStatus.EntryDateTime,
                ManifestHistoryStopStatus.BagsQuantity,
                ManifestHistoryStopStatus.EventLatitude,
                ManifestHistoryStopStatus.EventLongitude
 FROM     ManifestHistoryStop WITH (NOLOCK)
          INNER JOIN
          ManifestHistoryStopStatus WITH (NOLOCK)
          ON ManifestHistoryStopStatus.ManifestHistoryStopID = ManifestHistoryStop.InstanceID
             AND ManifestHistoryStopStatus.VisitStatusID = 1
             AND ManifestHistoryStopStatus.BagsQuantity &gt; 0
          INNER JOIN
          ManifestHistory WITH (NOLOCK)
          ON ManifestHistory.InstanceID = ManifestHistoryStop.ManifestID
          INNER JOIN
          MRSession WITH (NOLOCK)
          ON MRSession.ManifestID = ManifestHistory.InstanceID
             AND MRSession.StartDateTime &lt; MR.StartDateTime
 WHERE    ManifestHistoryStop.ClientAccountID = RM.CustomerID
 ORDER BY ManifestHistoryStopStatus.InstanceNumber DESC) AS MSSP</td>
        <td>612</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">(SELECT   TOP 1 ManifestHistory.InstanceID AS ManifestID,
                ManifestHistoryInvoiceStatus.EntryDateTime,
                ManifestHistoryInvoiceStatus.EventLatitude,
                ManifestHistoryInvoiceStatus.EventLongitude
 FROM     ManifestHistoryInvoiceStatus WITH (NOLOCK)
          INNER JOIN
          ManifestHistoryInvoice WITH (NOLOCK)
          ON ManifestHistoryInvoice.InstanceID = ManifestHistoryInvoiceStatus.ManifestHistoryInvoiceID
          INNER JOIN
          ManifestHistory WITH (NOLOCK)
          ON ManifestHistory.InstanceID = ManifestHistoryInvoice.ManifestID
          INNER JOIN
          Invoice WITH (NOLOCK)
          ON Invoice.InstanceID = ManifestHistoryInvoice.InvoiceID
             AND Invoice.ClientAccountID = RM.CustomerID
          INNER JOIN
          MRSession WITH (NOLOCK)
          ON MRSession.ManifestID = ManifestHistory.InstanceID
             AND MRSession.StartDateTime &lt; @MRSessionDate
 WHERE    ManifestHistoryInvoiceStatus.OrderStatusID = 1
 ORDER BY ManifestHistoryInvoiceStatus.InstanceNumber DESC) AS MISP</td>
        <td>630</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">(SELECT   TOP 1 ManifestHistoryStop.StopNumber,
                ManifestHistoryStopStatus.InstanceID,
                ManifestHistoryStopStatus.EntryDateTime,
                ManifestHistoryStopStatus.EventLatitude,
                ManifestHistoryStopStatus.EventLongitude
 FROM     ManifestHistoryStop WITH (NOLOCK)
          INNER JOIN
          ManifestHistoryStopStatus WITH (NOLOCK)
          ON ManifestHistoryStopStatus.ManifestHistoryStopID = ManifestHistoryStop.InstanceID
             AND ManifestHistoryStopStatus.InstanceNumber &lt; MSS.InstanceNumber
             AND ManifestHistoryStopStatus.VisitStatusID = 1
 WHERE    MSS.InstanceNumber IS NOT NULL
          AND ManifestHistoryStop.ManifestID = @ManifestID
 ORDER BY ManifestHistoryStopStatus.InstanceNumber DESC) AS MSLS</td>
        <td>651</td>
      </tr>
      <tr valign="top">
        <td colspan="1">One-part names</td>
        <td colspan="1">ManifestHistoryInvoice WITH (NOLOCK)</td>
        <td>5</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryInvoice</td>
        <td>7</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>9</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryInvoice AS MI WITH (NOLOCK)</td>
        <td>10</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Invoice WITH (NOLOCK)</td>
        <td>10</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistory WITH (NOLOCK)</td>
        <td>19</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>30</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>47</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest WITH (TABLOCK)</td>
        <td>217</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistory AS MH WITH (NOLOCK)</td>
        <td>364</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>365</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Route AS R WITH (NOLOCK)</td>
        <td>370</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount AS CA WITH (NOLOCK)</td>
        <td>371</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryInvoice AS MI WITH (NOLOCK)</td>
        <td>372</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestExclusionReason AS MER WITH (NOLOCK)</td>
        <td>373</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryLockerPickup AS MP WITH (NOLOCK)</td>
        <td>374</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount AS CAP WITH (NOLOCK)</td>
        <td>382</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountAddress AS CAR WITH (NOLOCK)</td>
        <td>383</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>393</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>409</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>410</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RouteStopClientAccount AS RSCA WITH (NOLOCK)</td>
        <td>411</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RouteStop AS RS WITH (NOLOCK)</td>
        <td>412</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Route AS R WITH (NOLOCK)</td>
        <td>413</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RouteZone AS RZ WITH (NOLOCK)</td>
        <td>414</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>418</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>434</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>435</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RouteStop AS RS WITH (NOLOCK)</td>
        <td>436</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Route AS R WITH (NOLOCK)</td>
        <td>437</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RouteZone AS RZ WITH (NOLOCK)</td>
        <td>438</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>443</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>459</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>460</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RouteStop AS RS WITH (NOLOCK)</td>
        <td>461</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Route AS R WITH (NOLOCK)</td>
        <td>462</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RouteZone AS RZ WITH (NOLOCK)</td>
        <td>463</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>467</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>477</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>478</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Route AS R WITH (NOLOCK)</td>
        <td>479</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>483</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>501</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccount AS CA WITH (NOLOCK)</td>
        <td>502</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountRouteInfo AS CARI WITH (NOLOCK)</td>
        <td>503</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>507</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>512</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistory AS MH WITH (NOLOCK)</td>
        <td>513</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Route AS R WITH (NOLOCK)</td>
        <td>514</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountRouteInfoExceptions WITH (NOLOCK)</td>
        <td>516</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>525</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>538</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Invoice AS Inv WITH (NOLOCK)</td>
        <td>539</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">DiscreteListInstance AS InvStatus WITH (NOLOCK)</td>
        <td>540</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">InvoiceHistory WITH (NOLOCK)</td>
        <td>534</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>543</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>549</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryLockerPickup AS MP WITH (NOLOCK)</td>
        <td>550</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">InvoiceLockerEvent AS LE WITH (NOLOCK)</td>
        <td>551</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Locker AS LL WITH (NOLOCK)</td>
        <td>552</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>556</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>561</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">InvoiceLockerEvent AS LE WITH (NOLOCK)</td>
        <td>562</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Invoice AS Inv WITH (NOLOCK)</td>
        <td>563</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Locker AS LL WITH (NOLOCK)</td>
        <td>564</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Locker AS LB WITH (NOLOCK)</td>
        <td>565</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">InvoiceLockerEvent AS NXT WITH (NOLOCK)</td>
        <td>566</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>572</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>579</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStopStatus AS MSS WITH (NOLOCK)</td>
        <td>580</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>582</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>590</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryInvoiceStatus AS MIS WITH (NOLOCK)</td>
        <td>591</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MRSession WITH (NOLOCK)</td>
        <td>600</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>605</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>610</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MRSession AS MR WITH (NOLOCK)</td>
        <td>611</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop WITH (NOLOCK)</td>
        <td>615</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStopStatus WITH (NOLOCK)</td>
        <td>616</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistory WITH (NOLOCK)</td>
        <td>617</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MRSession WITH (NOLOCK)</td>
        <td>618</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>623</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>628</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MRSession AS MR WITH (NOLOCK)</td>
        <td>629</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryInvoiceStatus WITH (NOLOCK)</td>
        <td>634</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryInvoice WITH (NOLOCK)</td>
        <td>635</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistory WITH (NOLOCK)</td>
        <td>636</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Invoice WITH (NOLOCK)</td>
        <td>637</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MRSession WITH (NOLOCK)</td>
        <td>638</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>643</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>648</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MRSession AS MR WITH (NOLOCK)</td>
        <td>649</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStopStatus AS MSS WITH (NOLOCK)</td>
        <td>650</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop WITH (NOLOCK)</td>
        <td>656</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStopStatus WITH (NOLOCK)</td>
        <td>657</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">RM</td>
        <td>665</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM</td>
        <td>669</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountAccountsOnFile AS CAF WITH (NOLOCK)</td>
        <td>670</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ClientAccountAccountsOnFileTerm AS CAFT WITH (NOLOCK)</td>
        <td>671</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest</td>
        <td>677</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistory AS MH WITH (NOLOCK)</td>
        <td>705</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>706</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest</td>
        <td>713</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">NOLOCK</td>
        <td colspan="1">NOLOCK</td>
        <td>5</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>9</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>10</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>10</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>19</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>30</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>47</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>364</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>365</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>370</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>371</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>372</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>373</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>374</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>382</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>383</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>410</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>411</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>412</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>413</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>414</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>435</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>436</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>437</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>438</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>460</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>461</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>462</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>463</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>478</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>479</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>502</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>503</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>513</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>514</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>516</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>539</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>540</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>534</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>550</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>551</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>552</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>562</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>563</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>564</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>565</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>566</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>580</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>591</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>600</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>611</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>615</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>616</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>617</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>618</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>629</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>634</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>635</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>636</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>637</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>638</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>649</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>650</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>656</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>657</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>670</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>671</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>705</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>706</td>
      </tr>
      <tr valign="top">
        <td colspan="1">UPDATE with FROM clause</td>
        <td colspan="1">
FROM ManifestHistoryStop AS MS WITH (NOLOCK)
     INNER JOIN
     ManifestHistoryInvoice AS MI WITH (NOLOCK)
     ON MI.ManifestID = MS.ManifestID
        AND EXISTS (SELECT *
                    FROM   Invoice WITH (NOLOCK)
                    WHERE  Invoice.InstanceID = MI.InvoiceID
                           AND Invoice.ClientAccountID = MS.ClientAccountID)</td>
        <td>9</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM Invoice WITH (NOLOCK)</td>
        <td>10</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ManifestHistoryStop AS MS WITH (NOLOCK)
     ON MS.InstanceID = RM.StopRecordID
        AND MS.StopID IS NULL
     INNER JOIN
     RouteStopClientAccount AS RSCA WITH (NOLOCK)
     ON RSCA.ClientAccountID = MS.ClientAccountID
     INNER JOIN
     RouteStop AS RS WITH (NOLOCK)
     ON RS.InstanceID = RSCA.RouteStopID
     INNER JOIN
     Route AS R WITH (NOLOCK)
     ON R.InstanceID = RS.RouteID
     LEFT OUTER JOIN
     RouteZone AS RZ WITH (NOLOCK)
     ON RZ.InstanceID = RS.RouteZoneID</td>
        <td>409</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ManifestHistoryStop AS MS WITH (NOLOCK)
     ON MS.InstanceID = RM.StopRecordID
        AND MS.StopID IS NULL
     INNER JOIN
     RouteStop AS RS WITH (NOLOCK)
     ON RS.AddressClientAccountID = MS.ClientAccountID
        AND (RS.ServiceType &amp; 3) &lt;&gt; 0
     INNER JOIN
     Route AS R WITH (NOLOCK)
     ON R.InstanceID = RS.RouteID
        AND R.VersionID = 1
     LEFT OUTER JOIN
     RouteZone AS RZ WITH (NOLOCK)
     ON RZ.InstanceID = RS.RouteZoneID</td>
        <td>434</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ManifestHistoryStop AS MS WITH (NOLOCK)
     ON MS.InstanceID = RM.StopRecordID
     INNER JOIN
     RouteStop AS RS WITH (NOLOCK)
     ON RS.InstanceID = MS.StopID
     INNER JOIN
     Route AS R WITH (NOLOCK)
     ON R.InstanceID = RS.RouteID
     LEFT OUTER JOIN
     RouteZone AS RZ WITH (NOLOCK)
     ON RZ.InstanceID = RS.RouteZoneID</td>
        <td>459</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ManifestHistoryStop AS MS WITH (NOLOCK)
     ON MS.InstanceID = RM.StopRecordID
        AND MS.StopID IS NULL
     INNER JOIN
     Route AS R WITH (NOLOCK)
     ON R.InstanceID = MS.RouteID</td>
        <td>477</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ClientAccount AS CA WITH (NOLOCK)
     ON CA.InstanceID = RM.CustomerID
     INNER JOIN
     ClientAccountRouteInfo AS CARI WITH (NOLOCK)
     ON CARI.ClientAccountID = RM.CustomerID OUTER APPLY dbo.GetRouteInstructions(CA.InstanceID, RM.AddressTypeID, 1) AS RI</td>
        <td>501</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ManifestHistory AS MH WITH (NOLOCK)
     ON MH.InstanceNumber = RM.InstanceNumber
     INNER JOIN
     Route AS R WITH (NOLOCK)
     ON R.RouteName = MH.RouteName
        AND R.SPAccountNodeID = MH.SPAccountNodeID OUTER APPLY (SELECT   TOP 1 *
                                                                FROM     ClientAccountRouteInfoExceptions WITH (NOLOCK)
                                                                WHERE    ClientAccountID = RM.CustomerID
                                                                         AND RouteID = R.InstanceID
                                                                         AND EntryType = 'Visit'
                                                                         AND ExceptionDate &gt;= @StartDate
                                                                         AND ExceptionDate &lt; @EndDate
                                                                ORDER BY InstanceNumber DESC) AS CARIE</td>
        <td>512</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM ClientAccountRouteInfoExceptions WITH (NOLOCK)</td>
        <td>516</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     Invoice AS Inv WITH (NOLOCK)
     ON Inv.InstanceID = RM.OrderID
     LEFT OUTER JOIN
     DiscreteListInstance AS InvStatus WITH (NOLOCK)
     ON InvStatus.InstanceID = Inv.CurrentStatusID</td>
        <td>538</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM InvoiceHistory WITH (NOLOCK)</td>
        <td>534</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ManifestHistoryLockerPickup AS MP WITH (NOLOCK)
     ON MP.InstanceID = RM.LockerPickupRecordID
     INNER JOIN
     InvoiceLockerEvent AS LE WITH (NOLOCK)
     ON LE.InstanceID = MP.InvoiceLockerEventID
     INNER JOIN
     Locker AS LL WITH (NOLOCK)
     ON LL.InstanceID = LE.LockerID</td>
        <td>549</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     InvoiceLockerEvent AS LE WITH (NOLOCK)
     ON LE.InvoiceID = RM.OrderID
        AND LE.EventType = 'R'
     INNER JOIN
     Invoice AS Inv WITH (NOLOCK)
     ON Inv.InstanceID = LE.InvoiceID
        AND Inv.LockerID = RM.LockerID
     INNER JOIN
     Locker AS LL WITH (NOLOCK)
     ON LL.InstanceID = LE.LockerID
        AND LL.NodeType = 'L'
     INNER JOIN
     Locker AS LB WITH (NOLOCK)
     ON LB.InstanceID = RM.LockerID
        AND LB.InstanceID = LL.ParentID
        AND LB.NodeType = 'B'
     LEFT OUTER JOIN
     InvoiceLockerEvent AS NXT WITH (NOLOCK)
     ON NXT.LockerID = LE.LockerID
        AND NXT.InvoiceID = LE.InvoiceID
        AND NXT.EventType &lt;&gt; 'O'
        AND NXT.InstanceNumber &gt; LE.InstanceNumber</td>
        <td>561</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ManifestHistoryStopStatus AS MSS WITH (NOLOCK)
     ON MSS.ManifestHistoryStopID = RM.StopRecordID</td>
        <td>579</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ManifestHistoryInvoiceStatus AS MIS WITH (NOLOCK)
     ON MIS.ManifestHistoryInvoiceID = RM.InvoiceRecordID</td>
        <td>590</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     MRSession AS MR WITH (NOLOCK)
     ON MR.InstanceID = @MRSessionID OUTER APPLY (SELECT   TOP 1 ManifestHistory.InstanceID AS ManifestID,
                                                                 ManifestHistoryStopStatus.EntryDateTime,
                                                                 ManifestHistoryStopStatus.BagsQuantity,
                                                                 ManifestHistoryStopStatus.EventLatitude,
                                                                 ManifestHistoryStopStatus.EventLongitude
                                                  FROM     ManifestHistoryStop WITH (NOLOCK)
                                                           INNER JOIN
                                                           ManifestHistoryStopStatus WITH (NOLOCK)
                                                           ON ManifestHistoryStopStatus.ManifestHistoryStopID = ManifestHistoryStop.InstanceID
                                                              AND ManifestHistoryStopStatus.VisitStatusID = 1
                                                              AND ManifestHistoryStopStatus.BagsQuantity &gt; 0
                                                           INNER JOIN
                                                           ManifestHistory WITH (NOLOCK)
                                                           ON ManifestHistory.InstanceID = ManifestHistoryStop.ManifestID
                                                           INNER JOIN
                                                           MRSession WITH (NOLOCK)
                                                           ON MRSession.ManifestID = ManifestHistory.InstanceID
                                                              AND MRSession.StartDateTime &lt; MR.StartDateTime
                                                  WHERE    ManifestHistoryStop.ClientAccountID = RM.CustomerID
                                                  ORDER BY ManifestHistoryStopStatus.InstanceNumber DESC) AS MSSP</td>
        <td>610</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM ManifestHistoryStop WITH (NOLOCK)
     INNER JOIN
     ManifestHistoryStopStatus WITH (NOLOCK)
     ON ManifestHistoryStopStatus.ManifestHistoryStopID = ManifestHistoryStop.InstanceID
        AND ManifestHistoryStopStatus.VisitStatusID = 1
        AND ManifestHistoryStopStatus.BagsQuantity &gt; 0
     INNER JOIN
     ManifestHistory WITH (NOLOCK)
     ON ManifestHistory.InstanceID = ManifestHistoryStop.ManifestID
     INNER JOIN
     MRSession WITH (NOLOCK)
     ON MRSession.ManifestID = ManifestHistory.InstanceID
        AND MRSession.StartDateTime &lt; MR.StartDateTime</td>
        <td>615</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     MRSession AS MR WITH (NOLOCK)
     ON MR.InstanceID = @MRSessionID OUTER APPLY (SELECT   TOP 1 ManifestHistory.InstanceID AS ManifestID,
                                                                 ManifestHistoryInvoiceStatus.EntryDateTime,
                                                                 ManifestHistoryInvoiceStatus.EventLatitude,
                                                                 ManifestHistoryInvoiceStatus.EventLongitude
                                                  FROM     ManifestHistoryInvoiceStatus WITH (NOLOCK)
                                                           INNER JOIN
                                                           ManifestHistoryInvoice WITH (NOLOCK)
                                                           ON ManifestHistoryInvoice.InstanceID = ManifestHistoryInvoiceStatus.ManifestHistoryInvoiceID
                                                           INNER JOIN
                                                           ManifestHistory WITH (NOLOCK)
                                                           ON ManifestHistory.InstanceID = ManifestHistoryInvoice.ManifestID
                                                           INNER JOIN
                                                           Invoice WITH (NOLOCK)
                                                           ON Invoice.InstanceID = ManifestHistoryInvoice.InvoiceID
                                                              AND Invoice.ClientAccountID = RM.CustomerID
                                                           INNER JOIN
                                                           MRSession WITH (NOLOCK)
                                                           ON MRSession.ManifestID = ManifestHistory.InstanceID
                                                              AND MRSession.StartDateTime &lt; @MRSessionDate
                                                  WHERE    ManifestHistoryInvoiceStatus.OrderStatusID = 1
                                                  ORDER BY ManifestHistoryInvoiceStatus.InstanceNumber DESC) AS MISP</td>
        <td>628</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM ManifestHistoryInvoiceStatus WITH (NOLOCK)
     INNER JOIN
     ManifestHistoryInvoice WITH (NOLOCK)
     ON ManifestHistoryInvoice.InstanceID = ManifestHistoryInvoiceStatus.ManifestHistoryInvoiceID
     INNER JOIN
     ManifestHistory WITH (NOLOCK)
     ON ManifestHistory.InstanceID = ManifestHistoryInvoice.ManifestID
     INNER JOIN
     Invoice WITH (NOLOCK)
     ON Invoice.InstanceID = ManifestHistoryInvoice.InvoiceID
        AND Invoice.ClientAccountID = RM.CustomerID
     INNER JOIN
     MRSession WITH (NOLOCK)
     ON MRSession.ManifestID = ManifestHistory.InstanceID
        AND MRSession.StartDateTime &lt; @MRSessionDate</td>
        <td>634</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     MRSession AS MR WITH (NOLOCK)
     ON MR.InstanceID = @MRSessionID
     INNER JOIN
     ManifestHistoryStopStatus AS MSS WITH (NOLOCK)
     ON MSS.ManifestHistoryStopID = RM.StopRecordID OUTER APPLY (SELECT   TOP 1 ManifestHistoryStop.StopNumber,
                                                                                ManifestHistoryStopStatus.InstanceID,
                                                                                ManifestHistoryStopStatus.EntryDateTime,
                                                                                ManifestHistoryStopStatus.EventLatitude,
                                                                                ManifestHistoryStopStatus.EventLongitude
                                                                 FROM     ManifestHistoryStop WITH (NOLOCK)
                                                                          INNER JOIN
                                                                          ManifestHistoryStopStatus WITH (NOLOCK)
                                                                          ON ManifestHistoryStopStatus.ManifestHistoryStopID = ManifestHistoryStop.InstanceID
                                                                             AND ManifestHistoryStopStatus.InstanceNumber &lt; MSS.InstanceNumber
                                                                             AND ManifestHistoryStopStatus.VisitStatusID = 1
                                                                 WHERE    MSS.InstanceNumber IS NOT NULL
                                                                          AND ManifestHistoryStop.ManifestID = @ManifestID
                                                                 ORDER BY ManifestHistoryStopStatus.InstanceNumber DESC) AS MSLS</td>
        <td>648</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">
FROM ManifestHistoryStop WITH (NOLOCK)
     INNER JOIN
     ManifestHistoryStopStatus WITH (NOLOCK)
     ON ManifestHistoryStopStatus.ManifestHistoryStopID = ManifestHistoryStop.InstanceID
        AND ManifestHistoryStopStatus.InstanceNumber &lt; MSS.InstanceNumber
        AND ManifestHistoryStopStatus.VisitStatusID = 1</td>
        <td>656</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">
FROM #RouteManifest AS RM
     INNER JOIN
     ClientAccountAccountsOnFile AS CAF WITH (NOLOCK)
     ON CAF.ClientAccountID = RM.CustomerID
        AND CAF.AccountType = 1
        AND CAF.AccountOrdinal = 1
        AND CAF.AccountDisabled = 0
     INNER JOIN
     ClientAccountAccountsOnFileTerm AS CAFT WITH (NOLOCK)
     ON CAFT.ClientAccountAccountsOnFileID = CAF.InstanceID</td>
        <td>669</td>
      </tr>
      <tr valign="top">
        <td colspan="1">OBJECT_ID</td>
        <td colspan="1">object_id('tempdb..#RouteManifest')</td>
        <td>52</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">TABLOCK</td>
        <td colspan="1">TABLOCK</td>
        <td>217</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN MI.InvoiceID IS NOT NULL THEN MS.VisitTypeID | 2 ELSE MS.VisitTypeID END</td>
        <td>257</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(CA.Locker, '') IN ('Y', 'P') THEN 1 ELSE 0 END</td>
        <td>356</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.Address1 ELSE CAP.Address1 END</td>
        <td>376</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.Address2 ELSE CAP.Address2 END</td>
        <td>377</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.City ELSE CAP.City END</td>
        <td>378</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.[State] ELSE CAP.[State] END</td>
        <td>379</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.PostalCode ELSE CAP.Zip END</td>
        <td>380</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.PostalCodeMask ELSE CAP.PostalCodeMask END</td>
        <td>381</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RS.RouteID = RM.RouteID
          AND IsNull(RS.ServiceType, 0) &lt;&gt; 0 THEN RS.ServiceType ELSE RM.VisitTypeID END</td>
        <td>395</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RM.CustomerType IS NOT NULL THEN RM.CustomerType WHEN RS.RouteID &lt;&gt; RM.RouteID
                                                                OR RS.DaysToVisit = '-------'
                                                                OR RM.VisitTypeID = 2
                                                                OR RS.LockerID IS NOT NULL THEN 'O' ELSE 'S' END</td>
        <td>396</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(RS.ScanAtDelivery, '--') = '--'
          OR RS.ScanAtDelivery = '' THEN CASE WHEN R.DefaultScanAtDelivery = '' THEN 'RA' ELSE IsNull(R.DefaultScanAtDelivery, 'RA') END ELSE RS.ScanAtDelivery END</td>
        <td>399</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN R.DefaultScanAtDelivery = '' THEN 'RA' ELSE IsNull(R.DefaultScanAtDelivery, 'RA') END</td>
        <td>400</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN R.ImageAtDelivery = 'R' THEN R.ImageAtDelivery ELSE IsNull(RS.ImageAtDelivery, R.ImageAtDelivery) END</td>
        <td>404</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RS.RouteID = RM.RouteID
          AND IsNull(RS.ServiceType, 0) &lt;&gt; 0 THEN RS.ServiceType ELSE RM.VisitTypeID END</td>
        <td>420</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RM.CustomerType IS NOT NULL THEN RM.CustomerType WHEN RS.RouteID &lt;&gt; RM.RouteID
                                                                OR RS.DaysToVisit = '-------'
                                                                OR RM.VisitTypeID = 2
                                                                OR RS.LockerID IS NOT NULL THEN 'O' ELSE 'S' END</td>
        <td>421</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(RS.ScanAtDelivery, '--') = '--'
          OR RS.ScanAtDelivery = '' THEN CASE WHEN R.DefaultScanAtDelivery = '' THEN 'RA' ELSE IsNull(R.DefaultScanAtDelivery, 'RA') END ELSE RS.ScanAtDelivery END</td>
        <td>424</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN R.DefaultScanAtDelivery = '' THEN 'RA' ELSE IsNull(R.DefaultScanAtDelivery, 'RA') END</td>
        <td>425</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN R.ImageAtDelivery = 'R' THEN R.ImageAtDelivery ELSE IsNull(RS.ImageAtDelivery, R.ImageAtDelivery) END</td>
        <td>429</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RS.RouteID = RM.RouteID
          AND IsNull(RS.ServiceType, 0) &lt;&gt; 0 THEN RS.ServiceType ELSE RM.VisitTypeID END</td>
        <td>445</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RM.CustomerType IS NOT NULL THEN RM.CustomerType WHEN RS.RouteID &lt;&gt; RM.RouteID
                                                                OR RS.DaysToVisit = '-------'
                                                                OR RM.VisitTypeID = 2
                                                                OR RS.LockerID IS NOT NULL THEN 'O' ELSE 'S' END</td>
        <td>446</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(RS.ScanAtDelivery, '--') = '--'
          OR RS.ScanAtDelivery = '' THEN CASE WHEN R.DefaultScanAtDelivery = '' THEN 'RA' ELSE IsNull(R.DefaultScanAtDelivery, 'RA') END ELSE RS.ScanAtDelivery END</td>
        <td>449</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN R.DefaultScanAtDelivery = '' THEN 'RA' ELSE IsNull(R.DefaultScanAtDelivery, 'RA') END</td>
        <td>450</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN R.ImageAtDelivery = 'R' THEN R.ImageAtDelivery ELSE IsNull(RS.ImageAtDelivery, R.ImageAtDelivery) END</td>
        <td>454</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RM.CustomerType IS NOT NULL THEN RM.CustomerType ELSE 'O' END</td>
        <td>469</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN R.DefaultScanAtDelivery = '' THEN 'RA' ELSE IsNull(R.DefaultScanAtDelivery, 'RA') END</td>
        <td>473</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN RM.CustomerType IS NULL THEN CASE WHEN IsNull(CA.UseRouteRules, 0) &lt;&gt; 0 THEN CASE WHEN CARI.PickupType = 0
                                                                                                 AND (RM.VisitTypeID &amp; 1) &lt;&gt; 0 THEN 'S' WHEN CARI.DeliveryType = 0
                                                                                                                                             AND (RM.VisitTypeID &amp; 2) &lt;&gt; 0 THEN 'S' WHEN CARI.PickupType &lt;&gt; 0
                                                                                                                                                                                         AND (RM.VisitTypeID &amp; 1) &lt;&gt; 0 THEN 'O' WHEN CARI.DeliveryType &lt;&gt; 0
                                                                                                                                                                                                                                     AND (RM.VisitTypeID &amp; 2) &lt;&gt; 0 THEN 'O' ELSE 'O' END ELSE 'O' END ELSE RM.CustomerType END</td>
        <td>492</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(CA.UseRouteRules, 0) &lt;&gt; 0 THEN CASE WHEN CARI.PickupType = 0
                                                          AND (RM.VisitTypeID &amp; 1) &lt;&gt; 0 THEN 'S' WHEN CARI.DeliveryType = 0
                                                                                                      AND (RM.VisitTypeID &amp; 2) &lt;&gt; 0 THEN 'S' WHEN CARI.PickupType &lt;&gt; 0
                                                                                                                                                  AND (RM.VisitTypeID &amp; 1) &lt;&gt; 0 THEN 'O' WHEN CARI.DeliveryType &lt;&gt; 0
                                                                                                                                                                                              AND (RM.VisitTypeID &amp; 2) &lt;&gt; 0 THEN 'O' ELSE 'O' END ELSE 'O' END</td>
        <td>493</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN CARI.PickupType = 0
          AND (RM.VisitTypeID &amp; 1) &lt;&gt; 0 THEN 'S' WHEN CARI.DeliveryType = 0
                                                      AND (RM.VisitTypeID &amp; 2) &lt;&gt; 0 THEN 'S' WHEN CARI.PickupType &lt;&gt; 0
                                                                                                  AND (RM.VisitTypeID &amp; 1) &lt;&gt; 0 THEN 'O' WHEN CARI.DeliveryType &lt;&gt; 0
                                                                                                                                              AND (RM.VisitTypeID &amp; 2) &lt;&gt; 0 THEN 'O' ELSE 'O' END</td>
        <td>494</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN Inv.Voided &lt;&gt; 0 THEN 'Voided' WHEN Inv.InstanceID IS NULL THEN NULL ELSE IsNull(InvStatus.Name, 'Invalid') END</td>
        <td>535</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 1 THEN 1 ELSE 0 END</td>
        <td>574</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 2 THEN 1 ELSE 0 END</td>
        <td>575</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MIS.OnTruck, 0) = 1 THEN 1 ELSE 0 END</td>
        <td>583</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MIS.OnTruck, 0) = 1 THEN IsNull(MIS.OnTruckLocation, '') ELSE '' END</td>
        <td>584</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 1 THEN CASE WHEN MSLS.InstanceID IS NULL THEN 'Start' ELSE CONVERT (VARCHAR (10), MSLS.StopNumber) END ELSE NULL END</td>
        <td>644</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN MSLS.InstanceID IS NULL THEN 'Start' ELSE CONVERT (VARCHAR (10), MSLS.StopNumber) END</td>
        <td>644</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 1 THEN CASE WHEN MSLS.InstanceID IS NULL THEN MR.StartDateTime ELSE MSLS.EntryDateTime END ELSE NULL END</td>
        <td>645</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN MSLS.InstanceID IS NULL THEN MR.StartDateTime ELSE MSLS.EntryDateTime END</td>
        <td>645</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 1 THEN CASE WHEN MSLS.InstanceID IS NULL THEN 0 ELSE MSLS.EventLatitude END ELSE NULL END</td>
        <td>646</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN MSLS.InstanceID IS NULL THEN 0 ELSE MSLS.EventLatitude END</td>
        <td>646</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 1 THEN CASE WHEN MSLS.InstanceID IS NULL THEN 0 ELSE MSLS.EventLongitude END ELSE NULL END</td>
        <td>647</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN MSLS.InstanceID IS NULL THEN 0 ELSE MSLS.EventLongitude END</td>
        <td>647</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN (IsNull(CAF.AccountFlags, 0) &amp; 1) = 1 THEN 1 ELSE 0 END</td>
        <td>668</td>
      </tr>
      <tr valign="top">
        <td colspan="1">APPLY</td>
        <td colspan="1">ManifestHistory AS MH WITH (NOLOCK)
INNER JOIN
ManifestHistoryStop AS MS WITH (NOLOCK)
ON MS.ManifestID = MH.InstanceID
   AND MS.StopNumber &gt;= @NextStopNumber
   AND MS.StopNumber &lt;= @EndStopNumber
   AND (MS.Cancelled = 0
        OR @ClientAccountID IS NOT NULL)
   AND (@ManifestHistoryStopID IS NULL
        OR (@ManifestHistoryStopID IS NOT NULL
            AND MS.InstanceID = @ManifestHistoryStopID))
INNER JOIN
Route AS R WITH (NOLOCK)
ON R.RouteName = MH.RouteName
   AND R.SPAccountNodeID = MH.SPAccountNodeID
LEFT OUTER JOIN
ClientAccount AS CA WITH (NOLOCK)
ON CA.InstanceID = MS.ClientAccountID
   AND (@ClientAccountID IS NULL
        OR (@ClientAccountID IS NOT NULL
            AND CA.InstanceID = @ClientAccountID))
LEFT OUTER JOIN
ManifestHistoryInvoice AS MI WITH (NOLOCK)
ON MI.ManifestHistoryStopID = MS.InstanceID
LEFT OUTER JOIN
ManifestExclusionReason AS MER WITH (NOLOCK)
ON MER.InstanceID = MI.ManifestExclusionReasonID
LEFT OUTER JOIN
ManifestHistoryLockerPickup AS MP WITH (NOLOCK)
ON MP.ManifestHistoryStopID = MS.InstanceID OUTER APPLY (SELECT CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.Address1 ELSE CAP.Address1 END AS Address1,
                                                                CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.Address2 ELSE CAP.Address2 END AS Address2,
                                                                CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.City ELSE CAP.City END AS City,
                                                                CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.[State] ELSE CAP.[State] END AS [State],
                                                                CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.PostalCode ELSE CAP.Zip END AS PostalCode,
                                                                CASE WHEN IsNull(CAR.Address1, '') &lt;&gt; '' THEN CAR.PostalCodeMask ELSE CAP.PostalCodeMask END AS PostalCodeMask
                                                         FROM   ClientAccount AS CAP WITH (NOLOCK)
                                                                LEFT OUTER JOIN
                                                                ClientAccountAddress AS CAR WITH (NOLOCK)
                                                                ON CAR.ClientAccountID = CAP.InstanceID
                                                                   AND CAR.AddressTypeID = 304
                                                         WHERE  CAP.InstanceID = CA.InstanceID) AS CustomerAddress</td>
        <td>364</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM
INNER JOIN
ClientAccount AS CA WITH (NOLOCK)
ON CA.InstanceID = RM.CustomerID
INNER JOIN
ClientAccountRouteInfo AS CARI WITH (NOLOCK)
ON CARI.ClientAccountID = RM.CustomerID OUTER APPLY dbo.GetRouteInstructions(CA.InstanceID, RM.AddressTypeID, 1) AS RI</td>
        <td>501</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM
INNER JOIN
ManifestHistory AS MH WITH (NOLOCK)
ON MH.InstanceNumber = RM.InstanceNumber
INNER JOIN
Route AS R WITH (NOLOCK)
ON R.RouteName = MH.RouteName
   AND R.SPAccountNodeID = MH.SPAccountNodeID OUTER APPLY (SELECT   TOP 1 *
                                                           FROM     ClientAccountRouteInfoExceptions WITH (NOLOCK)
                                                           WHERE    ClientAccountID = RM.CustomerID
                                                                    AND RouteID = R.InstanceID
                                                                    AND EntryType = 'Visit'
                                                                    AND ExceptionDate &gt;= @StartDate
                                                                    AND ExceptionDate &lt; @EndDate
                                                           ORDER BY InstanceNumber DESC) AS CARIE</td>
        <td>512</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM
INNER JOIN
MRSession AS MR WITH (NOLOCK)
ON MR.InstanceID = @MRSessionID OUTER APPLY (SELECT   TOP 1 ManifestHistory.InstanceID AS ManifestID,
                                                            ManifestHistoryStopStatus.EntryDateTime,
                                                            ManifestHistoryStopStatus.BagsQuantity,
                                                            ManifestHistoryStopStatus.EventLatitude,
                                                            ManifestHistoryStopStatus.EventLongitude
                                             FROM     ManifestHistoryStop WITH (NOLOCK)
                                                      INNER JOIN
                                                      ManifestHistoryStopStatus WITH (NOLOCK)
                                                      ON ManifestHistoryStopStatus.ManifestHistoryStopID = ManifestHistoryStop.InstanceID
                                                         AND ManifestHistoryStopStatus.VisitStatusID = 1
                                                         AND ManifestHistoryStopStatus.BagsQuantity &gt; 0
                                                      INNER JOIN
                                                      ManifestHistory WITH (NOLOCK)
                                                      ON ManifestHistory.InstanceID = ManifestHistoryStop.ManifestID
                                                      INNER JOIN
                                                      MRSession WITH (NOLOCK)
                                                      ON MRSession.ManifestID = ManifestHistory.InstanceID
                                                         AND MRSession.StartDateTime &lt; MR.StartDateTime
                                             WHERE    ManifestHistoryStop.ClientAccountID = RM.CustomerID
                                             ORDER BY ManifestHistoryStopStatus.InstanceNumber DESC) AS MSSP</td>
        <td>610</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM
INNER JOIN
MRSession AS MR WITH (NOLOCK)
ON MR.InstanceID = @MRSessionID OUTER APPLY (SELECT   TOP 1 ManifestHistory.InstanceID AS ManifestID,
                                                            ManifestHistoryInvoiceStatus.EntryDateTime,
                                                            ManifestHistoryInvoiceStatus.EventLatitude,
                                                            ManifestHistoryInvoiceStatus.EventLongitude
                                             FROM     ManifestHistoryInvoiceStatus WITH (NOLOCK)
                                                      INNER JOIN
                                                      ManifestHistoryInvoice WITH (NOLOCK)
                                                      ON ManifestHistoryInvoice.InstanceID = ManifestHistoryInvoiceStatus.ManifestHistoryInvoiceID
                                                      INNER JOIN
                                                      ManifestHistory WITH (NOLOCK)
                                                      ON ManifestHistory.InstanceID = ManifestHistoryInvoice.ManifestID
                                                      INNER JOIN
                                                      Invoice WITH (NOLOCK)
                                                      ON Invoice.InstanceID = ManifestHistoryInvoice.InvoiceID
                                                         AND Invoice.ClientAccountID = RM.CustomerID
                                                      INNER JOIN
                                                      MRSession WITH (NOLOCK)
                                                      ON MRSession.ManifestID = ManifestHistory.InstanceID
                                                         AND MRSession.StartDateTime &lt; @MRSessionDate
                                             WHERE    ManifestHistoryInvoiceStatus.OrderStatusID = 1
                                             ORDER BY ManifestHistoryInvoiceStatus.InstanceNumber DESC) AS MISP</td>
        <td>628</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">#RouteManifest AS RM
INNER JOIN
MRSession AS MR WITH (NOLOCK)
ON MR.InstanceID = @MRSessionID
INNER JOIN
ManifestHistoryStopStatus AS MSS WITH (NOLOCK)
ON MSS.ManifestHistoryStopID = RM.StopRecordID OUTER APPLY (SELECT   TOP 1 ManifestHistoryStop.StopNumber,
                                                                           ManifestHistoryStopStatus.InstanceID,
                                                                           ManifestHistoryStopStatus.EntryDateTime,
                                                                           ManifestHistoryStopStatus.EventLatitude,
                                                                           ManifestHistoryStopStatus.EventLongitude
                                                            FROM     ManifestHistoryStop WITH (NOLOCK)
                                                                     INNER JOIN
                                                                     ManifestHistoryStopStatus WITH (NOLOCK)
                                                                     ON ManifestHistoryStopStatus.ManifestHistoryStopID = ManifestHistoryStop.InstanceID
                                                                        AND ManifestHistoryStopStatus.InstanceNumber &lt; MSS.InstanceNumber
                                                                        AND ManifestHistoryStopStatus.VisitStatusID = 1
                                                            WHERE    MSS.InstanceNumber IS NOT NULL
                                                                     AND ManifestHistoryStop.ManifestID = @ManifestID
                                                            ORDER BY ManifestHistoryStopStatus.InstanceNumber DESC) AS MSLS</td>
        <td>648</td>
      </tr>
      <tr valign="top">
        <td colspan="1">Table-valued functions</td>
        <td colspan="1">dbo.GetRouteInstructions(CA.InstanceID, RM.AddressTypeID, 1) AS RI</td>
        <td>504</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">LIKE</td>
        <td colspan="1">RM.TenderInfo LIKE '%SOF%'</td>
        <td>672</td>
      </tr>
      <tr valign="top">
        <td colspan="1">*</td>
        <td colspan="1">SELECT   *
FROM     #RouteManifest
ORDER BY ID</td>
        <td>713</td>
      </tr>
    </table>
  </body>
</html>