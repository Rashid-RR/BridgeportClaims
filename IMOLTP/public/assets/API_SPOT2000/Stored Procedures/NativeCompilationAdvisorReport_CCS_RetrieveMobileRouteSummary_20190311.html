<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <title>Native Compilation Advisor evaluation results for [API_SPOT2000].[CCS_RetrieveMobileRouteSummary]</title>
  </head>
  <body>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 14pt;">
      <b>Native Compilation Advisor evaluation results for [API_SPOT2000].[CCS_RetrieveMobileRouteSummary]</b>
    </p>
    <p STYLE="font-family: Verdana, Arial, sans-serif; font-size: 10pt;">
      <b>Report Date/Time:</b>3/11/2019 10:30 AM<br /></p>
    <table border="1" cellpadding="5" cellspacing="0" STYLE="font-family: Verdana, Arial, sans-serif; font-size: 9pt;">
      <tr style="background-color:Silver">
        <th colspan="1" align="center">Transact-SQL Element</th>
        <th align="center">Transact-SQL Code</th>
        <th align="center">Line Number</th>
      </tr>
      <tr valign="top">
        <td colspan="1">SET OPTION ON</td>
        <td colspan="1">SET NOCOUNT ON</td>
        <td>2</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1">One-part names</td>
        <td colspan="1">MRSession WITH (NOLOCK)</td>
        <td>15</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MRSession WITH (NOLOCK)</td>
        <td>23</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">[Route]</td>
        <td>34</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">MRSession AS MR WITH (NOLOCK)</td>
        <td>72</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">[Route] WITH (NOLOCK)</td>
        <td>73</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistory AS MH WITH (NOLOCK)</td>
        <td>74</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ESM_SPAccountNode AS SPAN WITH (NOLOCK)</td>
        <td>75</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Setting AS Vehicle WITH (NOLOCK)</td>
        <td>76</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ESM_SPAccountNodeAddress AS SPADDR WITH (NOLOCK)</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Setting AS DN WITH (NOLOCK)</td>
        <td>78</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">Setting AS DP WITH (NOLOCK)</td>
        <td>79</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Setting AS DE WITH (NOLOCK)</td>
        <td>80</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStop AS MS WITH (NOLOCK)</td>
        <td>91</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryStopStatus AS MSS WITH (NOLOCK)</td>
        <td>92</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryInvoice AS MO WITH (NOLOCK)</td>
        <td>100</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">Invoice AS Inv WITH (NOLOCK)</td>
        <td>101</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">ManifestHistoryInvoiceStatus AS MOS WITH (NOLOCK)</td>
        <td>102</td>
      </tr>
      <tr valign="top">
        <td colspan="1">NOLOCK</td>
        <td colspan="1">NOLOCK</td>
        <td>15</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>23</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>72</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>73</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>74</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>75</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>76</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>77</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>78</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>79</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>80</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>91</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>92</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>100</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>101</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">NOLOCK</td>
        <td>102</td>
      </tr>
      <tr valign="top">
        <td colspan="1">APPLY</td>
        <td colspan="1">MRSession AS MR WITH (NOLOCK)
INNER JOIN
[Route] WITH (NOLOCK)
ON [Route].InstanceID = MR.RouteID
INNER JOIN
ManifestHistory AS MH WITH (NOLOCK)
ON MH.InstanceID = MR.ManifestID
INNER JOIN
ESM_SPAccountNode AS SPAN WITH (NOLOCK)
ON SPAN.InstanceID = MH.SPAccountNodeID
INNER JOIN
Setting AS Vehicle WITH (NOLOCK)
ON Vehicle.InstanceID = MR.VehicleID
LEFT OUTER JOIN
ESM_SPAccountNodeAddress AS SPADDR WITH (NOLOCK)
ON SPADDR.SPAccountNodeID = SPAN.InstanceID
   AND SPADDR.AddressTypeID = 216
LEFT OUTER JOIN
Setting AS DN WITH (NOLOCK)
ON DN.ParentID = MH.PrimaryDriverID
   AND DN.Name = 'Driver Display Name'
LEFT OUTER JOIN
Setting AS DP WITH (NOLOCK)
ON DP.ParentID = MH.PrimaryDriverID
   AND DP.Name = 'Driver Phone Number'
LEFT OUTER JOIN
Setting AS DE WITH (NOLOCK)
ON DE.ParentID = MH.PrimaryDriverID
   AND DE.Name = 'Driver Email Address' OUTER APPLY (SELECT Sum(CASE WHEN MS.SubStopOrdinal = 1 THEN 1 ELSE 0 END) AS StopsTotal,
                                                            Sum(CASE WHEN MS.SubStopOrdinal = 1
                                                                          AND IsNull(MSS.VisitStatusID, 0) = 1 THEN 1 ELSE 0 END) AS StopsVisited,
                                                            Sum(CASE WHEN MS.SubStopOrdinal = 1
                                                                          AND IsNull(MSS.VisitStatusID, 0) = 2 THEN 1 ELSE 0 END) AS StopsDNV,
                                                            Sum(CASE WHEN MS.SubStopOrdinal = 1
                                                                          AND IsNull(MSS.VisitStatusID, 0) = 0
                                                                          AND dbo.RouteGetStopEndingTime(@RouteStartDateTime, MS.TimeRange, MS.ETAOffsetSeconds) &lt; @EvalDateTime THEN 1 ELSE 0 END) AS StopsLate,
                                                            Count(*) AS CustomersTotal,
                                                            Sum(CASE WHEN IsNull(MSS.VisitStatusID, 0) = 1 THEN 1 ELSE 0 END) AS CustomersVisited,
                                                            Sum(CASE WHEN IsNull(MSS.VisitStatusID, 0) = 2 THEN 1 ELSE 0 END) AS CustomersDNV,
                                                            Sum(CASE WHEN IsNull(MSS.VisitStatusID, 0) = 0
                                                                          AND dbo.RouteGetStopEndingTime(@RouteStartDateTime, MS.TimeRange, MS.ETAOffsetSeconds) &lt; @EvalDateTime THEN 1 ELSE 0 END) AS CustomersLate,
                                                            Sum(IsNull(MSS.BagsQuantity, 0)) AS BagsCollected
                                                     FROM   ManifestHistoryStop AS MS WITH (NOLOCK)
                                                            LEFT OUTER JOIN
                                                            ManifestHistoryStopStatus AS MSS WITH (NOLOCK)
                                                            ON MSS.ManifestHistoryStopID = MS.InstanceID
                                                     WHERE  MS.ManifestID = MH.InstanceID
                                                            AND MS.ClientAccountID &lt;&gt; 'D796891E-02F2-4803-999A-1AD0BF9BE58B') AS Stops OUTER APPLY (SELECT Sum(CASE WHEN IsNull(MOS.OnTruck, 0) &lt;&gt; 0 THEN 1 WHEN IsNull(MOS.OrderStatusID, 0) = 1 THEN 1 WHEN IsNull(MO.DelayedFlag, 0) = 0 THEN 1 ELSE 0 END) AS OrdersTotal,
                                                                                                                                                           Sum(CASE WHEN IsNull(MOS.OrderStatusID, 0) = 1 THEN 1 ELSE 0 END) AS OrdersDelivered,
                                                                                                                                                           Sum(CASE WHEN IsNull(MOS.OrderStatusID, 0) = 2
                                                                                                                                                                         AND IsNull(MO.DelayedFlag, 0) = 0 THEN 1 ELSE 0 END) AS OrdersNotDeliverable
                                                                                                                                                    FROM   ManifestHistoryInvoice AS MO WITH (NOLOCK)
                                                                                                                                                           INNER JOIN
                                                                                                                                                           Invoice AS Inv WITH (NOLOCK)
                                                                                                                                                           ON Inv.InstanceID = MO.InvoiceID
                                                                                                                                                           LEFT OUTER JOIN
                                                                                                                                                           ManifestHistoryInvoiceStatus AS MOS WITH (NOLOCK)
                                                                                                                                                           ON MOS.ManifestHistoryInvoiceID = MO.InstanceID
                                                                                                                                                    WHERE  MO.ManifestID = MH.InstanceID) AS Orders</td>
        <td>72</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">MRSession AS MR WITH (NOLOCK)
INNER JOIN
[Route] WITH (NOLOCK)
ON [Route].InstanceID = MR.RouteID
INNER JOIN
ManifestHistory AS MH WITH (NOLOCK)
ON MH.InstanceID = MR.ManifestID
INNER JOIN
ESM_SPAccountNode AS SPAN WITH (NOLOCK)
ON SPAN.InstanceID = MH.SPAccountNodeID
INNER JOIN
Setting AS Vehicle WITH (NOLOCK)
ON Vehicle.InstanceID = MR.VehicleID
LEFT OUTER JOIN
ESM_SPAccountNodeAddress AS SPADDR WITH (NOLOCK)
ON SPADDR.SPAccountNodeID = SPAN.InstanceID
   AND SPADDR.AddressTypeID = 216
LEFT OUTER JOIN
Setting AS DN WITH (NOLOCK)
ON DN.ParentID = MH.PrimaryDriverID
   AND DN.Name = 'Driver Display Name'
LEFT OUTER JOIN
Setting AS DP WITH (NOLOCK)
ON DP.ParentID = MH.PrimaryDriverID
   AND DP.Name = 'Driver Phone Number'
LEFT OUTER JOIN
Setting AS DE WITH (NOLOCK)
ON DE.ParentID = MH.PrimaryDriverID
   AND DE.Name = 'Driver Email Address' OUTER APPLY (SELECT Sum(CASE WHEN MS.SubStopOrdinal = 1 THEN 1 ELSE 0 END) AS StopsTotal,
                                                            Sum(CASE WHEN MS.SubStopOrdinal = 1
                                                                          AND IsNull(MSS.VisitStatusID, 0) = 1 THEN 1 ELSE 0 END) AS StopsVisited,
                                                            Sum(CASE WHEN MS.SubStopOrdinal = 1
                                                                          AND IsNull(MSS.VisitStatusID, 0) = 2 THEN 1 ELSE 0 END) AS StopsDNV,
                                                            Sum(CASE WHEN MS.SubStopOrdinal = 1
                                                                          AND IsNull(MSS.VisitStatusID, 0) = 0
                                                                          AND dbo.RouteGetStopEndingTime(@RouteStartDateTime, MS.TimeRange, MS.ETAOffsetSeconds) &lt; @EvalDateTime THEN 1 ELSE 0 END) AS StopsLate,
                                                            Count(*) AS CustomersTotal,
                                                            Sum(CASE WHEN IsNull(MSS.VisitStatusID, 0) = 1 THEN 1 ELSE 0 END) AS CustomersVisited,
                                                            Sum(CASE WHEN IsNull(MSS.VisitStatusID, 0) = 2 THEN 1 ELSE 0 END) AS CustomersDNV,
                                                            Sum(CASE WHEN IsNull(MSS.VisitStatusID, 0) = 0
                                                                          AND dbo.RouteGetStopEndingTime(@RouteStartDateTime, MS.TimeRange, MS.ETAOffsetSeconds) &lt; @EvalDateTime THEN 1 ELSE 0 END) AS CustomersLate,
                                                            Sum(IsNull(MSS.BagsQuantity, 0)) AS BagsCollected
                                                     FROM   ManifestHistoryStop AS MS WITH (NOLOCK)
                                                            LEFT OUTER JOIN
                                                            ManifestHistoryStopStatus AS MSS WITH (NOLOCK)
                                                            ON MSS.ManifestHistoryStopID = MS.InstanceID
                                                     WHERE  MS.ManifestID = MH.InstanceID
                                                            AND MS.ClientAccountID &lt;&gt; 'D796891E-02F2-4803-999A-1AD0BF9BE58B') AS Stops</td>
        <td>72</td>
      </tr>
      <tr valign="top">
        <td colspan="1">CASE</td>
        <td colspan="1">CASE WHEN MS.SubStopOrdinal = 1 THEN 1 ELSE 0 END</td>
        <td>82</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN MS.SubStopOrdinal = 1
          AND IsNull(MSS.VisitStatusID, 0) = 1 THEN 1 ELSE 0 END</td>
        <td>83</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN MS.SubStopOrdinal = 1
          AND IsNull(MSS.VisitStatusID, 0) = 2 THEN 1 ELSE 0 END</td>
        <td>84</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN MS.SubStopOrdinal = 1
          AND IsNull(MSS.VisitStatusID, 0) = 0
          AND dbo.RouteGetStopEndingTime(@RouteStartDateTime, MS.TimeRange, MS.ETAOffsetSeconds) &lt; @EvalDateTime THEN 1 ELSE 0 END</td>
        <td>85</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 1 THEN 1 ELSE 0 END</td>
        <td>87</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 2 THEN 1 ELSE 0 END</td>
        <td>88</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MSS.VisitStatusID, 0) = 0
          AND dbo.RouteGetStopEndingTime(@RouteStartDateTime, MS.TimeRange, MS.ETAOffsetSeconds) &lt; @EvalDateTime THEN 1 ELSE 0 END</td>
        <td>89</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MOS.OnTruck, 0) &lt;&gt; 0 THEN 1 WHEN IsNull(MOS.OrderStatusID, 0) = 1 THEN 1 WHEN IsNull(MO.DelayedFlag, 0) = 0 THEN 1 ELSE 0 END</td>
        <td>97</td>
      </tr>
      <tr valign="top">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MOS.OrderStatusID, 0) = 1 THEN 1 ELSE 0 END</td>
        <td>98</td>
      </tr>
      <tr valign="top" style="background-color:LightYellow">
        <td colspan="1"></td>
        <td colspan="1">CASE WHEN IsNull(MOS.OrderStatusID, 0) = 2
          AND IsNull(MO.DelayedFlag, 0) = 0 THEN 1 ELSE 0 END</td>
        <td>99</td>
      </tr>
    </table>
  </body>
</html>